# PixelPunk 部署管理系统

## 🚀 快速开始

```bash
make deploy
```

或直接运行：

```bash
./deploy.sh
```

## 🎮 操作说明

- **↑↓** 方向键 - 上下选择菜单项
- **Enter** - 确认选择
- **q** - 退出或返回上级菜单

## 📋 功能特性

### 环境管理

- **测试环境**: dev.pixelpunk.cc
- **生产环境**: v1.pixelpunk.cc
- 每个环境独立的配置和日志

### 构建选项

- **完整构建**: 重新构建前端和后端
- **快速构建**: 仅构建后端（前端无改动时使用）

### 后端版本

- **WebP版本**: 支持图片自动压缩，适合生产环境 [推荐]
- **标准版本**: 构建快速，适合开发测试

### 服务管理

- 查看服务状态
- 查看日志（可自定义行数，默认100行）
- 重启服务
- 一键部署

## 📁 项目结构

```
deploy/
├── deploy-arrow.sh    # 主部署脚本（方向键交互）
├── service.sh         # 服务管理脚本（自动上传到服务器）
└── README.md          # 本文档

scripts/
├── build-webp-offline.sh  # WebP离线构建脚本
└── deploy-qdrant.sh       # Qdrant独立部署脚本（使用 make deploy-qdrant）

deploy.sh              # 根目录启动脚本
```

## 🌟 WebP支持说明

### 标准版本 vs WebP版本

| 特性       | WebP版本 | 标准版本 |
| ---------- | -------- | -------- |
| 构建速度   | 较慢     | 很快     |
| WebP压缩   | ✅       | ❌       |
| Docker依赖 | ✅       | ❌       |
| 适用场景   | 生产环境 | 开发测试 |

### WebP版本构建要求

1. **Docker环境**
   - Mac: Docker Desktop 或 OrbStack
   - Linux: Docker Engine

2. **Docker镜像**（首次需要下载）
   - golang:1.23 (编译环境)
   - ubuntu:22.04 (运行环境)

3. **离线构建**
   - 镜像下载后可完全离线构建
   - 不需要访问Docker Hub

## 🔧 使用流程

### 1. 选择环境

```
▶ 🧪 测试环境 (dev.pixelpunk.cc)
  🌐 生产环境 (v1.pixelpunk.cc)
```

### 2. 选择操作

```
▶ 🚀 部署应用
  📊 查看服务状态
  📝 查看日志
  🔄 重启服务
```

### 3. 选择构建方式

```
▶ 📦 完整构建（前端 + 后端）
  ⚡ 快速构建（仅后端）
```

### 4. 选择后端版本

```
▶ 🖼️ WebP版本（支持图片压缩）[推荐]
  ⚡ 标准版本（快速构建）
```

## 📊 日志查看

- 默认显示最近100行
- 可以自定义行数
- 直接按Enter使用默认值

## 🔐 配置文件

- **测试环境**: config.dev.yaml
- **生产环境**: config.prod.yaml
- 部署时自动上传对应配置

## 🛠️ 故障排查

### Docker相关

- 如果选择WebP版本但Docker未运行，会提示启动Docker
- 如果缺少镜像，会提供下载选项
- 网络问题时可以使用标准版本

### 部署失败

- 检查SSH连接是否正常
- 确认服务器端口未被占用
- 查看服务日志了解详细错误

## 📝 维护建议

1. **开发环境**: 使用标准版本快速迭代
2. **生产环境**: 使用WebP版本优化存储
3. **定期备份**: 数据库和uploads目录
4. **监控日志**: 定期查看服务状态和日志

## 🔄 更新历史

### v5.0 (当前版本)

- 方向键交互界面
- 智能Docker镜像检测
- 可自定义日志行数
- 简化构建选项
