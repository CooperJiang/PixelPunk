import{j as useTexts,Z as StorageUtil,$ as TOKEN_KEY,q as useToast,_ as _export_sfc}from"./index-4d0dab4c.js";import{d as defineComponent,r as ref,c as computed,I as createElementBlock,a0 as createBaseVNode,ab as createTextVNode,a1 as toDisplayString,u as unref,K as createCommentVNode,A as createBlock,L as withCtx,f as createVNode,E as resolveComponent,z as openBlock,F as Fragment,M as renderList}from"./vue-vendor-31320f47.js";import{c as createShare}from"./index-8277663f.js";import{c as copyToClipboard}from"./clipboard-b54d9428.js";const _hoisted_1$1={class:"share-controls"},_hoisted_2$1={key:0,class:"selection-info"},_hoisted_3$1={key:0,class:"selection-count folder-count"},_hoisted_4$1={key:1,class:"selection-count image-count"},_hoisted_5$1={key:2,class:"select-mode-controls"},_sfc_main$1=defineComponent({name:"ShareButton",__name:"ShareButton",props:{folders:{},images:{},requireLogin:{type:Boolean}},emits:["update:selectMode","update:shareDialogVisible"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),selectMode=ref(!1),selectedFolders=ref([]),selectedImages=ref([]),startSelectMode=()=>{if(props.requireLogin&&!StorageUtil.get(TOKEN_KEY)){toast.warning($t("components.share.messages.loginRequired"));return}selectMode.value=!0,emit("update:selectMode",!0),selectedFolders.value=[],selectedImages.value=[]},cancelSelectMode=()=>{selectMode.value=!1,emit("update:selectMode",!1),selectedFolders.value=[],selectedImages.value=[]},isFolderSelected=folder=>selectedFolders.value.some(f=>f.id===folder.id),isImageSelected=image=>selectedImages.value.some(img=>img.id===image.id),toggleFolderSelect=folder=>{if(props.requireLogin&&!StorageUtil.get(TOKEN_KEY)){toast.warning($t("components.share.messages.loginRequired"));return}const index=selectedFolders.value.findIndex(f=>f.id===folder.id);index===-1?selectedFolders.value.push(folder):selectedFolders.value.splice(index,1)},toggleImageSelect=image=>{if(props.requireLogin&&!StorageUtil.get(TOKEN_KEY)){toast.warning($t("components.share.messages.loginRequired"));return}const index=selectedImages.value.findIndex(img=>img.id===image.id);index===-1?selectedImages.value.push(image):selectedImages.value.splice(index,1)},openShareDialog=()=>{selectedFolders.value.length>0||selectedImages.value.length>0?emit("update:shareDialogVisible",!0):toast.info($t("components.share.messages.noItemsSelected"))},handleShareCreated=_share=>{cancelSelectMode(),emit("update:shareDialogVisible",!1)},toggleSelectAllFolders=folders=>{if(!folders||folders.length===0)return;folders.every(folder=>isFolderSelected(folder))?selectedFolders.value=[]:selectedFolders.value=[...folders]},invertFolderSelection=folders=>{if(!folders||folders.length===0)return;const currentlySelected=selectedFolders.value.map(f=>f.id);selectedFolders.value=folders.filter(folder=>!currentlySelected.includes(folder.id))},toggleSelectAllImages=images=>{if(!images||images.length===0)return;images.every(image=>isImageSelected(image))?selectedImages.value=[]:selectedImages.value=[...images]},invertImageSelection=images=>{if(!images||images.length===0)return;const currentlySelected=selectedImages.value.map(img=>img.id);selectedImages.value=images.filter(image=>!currentlySelected.includes(image.id))},isAllFoldersSelected=computed(()=>!props.folders||props.folders.length===0?!1:props.folders.every(folder=>isFolderSelected(folder)));return __expose({selectMode,selectedFolders,selectedImages,selectedFiles:selectedImages,isFolderSelected,isImageSelected,isFileSelected:isImageSelected,toggleFolderSelect,toggleImageSelect,toggleFileSelect:toggleImageSelect,cancelSelectMode,toggleSelectAllFolders,toggleSelectAllImages,invertFolderSelection,invertImageSelection,isAllFoldersSelected,handleShareCreated}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$1,[selectMode.value?(openBlock(),createElementBlock("div",_hoisted_2$1,[selectedFolders.value.length>0?(openBlock(),createElementBlock("span",_hoisted_3$1,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-folder"},null,-1)),createTextVNode(" "+toDisplayString(selectedFolders.value.length)+toDisplayString(unref($t)("components.share.selectionInfo.folders")),1)])):createCommentVNode("",!0),selectedImages.value.length>0?(openBlock(),createElementBlock("span",_hoisted_4$1,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-image"},null,-1)),createTextVNode(" "+toDisplayString(selectedImages.value.length)+toDisplayString(unref($t)("components.share.selectionInfo.images")),1)])):createCommentVNode("",!0)])):createCommentVNode("",!0),selectMode.value?(openBlock(),createElementBlock("div",_hoisted_5$1,[createVNode(_component_CyberButton,{type:"primary",icon:"share-alt",disabled:selectedFolders.value.length===0&&selectedImages.value.length===0,onClick:openShareDialog},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("components.share.shareSelected"))+"("+toDisplayString(selectedFolders.value.length+selectedImages.value.length)+") ",1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{type:"outlined",icon:"times",onClick:cancelSelectMode},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("components.share.cancel")),1)]),_:1})])):(openBlock(),createBlock(_component_CyberButton,{key:1,type:"outlined",icon:"share-alt",onClick:startSelectMode},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("components.share.createShare")),1)]),_:1}))])}}});const ShareButton=_export_sfc(_sfc_main$1,[["__scopeId","data-v-dc55d508"]]),_hoisted_1={class:"create-share-dialog"},_hoisted_2={class:"share-form"},_hoisted_3={class:"form-section"},_hoisted_4={class:"section-title"},_hoisted_5={class:"form-row"},_hoisted_6={class:"form-row"},_hoisted_7={class:"form-section"},_hoisted_8={class:"section-title"},_hoisted_9={class:"form-row"},_hoisted_10={class:"form-row"},_hoisted_11={class:"form-row"},_hoisted_12={class:"form-section"},_hoisted_13={class:"section-title"},_hoisted_14={class:"form-row"},_hoisted_15={class:"input-wrapper"},_hoisted_16={class:"input-tip"},_hoisted_17={class:"form-row"},_hoisted_18={class:"input-wrapper"},_hoisted_19={class:"input-tip"},_hoisted_20={key:0,class:"form-row notification-threshold-row"},_hoisted_21={class:"input-wrapper"},_hoisted_22={class:"input-tip"},_hoisted_23={class:"form-section"},_hoisted_24={class:"section-title"},_hoisted_25={class:"share-items"},_hoisted_26={key:0,class:"empty-items"},_hoisted_27={key:1,class:"item-list"},_hoisted_28={class:"item-name"},_hoisted_29=["onClick"],_hoisted_30={class:"item-name"},_hoisted_31=["onClick"],_hoisted_32={class:"dialog-footer p-4"},_sfc_main=defineComponent({__name:"CreateShareDialog",props:{modelValue:{type:Boolean,default:!1},selectedFolders:{type:Array,default:()=>[]},selectedImages:{type:Array,default:()=>[]}},emits:["update:modelValue","created","update:selectedFolders","update:selectedImages"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,toast=useToast(),visible=computed({get:()=>props.modelValue,set:value=>emit("update:modelValue",value)}),formData=ref({name:"",description:"",password:"",expired_days:7,max_views:0,items:[],collect_visitor_info:!1,notification_on_access:!1,notification_threshold:100}),submitting=ref(!1),isSubmitDisabled=computed(()=>props.selectedFolders.length===0&&props.selectedImages.length===0||submitting.value),handleClose=()=>{visible.value=!1},removeFolder=folder=>{const index=props.selectedFolders.findIndex(f=>f.id===folder.id);if(index!==-1){const updatedFolders=[...props.selectedFolders];updatedFolders.splice(index,1),emit("update:selectedFolders",updatedFolders)}},removeImage=image=>{const index=props.selectedImages.findIndex(img=>img.id===image.id);if(index!==-1){const updatedImages=[...props.selectedImages];updatedImages.splice(index,1),emit("update:selectedImages",updatedImages)}},handleSubmit=async()=>{submitting.value=!0;const items=[...props.selectedFolders.map(folder=>({item_type:"folder",item_id:folder.id})),...props.selectedImages.map(image=>({item_type:"file",item_id:image.id}))];formData.value.items=items;try{const result=await createShare(formData.value);if(result.success&&result.data){toast.success($t("folders.share.createSuccess"));try{await copyToClipboard(result.data.share_url),toast.success($t("folders.share.createSuccessWithCopy"))}catch(error){console.error("Failed to copy to clipboard:",error),toast.info($t("folders.share.manualCopy"))}visible.value=!1,emit("created",result.data)}}catch(error){toast.error(error.message)}submitting.value=!1};return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberSwitch=resolveComponent("CyberSwitch"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>visible.value=$event),title:unref($t)("folders.createShareDialog.title"),width:"500px","append-to-body":!0,onClose:handleClose},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_32,[createVNode(_component_CyberButton,{type:"outlined",onClick:handleClose},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.createShareDialog.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",disabled:isSubmitDisabled.value,loading:submitting.value,onClick:handleSubmit},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.createShareDialog.submit")),1)]),_:1},8,["disabled","loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("h3",_hoisted_4,toDisplayString(unref($t)("folders.createShareDialog.sections.basic")),1),createBaseVNode("div",_hoisted_5,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.name.label")),1),createVNode(_component_CyberInput,{modelValue:formData.value.name,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.value.name=$event),placeholder:unref($t)("folders.createShareDialog.form.name.placeholder")},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_6,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.share.description")),1),createVNode(_component_CyberInput,{modelValue:formData.value.description,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>formData.value.description=$event),placeholder:unref($t)("folders.createShareDialog.form.description.placeholder"),type:"textarea",maxlength:200,"show-word-limit":!0,rows:2},null,8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_7,[createBaseVNode("h3",_hoisted_8,toDisplayString(unref($t)("folders.createShareDialog.sections.access")),1),createBaseVNode("div",_hoisted_9,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.password.label")),1),createVNode(_component_CyberInput,{modelValue:formData.value.password,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.value.password=$event),placeholder:unref($t)("folders.createShareDialog.form.password.placeholder"),type:"password"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_10,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.expiredDays.label")),1),createVNode(_component_CyberInput,{modelValue:formData.value.expired_days,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>formData.value.expired_days=$event),modelModifiers:{number:!0},placeholder:unref($t)("folders.createShareDialog.form.expiredDays.placeholder"),type:"number",min:"0"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_11,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.maxViews.label")),1),createVNode(_component_CyberInput,{modelValue:formData.value.max_views,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>formData.value.max_views=$event),modelModifiers:{number:!0},placeholder:unref($t)("folders.createShareDialog.form.maxViews.placeholder"),type:"number",min:"0"},null,8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_12,[createBaseVNode("h3",_hoisted_13,toDisplayString(unref($t)("folders.createShareDialog.sections.advanced")),1),createBaseVNode("div",_hoisted_14,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.collectVisitor.label")),1),createBaseVNode("div",_hoisted_15,[createVNode(_component_CyberSwitch,{modelValue:formData.value.collect_visitor_info,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>formData.value.collect_visitor_info=$event)},null,8,["modelValue"]),createBaseVNode("div",_hoisted_16,toDisplayString(unref($t)("folders.createShareDialog.form.collectVisitor.tip")),1)])]),createBaseVNode("div",_hoisted_17,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.notification.label")),1),createBaseVNode("div",_hoisted_18,[createVNode(_component_CyberSwitch,{modelValue:formData.value.notification_on_access,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>formData.value.notification_on_access=$event)},null,8,["modelValue"]),createBaseVNode("div",_hoisted_19,toDisplayString(unref($t)("folders.createShareDialog.form.notification.tip")),1)])]),formData.value.notification_on_access?(openBlock(),createElementBlock("div",_hoisted_20,[createBaseVNode("label",null,toDisplayString(unref($t)("folders.createShareDialog.form.notificationThreshold.label")),1),createBaseVNode("div",_hoisted_21,[createVNode(_component_CyberInput,{modelValue:formData.value.notification_threshold,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>formData.value.notification_threshold=$event),modelModifiers:{number:!0},placeholder:unref($t)("folders.createShareDialog.form.notificationThreshold.placeholder"),type:"number",min:"1"},null,8,["modelValue","placeholder"]),createBaseVNode("div",_hoisted_22,toDisplayString(unref($t)("folders.createShareDialog.form.notificationThreshold.tip")),1)])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_23,[createBaseVNode("h3",_hoisted_24,toDisplayString(unref($t)("folders.createShareDialog.sections.content")),1),createBaseVNode("div",_hoisted_25,[__props.selectedFolders.length===0&&__props.selectedImages.length===0?(openBlock(),createElementBlock("div",_hoisted_26,toDisplayString(unref($t)("folders.createShareDialog.emptyItems")),1)):(openBlock(),createElementBlock("div",_hoisted_27,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.selectedFolders,folder=>(openBlock(),createElementBlock("div",{key:`folder-${folder.id}`,class:"share-item"},[_cache[10]||(_cache[10]=createBaseVNode("div",{class:"item-icon"},[createBaseVNode("i",{class:"fas fa-folder"})],-1)),createBaseVNode("div",_hoisted_28,toDisplayString(folder.name),1),createBaseVNode("button",{class:"remove-btn",onClick:$event=>removeFolder(folder)},[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])],8,_hoisted_29)]))),128)),(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.selectedImages,image=>(openBlock(),createElementBlock("div",{key:`image-${image.id}`,class:"share-item"},[_cache[12]||(_cache[12]=createBaseVNode("div",{class:"item-icon"},[createBaseVNode("i",{class:"fas fa-image"})],-1)),createBaseVNode("div",_hoisted_30,toDisplayString(image.display_name||image.file_name),1),createBaseVNode("button",{class:"remove-btn",onClick:$event=>removeImage(image)},[..._cache[11]||(_cache[11]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])],8,_hoisted_31)]))),128))]))])])])])]),_:1},8,["modelValue","title"])}}});const CreateShareDialog=_export_sfc(_sfc_main,[["__scopeId","data-v-cc281d2f"]]);export{CreateShareDialog as C,ShareButton as S};
