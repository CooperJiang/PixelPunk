import{d as defineComponent,c as computed,r as ref,w as watch,b as onMounted,o as onUnmounted,I as createElementBlock,a0 as createBaseVNode,R as normalizeClass,F as Fragment,M as renderList,K as createCommentVNode,H as withDirectives,a9 as vModelText,aa as withKeys,u as unref,f as createVNode,L as withCtx,a6 as Transition,a1 as toDisplayString,G as resolveDirective,z as openBlock,a5 as withModifiers,ab as createTextVNode,n as nextTick,ac as createStaticVNode}from"./vue-vendor-31320f47.js";import{j as useTexts,e as getGlobalSettings,_ as _export_sfc}from"./index-ac67a30c.js";const _hoisted_1$1={class:"compact-search-bar"},_hoisted_2$1={class:"search-container"},_hoisted_3$1={key:0,class:"mode-selector"},_hoisted_4$1=["title","onClick"],_hoisted_5$1={key:1,class:"separator"},_hoisted_6=["placeholder"],_hoisted_7=["title"],_hoisted_8=["disabled","title"],_hoisted_9={key:0,class:"suggestions-group"},_hoisted_10={class:"group-header"},_hoisted_11=["onClick"],_hoisted_12={key:1,class:"suggestions-group"},_hoisted_13={class:"group-header"},_hoisted_14=["title"],_hoisted_15=["onClick"],_hoisted_16=["title"],_hoisted_17={key:0,class:"filter-badge"},_sfc_main$1=defineComponent({__name:"CompactSearchBar",props:{modelValue:{},searchMode:{},showFilter:{type:Boolean},filterCount:{},isSearching:{type:Boolean}},emits:["update:modelValue","update:searchMode","update:showFilter","search"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),searchModes=computed(()=>[{value:"vector",label:$t("explore.search.mode.ai"),icon:"fas fa-brain",description:$t("explore.search.mode.aiDesc")},{value:"normal",label:$t("explore.search.mode.normal"),icon:"fas fa-search",description:$t("explore.search.mode.normalDesc")}]),keyword=ref(props.modelValue),vectorEnabled=ref(!1),currentSearchMode=ref(props.searchMode||"vector"),isFocused=ref(!1),showSuggestions=ref(!1),searchInput=ref(),searchHistory=ref([]),suggestions=ref([]);let suggestionTimer=null;const currentModePlaceholder=computed(()=>vectorEnabled.value&&currentSearchMode.value==="vector"?$t("explore.search.aiPlaceholder"):$t("explore.search.placeholder"));watch(()=>props.modelValue,newVal=>{keyword.value=newVal}),watch(()=>props.searchMode,newVal=>{newVal&&(currentSearchMode.value=newVal)}),watch(keyword,newVal=>{emit("update:modelValue",newVal)}),watch(currentSearchMode,newVal=>{emit("update:searchMode",newVal),suggestions.value=[]});const switchMode=mode=>{currentSearchMode.value!==mode&&(currentSearchMode.value=mode,nextTick(()=>{searchInput.value?.focus()}))},handleFocus=()=>{isFocused.value=!0,showSuggestions.value=!0,keyword.value.trim()||loadSearchHistory()},handleBlur=()=>{isFocused.value=!1,setTimeout(()=>{showSuggestions.value=!1},150)},handleInput=()=>{suggestionTimer&&clearTimeout(suggestionTimer),suggestionTimer=setTimeout(()=>{getSuggestions()},300)},handleSearch=()=>{const searchKeyword=keyword.value.trim();searchKeyword&&saveSearchHistory(searchKeyword,currentSearchMode.value),emit("search",{keyword:searchKeyword,mode:currentSearchMode.value}),showSuggestions.value=!1,searchInput.value?.blur()},clearSearch=()=>{keyword.value="",suggestions.value=[],searchInput.value?.focus()},selectSuggestion=suggestion=>{keyword.value=suggestion,showSuggestions.value=!1,nextTick(()=>{handleSearch()})},toggleFilter=()=>{emit("update:showFilter",!props.showFilter)},getSuggestions=()=>{const query=keyword.value.trim().toLowerCase();if(!query||query.length<2){suggestions.value=[];return}if(currentSearchMode.value==="vector"){const aiSuggestions=$t("explore.search.suggestions.ai").filter(item=>item.toLowerCase().includes(query));suggestions.value=aiSuggestions}else{const normalSuggestions=["screenshot","photo","image","picture","wallpaper"].filter(item=>item.toLowerCase().includes(query));suggestions.value=normalSuggestions}},loadSearchHistory=()=>{try{const saved=localStorage.getItem("gallery_search_history");if(saved){const parsed=JSON.parse(saved),thirtyDaysAgo=Date.now()-30*24*60*60*1e3;searchHistory.value=parsed.filter(item=>item.timestamp>thirtyDaysAgo).sort((a,b)=>b.timestamp-a.timestamp)}}catch{searchHistory.value=[]}},saveSearchHistory=(searchKeyword,mode)=>{try{const filtered=searchHistory.value.filter(item=>item.keyword!==searchKeyword||item.mode!==mode),updated=[{keyword:searchKeyword,mode,timestamp:Date.now()},...filtered].slice(0,10);searchHistory.value=updated,localStorage.setItem("gallery_search_history",JSON.stringify(updated))}catch{}},clearHistory=()=>{searchHistory.value=[],localStorage.removeItem("gallery_search_history")},fetchGlobalSettings=async()=>{try{const result=await getGlobalSettings();if(result.success&&result.data){const vectorConfig=result.data.vector;vectorConfig&&typeof vectorConfig.vector_enabled=="boolean"&&(vectorEnabled.value=vectorConfig.vector_enabled,vectorEnabled.value?currentSearchMode.value=props.searchMode||"vector":currentSearchMode.value="normal")}}catch{vectorEnabled.value=!1,currentSearchMode.value="normal"}};return onMounted(async()=>{await fetchGlobalSettings(),loadSearchHistory()}),onUnmounted(()=>{suggestionTimer&&clearTimeout(suggestionTimer)}),__expose({focus:()=>searchInput.value?.focus(),clear:clearSearch}),(_ctx,_cache)=>{const _directive_loading=resolveDirective("loading");return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",{class:normalizeClass(["search-input-wrapper",{focused:isFocused.value,loading:__props.isSearching}])},[vectorEnabled.value?(openBlock(),createElementBlock("div",_hoisted_3$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(searchModes.value,mode=>(openBlock(),createElementBlock("button",{key:mode.value,class:normalizeClass(["mode-btn",{active:currentSearchMode.value===mode.value}]),title:mode.description,onClick:$event=>switchMode(mode.value)},[createBaseVNode("i",{class:normalizeClass(mode.icon)},null,2)],10,_hoisted_4$1))),128))])):createCommentVNode("",!0),vectorEnabled.value?(openBlock(),createElementBlock("div",_hoisted_5$1)):createCommentVNode("",!0),withDirectives(createBaseVNode("input",{ref_key:"searchInput",ref:searchInput,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>keyword.value=$event),type:"text",class:"search-input",placeholder:currentModePlaceholder.value,onFocus:handleFocus,onBlur:handleBlur,onKeyup:withKeys(handleSearch,["enter"]),onInput:handleInput},null,40,_hoisted_6),[[vModelText,keyword.value]]),keyword.value?(openBlock(),createElementBlock("button",{key:2,class:"clear-btn",title:unref($t)("explore.search.clear"),onClick:clearSearch},[..._cache[2]||(_cache[2]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])],8,_hoisted_7)):createCommentVNode("",!0),withDirectives((openBlock(),createElementBlock("button",{class:"search-btn",disabled:__props.isSearching,title:`${currentSearchMode.value==="vector"?unref($t)("explore.search.mode.ai"):unref($t)("explore.search.mode.normalText")}`,onClick:handleSearch},[..._cache[3]||(_cache[3]=[createBaseVNode("i",{class:"fas fa-search"},null,-1)])],8,_hoisted_8)),[[_directive_loading,__props.isSearching]])],2),createVNode(Transition,{name:"suggestions-fade"},{default:withCtx(()=>[showSuggestions.value&&(suggestions.value.length>0||searchHistory.value.length>0)?(openBlock(),createElementBlock("div",{key:0,class:"search-suggestions",onClick:_cache[1]||(_cache[1]=withModifiers(()=>{},["stop"]))},[suggestions.value.length>0?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,toDisplayString(unref($t)("explore.search.suggestions.header")),1),(openBlock(!0),createElementBlock(Fragment,null,renderList(suggestions.value.slice(0,5),(suggestion,index)=>(openBlock(),createElementBlock("div",{key:`suggestion-${index}`,class:"suggestion-item",onClick:$event=>selectSuggestion(suggestion)},[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-search"},null,-1)),createBaseVNode("span",null,toDisplayString(suggestion),1)],8,_hoisted_11))),128))])):createCommentVNode("",!0),searchHistory.value.length>0&&!keyword.value.trim()?(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createTextVNode(toDisplayString(unref($t)("explore.search.history.title"))+" ",1),createBaseVNode("button",{class:"clear-history",title:unref($t)("actions.clear"),onClick:clearHistory},[..._cache[5]||(_cache[5]=[createBaseVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_hoisted_14)]),(openBlock(!0),createElementBlock(Fragment,null,renderList(searchHistory.value.slice(0,3),(item,index)=>(openBlock(),createElementBlock("div",{key:`history-${index}`,class:"suggestion-item history-item",onClick:$event=>selectSuggestion(item.keyword)},[createBaseVNode("i",{class:normalizeClass(item.mode==="vector"?"fas fa-brain":"fas fa-search")},null,2),createBaseVNode("span",null,toDisplayString(item.keyword),1)],8,_hoisted_15))),128))])):createCommentVNode("",!0)])):createCommentVNode("",!0)]),_:1})]),createBaseVNode("button",{class:normalizeClass(["filter-btn",{active:__props.showFilter}]),title:unref($t)("explore.actions.filter"),onClick:toggleFilter},[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-sliders-h"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("explore.actions.filter")),1),__props.filterCount>0?(openBlock(),createElementBlock("span",_hoisted_17,toDisplayString(__props.filterCount),1)):createCommentVNode("",!0)],10,_hoisted_16)])}}});const CompactSearchBar=_export_sfc(_sfc_main$1,[["__scopeId","data-v-85f464a1"]]),_hoisted_1={class:"empty-state-container"},_hoisted_2={class:"empty-content"},_hoisted_3={class:"empty-text-content"},_hoisted_4={class:"empty-title"},_hoisted_5={class:"empty-description"},_sfc_main=defineComponent({__name:"EmptyState",emits:["reset"],setup(__props){return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[_cache[0]||(_cache[0]=createStaticVNode('<div class="empty-bg-decoration" data-v-595dd72c><div class="glow-orb glow-1" data-v-595dd72c></div><div class="glow-orb glow-2" data-v-595dd72c></div><div class="glow-orb glow-3" data-v-595dd72c></div></div><div class="empty-icon-wrapper" data-v-595dd72c><div class="icon-circle" data-v-595dd72c><i class="fas fa-images" data-v-595dd72c></i></div><div class="icon-ring ring-1" data-v-595dd72c></div><div class="icon-ring ring-2" data-v-595dd72c></div><div class="icon-ring ring-3" data-v-595dd72c></div></div>',2)),createBaseVNode("div",_hoisted_3,[createBaseVNode("h3",_hoisted_4,toDisplayString(_ctx.$t("explore.empty.title")),1),createBaseVNode("p",_hoisted_5,toDisplayString(_ctx.$t("explore.empty.description")),1)])])]))}});const EmptyState=_export_sfc(_sfc_main,[["__scopeId","data-v-595dd72c"]]);export{CompactSearchBar as C,EmptyState as E};
