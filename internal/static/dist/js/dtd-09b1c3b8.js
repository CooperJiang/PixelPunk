var type;function ret(style,tp){return type=tp,style}function tokenBase(stream,state){var ch=stream.next();if(ch=="<"&&stream.eat("!")){if(stream.eatWhile(/[\-]/))return state.tokenize=tokenSGMLComment,tokenSGMLComment(stream,state);if(stream.eatWhile(/[\w]/))return ret("keyword","doindent")}else{if(ch=="<"&&stream.eat("?"))return state.tokenize=inBlock("meta","?>"),ret("meta",ch);if(ch=="#"&&stream.eatWhile(/[\w]/))return ret("atom","tag");if(ch=="|")return ret("keyword","separator");if(ch.match(/[\(\)\[\]\-\.,\+\?>]/))return ret(null,ch);if(ch.match(/[\[\]]/))return ret("rule",ch);if(ch=='"'||ch=="'")return state.tokenize=tokenString(ch),state.tokenize(stream,state);if(stream.eatWhile(/[a-zA-Z\?\+\d]/)){var sc=stream.current();return sc.substr(sc.length-1,sc.length).match(/\?|\+/)!==null&&stream.backUp(1),ret("tag","tag")}else return ch=="%"||ch=="*"?ret("number","number"):(stream.eatWhile(/[\w\\\-_%.{,]/),ret(null,null))}}function tokenSGMLComment(stream,state){for(var dashes=0,ch;(ch=stream.next())!=null;){if(dashes>=2&&ch==">"){state.tokenize=tokenBase;break}dashes=ch=="-"?dashes+1:0}return ret("comment","comment")}function tokenString(quote){return function(stream,state){for(var escaped=!1,ch;(ch=stream.next())!=null;){if(ch==quote&&!escaped){state.tokenize=tokenBase;break}escaped=!escaped&&ch=="\\"}return ret("string","tag")}}function inBlock(style,terminator){return function(stream,state){for(;!stream.eol();){if(stream.match(terminator)){state.tokenize=tokenBase;break}stream.next()}return style}}const dtd={name:"dtd",startState:function(){return{tokenize:tokenBase,baseIndent:0,stack:[]}},token:function(stream,state){if(stream.eatSpace())return null;var style=state.tokenize(stream,state),context=state.stack[state.stack.length-1];return stream.current()=="["||type==="doindent"||type=="["?state.stack.push("rule"):type==="endtag"?state.stack[state.stack.length-1]="endtag":stream.current()=="]"||type=="]"||type==">"&&context=="rule"?state.stack.pop():type=="["&&state.stack.push("["),style},indent:function(state,textAfter,cx){var n=state.stack.length;return textAfter.charAt(0)==="]"?n--:textAfter.substr(textAfter.length-1,textAfter.length)===">"&&(textAfter.substr(0,1)==="<"||type=="doindent"&&textAfter.length>1||(type=="doindent"?n--:type==">"&&textAfter.length>1||type=="tag"&&textAfter!==">"||(type=="tag"&&state.stack[state.stack.length-1]=="rule"?n--:type=="tag"?n++:textAfter===">"&&state.stack[state.stack.length-1]=="rule"&&type===">"?n--:textAfter===">"&&state.stack[state.stack.length-1]=="rule"||(textAfter.substr(0,1)!=="<"&&textAfter.substr(0,1)===">"?n=n-1:textAfter===">"||(n=n-1)))),(type==null||type=="]")&&n--),state.baseIndent+n*cx.unit},languageData:{indentOnInput:/^\s*[\]>]$/}};export{dtd};
