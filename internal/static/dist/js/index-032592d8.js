import{ai as post,y as get,j as useTexts,_ as _export_sfc,a4 as getValidationRules,q as useToast,a7 as Validator,az as formatDate}from"./index-ac67a30c.js";import{d as defineComponent,a as reactive,w as watch,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,ab as createTextVNode,K as createCommentVNode,r as ref,c as computed,b as onMounted,F as Fragment,M as renderList,A as createBlock,R as normalizeClass,o as onUnmounted,Q as normalizeStyle,T as Teleport,n as nextTick,h}from"./vue-vendor-31320f47.js";import{_ as __vitePreload}from"./editor-markdown-0b2e1ce5.js";import{s as showConfirm}from"./dialog-12b1cf68.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";function getUserList(params){return get("/admin/user/list",params)}function updateUser(data){return post("/admin/user/update",data)}function getUserDetail(userId){return get(`/admin/user/detail/${userId}`)}function batchOperateUsers(data){return post("/admin/user/batch",data)}function updateUserStorage(data){return post("/admin/user/storage",data)}function resetUserPassword(userId){return post(`/admin/user/reset-password/${userId}`,{})}function sendUserEmail(data){return post("/admin/user/send-email",data)}function toggleUserStatus(userId,status){return post("/admin/user/toggle-status",{user_id:userId,status})}function createUser(data){return post("/admin/user/create",data)}function deleteUser(userId){return post(`/admin/user/delete/${userId}`,{})}const index$1={getUserList,updateUser,getUserDetail,batchOperateUsers,updateUserStorage,resetUserPassword,sendUserEmail,toggleUserStatus,createUser,deleteUser},index$2=Object.freeze(Object.defineProperty({__proto__:null,batchOperateUsers,createUser,default:index$1,deleteUser,getUserDetail,getUserList,resetUserPassword,sendUserEmail,toggleUserStatus,updateUser,updateUserStorage},Symbol.toStringTag,{value:"Module"})),_hoisted_1$6={key:0,class:"space-y-4"},_hoisted_2$6={class:"mb-1 block text-sm text-content-muted"},_hoisted_3$6={class:"mb-1 block text-sm text-content-muted"},_hoisted_4$6={class:"mb-1 block text-sm text-content-muted"},_hoisted_5$6={class:"flex gap-4"},_hoisted_6$6={class:"mb-1 block text-sm text-content-muted"},_hoisted_7$6={class:"flex gap-4"},_sfc_main$6=defineComponent({__name:"UserForm",props:{modelValue:{}},emits:["update:modelValue"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,formData=reactive({id:0,username:"",email:"",avatar:"",status:1,role:3,created_at:"",updated_at:""});return watch(()=>props.modelValue,newVal=>{newVal&&Object.assign(formData,newVal)},{immediate:!0,deep:!0}),watch(formData,newVal=>{emit("update:modelValue",{...newVal})},{deep:!0}),(_ctx,_cache)=>{const _component_cyberInput=resolveComponent("cyberInput"),_component_cyberRadio=resolveComponent("cyberRadio");return __props.modelValue?(openBlock(),createElementBlock("div",_hoisted_1$6,[createBaseVNode("div",null,[createBaseVNode("label",_hoisted_2$6,toDisplayString(unref($t)("admin.users.form.username")),1),createVNode(_component_cyberInput,{modelValue:formData.username,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.username=$event),placeholder:unref($t)("admin.users.form.usernamePlaceholder")},null,8,["modelValue","placeholder"])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_3$6,toDisplayString(unref($t)("admin.users.form.email")),1),createVNode(_component_cyberInput,{modelValue:formData.email,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>formData.email=$event),placeholder:unref($t)("admin.users.form.emailPlaceholder"),disabled:""},null,8,["modelValue","placeholder"])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_4$6,toDisplayString(unref($t)("admin.users.form.status")),1),createBaseVNode("div",_hoisted_5$6,[createVNode(_component_cyberRadio,{modelValue:formData.status,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.status=$event),value:1},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.statusActive")),1)]),_:1},8,["modelValue"]),createVNode(_component_cyberRadio,{modelValue:formData.status,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>formData.status=$event),value:2},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.statusDisabled")),1)]),_:1},8,["modelValue"])])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_6$6,toDisplayString(unref($t)("admin.users.form.role")),1),createBaseVNode("div",_hoisted_7$6,[createVNode(_component_cyberRadio,{modelValue:formData.role,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>formData.role=$event),value:3},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.roleUser")),1)]),_:1},8,["modelValue"]),createVNode(_component_cyberRadio,{modelValue:formData.role,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>formData.role=$event),value:1},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.roleSuperAdmin")),1)]),_:1},8,["modelValue"])])])])):createCommentVNode("",!0)}}});const UserForm=_export_sfc(_sfc_main$6,[["__scopeId","data-v-1b06acf8"]]),_hoisted_1$5={class:"user-filter-panel mb-4 rounded-xl border border-subtle bg-background-800 p-3"},_hoisted_2$5={class:"mb-3 flex items-center justify-between"},_hoisted_3$5={class:"text-base font-bold text-content-heading"},_hoisted_4$5={class:"flex space-x-1.5"},_hoisted_5$5={class:"grid grid-cols-1 gap-x-3 gap-y-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},_hoisted_6$5={class:"filter-item"},_hoisted_7$5={class:"mb-0.5 block text-xs text-content"},_hoisted_8$4={class:"filter-item"},_hoisted_9$4={class:"mb-1 block text-xs text-content"},_hoisted_10$4={class:"checkbox-group"},_hoisted_11$4={class:"filter-item"},_hoisted_12$4={class:"mb-1 block text-xs text-content"},_hoisted_13$4={class:"checkbox-group"},_hoisted_14$4={class:"filter-item"},_hoisted_15$4={class:"mb-0.5 block text-xs text-content"},_hoisted_16$4={class:"filter-item"},_hoisted_17$3={class:"mb-0.5 block text-xs text-content"},_sfc_main$5=defineComponent({__name:"UserFilterPanel",props:{initialFilters:{}},emits:["filter"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,filters=reactive({keyword:"",status:"0",role:"0",sort_by:"",start_date:"",end_date:""}),dateRange=ref([null,null]),selectedStatuses=ref([]),selectedRoles=ref([]),statusOptions=computed(()=>[{label:$t("admin.users.filter.status.all"),value:"0"},{label:$t("admin.users.filter.status.normal"),value:"1"},{label:$t("admin.users.filter.status.disabled"),value:"2"},{label:$t("admin.users.filter.status.deleted"),value:"3"}]),roleOptions=computed(()=>[{label:$t("admin.users.filter.role.all"),value:"0"},{label:$t("admin.users.filter.role.superAdmin"),value:"1"},{label:$t("admin.users.filter.role.user"),value:"3"}]),sortOptions=computed(()=>[{label:$t("admin.users.filter.sort.default"),value:""},{label:$t("admin.users.filter.sort.newest"),value:"created_at_desc"},{label:$t("admin.users.filter.sort.oldest"),value:"created_at_asc"},{label:$t("admin.users.filter.sort.lastActivityNewest"),value:"last_activity_desc"},{label:$t("admin.users.filter.sort.lastActivityOldest"),value:"last_activity_asc"},{label:$t("admin.users.filter.sort.usernameAZ"),value:"username_asc"},{label:$t("admin.users.filter.sort.usernameZA"),value:"username_desc"}]),handleDateRangeChange=dates=>{dates&&dates.length===2&&dates[0]&&dates[1]?(filters.start_date=formatDateToString(dates[0]),filters.end_date=formatDateToString(dates[1])):(filters.start_date="",filters.end_date="")},formatDateToString=date=>{const year=date.getFullYear(),month=(date.getMonth()+1).toString().padStart(2,"0"),day=date.getDate().toString().padStart(2,"0");return`${year}-${month}-${day}`},toggleStatusFilter=(value,checked)=>{if(checked)selectedStatuses.value.includes(value)||selectedStatuses.value.push(value);else{const index2=selectedStatuses.value.indexOf(value);index2>-1&&selectedStatuses.value.splice(index2,1)}selectedStatuses.value.length===0?filters.status="0":selectedStatuses.value.length===1?filters.status=selectedStatuses.value[0]:filters.status=selectedStatuses.value.join(",")},toggleRoleFilter=(value,checked)=>{if(checked)selectedRoles.value.includes(value)||selectedRoles.value.push(value);else{const index2=selectedRoles.value.indexOf(value);index2>-1&&selectedRoles.value.splice(index2,1)}selectedRoles.value.length===0?filters.role="0":selectedRoles.value.length===1?filters.role=selectedRoles.value[0]:filters.role=selectedRoles.value.join(",")},applyFilters=()=>{emit("filter",{...filters})},resetFilters=()=>{Object.assign(filters,{keyword:"",status:"0",role:"0",sort_by:"",start_date:"",end_date:""}),dateRange.value=[null,null],selectedStatuses.value=[],selectedRoles.value=[],applyFilters()};return onMounted(()=>{props.initialFilters&&(Object.assign(filters,props.initialFilters),filters.start_date&&filters.end_date&&(dateRange.value=[new Date(filters.start_date),new Date(filters.end_date)]))}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberCheckbox=resolveComponent("CyberCheckbox"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberDatePicker=resolveComponent("CyberDatePicker");return openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("h3",_hoisted_3$5,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-filter mr-1.5 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.users.filter.title")),1)]),createBaseVNode("div",_hoisted_4$5,[createVNode(_component_CyberButton,{type:"secondary",class:"px-2 py-1 text-xs",onClick:resetFilters},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-undo-alt mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.users.buttons.resetFilter")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",class:"px-2 py-1 text-xs",onClick:applyFilters},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-search mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.users.buttons.applyFilter")),1)]),_:1})])]),createBaseVNode("div",_hoisted_5$5,[createBaseVNode("div",_hoisted_6$5,[createBaseVNode("label",_hoisted_7$5,toDisplayString(unref($t)("admin.users.filter.keyword")),1),createVNode(_component_CyberInput,{modelValue:filters.keyword,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>filters.keyword=$event),placeholder:unref($t)("admin.users.filter.keywordPlaceholder"),class:"compact"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_8$4,[createBaseVNode("label",_hoisted_9$4,toDisplayString(unref($t)("admin.users.filter.status.label")),1),createBaseVNode("div",_hoisted_10$4,[(openBlock(!0),createElementBlock(Fragment,null,renderList(statusOptions.value.slice(1),option=>(openBlock(),createBlock(_component_CyberCheckbox,{key:option.value,"model-value":selectedStatuses.value.includes(option.value),class:"checkbox-item","onUpdate:modelValue":checked=>toggleStatusFilter(option.value,checked)},{default:withCtx(()=>[createTextVNode(toDisplayString(option.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))])]),createBaseVNode("div",_hoisted_11$4,[createBaseVNode("label",_hoisted_12$4,toDisplayString(unref($t)("admin.users.filter.role.label")),1),createBaseVNode("div",_hoisted_13$4,[(openBlock(!0),createElementBlock(Fragment,null,renderList(roleOptions.value.slice(1),option=>(openBlock(),createBlock(_component_CyberCheckbox,{key:option.value,"model-value":selectedRoles.value.includes(option.value),class:"checkbox-item","onUpdate:modelValue":checked=>toggleRoleFilter(option.value,checked)},{default:withCtx(()=>[createTextVNode(toDisplayString(option.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))])]),createBaseVNode("div",_hoisted_14$4,[createBaseVNode("label",_hoisted_15$4,toDisplayString(unref($t)("admin.users.filter.sort.label")),1),createVNode(_component_CyberDropdown,{modelValue:filters.sort_by,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>filters.sort_by=$event),options:sortOptions.value,placeholder:unref($t)("admin.users.filter.sort.placeholder"),class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_16$4,[createBaseVNode("label",_hoisted_17$3,toDisplayString(unref($t)("admin.users.filter.registrationTime")),1),createVNode(_component_CyberDatePicker,{modelValue:dateRange.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>dateRange.value=$event),type:"daterange",placeholder:unref($t)("admin.users.filter.dateRangePlaceholder"),"start-placeholder":unref($t)("admin.users.filter.startDatePlaceholder"),"end-placeholder":unref($t)("admin.users.filter.endDatePlaceholder"),class:"compact",onChange:handleDateRangeChange},null,8,["modelValue","placeholder","start-placeholder","end-placeholder"])])])])}}});const UserFilterPanel=_export_sfc(_sfc_main$5,[["__scopeId","data-v-99cd8167"]]),_hoisted_1$4={class:"space-y-4 p-6"},_hoisted_2$4={class:"mb-2 block text-sm text-brand-700"},_hoisted_3$4={key:0,class:"mt-1 text-xs text-red-500"},_hoisted_4$4={class:"mb-2 block text-sm text-brand-700"},_hoisted_5$4={key:0,class:"mt-1 text-xs text-red-500"},_hoisted_6$4={class:"mb-2 block text-sm text-brand-700"},_hoisted_7$4={key:0,class:"mt-1 text-xs text-red-500"},_hoisted_8$3={class:"mt-1 text-xs text-brand-500"},_hoisted_9$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_10$3={class:"flex gap-4"},_hoisted_11$3={class:"border-t border-subtle pt-4"},_hoisted_12$3={class:"mb-3 font-medium text-content"},_hoisted_13$3={class:"grid grid-cols-1 gap-4"},_hoisted_14$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_15$3={class:"flex items-center gap-2"},_hoisted_16$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_17$2={class:"flex items-center gap-2"},_hoisted_18$2={class:"flex justify-end gap-2 p-4"},_sfc_main$4=defineComponent({__name:"CreateUserDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","userCreated"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),R=getValidationRules($t),storageUnitOptions=[{label:"MB",value:"MB"},{label:"GB",value:"GB"},{label:"TB",value:"TB"}],visible=ref(!1),submitting=ref(!1),formData=reactive({username:"",email:"",password:"",role:3,storage_limit:5,bandwidth_limit:100,storage_unit:"GB",bandwidth_unit:"GB"}),errors=reactive({username:null,email:null,password:null});watch(()=>props.modelValue,newVal=>{visible.value=newVal,newVal&&resetForm()},{immediate:!0}),watch(visible,newVal=>{emit("update:modelValue",newVal)});const convertToBytes=(value,unit)=>{switch(unit){case"TB":return value*1024*1024*1024*1024;case"GB":return value*1024*1024*1024;case"MB":return value*1024*1024;default:return value}},resetForm=()=>{formData.username="",formData.email="",formData.password="",formData.role=3,formData.storage_limit=5,formData.bandwidth_limit=100,formData.storage_unit="GB",formData.bandwidth_unit="GB",Object.keys(errors).forEach(key=>{errors[key]=null})},clearError=field=>{errors[field]=null},validateForm=()=>{let isValid=!0;const usernameCheck=Validator.validate(formData.username,[R.required,R.minLength(2),R.maxLength(20),R.username],$t);errors.username=usernameCheck.valid?null:usernameCheck.message||$t("validation.errors.custom"),usernameCheck.valid||(isValid=!1);const emailCheck=Validator.validate(formData.email,[R.required,R.email],$t);errors.email=emailCheck.valid?null:emailCheck.message||$t("validation.errors.email"),emailCheck.valid||(isValid=!1);const passwordCheck=Validator.validate(formData.password,[R.required,R.minLength(6),R.maxLength(20)],$t);return errors.password=passwordCheck.valid?null:passwordCheck.message||$t("validation.errors.custom"),passwordCheck.valid||(isValid=!1),isValid},handleSubmit=async()=>{if(validateForm()){submitting.value=!0;try{const requestData={username:formData.username,email:formData.email,password:formData.password,role:formData.role,storage_limit:formData.storage_limit?convertToBytes(formData.storage_limit,formData.storage_unit):void 0,bandwidth_limit:formData.bandwidth_limit?convertToBytes(formData.bandwidth_limit,formData.bandwidth_unit):void 0},result=await createUser(requestData);result.success&&(toast.success($t("admin.users.toast.createSuccess")),emit("userCreated",result.data),visible.value=!1)}catch{toast.error($t("admin.users.toast.createFailed"))}submitting.value=!1}},handleCancel=()=>{visible.value=!1};return(_ctx,_cache)=>{const _component_cyberInput=resolveComponent("cyberInput"),_component_cyberRadio=resolveComponent("cyberRadio"),_component_cyberDropdown=resolveComponent("cyberDropdown"),_component_cyberButton=resolveComponent("cyberButton"),_component_cyberDialog=resolveComponent("cyberDialog");return openBlock(),createBlock(_component_cyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[12]||(_cache[12]=$event=>visible.value=$event),title:unref($t)("admin.users.form.createTitle"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_18$2,[createVNode(_component_cyberButton,{type:"secondary",onClick:handleCancel},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.cancel")),1)]),_:1}),createVNode(_component_cyberButton,{type:"primary",loading:submitting.value,onClick:handleSubmit},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.create")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[createBaseVNode("div",null,[createBaseVNode("label",_hoisted_2$4,[_cache[13]||(_cache[13]=createBaseVNode("span",{class:"text-red-500"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.form.username")),1)]),createVNode(_component_cyberInput,{modelValue:formData.username,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.username=$event),placeholder:unref($t)("admin.users.form.usernamePlaceholder"),error:errors.username,onInput:_cache[1]||(_cache[1]=$event=>clearError("username"))},null,8,["modelValue","placeholder","error"]),errors.username?(openBlock(),createElementBlock("div",_hoisted_3$4,toDisplayString(errors.username),1)):createCommentVNode("",!0)]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_4$4,[_cache[14]||(_cache[14]=createBaseVNode("span",{class:"text-red-500"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.form.email")),1)]),createVNode(_component_cyberInput,{modelValue:formData.email,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.email=$event),type:"email",placeholder:unref($t)("admin.users.form.emailPlaceholder"),error:errors.email,onInput:_cache[3]||(_cache[3]=$event=>clearError("email"))},null,8,["modelValue","placeholder","error"]),errors.email?(openBlock(),createElementBlock("div",_hoisted_5$4,toDisplayString(errors.email),1)):createCommentVNode("",!0)]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_6$4,[_cache[15]||(_cache[15]=createBaseVNode("span",{class:"text-red-500"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.form.password")),1)]),createVNode(_component_cyberInput,{modelValue:formData.password,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>formData.password=$event),type:"password",placeholder:unref($t)("admin.users.form.passwordPlaceholder"),error:errors.password,onInput:_cache[5]||(_cache[5]=$event=>clearError("password"))},null,8,["modelValue","placeholder","error"]),errors.password?(openBlock(),createElementBlock("div",_hoisted_7$4,toDisplayString(errors.password),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_8$3,toDisplayString(unref($t)("admin.users.form.passwordHint")),1)]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_9$3,toDisplayString(unref($t)("admin.users.form.role")),1),createBaseVNode("div",_hoisted_10$3,[createVNode(_component_cyberRadio,{modelValue:formData.role,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>formData.role=$event),value:3},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.roleUser")),1)]),_:1},8,["modelValue"]),createVNode(_component_cyberRadio,{modelValue:formData.role,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>formData.role=$event),value:1},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.form.roleSuperAdmin")),1)]),_:1},8,["modelValue"])])]),createBaseVNode("div",_hoisted_11$3,[createBaseVNode("h4",_hoisted_12$3,toDisplayString(unref($t)("admin.users.form.storageConfig")),1),createBaseVNode("div",_hoisted_13$3,[createBaseVNode("div",null,[createBaseVNode("label",_hoisted_14$3,toDisplayString(unref($t)("admin.users.form.storageLimit")),1),createBaseVNode("div",_hoisted_15$3,[createVNode(_component_cyberInput,{modelValue:formData.storage_limit,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>formData.storage_limit=$event),type:"number",min:0,max:99999,placeholder:unref($t)("admin.users.form.storageLimitDefault"),class:"flex-1"},null,8,["modelValue","placeholder"]),createVNode(_component_cyberDropdown,{modelValue:formData.storage_unit,"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>formData.storage_unit=$event),options:storageUnitOptions,class:"w-20"},null,8,["modelValue"])])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_16$3,toDisplayString(unref($t)("admin.users.form.bandwidthLimit")),1),createBaseVNode("div",_hoisted_17$2,[createVNode(_component_cyberInput,{modelValue:formData.bandwidth_limit,"onUpdate:modelValue":_cache[10]||(_cache[10]=$event=>formData.bandwidth_limit=$event),type:"number",min:0,max:99999,placeholder:unref($t)("admin.users.form.bandwidthLimitDefault"),class:"flex-1"},null,8,["modelValue","placeholder"]),createVNode(_component_cyberDropdown,{modelValue:formData.bandwidth_unit,"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>formData.bandwidth_unit=$event),options:storageUnitOptions,class:"w-20"},null,8,["modelValue"])])])])])])]),_:1},8,["modelValue","title"])}}}),_hoisted_1$3={class:"space-y-4 p-6"},_hoisted_2$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_3$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_4$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_5$3={class:"mb-2 block text-sm text-brand-700"},_hoisted_6$3={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},_hoisted_7$3={class:"flex justify-end gap-2 p-4"},_sfc_main$3=defineComponent({__name:"SendEmailDialog",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","emailSent"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),R=getValidationRules($t),visible=ref(!1),submitting=ref(!1),userInfo=computed(()=>props.user?`${props.user.username} (${props.user.email})`:""),formData=reactive({subject:"",content:""}),errors=reactive({subject:"",content:""}),templates={welcome:{subject:$t("admin.users.sendEmail.templatesContent.welcome.subject"),content:$t("admin.users.sendEmail.templatesContent.welcome.content")},warning:{subject:$t("admin.users.sendEmail.templatesContent.warning.subject"),content:$t("admin.users.sendEmail.templatesContent.warning.content")},notice:{subject:$t("admin.users.sendEmail.templatesContent.notice.subject"),content:$t("admin.users.sendEmail.templatesContent.notice.content")},custom:{subject:"",content:$t("admin.users.sendEmail.templatesContent.custom.content")}};watch(()=>props.modelValue,newVal=>{visible.value=newVal,newVal&&resetForm()},{immediate:!0}),watch(visible,newVal=>{emit("update:modelValue",newVal)});const resetForm=()=>{formData.subject="",formData.content="",Object.keys(errors).forEach(key=>{errors[key]=""})},clearError=field=>{errors[field]=""},useTemplate=templateType=>{const template=templates[templateType];formData.subject=template.subject,formData.content=template.content},validateForm=()=>{let isValid=!0;const subjectCheck=Validator.validate(formData.subject,[R.required,R.maxLength(100)],$t);errors.subject=subjectCheck.valid?"":subjectCheck.message||$t("validation.errors.custom"),subjectCheck.valid||(isValid=!1);const contentCheck=Validator.validate(formData.content,[R.required,R.maxLength(5e3)],$t);return errors.content=contentCheck.valid?"":contentCheck.message||$t("validation.errors.custom"),contentCheck.valid||(isValid=!1),isValid},handleSubmit=async()=>{if(props.user&&validateForm()){submitting.value=!0;try{emit("emailSent",{userId:props.user.id,subject:formData.subject,content:formData.content}),toast.success($t("admin.users.sendEmail.messages.sent")),visible.value=!1}catch{toast.error($t("admin.users.sendEmail.messages.failed"))}submitting.value=!1}},handleCancel=()=>{visible.value=!1};return(_ctx,_cache)=>{const _component_cyberInput=resolveComponent("cyberInput"),_component_cyberButton=resolveComponent("cyberButton"),_component_cyberDialog=resolveComponent("cyberDialog");return openBlock(),createBlock(_component_cyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>visible.value=$event),title:unref($t)("admin.users.sendEmail.title"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_7$3,[createVNode(_component_cyberButton,{type:"secondary",onClick:handleCancel},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.sendEmail.cancel")),1)]),_:1}),createVNode(_component_cyberButton,{type:"primary",loading:submitting.value,onClick:handleSubmit},{default:withCtx(()=>[createTextVNode(toDisplayString(submitting.value?unref($t)("admin.users.sendEmail.sending"):unref($t)("admin.users.sendEmail.send")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$3,[createBaseVNode("div",null,[createBaseVNode("label",_hoisted_2$3,toDisplayString(unref($t)("admin.users.sendEmail.recipients")),1),createVNode(_component_cyberInput,{value:userInfo.value,readonly:"",class:"bg-background-200"},null,8,["value"])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_3$3,[_cache[9]||(_cache[9]=createBaseVNode("span",{class:"text-red-500"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.sendEmail.subject")),1)]),createVNode(_component_cyberInput,{modelValue:formData.subject,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.subject=$event),placeholder:unref($t)("admin.users.sendEmail.subjectPlaceholder"),error:!!errors.subject,"error-message":errors.subject,onInput:_cache[1]||(_cache[1]=$event=>clearError("subject"))},null,8,["modelValue","placeholder","error","error-message"])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_4$3,[_cache[10]||(_cache[10]=createBaseVNode("span",{class:"text-red-500"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.sendEmail.content")),1)]),createVNode(_component_cyberInput,{modelValue:formData.content,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.content=$event),type:"textarea",rows:6,placeholder:unref($t)("admin.users.sendEmail.contentPlaceholder"),error:!!errors.content,"error-message":errors.content,onInput:_cache[3]||(_cache[3]=$event=>clearError("content"))},null,8,["modelValue","placeholder","error","error-message"])]),createBaseVNode("div",null,[createBaseVNode("label",_hoisted_5$3,toDisplayString(unref($t)("admin.users.sendEmail.templates")),1),createBaseVNode("div",_hoisted_6$3,[createVNode(_component_cyberButton,{type:"secondary",onClick:_cache[4]||(_cache[4]=$event=>useTemplate("welcome"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.sendEmail.templateButtons.welcome")),1)]),_:1}),createVNode(_component_cyberButton,{type:"secondary",onClick:_cache[5]||(_cache[5]=$event=>useTemplate("warning"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.sendEmail.templateButtons.warning")),1)]),_:1}),createVNode(_component_cyberButton,{type:"secondary",onClick:_cache[6]||(_cache[6]=$event=>useTemplate("notice"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.sendEmail.templateButtons.notice")),1)]),_:1}),createVNode(_component_cyberButton,{type:"secondary",onClick:_cache[7]||(_cache[7]=$event=>useTemplate("custom"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.sendEmail.templateButtons.custom")),1)]),_:1})])])])]),_:1},8,["modelValue","title"])}}}),_hoisted_1$2={class:"user-detail-drawer"},_hoisted_2$2={key:0,class:"space-y-4 p-4"},_hoisted_3$2={class:"animate-slide-up rounded-lg border border-subtle bg-background-800 p-4",style:{"animation-delay":"0.05s"}},_hoisted_4$2={class:"mb-4 flex items-center text-lg font-semibold text-content"},_hoisted_5$2={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},_hoisted_6$2={class:"flex items-center space-x-3"},_hoisted_7$2={class:"relative"},_hoisted_8$2={class:"min-w-0 flex-1"},_hoisted_9$2={class:"truncate font-medium text-content"},_hoisted_10$2={class:"truncate text-sm text-content-muted"},_hoisted_11$2={class:"space-y-2"},_hoisted_12$2={class:"flex items-center justify-between text-sm"},_hoisted_13$2={class:"whitespace-nowrap text-content-muted"},_hoisted_14$2={class:"font-mono text-content"},_hoisted_15$2={class:"flex items-center justify-between text-sm"},_hoisted_16$2={class:"whitespace-nowrap text-content-muted"},_hoisted_17$1={class:"flex items-center justify-between text-sm"},_hoisted_18$1={class:"whitespace-nowrap text-content-muted"},_hoisted_19$1={class:"flex items-center justify-between text-sm"},_hoisted_20={class:"whitespace-nowrap text-content-muted"},_hoisted_21={class:"truncate text-xs text-content"},_hoisted_22={class:"flex items-center justify-between text-sm"},_hoisted_23={class:"whitespace-nowrap text-content-muted"},_hoisted_24={class:"truncate text-xs text-content"},_hoisted_25={class:"flex items-center justify-between text-sm"},_hoisted_26={class:"whitespace-nowrap text-content-muted"},_hoisted_27={class:"font-mono text-xs text-content"},_hoisted_28={class:"animate-slide-up rounded-xl border border-subtle bg-background-800 p-6 shadow-lg backdrop-blur-sm",style:{"animation-delay":"0.1s"}},_hoisted_29={class:"mb-6 flex items-center text-xl font-bold text-content"},_hoisted_30={class:"space-y-6"},_hoisted_31={class:"grid grid-cols-1 gap-6"},_hoisted_32={class:"rounded-lg border border-subtle bg-background-700 p-4"},_hoisted_33={class:"mb-3 block flex items-center text-sm font-medium text-content"},_hoisted_34={class:"flex items-center gap-3"},_hoisted_35={class:"mt-2 flex items-center text-xs text-content-muted"},_hoisted_36={class:"rounded-lg border border-subtle bg-background-700 p-4"},_hoisted_37={class:"mb-3 block flex items-center text-sm font-medium text-content"},_hoisted_38={class:"flex items-center gap-3"},_hoisted_39={class:"mt-2 flex items-center text-xs text-content-muted"},_hoisted_40={class:"flex justify-end"},_hoisted_41={class:"animate-slide-up rounded-xl border border-subtle bg-background-800 p-6 shadow-lg backdrop-blur-sm",style:{"animation-delay":"0.15s"}},_hoisted_42={class:"mb-6 flex items-center text-xl font-bold text-content"},_hoisted_43={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},_hoisted_44={class:"space-y-4"},_hoisted_45={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_46={class:"flex items-center justify-between"},_hoisted_47={class:"flex items-center text-sm text-content-muted"},_hoisted_48={class:"text-lg font-bold text-content"},_hoisted_49={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_50={class:"flex items-center justify-between"},_hoisted_51={class:"flex items-center text-sm text-content-muted"},_hoisted_52={class:"text-lg font-bold text-content"},_hoisted_53={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_54={class:"flex items-center justify-between"},_hoisted_55={class:"flex items-center text-sm text-content-muted"},_hoisted_56={class:"text-lg font-bold text-content"},_hoisted_57={class:"space-y-4"},_hoisted_58={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_59={class:"flex items-center justify-between"},_hoisted_60={class:"flex items-center text-sm text-content-muted"},_hoisted_61={class:"text-lg font-bold text-content"},_hoisted_62={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_63={class:"flex items-center justify-between"},_hoisted_64={class:"flex items-center text-sm text-content-muted"},_hoisted_65={class:"text-lg font-bold text-content"},_hoisted_66={class:"rounded-lg border border-subtle bg-background-700 p-3"},_hoisted_67={class:"flex items-center justify-between"},_hoisted_68={class:"flex items-center text-sm text-content-muted"},_hoisted_69={class:"text-sm font-medium text-content"},_hoisted_70={class:"animate-slide-up rounded-xl border border-subtle bg-background-800 p-6 shadow-lg backdrop-blur-sm",style:{"animation-delay":"0.2s"}},_hoisted_71={class:"mb-6 flex items-center text-xl font-bold text-content"},_hoisted_72={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3"},_hoisted_73={class:"rounded-lg border border-subtle bg-background-700 p-4 transition-all hover:border-default hover:bg-background-600"},_hoisted_74={class:"mt-2 text-center text-xs text-content-muted"},_hoisted_75={class:"rounded-lg border border-subtle bg-background-700 p-4 transition-all hover:border-default hover:bg-background-600"},_hoisted_76={class:"mt-2 text-center text-xs text-content-muted"},_hoisted_77={class:"rounded-lg border border-subtle bg-background-700 p-4 transition-all hover:border-default hover:bg-background-600"},_hoisted_78={class:"mt-2 text-center text-xs text-content-muted"},_hoisted_79={key:1,class:"loading-container p-6 text-center"},_sfc_main$2=defineComponent({__name:"UserDetailDrawer",props:{modelValue:{type:Boolean},userId:{},userData:{}},emits:["update:modelValue","userUpdated"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,toast=useToast(),visible=ref(!1),userDetail=ref(null),userStats=ref({}),updateStorageLoading=ref(!1),resetPasswordLoading=ref(!1),sendEmailLoading=ref(!1),toggleStatusLoading=ref(!1),showEmailDialog=ref(!1),storageUnitOptions=computed(()=>[{label:$t("admin.users.detail.units.mb"),value:"MB"},{label:$t("admin.users.detail.units.gb"),value:"GB"},{label:$t("admin.users.detail.units.tb"),value:"TB"}]),bandwidthUnitOptions=computed(()=>[{label:$t("admin.users.detail.units.mb"),value:"MB"},{label:$t("admin.users.detail.units.gb"),value:"GB"},{label:$t("admin.users.detail.units.tb"),value:"TB"}]),storageSettings=reactive({storage_limit:0,bandwidth_limit:0,storage_unit:"GB",bandwidth_unit:"GB"});watch(()=>props.modelValue,newVal=>{visible.value=newVal,newVal&&(props.userData||props.userId)&&initUserDetail()},{immediate:!0}),watch(()=>props.userData,newVal=>{newVal&&visible.value&&initUserDetail()}),watch(visible,newVal=>{emit("update:modelValue",newVal)});const convertBytesToBestUnit=bytes=>{if(bytes===0)return{value:0,unit:"GB"};const tb=bytes/(1024*1024*1024*1024),gb=bytes/(1024*1024*1024),mb=bytes/(1024*1024);return tb>=1?{value:Math.round(tb*100)/100,unit:"TB"}:gb>=1?{value:Math.round(gb*100)/100,unit:"GB"}:{value:Math.round(mb*100)/100,unit:"MB"}},convertToBytes=(value,unit)=>{switch(unit){case"TB":return value*1024*1024*1024*1024;case"GB":return value*1024*1024*1024;case"MB":return value*1024*1024;default:return value}},initUserDetail=async()=>{if(props.userData){userDetail.value=props.userData;const storageConverted=convertBytesToBestUnit(props.userData.storage_limit||5*1024*1024*1024),bandwidthConverted=convertBytesToBestUnit(props.userData.bandwidth_limit||100*1024*1024*1024);storageSettings.storage_limit=storageConverted.value,storageSettings.storage_unit=storageConverted.unit,storageSettings.bandwidth_limit=bandwidthConverted.value,storageSettings.bandwidth_unit=bandwidthConverted.unit,userStats.value={total_images:props.userData.total_images||0,used_storage:props.userData.used_storage||0,monthly_bandwidth:props.userData.used_bandwidth||0,total_views:props.userData.total_views||0,total_shares:0,last_login:$t("admin.users.detail.noData")}}else if(props.userId)try{const result=await getUserDetail(props.userId);if(result.success){const userDetailData=result.data;userDetail.value=userDetailData;const storageConverted=convertBytesToBestUnit(userDetailData.storage_limit||5*1024*1024*1024),bandwidthConverted=convertBytesToBestUnit(userDetailData.bandwidth_limit||100*1024*1024*1024);storageSettings.storage_limit=storageConverted.value,storageSettings.storage_unit=storageConverted.unit,storageSettings.bandwidth_limit=bandwidthConverted.value,storageSettings.bandwidth_unit=bandwidthConverted.unit,userStats.value={total_images:userDetailData.total_images||0,used_storage:userDetailData.used_storage||0,monthly_bandwidth:userDetailData.used_bandwidth||0,total_views:userDetailData.total_views||0,total_shares:0,last_login:$t("admin.users.detail.noData")}}}catch(error){const errorMessage=error?.response?.data?.message||error?.message||$t("admin.users.detail.errors.fetchFailed");toast.error(errorMessage)}},updateStorageSettings=async()=>{if(userDetail.value){updateStorageLoading.value=!0;try{const storageBytes=convertToBytes(Number(storageSettings.storage_limit),storageSettings.storage_unit),bandwidthBytes=convertToBytes(Number(storageSettings.bandwidth_limit),storageSettings.bandwidth_unit);await updateUserStorage({user_id:userDetail.value.id,storage_limit:storageBytes,bandwidth_limit:bandwidthBytes}),toast.success($t("admin.users.detail.messages.storageUpdateSuccess")),userDetail.value&&(userDetail.value.storage_limit=storageBytes,userDetail.value.bandwidth_limit=bandwidthBytes),emit("userUpdated",userDetail.value)}catch(error){const errorMessage=error?.response?.data?.message||error?.message||$t("admin.users.detail.errors.storageUpdateFailed");toast.error(errorMessage)}updateStorageLoading.value=!1}},resetPassword=async()=>{if(userDetail.value){resetPasswordLoading.value=!0;try{const result=await resetUserPassword(userDetail.value.id);toast.success($t("admin.users.detail.messages.passwordResetSuccess",{password:result.new_password}))}catch(error){const errorMessage=error?.response?.data?.message||error?.message||$t("admin.users.detail.errors.passwordResetFailed");toast.error(errorMessage)}resetPasswordLoading.value=!1}},handleEmailSent=async data=>{sendEmailLoading.value=!0;try{await sendUserEmail({user_id:data.userId,subject:data.subject,content:data.content}),toast.success($t("admin.users.detail.messages.emailSentSuccess"))}catch(error){const errorMessage=error?.response?.data?.message||error?.message||$t("admin.users.detail.errors.emailSentFailed");toast.error(errorMessage)}sendEmailLoading.value=!1},toggleStatus=async()=>{if(userDetail.value){toggleStatusLoading.value=!0;try{const newStatus=userDetail.value.status===1?2:1;await toggleUserStatus(userDetail.value.id,newStatus),userDetail.value.status=newStatus,toast.success($t(`admin.users.detail.messages.${newStatus===1?"userEnabled":"userDisabled"}`)),emit("userUpdated",userDetail.value)}catch(error){const errorMessage=error?.response?.data?.message||error?.message||$t("admin.users.detail.errors.operationFailed");toast.error(errorMessage)}toggleStatusLoading.value=!1}},handleClose=()=>{visible.value=!1,userDetail.value=null,userStats.value={}},getStatusText=status=>{switch(status){case 1:return $t("admin.users.detail.status.active");case 2:return $t("admin.users.detail.status.disabled");case 3:return $t("admin.users.detail.status.deleted");default:return $t("admin.users.detail.status.unknown")}},getRoleText=role=>{switch(role){case 1:return $t("admin.users.detail.roles.superAdmin");case 2:return $t("admin.users.detail.roles.admin");case 3:return $t("admin.users.detail.roles.user");default:return $t("admin.users.detail.roles.unknown")}},formatStorageSize=bytes=>{if(bytes===0)return"0 B";const k=1024,sizes=["B","KB","MB","GB","TB"],i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`};return(_ctx,_cache)=>{const _component_CyberUserAvatar=resolveComponent("CyberUserAvatar"),_component_cyberInput=resolveComponent("cyberInput"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_cyberButton=resolveComponent("cyberButton"),_component_cyberLoading=resolveComponent("cyberLoading"),_component_CyberDrawer=resolveComponent("CyberDrawer");return openBlock(),createElementBlock("div",_hoisted_1$2,[createVNode(_component_CyberDrawer,{modelValue:visible.value,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>visible.value=$event),title:unref($t)("admin.users.detail.title"),width:"600px",onClose:handleClose},{default:withCtx(()=>[userDetail.value?(openBlock(),createElementBlock("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("h3",_hoisted_4$2,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-user mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.basicInfo")),1)]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$2,[createBaseVNode("div",_hoisted_7$2,[createVNode(_component_CyberUserAvatar,{"avatar-url":userDetail.value.avatar_full_path,username:userDetail.value.username,size:"lg"},null,8,["avatar-url","username"]),_cache[8]||(_cache[8]=createBaseVNode("div",{class:"absolute -bottom-1 -right-1 h-3 w-3 rounded-full border border-default bg-green-500"},null,-1))]),createBaseVNode("div",_hoisted_8$2,[createBaseVNode("p",_hoisted_9$2,toDisplayString(userDetail.value.username),1),createBaseVNode("p",_hoisted_10$2,toDisplayString(userDetail.value.email),1)])]),createBaseVNode("div",_hoisted_11$2,[createBaseVNode("div",_hoisted_12$2,[createBaseVNode("span",_hoisted_13$2,toDisplayString(unref($t)("admin.users.detail.userId"))+":",1),createBaseVNode("span",_hoisted_14$2,"#"+toDisplayString(userDetail.value.id),1)]),createBaseVNode("div",_hoisted_15$2,[createBaseVNode("span",_hoisted_16$2,toDisplayString(unref($t)("admin.users.detail.status.label"))+":",1),createBaseVNode("span",{class:normalizeClass(["rounded px-2 py-1 text-xs font-medium",[userDetail.value.status===1?"bg-green-500/20 text-green-400":userDetail.value.status===2?"bg-red-500/20 text-red-400":"bg-content/20 text-content-muted"]])},toDisplayString(getStatusText(userDetail.value.status)),3)]),createBaseVNode("div",_hoisted_17$1,[createBaseVNode("span",_hoisted_18$1,toDisplayString(unref($t)("admin.users.detail.role"))+":",1),createBaseVNode("span",{class:normalizeClass(["rounded px-2 py-1 text-xs font-medium",[userDetail.value.role===1?"bg-purple-500/20 text-purple-400":userDetail.value.role===2?"bg-brand-500/20 text-brand-primary":"bg-content/20 text-content-muted"]])},toDisplayString(getRoleText(userDetail.value.role)),3)]),createBaseVNode("div",_hoisted_19$1,[createBaseVNode("span",_hoisted_20,toDisplayString(unref($t)("admin.users.detail.registeredAt"))+":",1),createBaseVNode("span",_hoisted_21,toDisplayString(unref(formatDate)(userDetail.value.created_at)),1)]),createBaseVNode("div",_hoisted_22,[createBaseVNode("span",_hoisted_23,toDisplayString(unref($t)("admin.users.detail.lastActivity"))+":",1),createBaseVNode("span",_hoisted_24,toDisplayString(unref(formatDate)(userDetail.value.last_activity_at)||unref($t)("admin.users.detail.never")),1)]),createBaseVNode("div",_hoisted_25,[createBaseVNode("span",_hoisted_26,toDisplayString(unref($t)("admin.users.detail.lastActivityIp"))+":",1),createBaseVNode("span",_hoisted_27,toDisplayString(userDetail.value.last_activity_ip||"--"),1)])])])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("h3",_hoisted_29,[_cache[9]||(_cache[9]=createBaseVNode("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-green-500/20"},[createBaseVNode("i",{class:"fas fa-hdd text-green-400"})],-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.storageManagement")),1)]),createBaseVNode("div",_hoisted_30,[createBaseVNode("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,[createBaseVNode("label",_hoisted_33,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-database mr-2 text-blue-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.storageLimit")),1)]),createBaseVNode("div",_hoisted_34,[createVNode(_component_cyberInput,{modelValue:storageSettings.storage_limit,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>storageSettings.storage_limit=$event),type:"number",min:0,max:99999,placeholder:unref($t)("admin.users.detail.enterValue"),class:"flex-1"},null,8,["modelValue","placeholder"]),createVNode(_component_CyberDropdown,{modelValue:storageSettings.storage_unit,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>storageSettings.storage_unit=$event),options:storageUnitOptions.value,class:"w-20",placeholder:unref($t)("admin.users.detail.unit")},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_35,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-info-circle mr-1 text-blue-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.currentSetting"))+": "+toDisplayString(formatStorageSize(userDetail.value?.storage_limit||0)),1)])]),createBaseVNode("div",_hoisted_36,[createBaseVNode("label",_hoisted_37,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-wifi mr-2 text-purple-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.bandwidthLimit")),1)]),createBaseVNode("div",_hoisted_38,[createVNode(_component_cyberInput,{modelValue:storageSettings.bandwidth_limit,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>storageSettings.bandwidth_limit=$event),type:"number",min:0,max:99999,placeholder:unref($t)("admin.users.detail.enterValue"),class:"flex-1"},null,8,["modelValue","placeholder"]),createVNode(_component_CyberDropdown,{modelValue:storageSettings.bandwidth_unit,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>storageSettings.bandwidth_unit=$event),options:bandwidthUnitOptions.value,class:"w-20",placeholder:unref($t)("admin.users.detail.unit")},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_39,[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-info-circle mr-1 text-purple-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.currentSetting"))+": "+toDisplayString(formatStorageSize(userDetail.value?.bandwidth_limit||0)),1)])])]),createBaseVNode("div",_hoisted_40,[createVNode(_component_cyberButton,{type:"primary",loading:updateStorageLoading.value,onClick:updateStorageSettings},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.detail.updateStorageSettings")),1)]),_:1},8,["loading"])])])]),createBaseVNode("div",_hoisted_41,[createBaseVNode("h3",_hoisted_42,[_cache[14]||(_cache[14]=createBaseVNode("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-orange-500/20"},[createBaseVNode("i",{class:"fas fa-chart-bar text-orange-400"})],-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.usageStats")),1)]),createBaseVNode("div",_hoisted_43,[createBaseVNode("div",_hoisted_44,[createBaseVNode("div",_hoisted_45,[createBaseVNode("div",_hoisted_46,[createBaseVNode("span",_hoisted_47,[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-images mr-2 text-blue-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.uploadedFiles")),1)]),createBaseVNode("span",_hoisted_48,toDisplayString(userStats.value.total_images||0),1)])]),createBaseVNode("div",_hoisted_49,[createBaseVNode("div",_hoisted_50,[createBaseVNode("span",_hoisted_51,[_cache[16]||(_cache[16]=createBaseVNode("i",{class:"fas fa-hdd mr-2 text-green-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.usedStorage")),1)]),createBaseVNode("span",_hoisted_52,toDisplayString(formatStorageSize(userStats.value.used_storage||0)),1)])]),createBaseVNode("div",_hoisted_53,[createBaseVNode("div",_hoisted_54,[createBaseVNode("span",_hoisted_55,[_cache[17]||(_cache[17]=createBaseVNode("i",{class:"fas fa-download mr-2 text-purple-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.monthlyBandwidth")),1)]),createBaseVNode("span",_hoisted_56,toDisplayString(formatStorageSize(userStats.value.monthly_bandwidth||0)),1)])])]),createBaseVNode("div",_hoisted_57,[createBaseVNode("div",_hoisted_58,[createBaseVNode("div",_hoisted_59,[createBaseVNode("span",_hoisted_60,[_cache[18]||(_cache[18]=createBaseVNode("i",{class:"fas fa-eye mr-2 text-yellow-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.totalViews")),1)]),createBaseVNode("span",_hoisted_61,toDisplayString(userStats.value.total_views||0),1)])]),createBaseVNode("div",_hoisted_62,[createBaseVNode("div",_hoisted_63,[createBaseVNode("span",_hoisted_64,[_cache[19]||(_cache[19]=createBaseVNode("i",{class:"fas fa-share mr-2 text-pink-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.shareCount")),1)]),createBaseVNode("span",_hoisted_65,toDisplayString(userStats.value.total_shares||0),1)])]),createBaseVNode("div",_hoisted_66,[createBaseVNode("div",_hoisted_67,[createBaseVNode("span",_hoisted_68,[_cache[20]||(_cache[20]=createBaseVNode("i",{class:"fas fa-clock mr-2 text-indigo-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.lastLogin")),1)]),createBaseVNode("span",_hoisted_69,toDisplayString(userStats.value.last_login||unref($t)("admin.users.detail.never")),1)])])])])]),createBaseVNode("div",_hoisted_70,[createBaseVNode("h3",_hoisted_71,[_cache[21]||(_cache[21]=createBaseVNode("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-red-500/20"},[createBaseVNode("i",{class:"fas fa-tools text-red-400"})],-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.quickActions")),1)]),createBaseVNode("div",_hoisted_72,[createBaseVNode("div",_hoisted_73,[createVNode(_component_cyberButton,{type:"secondary",loading:resetPasswordLoading.value,class:"w-full justify-center border-0 shadow-sm",onClick:resetPassword},{default:withCtx(()=>[_cache[22]||(_cache[22]=createBaseVNode("i",{class:"fas fa-key mr-2 text-yellow-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.actions.resetPassword")),1)]),_:1},8,["loading"]),createBaseVNode("p",_hoisted_74,toDisplayString(unref($t)("admin.users.detail.actions.resetPasswordDesc")),1)]),createBaseVNode("div",_hoisted_75,[createVNode(_component_cyberButton,{type:"secondary",class:"w-full justify-center border-0 shadow-sm",onClick:_cache[4]||(_cache[4]=$event=>showEmailDialog.value=!0)},{default:withCtx(()=>[_cache[23]||(_cache[23]=createBaseVNode("i",{class:"fas fa-envelope mr-2 text-blue-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.detail.actions.sendEmail")),1)]),_:1}),createBaseVNode("p",_hoisted_76,toDisplayString(unref($t)("admin.users.detail.actions.sendEmailDesc")),1)]),createBaseVNode("div",_hoisted_77,[createVNode(_component_cyberButton,{type:userDetail.value.status===1?"danger":"success",loading:toggleStatusLoading.value,class:"w-full justify-center border-0 shadow-sm",onClick:toggleStatus},{default:withCtx(()=>[createBaseVNode("i",{class:normalizeClass(["mr-2",[userDetail.value.status===1?"fas fa-ban text-red-400":"fas fa-check text-green-400"]])},null,2),createTextVNode(" "+toDisplayString(userDetail.value.status===1?unref($t)("admin.users.detail.actions.disableUser"):unref($t)("admin.users.detail.actions.enableUser")),1)]),_:1},8,["type","loading"]),createBaseVNode("p",_hoisted_78,toDisplayString(userDetail.value.status===1?unref($t)("admin.users.detail.actions.disableUserDesc"):unref($t)("admin.users.detail.actions.enableUserDesc")),1)])])])])):(openBlock(),createElementBlock("div",_hoisted_79,[createVNode(_component_cyberLoading,{visible:!0,text:unref($t)("admin.users.detail.loading")},null,8,["text"])]))]),_:1},8,["modelValue","title"]),createVNode(_sfc_main$3,{modelValue:showEmailDialog.value,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>showEmailDialog.value=$event),user:userDetail.value,onEmailSent:handleEmailSent},null,8,["modelValue","user"])])}}});const UserDetailDrawer=_export_sfc(_sfc_main$2,[["__scopeId","data-v-4b33e181"]]),_hoisted_1$1={key:0,class:"batch-operations"},_hoisted_2$1={class:"batch-operations-container"},_hoisted_3$1={class:"flex items-center space-x-3"},_hoisted_4$1={class:"text-sm font-medium text-content"},_hoisted_5$1={class:"flex flex-wrap items-center space-x-1.5"},_hoisted_6$1={class:"role-checkbox-group"},_hoisted_7$1={class:"role-actions"},_hoisted_8$1={class:"disable-confirm-content"},_hoisted_9$1={class:"warning-message"},_hoisted_10$1={class:"warning-title"},_hoisted_11$1={class:"warning-text"},_hoisted_12$1={class:"warning-item"},_hoisted_13$1={class:"warning-item"},_hoisted_14$1={class:"warning-item"},_hoisted_15$1={class:"flex justify-end gap-2 p-4"},_hoisted_16$1={key:1,style:{display:"none"}},_sfc_main$1=defineComponent({__name:"BatchOperations",props:{selectedUsers:{},allUsers:{}},emits:["clearSelection","batchCompleted"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,toast=useToast(),{$t}=useTexts(),enableLoading=ref(!1),disableLoading=ref(!1),roleLoading=ref(!1),deleteLoading=ref(!1),exportLoading=ref(!1);ref("");const showRoleSelector=ref(!1),selectedRoles=ref([]),roleButtonRef=ref(null),dropdownPosition=ref({top:0,left:0,width:0}),showBatchDisableDialog=ref(!1),roleOptions=[{label:$t("admin.users.roles.normal"),value:"3"},{label:$t("admin.users.roles.superAdmin"),value:"1"}],updateDropdownPosition=()=>{if(roleButtonRef.value){const rect=roleButtonRef.value.getBoundingClientRect();dropdownPosition.value={top:rect.bottom+4,left:rect.left,width:rect.width}}},toggleRoleSelector=()=>{showRoleSelector.value=!showRoleSelector.value,showRoleSelector.value&&nextTick(()=>{updateDropdownPosition()})},handlePositionUpdate=()=>{showRoleSelector.value&&updateDropdownPosition()};onMounted(()=>{window.addEventListener("scroll",handlePositionUpdate,!0),window.addEventListener("resize",handlePositionUpdate)}),onUnmounted(()=>{window.removeEventListener("scroll",handlePositionUpdate,!0),window.removeEventListener("resize",handlePositionUpdate)});const clearSelection=()=>{emit("clearSelection")},handleBatchEnable=async()=>{await performBatchOperation("enable",$t("admin.users.batch.enable"),void 0,enableLoading)},handleBatchDisable=()=>{if(props.selectedUsers.length===0){toast.warning($t("admin.users.batch.noSelection"));return}showBatchDisableDialog.value=!0},confirmBatchDisable=async()=>{showBatchDisableDialog.value=!1,await performBatchOperation("disable",$t("admin.users.batch.disable"),void 0,disableLoading)},cancelBatchDisable=()=>{showBatchDisableDialog.value=!1},toggleRoleSelection=(value,checked)=>{if(checked)selectedRoles.value.includes(value)||selectedRoles.value.push(value);else{const index2=selectedRoles.value.indexOf(value);index2>-1&&selectedRoles.value.splice(index2,1)}},applyRoleSelection=async()=>{if(selectedRoles.value.length===0){toast.warning($t("admin.users.batch.selectRole"));return}const roleToSet=selectedRoles.value[0];await performBatchOperation("set_role",$t("admin.users.batch.setRole"),parseInt(roleToSet),roleLoading),selectedRoles.value=[],showRoleSelector.value=!1},cancelRoleSelection=()=>{selectedRoles.value=[],showRoleSelector.value=!1},handleBatchDelete=async()=>{await performBatchOperation("delete",$t("admin.users.batch.delete"),void 0,deleteLoading)},performBatchOperation=async(operation,operationName,role,loadingRef)=>{if(props.selectedUsers.length===0){toast.warning($t("admin.users.batch.noSelection"));return}loadingRef&&(loadingRef.value=!0);try{const{batchOperateUsers:batchOperateUsers2}=await __vitePreload(()=>Promise.resolve().then(()=>index$2),void 0),params={user_ids:props.selectedUsers,operation};operation==="set_role"&&role&&(params.role=role);const result=await batchOperateUsers2(params);result.success?(toast.success($t("admin.users.toast.success",{operation:operationName})),emit("batchCompleted"),emit("clearSelection")):toast.error(result.message||$t("admin.users.toast.error",{operation:operationName}))}catch(error){toast.error(error?.message||$t("admin.users.toast.error",{operation:operationName}))}loadingRef&&(loadingRef.value=!1)},handleExport=async()=>{if(props.selectedUsers.length===0){toast.warning($t("admin.users.batch.selectUsersToExport"));return}exportLoading.value=!0;try{const exportData=props.allUsers.filter(user=>props.selectedUsers.includes(user.id)).map(user=>({[$t("admin.users.export.id")]:user.id,[$t("admin.users.export.username")]:user.username,[$t("admin.users.export.email")]:user.email,[$t("admin.users.export.status")]:getStatusText(user.status),[$t("admin.users.export.role")]:getRoleText(user.role),[$t("admin.users.export.createdAt")]:user.created_at,[$t("admin.users.export.updatedAt")]:user.updated_at})),csvContent=generateCSV(exportData);downloadCSV(csvContent,`${$t("admin.users.export.filename")}_${new Date().toISOString().split("T")[0]}.csv`),toast.success($t("admin.users.toast.exportSuccess"))}catch{toast.error($t("admin.users.toast.exportError"))}exportLoading.value=!1},generateCSV=data=>{if(data.length===0)return"";const headers=Object.keys(data[0]),csvRows=[];csvRows.push(headers.join(","));for(const row of data){const values=headers.map(header=>{const value=row[header];return typeof value=="string"&&(value.includes(",")||value.includes('"'))?`"${value.replace(/"/g,'""')}"`:value});csvRows.push(values.join(","))}return csvRows.join(`
`)},downloadCSV=(csvContent,filename)=>{const blob=new Blob([`\uFEFF${csvContent}`],{type:"text/csv;charset=utf-8;"}),link=document.createElement("a");if(link.download!==void 0){const url=URL.createObjectURL(blob);link.setAttribute("href",url),link.setAttribute("download",filename),link.style.visibility="hidden",document.body.appendChild(link),link.click(),document.body.removeChild(link)}},getStatusText=status=>{switch(status){case 1:return $t("admin.users.status.active");case 2:return $t("admin.users.status.disabled");case 3:return $t("admin.users.status.deleted");default:return $t("admin.users.status.unknown")}},getRoleText=role=>{switch(role){case 1:return $t("admin.users.roles.superAdmin");case 2:return $t("admin.users.roles.admin");case 3:return $t("admin.users.roles.normal");default:return $t("admin.users.roles.unknown")}};return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberPopconfirm=resolveComponent("CyberPopconfirm"),_component_CyberCheckbox=resolveComponent("CyberCheckbox"),_component_CyberDialog=resolveComponent("CyberDialog");return __props.selectedUsers.length>0?(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("span",_hoisted_4$1,toDisplayString(unref($t)("admin.users.batch.selected",{count:__props.selectedUsers.length})),1),createVNode(_component_CyberButton,{type:"ghost",class:"text-xs",onClick:clearSelection},{default:withCtx(()=>[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.clearSelection")),1)]),_:1})]),createBaseVNode("div",_hoisted_5$1,[createVNode(_component_CyberButton,{type:"primary",loading:enableLoading.value,onClick:handleBatchEnable},{default:withCtx(()=>[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-check mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.enable")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"danger",loading:disableLoading.value,onClick:handleBatchDisable},{default:withCtx(()=>[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-ban mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.disable")),1)]),_:1},8,["loading"]),createBaseVNode("div",{ref_key:"roleButtonRef",ref:roleButtonRef,class:"role-selector-dropdown"},[createVNode(_component_CyberButton,{type:"secondary",loading:roleLoading.value,class:normalizeClass({active:showRoleSelector.value}),onClick:toggleRoleSelector},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-user-cog mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.role"))+" ",1),createBaseVNode("i",{class:normalizeClass(["fas fa-chevron-down ml-1",{"rotate-180":showRoleSelector.value}])},null,2)]),_:1},8,["loading","class"])],512),createVNode(_component_CyberPopconfirm,{title:unref($t)("admin.users.confirm.delete"),onConfirm:handleBatchDelete},{default:withCtx(()=>[createVNode(_component_CyberButton,{type:"danger",loading:deleteLoading.value},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-trash mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.delete")),1)]),_:1},8,["loading"])]),_:1},8,["title"]),createVNode(_component_CyberButton,{type:"secondary",loading:exportLoading.value,onClick:handleExport},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-download mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.export")),1)]),_:1},8,["loading"])])]),(openBlock(),createBlock(Teleport,{to:"body"},[showRoleSelector.value?(openBlock(),createElementBlock("div",{key:0,class:"role-selector-panel",style:normalizeStyle({top:`${dropdownPosition.value.top}px`,left:`${dropdownPosition.value.left}px`,minWidth:`${dropdownPosition.value.width}px`})},[createBaseVNode("div",_hoisted_6$1,[(openBlock(),createElementBlock(Fragment,null,renderList(roleOptions,option=>createVNode(_component_CyberCheckbox,{key:option.value,"model-value":selectedRoles.value.includes(option.value),class:"role-checkbox-item","onUpdate:modelValue":checked=>toggleRoleSelection(option.value,checked)},{default:withCtx(()=>[createTextVNode(toDisplayString(option.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"])),64)),createBaseVNode("div",_hoisted_7$1,[createVNode(_component_CyberButton,{type:"primary",size:"small",loading:roleLoading.value,disabled:selectedRoles.value.length===0,onClick:applyRoleSelection},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.batch.apply")),1)]),_:1},8,["loading","disabled"]),createVNode(_component_CyberButton,{type:"secondary",size:"small",onClick:cancelRoleSelection},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.batch.cancel")),1)]),_:1})])])],4)):createCommentVNode("",!0)])),createVNode(_component_CyberDialog,{modelValue:showBatchDisableDialog.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>showBatchDisableDialog.value=$event),title:unref($t)("admin.users.confirm.batchDisable"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_15$1,[createVNode(_component_CyberButton,{type:"outlined",onClick:cancelBatchDisable},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.batch.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"danger",loading:disableLoading.value,onClick:confirmBatchDisable},{default:withCtx(()=>[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-ban mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.batch.confirmDisable")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_8$1,[_cache[10]||(_cache[10]=createBaseVNode("div",{class:"warning-icon"},[createBaseVNode("i",{class:"fas fa-exclamation-triangle"})],-1)),createBaseVNode("div",_hoisted_9$1,[createBaseVNode("h3",_hoisted_10$1,toDisplayString(unref($t)("admin.users.confirm.disableTitle",{count:__props.selectedUsers.length})),1),createBaseVNode("div",_hoisted_11$1,[createBaseVNode("p",_hoisted_12$1,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-info-circle"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.confirm.disableMessage1")),1)]),createBaseVNode("p",_hoisted_13$1,[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-sign-out-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.confirm.disableMessage2")),1)]),createBaseVNode("p",_hoisted_14$1,[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-lock"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.confirm.disableMessage3")),1)])])])])]),_:1},8,["modelValue","title"])])):(openBlock(),createElementBlock("div",_hoisted_16$1))}}});const BatchOperations=_export_sfc(_sfc_main$1,[["__scopeId","data-v-a6bad2e8"]]),_hoisted_1={class:"admin-users-page admin-page-container"},_hoisted_2={class:"admin-content-wrapper"},_hoisted_3={class:"table-container"},_hoisted_4={class:"table-wrapper"},_hoisted_5={key:0,class:"admin-loading"},_hoisted_6={key:1,class:"empty-state"},_hoisted_7={class:"empty-content"},_hoisted_8={class:"empty-title"},_hoisted_9={class:"empty-desc"},_hoisted_10={key:0,class:"pagination-wrapper"},_hoisted_11={class:"flex justify-end gap-2 p-4"},_hoisted_12={class:"disable-confirm-content"},_hoisted_13={class:"warning-message"},_hoisted_14={class:"warning-title"},_hoisted_15={class:"warning-text"},_hoisted_16={class:"warning-item"},_hoisted_17={class:"warning-item"},_hoisted_18={class:"warning-item"},_hoisted_19={class:"flex justify-end gap-2 p-4"},_sfc_main=defineComponent({name:"AdminUsers",__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),dataTableColumns=computed(()=>[{key:"username",title:$t("admin.users.columns.user"),width:160,align:"left",render:(value,record)=>h("div",{class:"flex items-center"},[h("div",{class:"mr-3"},[h("CyberUserAvatar",{avatarUrl:record.avatar_full_path,username:record.username,size:"sm"})]),h("div",{},[h("div",{class:"font-medium",style:{color:"var(--color-content-default)"}},record.username),h("div",{class:"text-xs",style:{color:"var(--color-content-muted)"}},`ID: ${record.id}`)])])},{key:"email",title:$t("admin.users.columns.email"),dataIndex:"email",width:200,align:"center",ellipsis:!0},{key:"created_at",title:$t("admin.users.columns.registeredAt"),width:180,align:"center",render:value=>formatDate(value)},{key:"last_activity_at",title:$t("admin.users.columns.lastActivity"),width:160,align:"center",render:(value,record)=>h("div",{class:"last-activity-cell"},[record.last_activity_at?h("div",{class:"activity-time"},formatDate(record.last_activity_at)):h("div",{class:"no-activity"},$t("admin.users.columns.neverActive")),record.last_activity_ip?h("div",{class:"activity-ip",title:record.last_activity_ip},record.last_activity_ip):null])},{key:"status",title:$t("admin.users.columns.status"),width:80,align:"center",render:(value,record)=>h("span",{class:"inline-block whitespace-nowrap rounded px-2 py-1 text-xs font-medium",style:record.status===1?{background:"rgba(var(--color-success-rgb), 0.2)",color:"var(--color-success-400)"}:record.status===2?{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)"}:{}},getStatusText(record.status))},{key:"role",title:$t("admin.users.columns.role"),width:100,align:"center",render:(value,record)=>h("span",{class:"inline-block whitespace-nowrap text-xs font-medium",style:{color:record.role===1?"var(--color-error-500)":record.role===2?"var(--color-brand-500)":"var(--color-content-muted)"}},getRoleText(record.role))},{key:"storage",title:$t("admin.users.columns.storage"),width:180,align:"center",render:(value,record)=>h("div",{class:"storage-cell"},[h("div",{class:"storage-item"},[h("span",{class:"storage-label"},`${$t("admin.users.columns.storageLabel")}:`),h("span",{class:"storage-value"},`${formatStorageSize(record.used_storage||0)}/${formatStorageSize(record.storage_limit||0)}`)]),h("div",{class:"storage-item"},[h("span",{class:"storage-label"},`${$t("admin.users.columns.bandwidthLabel")}:`),h("span",{class:"storage-value"},`${formatStorageSize(record.used_bandwidth||0)}/${formatStorageSize(record.bandwidth_limit||0)}`)])])},{key:"actions",title:$t("admin.users.columns.actions"),width:120,align:"center",render:(value,record)=>h("div",{class:"action-buttons flex gap-1 justify-center items-center"},[h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs border rounded transition-colors",style:{background:"rgba(var(--color-brand-500-rgb), 0.2)",color:"var(--color-brand-500)",borderColor:"rgba(var(--color-brand-500-rgb), 0.3)"},title:$t("admin.users.actions.view"),onClick:()=>viewUserDetail(record.id),onMouseenter:e=>{e.target.style.background="rgba(var(--color-brand-500-rgb), 0.3)"},onMouseleave:e=>{e.target.style.background="rgba(var(--color-brand-500-rgb), 0.2)"}},[h("i",{class:"fas fa-eye"})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs border rounded transition-colors focus:outline-none",style:{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-500)",borderColor:"rgba(var(--color-error-rgb), 0.4)"},title:$t("admin.users.actions.edit"),onClick:()=>editUser(record),onMouseenter:e=>{e.target.style.background="rgba(var(--color-error-rgb), 0.3)"},onMouseleave:e=>{e.target.style.background="rgba(var(--color-error-rgb), 0.2)"}},[h("i",{class:"fas fa-edit"})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs border rounded transition-colors",style:record.status===1?{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)",borderColor:"rgba(var(--color-error-rgb), 0.3)"}:{background:"rgba(var(--color-success-rgb), 0.2)",color:"var(--color-success-400)",borderColor:"rgba(var(--color-success-rgb), 0.3)"},title:record.status===1?$t("admin.users.actions.disable"):$t("admin.users.actions.enable"),onClick:()=>{record.status===1?(userToDisable.value=record,showDisableConfirmDialog.value=!0):showConfirm($t("admin.users.confirm.enableUser"))&&toggleUserStatus$1(record)},onMouseenter:e=>{record.status===1?e.target.style.background="rgba(var(--color-error-rgb), 0.3)":e.target.style.background="rgba(var(--color-success-rgb), 0.3)"},onMouseleave:e=>{record.status===1?e.target.style.background="rgba(var(--color-error-rgb), 0.2)":e.target.style.background="rgba(var(--color-success-rgb), 0.2)"}},[h("i",{class:record.status===1?"fas fa-ban":"fas fa-check"})])])}]),users=ref([]),loading=ref(!1),saveLoading=ref(!1),totalUsers=ref(0),currentPage=ref(1),pageSize=ref(10),showFilter=ref(!1),currentFilters=reactive({keyword:"",status:"0",role:"0",sort_by:"",start_date:"",end_date:""}),showEditDialog=ref(!1),currentEditUser=ref(null),showCreateDialog=ref(!1),showDetailDrawer=ref(!1),selectedDetailUserId=ref(null),selectedDetailUserData=ref(null),showDisableConfirmDialog=ref(!1),userToDisable=ref(null),selectedUserIds=ref([]);computed(()=>users.value.length>0&&selectedUserIds.value.length===users.value.length);const fetchUserList=async()=>{loading.value=!0;const params={page:currentPage.value,size:pageSize.value,keyword:currentFilters.keyword||void 0,status:currentFilters.status!=="0"?parseInt(currentFilters.status):void 0,role:currentFilters.role!=="0"?parseInt(currentFilters.role):void 0,start_date:currentFilters.start_date||void 0,end_date:currentFilters.end_date||void 0,sort_by:currentFilters.sort_by||void 0};try{const result=await getUserList(params);if(result.success){const{data}=result;users.value=data.list,totalUsers.value=data.total,selectedUserIds.value=selectedUserIds.value.filter(id=>users.value.some(user=>user.id===id))}}catch{}loading.value=!1},handleFilter=filters=>{Object.assign(currentFilters,filters),currentPage.value=1,selectedUserIds.value=[],fetchUserList(),showFilter.value=!1},handlePageChange=page=>{currentPage.value=page,fetchUserList()},handlePageSizeChange=size=>{pageSize.value=size,currentPage.value=1,fetchUserList()},editUser=user=>{currentEditUser.value=JSON.parse(JSON.stringify(user)),showEditDialog.value=!0},saveUserChanges=async()=>{if(!currentEditUser.value)return;saveLoading.value=!0;const userData={id:currentEditUser.value.id,username:currentEditUser.value.username,status:currentEditUser.value.status,role:currentEditUser.value.role};try{if((await updateUser(userData)).success){const index2=users.value.findIndex(u=>u.id===currentEditUser.value?.id);index2!==-1&&(users.value[index2]={...currentEditUser.value}),toast.success($t("admin.users.toast.userUpdated")),showEditDialog.value=!1,fetchUserList()}}catch{}saveLoading.value=!1},toggleUserStatus$1=async user=>{const newStatus=user.status===1?2:1;try{if((await toggleUserStatus(user.id,newStatus)).success){const index2=users.value.findIndex(u=>u.id===user.id);index2!==-1&&(users.value[index2].status=newStatus),toast.success($t(newStatus===1?"admin.users.toast.userEnabled":"admin.users.toast.userDisabled"))}}catch{}},confirmDisableUser=()=>{userToDisable.value&&(toggleUserStatus$1(userToDisable.value),showDisableConfirmDialog.value=!1,userToDisable.value=null)},cancelDisableUser=()=>{showDisableConfirmDialog.value=!1,userToDisable.value=null},getStatusText=status=>{switch(status){case 1:return $t("admin.users.statusText.normal");case 2:return $t("admin.users.statusText.disabled");case 3:return $t("admin.users.statusText.deleted");default:return $t("admin.users.statusText.unknown")}},getRoleText=role=>{switch(role){case 1:return $t("admin.users.role.superAdmin");case 2:return $t("admin.users.role.admin");case 3:return $t("admin.users.role.user");default:return $t("admin.users.role.unknown")}},viewUserDetail=userId=>{const userData=users.value.find(user=>user.id===userId);userData?(selectedDetailUserId.value=userId,selectedDetailUserData.value=userData,showDetailDrawer.value=!0):toast.error($t("admin.users.toast.userDataNotFound"))},handleRefresh=()=>{selectedUserIds.value=[],fetchUserList()},handleUserCreated=_newUser=>{fetchUserList()},handleUserUpdated=updatedUser=>{const index2=users.value.findIndex(u=>u.id===updatedUser.id);index2!==-1&&(users.value[index2]={...updatedUser})},handleBatchCompleted=()=>{fetchUserList()},clearSelection=()=>{selectedUserIds.value=[]},handleRowClick=(_row,_index)=>{},handleSelectionChange=selectedRows=>{selectedUserIds.value=selectedRows.map(id=>Number(id))},formatStorageSize=bytes=>{if(bytes===0)return"0 B";const k=1024,sizes=["B","KB","MB","GB","TB"],i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`};return onMounted(()=>{fetchUserList()}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberLoading=resolveComponent("CyberLoading"),_component_CyberDataTable=resolveComponent("CyberDataTable"),_component_CyberPagination=resolveComponent("CyberPagination"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.users.title"),subtitle:unref($t)("admin.users.subtitle"),icon:"fas fa-users","show-topbar":showFilter.value},{actions:withCtx(()=>[createVNode(_component_CyberButton,{type:"primary",icon:"plus",onClick:_cache[0]||(_cache[0]=$event=>showCreateDialog.value=!0)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.createUser")),1)]),_:1}),createVNode(_component_CyberButton,{type:"secondary",loading:loading.value,"loading-mode":"inline",icon:"sync-alt",onClick:handleRefresh},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.actions.refresh")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"outlined",icon:"filter",class:normalizeClass({"border-error-500 text-error-500":showFilter.value}),onClick:_cache[1]||(_cache[1]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.filter")),1)]),_:1},8,["class"])]),topbar:withCtx(()=>[createVNode(UserFilterPanel,{"initial-filters":currentFilters,onFilter:handleFilter},null,8,["initial-filters"])]),content:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(BatchOperations,{"selected-users":selectedUserIds.value,"all-users":users.value,onClearSelection:clearSelection,onBatchCompleted:handleBatchCompleted},null,8,["selected-users","all-users"]),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[loading.value?(openBlock(),createElementBlock("div",_hoisted_5,[createVNode(_component_CyberLoading,{visible:!0,text:unref($t)("admin.users.loading.users")},null,8,["text"])])):!loading.value&&users.value.length===0?(openBlock(),createElementBlock("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[_cache[10]||(_cache[10]=createBaseVNode("div",{class:"empty-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-users empty-icon"})],-1)),createBaseVNode("h3",_hoisted_8,toDisplayString(unref($t)("admin.users.empty.title")),1),createBaseVNode("p",_hoisted_9,toDisplayString(unref($t)("admin.users.empty.description")),1),createVNode(_component_CyberButton,{type:"secondary",onClick:handleRefresh},{default:withCtx(()=>[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-redo mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.empty.resetFilter")),1)]),_:1})])])):(openBlock(),createBlock(_component_CyberDataTable,{key:2,data:users.value,columns:dataTableColumns.value,loading:loading.value,selectable:!0,hoverable:!0,striped:!0,bordered:!0,size:"small","row-key":"id","selected-row-keys":selectedUserIds.value,"loading-text":unref($t)("admin.users.loading.users"),"onUpdate:selectedRowKeys":handleSelectionChange,onRowClick:handleRowClick},null,8,["data","columns","loading","selected-row-keys","loading-text"]))]),totalUsers.value>0?(openBlock(),createElementBlock("div",_hoisted_10,[createVNode(_component_CyberPagination,{"current-page":currentPage.value,"onUpdate:currentPage":[_cache[2]||(_cache[2]=$event=>currentPage.value=$event),handlePageChange],total:totalUsers.value,"page-size":pageSize.value,"show-page-size-selector":!0,"show-quick-jumper":!0,class:"compact-pagination","onUpdate:pageSize":handlePageSizeChange},null,8,["current-page","total","page-size"])])):createCommentVNode("",!0)])])]),_:1},8,["title","subtitle","show-topbar"]),createVNode(_component_CyberDialog,{modelValue:showEditDialog.value,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>showEditDialog.value=$event),title:unref($t)("admin.users.editDialog.title"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_11,[createVNode(_component_CyberButton,{type:"outlined",onClick:_cache[4]||(_cache[4]=$event=>showEditDialog.value=!1)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",loading:saveLoading.value,onClick:saveUserChanges},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.editDialog.saveChanges")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createVNode(UserForm,{modelValue:currentEditUser.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>currentEditUser.value=$event)},null,8,["modelValue"])]),_:1},8,["modelValue","title"]),createVNode(_component_CyberDialog,{modelValue:showDisableConfirmDialog.value,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>showDisableConfirmDialog.value=$event),title:unref($t)("admin.users.disableWarning.title"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_19,[createVNode(_component_CyberButton,{type:"outlined",onClick:cancelDisableUser},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.users.buttons.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"danger",onClick:confirmDisableUser},{default:withCtx(()=>[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-ban mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.disableWarning.confirmButton")),1)]),_:1})])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_12,[_cache[14]||(_cache[14]=createBaseVNode("div",{class:"warning-icon"},[createBaseVNode("i",{class:"fas fa-exclamation-triangle"})],-1)),createBaseVNode("div",_hoisted_13,[createBaseVNode("h3",_hoisted_14,toDisplayString(unref($t)("admin.users.disableWarning.warning",{username:userToDisable.value?.username})),1),createBaseVNode("div",_hoisted_15,[createBaseVNode("p",_hoisted_16,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-info-circle"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.disableWarning.consequence1")),1)]),createBaseVNode("p",_hoisted_17,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-sign-out-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.disableWarning.consequence2")),1)]),createBaseVNode("p",_hoisted_18,[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-lock"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.users.disableWarning.consequence3")),1)])])])])]),_:1},8,["modelValue","title"]),createVNode(_sfc_main$4,{modelValue:showCreateDialog.value,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>showCreateDialog.value=$event),onUserCreated:handleUserCreated},null,8,["modelValue"]),createVNode(UserDetailDrawer,{modelValue:showDetailDrawer.value,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>showDetailDrawer.value=$event),"user-id":selectedDetailUserId.value,"user-data":selectedDetailUserData.value,onUserUpdated:handleUserUpdated},null,8,["modelValue","user-id","user-data"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-353c075f"]]);export{index as default};
