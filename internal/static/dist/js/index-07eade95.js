import{j as useTexts,_ as _export_sfc,J as getCurrentLocale,aS as useTextThemeStore,X as __unplugin_components_0,ah as post,x as get,q as useToast,g as getSettings,b as batchUpsertSettings}from"./index-4d0dab4c.js";import{u as useWebSocketStore}from"./websocket-2c9a6d8f.js";import{g as getVectorStats,r as reconcileMissing,c as cleanOrphans,a as rebuildStale,b as recoverStuckTasks,d as getVectorList,e as getQdrantRealStats,f as getAvailableModels,h as getVectorLogs,i as retryVector,j as batchVectorAction,k as getAutoProcessing,l as regenerateAllVectors,m as retryAllFailedVectors,s as setAutoProcessing,n as setConcurrency}from"./index-fbd281f9.js";import{d as defineComponent,r as ref,c as computed,b as onMounted,G as resolveDirective,H as withDirectives,z as openBlock,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,R as normalizeClass,F as Fragment,M as renderList,K as createCommentVNode,a as reactive,w as watch,E as resolveComponent,f as createVNode,L as withCtx,ab as createTextVNode,A as createBlock,$ as vShow,a6 as Transition,o as onUnmounted,Q as normalizeStyle,i as isRef}from"./vue-vendor-31320f47.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const _hoisted_1$6={class:"vector-status-card"},_hoisted_2$6={class:"card-header"},_hoisted_3$6={class:"worker-info"},_hoisted_4$6={class:"text-content-content-muted text-xs"},_hoisted_5$6={class:"connection-status"},_hoisted_6$6={class:"status-text text-xs"},_hoisted_7$6={class:"last-update"},_hoisted_8$6={class:"update-time"},_hoisted_9$6={class:"status-grid"},_hoisted_10$6=["onClick"],_hoisted_11$6={class:"status-content"},_hoisted_12$6={class:"status-label"},_hoisted_13$6={class:"status-count"},_hoisted_14$6={class:"summary-info"},_hoisted_15$6={class:"summary-item"},_hoisted_16$5={class:"summary-label"},_hoisted_17$5={class:"summary-value"},_hoisted_18$5={class:"summary-item"},_hoisted_19$5={class:"summary-label"},_hoisted_20$5={class:"summary-value"},_sfc_main$6=defineComponent({__name:"VectorStatusCard",props:{selectedStatus:{},isLoading:{type:Boolean}},emits:["select"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),webSocketStore=useWebSocketStore(),fallbackVectorStats=ref(null),lastUpdate=ref(new Date),statsLoading=ref(!1),useWebSocketMode=ref(!0),ws=computed(()=>webSocketStore.vectorStats),stats=computed(()=>ws.value?.queue_stats||fallbackVectorStats.value);computed(()=>ws.value?.coverage||null),computed(()=>ws.value?.divergence||null);const lastUpdatedText=computed(()=>{const updateTime=useWebSocketMode.value?webSocketStore.lastUpdated:lastUpdate.value,diff=new Date().getTime()-updateTime.getTime(),seconds=Math.floor(diff/1e3);if(seconds<60)return $t("admin.vectors.status.updatedSecondsAgo",{seconds});const minutes=Math.floor(seconds/60);return $t("admin.vectors.status.updatedMinutesAgo",{minutes})}),isConnected=computed(()=>webSocketStore.isConnected),connectionStatus=computed(()=>webSocketStore.connectionStatus),connectionStatusText=computed(()=>useWebSocketMode.value?webSocketStore.connectionStatusText:$t("admin.vectors.status.scheduledUpdate")),workerInfo=computed(()=>ws.value?.runtime?{current:ws.value.runtime.active_workers||0,max:ws.value.runtime.configured_concurrency||0}:{current:0,max:0}),loadVectorStats=async()=>{if(!statsLoading.value){statsLoading.value=!0;try{const result=await getVectorStats();if(result&&(result.success===!0||result.code===200)&&result.data&&typeof result.data=="object"){const data=result.data,q=data.queue_stats??data,rt=data.runtime??{};fallbackVectorStats.value={total_count:q.total_count||0,pending_count:q.pending_count||0,running_count:q.processing_count??q.running_count??0,completed_count:q.completed_count||0,failed_count:q.failed_count||0,reset_count:q.reset_count||0,active_workers:rt.active_workers||data.active_workers||0,max_workers:rt.configured_concurrency||data.max_workers||0},useWebSocketMode.value||(lastUpdate.value=new Date)}}catch{fallbackVectorStats.value=null}finally{statsLoading.value=!1}}};onMounted(async()=>{await loadVectorStats()});const completionRate=computed(()=>!stats.value||stats.value.total_count===0?0:Math.round(stats.value.completed_count/stats.value.total_count*100)),hasQueueActivity=computed(()=>{if(!stats.value)return!1;const statsValue=stats.value,running=statsValue.running_count??statsValue.processing_count??0;return workerInfo.value.current>0||(stats.value.pending_count||0)>0||running>0});__expose({refresh:loadVectorStats,hasActivity:hasQueueActivity,isConnected:webSocketStore.isConnected,connectionStatus:webSocketStore.connectionStatusText});const statusList=computed(()=>[{key:"all",label:$t("admin.vectors.filter.options.all"),icon:"fas fa-list",iconClass:"icon-all"},{key:"pending",label:$t("admin.vectors.status.indexing"),icon:"fas fa-clock",iconClass:"icon-pending"},{key:"running",label:$t("admin.vectors.status.processing"),icon:"fas fa-spinner animate-spin",iconClass:"icon-running"},{key:"completed",label:$t("admin.vectors.status.active"),icon:"fas fa-check-circle",iconClass:"icon-completed"},{key:"failed",label:$t("admin.vectors.status.error"),icon:"fas fa-exclamation-circle",iconClass:"icon-failed"}]),getStatusCount=status=>{if(!stats.value)return 0;switch(status){case"all":return stats.value.total_count||0;case"pending":return stats.value.pending_count||0;case"running":{const statsValue=stats.value;return statsValue.running_count??statsValue.processing_count??0}case"completed":return stats.value.completed_count||0;case"failed":return stats.value.failed_count||0;default:return 0}},selectStatus=status=>{const mappedStatus={all:"",pending:"pending",running:"processing",completed:"completed",failed:"failed"}[status]||status;emit("select",mappedStatus===props.selectedStatus?"":mappedStatus)},getStatusItemClass=status=>{const mappedStatus={all:"",pending:"pending",running:"processing",completed:"completed",failed:"failed",reset:"reset"}[status],isSelected=props.selectedStatus===mappedStatus,baseClass="status-item";return isSelected?`${baseClass} status-item-selected`:baseClass};return(_ctx,_cache)=>{const _directive_loading=resolveDirective("loading");return withDirectives((openBlock(),createElementBlock("div",_hoisted_1$6,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$6,[createBaseVNode("span",_hoisted_4$6,toDisplayString(unref($t)("admin.vectors.qdrant.workerThreads"))+": "+toDisplayString(workerInfo.value.current)+"/"+toDisplayString(workerInfo.value.max),1),createBaseVNode("div",_hoisted_5$6,[createBaseVNode("i",{class:normalizeClass({"fas fa-wifi":isConnected.value&&useWebSocketMode.value,"fas fa-wifi text-green-500":isConnected.value&&useWebSocketMode.value,"fas fa-exclamation-triangle text-yellow-500":connectionStatus.value==="reconnecting","fas fa-times-circle text-red-500":connectionStatus.value==="error"||connectionStatus.value==="disconnected","fas fa-clock":!useWebSocketMode.value})},null,2),createBaseVNode("span",_hoisted_6$6,toDisplayString(connectionStatusText.value),1)]),createBaseVNode("div",_hoisted_7$6,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-clock mr-1"},null,-1)),createBaseVNode("span",_hoisted_8$6,toDisplayString(lastUpdatedText.value),1)])])]),createBaseVNode("div",_hoisted_9$6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(statusList.value,status=>(openBlock(),createElementBlock("div",{key:status.key,class:normalizeClass(getStatusItemClass(status.key)),onClick:$event=>selectStatus(status.key)},[createBaseVNode("div",{class:normalizeClass(["status-icon",status.iconClass])},[createBaseVNode("i",{class:normalizeClass(status.icon)},null,2)],2),createBaseVNode("div",_hoisted_11$6,[createBaseVNode("div",_hoisted_12$6,toDisplayString(status.label),1),createBaseVNode("div",_hoisted_13$6,toDisplayString(getStatusCount(status.key)),1)])],10,_hoisted_10$6))),128))]),createBaseVNode("div",_hoisted_14$6,[createBaseVNode("div",_hoisted_15$6,[createBaseVNode("span",_hoisted_16$5,toDisplayString(unref($t)("admin.vectors.pagination.total"))+":",1),createBaseVNode("span",_hoisted_17$5,toDisplayString(stats.value?.total_count||0),1)]),createBaseVNode("div",_hoisted_18$5,[createBaseVNode("span",_hoisted_19$5,toDisplayString(unref($t)("admin.vectors.qdrant.throughput"))+":",1),createBaseVNode("span",_hoisted_20$5,toDisplayString(completionRate.value)+"%",1)])])])),[[_directive_loading,props.isLoading]])}}});const VectorStatusCard=_export_sfc(_sfc_main$6,[["__scopeId","data-v-e9df4acb"]]);function formatText(template,params){let result=template;return Object.keys(params).forEach(key=>{result=result.replace(new RegExp(`\\{${key}\\}`,"g"),String(params[key]))}),result}function formatDistanceToNow(date){if(!date)return"-";try{const targetDate=typeof date=="string"?new Date(date):date,diffInSeconds=Math.floor((new Date().getTime()-targetDate.getTime())/1e3);if(diffInSeconds<0)return targetDate.toLocaleString(getCurrentLocale());const store=useTextThemeStore();if(diffInSeconds<60)return formatText(store.getText("utils.formatting.time.secondsAgo"),{seconds:diffInSeconds});const diffInMinutes=Math.floor(diffInSeconds/60);if(diffInMinutes<60)return formatText(store.getText("utils.formatting.time.minutesAgo"),{minutes:diffInMinutes});const diffInHours=Math.floor(diffInMinutes/60);if(diffInHours<24)return formatText(store.getText("utils.formatting.time.hoursAgo"),{hours:diffInHours});const diffInDays=Math.floor(diffInHours/24);if(diffInDays<7)return formatText(store.getText("utils.formatting.time.daysAgo"),{days:diffInDays});if(diffInDays<30){const diffInWeeks=Math.floor(diffInDays/7);return formatText(store.getText("utils.formatting.time.weeksAgo"),{weeks:diffInWeeks})}if(diffInDays<365){const diffInMonths=Math.floor(diffInDays/30);return formatText(store.getText("utils.formatting.time.monthsAgo"),{months:diffInMonths})}const diffInYears=Math.floor(diffInDays/365);return formatText(store.getText("utils.formatting.time.yearsAgo"),{years:diffInYears})}catch{if(typeof date=="string")try{return new Date(date).toLocaleString(getCurrentLocale())}catch{return date}return"-"}}const VECTOR_STATUS={PENDING:"pending",RUNNING:"running",COMPLETED:"completed",FAILED:"failed",RESET:"reset"},getStatusTextMap=()=>{const{$t}=useTexts();return{[VECTOR_STATUS.PENDING]:$t("admin.vectors.status.pending"),[VECTOR_STATUS.RUNNING]:$t("admin.vectors.status.running"),[VECTOR_STATUS.COMPLETED]:$t("admin.vectors.status.completed"),[VECTOR_STATUS.FAILED]:$t("admin.vectors.status.failed"),[VECTOR_STATUS.RESET]:$t("admin.vectors.status.reset")}};getStatusTextMap();const BATCH_ACTIONS={RETRY:"retry",RESET:"reset",DELETE:"delete"},getBatchActionTextMap=()=>{const{$t}=useTexts();return{[BATCH_ACTIONS.RETRY]:$t("admin.vectors.actions.retry"),[BATCH_ACTIONS.RESET]:$t("admin.vectors.actions.reset"),[BATCH_ACTIONS.DELETE]:$t("admin.vectors.actions.delete")}};getBatchActionTextMap();const getCollectionStatusTextMap=()=>{const{$t}=useTexts();return{healthy:$t("admin.vectors.collectionStatus.healthy"),empty_normal:$t("admin.vectors.collectionStatus.emptyNormal"),empty_but_should_have_data:$t("admin.vectors.collectionStatus.dataMissing"),partially_synced:$t("admin.vectors.collectionStatus.partiallySynced"),needs_resync:$t("admin.vectors.collectionStatus.needsResync"),engine_not_initialized:$t("admin.vectors.collectionStatus.engineNotInitialized"),qdrant_connection_failed:$t("admin.vectors.collectionStatus.qdrantConnectionFailed"),error:$t("admin.vectors.collectionStatus.error"),unknown:$t("admin.vectors.collectionStatus.unknown")}},COLLECTION_STATUS_TEXT_MAP=getCollectionStatusTextMap(),getModelDescriptions=()=>{const{$t}=useTexts();return{"text-embedding-3-small":$t("admin.vectors.modelDesc.small"),"text-embedding-3-large":$t("admin.vectors.modelDesc.large"),"text-embedding-ada-002":$t("admin.vectors.modelDesc.ada")}};getModelDescriptions();useTexts();const getCollectionStatusText=status=>COLLECTION_STATUS_TEXT_MAP[status]||status,_hoisted_1$5={key:0,class:"qdrant-stats-card"},_hoisted_2$5={class:"card-header"},_hoisted_3$5={class:"stats-grid"},_hoisted_4$5={class:"stat-item"},_hoisted_5$5={class:"label"},_hoisted_6$5={class:"value primary"},_hoisted_7$5={class:"stat-item"},_hoisted_8$5={class:"label"},_hoisted_9$5={class:"value"},_hoisted_10$5={class:"stat-item"},_hoisted_11$5={class:"label"},_hoisted_12$5={class:"value"},_hoisted_13$5={class:"stat-item"},_hoisted_14$5={class:"label"},_hoisted_15$5={class:"value"},_hoisted_16$4={class:"stat-item"},_hoisted_17$4={class:"label"},_hoisted_18$4={class:"stat-item"},_hoisted_19$4={class:"label"},_hoisted_20$4={class:"card-footer"},_hoisted_21$4={class:"last-checked"},_sfc_main$5=defineComponent({name:"QdrantStatsCard",__name:"QdrantStatsCard",props:{qdrantStats:{}},setup(__props){const{$t}=useTexts();return(_ctx,_cache)=>__props.qdrantStats?(openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("div",{class:normalizeClass(["health-indicator",{healthy:__props.qdrantStats.is_healthy,unhealthy:!__props.qdrantStats.is_healthy}])},toDisplayString(__props.qdrantStats.is_healthy?unref($t)("admin.vectors.stats.systemStatus.healthy"):unref($t)("admin.vectors.stats.systemStatus.error")),3)]),createBaseVNode("div",_hoisted_3$5,[createBaseVNode("div",_hoisted_4$5,[createBaseVNode("span",_hoisted_5$5,toDisplayString(unref($t)("admin.vectors.qdrant.vectors")),1),createBaseVNode("span",_hoisted_6$5,toDisplayString(__props.qdrantStats.qdrant_vector_count),1)]),createBaseVNode("div",_hoisted_7$5,[createBaseVNode("span",_hoisted_8$5,toDisplayString(unref($t)("admin.vectors.stats.indexStatus.title")),1),createBaseVNode("span",_hoisted_9$5,toDisplayString(__props.qdrantStats.qdrant_indexed_count),1)]),createBaseVNode("div",_hoisted_10$5,[createBaseVNode("span",_hoisted_11$5,toDisplayString(unref($t)("admin.vectors.qdrant.collections")),1),createBaseVNode("span",_hoisted_12$5,toDisplayString(__props.qdrantStats.mysql_total_count),1)]),createBaseVNode("div",_hoisted_13$5,[createBaseVNode("span",_hoisted_14$5,toDisplayString(unref($t)("admin.vectors.stats.indexStatus.completed")),1),createBaseVNode("span",_hoisted_15$5,toDisplayString(__props.qdrantStats.mysql_completed_count),1)]),createBaseVNode("div",_hoisted_16$4,[createBaseVNode("span",_hoisted_17$4,toDisplayString(unref($t)("admin.vectors.qdrant.throughput")),1),createBaseVNode("span",{class:normalizeClass(["value",{success:__props.qdrantStats.sync_ratio>=95,warning:__props.qdrantStats.sync_ratio>=70&&__props.qdrantStats.sync_ratio<95,error:__props.qdrantStats.sync_ratio<70}])},toDisplayString(__props.qdrantStats.sync_ratio.toFixed(1))+"% ",3)]),createBaseVNode("div",_hoisted_18$4,[createBaseVNode("span",_hoisted_19$4,toDisplayString(unref($t)("admin.vectors.columns.collection")),1),createBaseVNode("span",{class:normalizeClass(["value status",__props.qdrantStats.collection_status])},toDisplayString(unref(getCollectionStatusText)(__props.qdrantStats.collection_status)),3)])]),createBaseVNode("div",_hoisted_20$4,[createBaseVNode("span",_hoisted_21$4,toDisplayString(unref($t)("admin.vectors.qdrant.uptime"))+": "+toDisplayString(__props.qdrantStats.last_checked),1)])])):createCommentVNode("",!0)}});const QdrantStatsCard=_export_sfc(_sfc_main$5,[["__scopeId","data-v-6b304874"]]),_hoisted_1$4={class:"vector-filter-panel"},_hoisted_2$4={class:"filter-form"},_hoisted_3$4={class:"filter-row"},_hoisted_4$4={class:"filter-item"},_hoisted_5$4={class:"filter-label"},_hoisted_6$4={class:"filter-item"},_hoisted_7$4={class:"filter-label"},_hoisted_8$4={class:"filter-item"},_hoisted_9$4={class:"filter-label"},_hoisted_10$4={class:"filter-row"},_hoisted_11$4={class:"filter-item"},_hoisted_12$4={class:"filter-label"},_hoisted_13$4={class:"filter-item"},_hoisted_14$4={class:"filter-label"},_hoisted_15$4={class:"filter-item filter-actions"},_sfc_main$4=defineComponent({__name:"VectorFilterPanel",props:{initialFilters:{},availableModels:{default:()=>[]}},emits:["filter"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),localFilters=reactive({page:1,page_size:10,status:void 0,model:void 0,keyword:void 0}),sortField=ref("created_at_desc"),statusOptions=computed(()=>[{label:$t("admin.vectors.status.pending"),value:"pending"},{label:$t("admin.vectors.status.running"),value:"running"},{label:$t("admin.vectors.status.completed"),value:"completed"},{label:$t("admin.vectors.status.failed"),value:"failed"},{label:$t("admin.vectors.status.reset"),value:"reset"}]),pageSizeOptions=computed(()=>[{label:$t("admin.vectors.filter.pageSize.size10"),value:10},{label:$t("admin.vectors.filter.pageSize.size20"),value:20},{label:$t("admin.vectors.filter.pageSize.size50"),value:50},{label:$t("admin.vectors.filter.pageSize.size100"),value:100}]),sortOptions=computed(()=>[{label:$t("admin.vectors.filter.sort.createdAtDesc"),value:"created_at_desc"},{label:$t("admin.vectors.filter.sort.createdAtAsc"),value:"created_at_asc"},{label:$t("admin.vectors.filter.sort.updatedAtDesc"),value:"updated_at_desc"},{label:$t("admin.vectors.filter.sort.updatedAtAsc"),value:"updated_at_asc"},{label:$t("admin.vectors.filter.sort.retryCountDesc"),value:"retry_count_desc"},{label:$t("admin.vectors.filter.sort.durationDesc"),value:"duration_desc"}]),modelOptions=computed(()=>props.availableModels.map(model=>({label:model,value:model})));watch(()=>props.initialFilters,()=>{Object.assign(localFilters,{page:props.initialFilters.page||1,page_size:props.initialFilters.page_size||10,status:props.initialFilters.status,model:props.initialFilters.model,keyword:props.initialFilters.keyword})},{immediate:!0});const handleApply=()=>{const filters={...localFilters,page:1};emit("filter",filters)},handleReset=()=>{localFilters.page=1,localFilters.page_size=10,localFilters.status=void 0,localFilters.model=void 0,localFilters.keyword=void 0,sortField.value="created_at_desc",handleApply()};return(_ctx,_cache)=>{const _component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("div",_hoisted_4$4,[createBaseVNode("label",_hoisted_5$4,toDisplayString(unref($t)("admin.vectors.columns.status")),1),createVNode(_component_CyberDropdown,{modelValue:localFilters.status,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>localFilters.status=$event),placeholder:unref($t)("admin.vectors.filter.options.all"),options:statusOptions.value,class:"filter-input"},null,8,["modelValue","placeholder","options"])]),createBaseVNode("div",_hoisted_6$4,[createBaseVNode("label",_hoisted_7$4,toDisplayString(unref($t)("admin.vectors.qdrant.version")),1),createVNode(_component_CyberDropdown,{modelValue:localFilters.model,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>localFilters.model=$event),placeholder:unref($t)("admin.vectors.filter.options.all"),options:modelOptions.value,class:"filter-input"},null,8,["modelValue","placeholder","options"])]),createBaseVNode("div",_hoisted_8$4,[createBaseVNode("label",_hoisted_9$4,toDisplayString(unref($t)("admin.vectors.filter.keyword")),1),createVNode(_component_CyberInput,{modelValue:localFilters.keyword,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>localFilters.keyword=$event),placeholder:unref($t)("admin.vectors.filter.options.keywordPlaceholder"),clearable:"",class:"filter-input"},{prefix:withCtx(()=>[..._cache[5]||(_cache[5]=[createBaseVNode("i",{class:"fas fa-search"},null,-1)])]),_:1},8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_10$4,[createBaseVNode("div",_hoisted_11$4,[createBaseVNode("label",_hoisted_12$4,toDisplayString(unref($t)("admin.vectors.pagination.perPage")),1),createVNode(_component_CyberDropdown,{modelValue:localFilters.page_size,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>localFilters.page_size=$event),options:pageSizeOptions.value,class:"filter-input"},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_13$4,[createBaseVNode("label",_hoisted_14$4,toDisplayString(unref($t)("admin.vectors.filter.sortBy")),1),createVNode(_component_CyberDropdown,{modelValue:sortField.value,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>sortField.value=$event),options:sortOptions.value,class:"filter-input"},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_15$4,[createVNode(_component_CyberButton,{type:"secondary",onClick:handleReset,class:"action-btn"},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-undo mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.filter.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",onClick:handleApply,class:"action-btn"},{default:withCtx(()=>[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-filter mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.filter.apply")),1)]),_:1})])])])])}}});const VectorFilterPanel=_export_sfc(_sfc_main$4,[["__scopeId","data-v-e63d33d6"]]),_hoisted_1$3={class:"vector-list"},_hoisted_2$3={class:"list-header"},_hoisted_3$3={class:"list-title"},_hoisted_4$3={class:"list-count"},_hoisted_5$3={class:"list-actions"},_hoisted_6$3={class:"filter-panel-container"},_hoisted_7$3={class:"batch-actions-panel"},_hoisted_8$3={class:"batch-info"},_hoisted_9$3={class:"batch-buttons"},_hoisted_10$3={class:"vector-table-container"},_hoisted_11$3={key:0,class:"empty-state"},_hoisted_12$3={class:"empty-text"},_hoisted_13$3={key:1,class:"vector-table"},_hoisted_14$3={class:"table-header"},_hoisted_15$3={class:"cell-checkbox table-cell"},_hoisted_16$3={class:"cell-image table-cell"},_hoisted_17$3={class:"cell-status table-cell"},_hoisted_18$3={class:"cell-model table-cell"},_hoisted_19$3={class:"cell-dimension table-cell"},_hoisted_20$3={class:"cell-vector table-cell"},_hoisted_21$3={class:"cell-retry table-cell"},_hoisted_22$3={class:"cell-duration table-cell"},_hoisted_23$3={class:"cell-time table-cell"},_hoisted_24$3={class:"cell-actions table-cell"},_hoisted_25$3={class:"table-body"},_hoisted_26$2={class:"cell-checkbox table-cell"},_hoisted_27$1={class:"cell-image table-cell"},_hoisted_28$1={class:"image-info"},_hoisted_29$1=["onClick"],_hoisted_30$1=["src","alt"],_hoisted_31$1={key:1,class:"image-placeholder"},_hoisted_32$1={class:"image-details"},_hoisted_33$1={class:"file-name"},_hoisted_34$1={class:"image-id"},_hoisted_35$1={class:"cell-status table-cell"},_hoisted_36$1={key:0,class:"error-message"},_hoisted_37$1={class:"cell-model table-cell"},_hoisted_38$1={class:"model-info"},_hoisted_39$1={class:"model-name"},_hoisted_40$1={class:"cell-dimension table-cell"},_hoisted_41$1={class:"dimension-info"},_hoisted_42$1={class:"cell-vector table-cell"},_hoisted_43$1={class:"vector-content"},_hoisted_44$1={class:"vector-description"},_hoisted_45$1={key:1,class:"vector-empty"},_hoisted_46$1={class:"cell-retry table-cell"},_hoisted_47$1={class:"retry-info"},_hoisted_48$1={class:"retry-count"},_hoisted_49$1={key:0,class:"retry-time"},_hoisted_50$1={class:"cell-duration table-cell"},_hoisted_51$1={class:"duration-info"},_hoisted_52$1={class:"cell-time table-cell"},_hoisted_53$1={class:"time-info"},_hoisted_54={class:"update-time"},_hoisted_55={class:"create-time"},_hoisted_56={class:"cell-actions table-cell"},_hoisted_57={class:"action-buttons"},_hoisted_58={key:0,class:"pagination-container"},_sfc_main$3=defineComponent({__name:"VectorList",props:{vectors:{},isLoading:{type:Boolean,default:!1},pagination:{},processing:{type:Boolean,default:!1},showFilter:{type:Boolean,default:!1},availableModels:{default:()=>[]},filters:{default:()=>({page:1,page_size:10})}},emits:["retry","batch-action","page-change","page-size-change","view-detail","toggle-filter","filter"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),selectedVectors=ref([]),showBatchActions=ref(!1);watch(()=>props.vectors,()=>{selectedVectors.value=[]},{deep:!0,immediate:!0});const isAllSelected=computed(()=>props.vectors.length>0&&selectedVectors.value.length===props.vectors.length),isIndeterminate=computed(()=>selectedVectors.value.length>0&&selectedVectors.value.length<props.vectors.length),handleSelectAll=selected=>{selected?selectedVectors.value=props.vectors.map(v=>v.file_id):selectedVectors.value=[]},handleSelectVector=(fileId,selected)=>{if(selected)selectedVectors.value.includes(fileId)||selectedVectors.value.push(fileId);else{const index2=selectedVectors.value.indexOf(fileId);index2>-1&&selectedVectors.value.splice(index2,1)}},clearSelection=()=>{selectedVectors.value=[],showBatchActions.value=!1},handleRetry=fileId=>{emit("retry",fileId)},handleBatchAction=action=>{selectedVectors.value.length!==0&&(emit("batch-action",selectedVectors.value,action),clearSelection())},handlePageChange=page=>{emit("page-change",page),clearSelection()},handlePageSizeChange=size=>{emit("page-size-change",size),clearSelection()},handleViewDetail=fileId=>{emit("view-detail",fileId)},getStatusText=status=>({pending:$t("admin.vectors.status.indexing"),running:$t("admin.vectors.status.processing"),completed:$t("admin.vectors.status.active"),failed:$t("admin.vectors.status.error"),reset:$t("admin.vectors.buttons.reset")})[status]||status,getStatusIcon=status=>({pending:"fas fa-clock",running:"fas fa-spinner fa-spin",completed:"fas fa-check-circle",failed:"fas fa-exclamation-circle",reset:"fas fa-redo"})[status]||"fas fa-question-circle",formatTime=time=>formatDistanceToNow(time),formatDuration=duration=>{if(!duration||duration===0)return"-";if(duration<60)return`${duration}s`;const minutes=Math.floor(duration/60),seconds=duration%60;return seconds>0?`${minutes}m ${seconds}s`:`${minutes}m`},canRetry=vector=>vector.status==="failed"||vector.status==="reset";return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberSkeleton=__unplugin_components_0,_component_CyberCheckbox=resolveComponent("CyberCheckbox"),_component_CyberTooltip=resolveComponent("CyberTooltip"),_component_CyberPagination=resolveComponent("CyberPagination");return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("span",_hoisted_4$3,toDisplayString(unref($t)("admin.vectors.pagination.total"))+" "+toDisplayString(__props.pagination.total)+" "+toDisplayString(unref($t)("admin.vectors.pagination.items")),1)]),createBaseVNode("div",_hoisted_5$3,[createVNode(_component_CyberButton,{type:"secondary",onClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("toggle-filter")),class:normalizeClass({"border-error-500 text-error-500":__props.showFilter})},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-filter mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.filter.title")),1)]),_:1},8,["class"]),selectedVectors.value.length>0?(openBlock(),createBlock(_component_CyberButton,{key:0,type:"warning",onClick:_cache[1]||(_cache[1]=$event=>showBatchActions.value=!showBatchActions.value),class:"batch-btn ml-2"},{default:withCtx(()=>[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-layer-group mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.batchOperations.title"))+" ("+toDisplayString(selectedVectors.value.length)+") ",1)]),_:1})):createCommentVNode("",!0)])]),createVNode(Transition,{name:"filter-panel","enter-active-class":"transition duration-300 ease-out","leave-active-class":"transition duration-200 ease-in","enter-from-class":"opacity-0 transform -translate-y-8","enter-to-class":"opacity-100 transform translate-y-0","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-8"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_6$3,[createVNode(VectorFilterPanel,{"initial-filters":__props.filters,"available-models":__props.availableModels,onFilter:_cache[2]||(_cache[2]=$event=>_ctx.$emit("filter",$event))},null,8,["initial-filters","available-models"])],512),[[vShow,__props.showFilter]])]),_:1}),createVNode(Transition,{name:"batch-panel","enter-active-class":"transition duration-300 ease-out","leave-active-class":"transition duration-200 ease-in","enter-from-class":"opacity-0 transform -translate-y-4","enter-to-class":"opacity-100 transform translate-y-0","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-4"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_7$3,[createBaseVNode("div",_hoisted_8$3,toDisplayString(unref($t)("admin.vectors.batchOperations.selected"))+" "+toDisplayString(selectedVectors.value.length)+" "+toDisplayString(unref($t)("admin.vectors.batchOperations.items")),1),createBaseVNode("div",_hoisted_9$3,[createVNode(_component_CyberButton,{type:"primary",loading:__props.processing,onClick:_cache[3]||(_cache[3]=$event=>handleBatchAction("retry"))},{default:withCtx(()=>[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-redo mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.search")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"warning",loading:__props.processing,onClick:_cache[4]||(_cache[4]=$event=>handleBatchAction("reset"))},{default:withCtx(()=>[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-sync-alt mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.buttons.reset")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"danger",loading:__props.processing,onClick:_cache[5]||(_cache[5]=$event=>handleBatchAction("delete"))},{default:withCtx(()=>[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-trash mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.delete")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"secondary",onClick:clearSelection},{default:withCtx(()=>[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.batchOperations.deselectAll")),1)]),_:1})])],512),[[vShow,showBatchActions.value]])]),_:1}),createBaseVNode("div",_hoisted_10$3,[createVNode(_component_CyberSkeleton,{type:"table",count:__props.pagination.page_size,loading:__props.isLoading},null,8,["count","loading"]),!__props.isLoading&&__props.vectors.length===0?(openBlock(),createElementBlock("div",_hoisted_11$3,[_cache[12]||(_cache[12]=createBaseVNode("div",{class:"empty-icon"},[createBaseVNode("i",{class:"fas fa-vector-square"})],-1)),createBaseVNode("div",_hoisted_12$3,toDisplayString(unref($t)("admin.vectors.empty.title")),1)])):createCommentVNode("",!0),!__props.isLoading&&__props.vectors.length>0?(openBlock(),createElementBlock("div",_hoisted_13$3,[createBaseVNode("div",_hoisted_14$3,[createBaseVNode("div",_hoisted_15$3,[createVNode(_component_CyberCheckbox,{"model-value":isAllSelected.value,indeterminate:isIndeterminate.value,"onUpdate:modelValue":handleSelectAll},null,8,["model-value","indeterminate"])]),createBaseVNode("div",_hoisted_16$3,toDisplayString(unref($t)("admin.vectors.columns.filename")),1),createBaseVNode("div",_hoisted_17$3,toDisplayString(unref($t)("admin.vectors.columns.status")),1),createBaseVNode("div",_hoisted_18$3,toDisplayString(unref($t)("admin.vectors.qdrant.version")),1),createBaseVNode("div",_hoisted_19$3,toDisplayString(unref($t)("admin.vectors.columns.dimensions")),1),createBaseVNode("div",_hoisted_20$3,toDisplayString(unref($t)("admin.vectors.form.description")),1),createBaseVNode("div",_hoisted_21$3,toDisplayString(unref($t)("admin.vectors.actions.rebuild")),1),createBaseVNode("div",_hoisted_22$3,toDisplayString(unref($t)("admin.vectors.logs.duration")),1),createBaseVNode("div",_hoisted_23$3,toDisplayString(unref($t)("admin.vectors.columns.updatedAt")),1),createBaseVNode("div",_hoisted_24$3,toDisplayString(unref($t)("admin.vectors.columns.actions")),1)]),createBaseVNode("div",_hoisted_25$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.vectors,vector=>(openBlock(),createElementBlock("div",{key:vector.id,class:normalizeClass(["table-row",{selected:selectedVectors.value.includes(vector.file_id)}])},[createBaseVNode("div",_hoisted_26$2,[createVNode(_component_CyberCheckbox,{"model-value":selectedVectors.value.includes(vector.file_id),"onUpdate:modelValue":$event=>handleSelectVector(vector.file_id,$event)},null,8,["model-value","onUpdate:modelValue"])]),createBaseVNode("div",_hoisted_27$1,[createBaseVNode("div",_hoisted_28$1,[vector.thumbnail_url?(openBlock(),createElementBlock("div",{key:0,class:"image-preview",onClick:$event=>handleViewDetail(vector.file_id)},[createBaseVNode("img",{src:vector.thumbnail_url,alt:vector.file_name||unref($t)("admin.vectors.columns.filename")},null,8,_hoisted_30$1)],8,_hoisted_29$1)):(openBlock(),createElementBlock("div",_hoisted_31$1,[..._cache[13]||(_cache[13]=[createBaseVNode("i",{class:"fas fa-image"},null,-1)])])),createBaseVNode("div",_hoisted_32$1,[createBaseVNode("div",_hoisted_33$1,toDisplayString(vector.file_name||"Unknown"),1),createBaseVNode("div",_hoisted_34$1,toDisplayString(vector.file_id),1)])])]),createBaseVNode("div",_hoisted_35$1,[createBaseVNode("div",{class:normalizeClass(["status-badge",`status-${vector.status}`])},[createBaseVNode("i",{class:normalizeClass(getStatusIcon(vector.status))},null,2),createBaseVNode("span",null,toDisplayString(getStatusText(vector.status)),1)],2),vector.error_message?(openBlock(),createElementBlock("div",_hoisted_36$1,toDisplayString(vector.error_message),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_37$1,[createBaseVNode("div",_hoisted_38$1,[createBaseVNode("div",_hoisted_39$1,toDisplayString(vector.model),1)])]),createBaseVNode("div",_hoisted_40$1,[createBaseVNode("div",_hoisted_41$1,toDisplayString(vector.dimension||"-"),1)]),createBaseVNode("div",_hoisted_42$1,[createBaseVNode("div",_hoisted_43$1,[vector.description?(openBlock(),createBlock(_component_CyberTooltip,{key:0,content:vector.description,placement:"top","max-width":400},{default:withCtx(()=>[createBaseVNode("div",_hoisted_44$1,toDisplayString(vector.description),1)]),_:2},1032,["content"])):(openBlock(),createElementBlock("div",_hoisted_45$1,[..._cache[14]||(_cache[14]=[createBaseVNode("span",null,"-",-1)])]))])]),createBaseVNode("div",_hoisted_46$1,[createBaseVNode("div",_hoisted_47$1,[createBaseVNode("span",_hoisted_48$1,toDisplayString(vector.retry_count),1),vector.last_retry_at?(openBlock(),createElementBlock("span",_hoisted_49$1,toDisplayString(formatTime(vector.last_retry_at)),1)):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_50$1,[createBaseVNode("div",_hoisted_51$1,toDisplayString(formatDuration(vector.processing_duration)),1)]),createBaseVNode("div",_hoisted_52$1,[createBaseVNode("div",_hoisted_53$1,[createBaseVNode("div",_hoisted_54,toDisplayString(formatTime(vector.updated_at)),1),createBaseVNode("div",_hoisted_55,toDisplayString(formatTime(vector.created_at)),1)])]),createBaseVNode("div",_hoisted_56,[createBaseVNode("div",_hoisted_57,[canRetry(vector)?(openBlock(),createBlock(_component_CyberButton,{key:0,type:"primary",size:"mini",loading:__props.processing,onClick:$event=>handleRetry(vector.file_id),title:unref($t)("admin.vectors.actions.search")},{default:withCtx(()=>[..._cache[15]||(_cache[15]=[createBaseVNode("i",{class:"fas fa-redo"},null,-1)])]),_:1},8,["loading","onClick","title"])):createCommentVNode("",!0),createVNode(_component_CyberButton,{type:"info",size:"mini",onClick:$event=>handleViewDetail(vector.file_id),title:unref($t)("admin.vectors.actions.view")},{default:withCtx(()=>[..._cache[16]||(_cache[16]=[createBaseVNode("i",{class:"fas fa-eye"},null,-1)])]),_:1},8,["onClick","title"])])])],2))),128))])])):createCommentVNode("",!0)]),__props.pagination.total>0?(openBlock(),createElementBlock("div",_hoisted_58,[createVNode(_component_CyberPagination,{currentPage:__props.pagination.page,total:__props.pagination.total,pageSize:__props.pagination.page_size,onPageChange:handlePageChange,onPageSizeChange:handlePageSizeChange},null,8,["currentPage","total","pageSize"])])):createCommentVNode("",!0)])}}});const VectorList=_export_sfc(_sfc_main$3,[["__scopeId","data-v-5f1e4724"]]);function formatVectorLog(log,$t){const{type,data}=log;try{switch(type){case"vector.reset":return data.model?$t("admin.vectors.log.reset_with_model",{model:String(data.model)}):$t("admin.vectors.log.reset");case"vector.retry":return data.retry_count?$t("admin.vectors.log.retry_with_count",{retry_count:String(data.retry_count)}):$t("admin.vectors.log.retry");case"vector.delete":return $t("admin.vectors.log.delete");case"vector.retry_all":return $t("admin.vectors.log.retry_all",{retry_count:String(data.retry_count||0)});case"vector.recover_stuck":return $t("admin.vectors.log.recover_stuck",{count:String(data.count||0)});case"vector.start":return $t("admin.vectors.log.start",{model:String(data.model||"")});default:return`${type}: ${JSON.stringify(data)}`}}catch{return`${type}: ${JSON.stringify(data)}`}}const _hoisted_1$2={class:"vector-log-list"},_hoisted_2$2={class:"log-header"},_hoisted_3$2={class:"log-info"},_hoisted_4$2={key:0,class:"total-info"},_hoisted_5$2={key:1,class:"log-filter-info"},_hoisted_6$2={class:"log-actions"},_hoisted_7$2={key:0,class:"empty-logs"},_hoisted_8$2={class:"empty-text"},_hoisted_9$2={key:1,class:"log-timeline"},_hoisted_10$2={class:"log-icon"},_hoisted_11$2={class:"log-content-wrapper"},_hoisted_12$2={class:"log-main"},_hoisted_13$2={class:"log-header-info"},_hoisted_14$2={class:"log-primary"},_hoisted_15$2={class:"log-message"},_hoisted_16$2={class:"log-time"},_hoisted_17$2={class:"log-meta"},_hoisted_18$2={key:0,class:"meta-item"},_hoisted_19$2={key:1,class:"meta-item"},_hoisted_20$2={key:2,class:"meta-item"},_hoisted_21$2={class:"meta-item"},_hoisted_22$2={key:0,class:"log-error"},_hoisted_23$2={key:0,class:"loading-indicator"},_hoisted_24$2={class:"loading-text"},_hoisted_25$2={key:1,class:"no-more-hint"},_sfc_main$2=defineComponent({__name:"VectorLogList",props:{logs:{},pagination:{},selectedFileId:{}},emits:["load-more","refresh","clear-filter"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),logContainer=ref(),isLoadingMore=ref(!1),hasMore=computed(()=>props.logs.length<props.pagination.total),getActionText=action=>({start:$t("admin.vectors.status.indexing"),success:$t("admin.vectors.status.active"),error:$t("admin.vectors.status.error"),retry:$t("admin.vectors.actions.search"),reset:$t("admin.vectors.buttons.reset"),delete:$t("admin.vectors.actions.delete"),skip:$t("admin.vectors.status.processing")})[action]||action,getActionIcon=action=>({start:"fas fa-play-circle",success:"fas fa-check-circle",error:"fas fa-exclamation-circle",retry:"fas fa-redo",reset:"fas fa-sync-alt",delete:"fas fa-trash-alt",skip:"fas fa-forward"})[action]||"fas fa-info-circle",formatTime=time=>formatDistanceToNow(time),formatDuration=duration=>{if(!duration||duration===0)return"-";if(duration<60)return $t("admin.vectors.logs.durationSeconds",{seconds:duration});const minutes=Math.floor(duration/60),seconds=duration%60;return seconds>0?$t("admin.vectors.logs.durationMinutesSeconds",{minutes,seconds}):$t("admin.vectors.logs.durationMinutes",{minutes})},handleScroll=async()=>{if(!hasMore.value||isLoadingMore.value||!logContainer.value)return;const{scrollTop,scrollHeight,clientHeight}=logContainer.value,threshold=50;scrollTop+clientHeight>=scrollHeight-threshold&&(isLoadingMore.value=!0,emit("load-more"))};watch(()=>props.logs,()=>{isLoadingMore.value=!1});const handleRefresh=()=>{emit("refresh")},handleClearFilter=()=>{emit("clear-filter")};return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[__props.pagination.total>0?(openBlock(),createElementBlock("div",_hoisted_4$2,toDisplayString(unref($t)("admin.vectors.logs.filters.keywords"))+" "+toDisplayString(__props.logs.length)+" / "+toDisplayString(__props.pagination.total)+" "+toDisplayString(unref($t)("admin.vectors.logs.title")),1)):createCommentVNode("",!0),__props.selectedFileId?(openBlock(),createElementBlock("span",_hoisted_5$2,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-filter mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.columns.filename"))+": "+toDisplayString(__props.selectedFileId),1)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_6$2,[__props.selectedFileId?(openBlock(),createBlock(_component_CyberButton,{key:0,type:"warning",onClick:handleClearFilter},{default:withCtx(()=>[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.filter.options.all")),1)]),_:1})):createCommentVNode("",!0),createVNode(_component_CyberButton,{type:"secondary",onClick:handleRefresh},{default:withCtx(()=>[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-refresh mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.buttons.refresh")),1)]),_:1})])]),createBaseVNode("div",{ref_key:"logContainer",ref:logContainer,class:"log-content",onScroll:handleScroll},[__props.logs.length===0?(openBlock(),createElementBlock("div",_hoisted_7$2,[_cache[3]||(_cache[3]=createBaseVNode("div",{class:"empty-icon"},[createBaseVNode("i",{class:"fas fa-file-alt"})],-1)),createBaseVNode("div",_hoisted_8$2,toDisplayString(unref($t)("admin.vectors.logs.title")),1)])):(openBlock(),createElementBlock("div",_hoisted_9$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.logs,log=>(openBlock(),createElementBlock("div",{key:log.id,class:normalizeClass(["log-item",`log-${log.action}`])},[createBaseVNode("div",_hoisted_10$2,[createBaseVNode("i",{class:normalizeClass(getActionIcon(log.action))},null,2)]),createBaseVNode("div",_hoisted_11$2,[createBaseVNode("div",_hoisted_12$2,[createBaseVNode("div",_hoisted_13$2,[createBaseVNode("div",_hoisted_14$2,[createBaseVNode("span",{class:normalizeClass(["action-badge",`action-${log.action}`])},toDisplayString(getActionText(log.action)),3),createBaseVNode("span",_hoisted_15$2,toDisplayString(unref(formatVectorLog)(log,unref($t))),1)]),createBaseVNode("span",_hoisted_16$2,toDisplayString(formatTime(log.created_at)),1)]),createBaseVNode("div",_hoisted_17$2,[log.model?(openBlock(),createElementBlock("span",_hoisted_18$2,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-brain"},null,-1)),createTextVNode(toDisplayString(log.model),1)])):createCommentVNode("",!0),log.duration>0?(openBlock(),createElementBlock("span",_hoisted_19$2,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-clock"},null,-1)),createTextVNode(toDisplayString(formatDuration(log.duration)),1)])):createCommentVNode("",!0),log.task_id?(openBlock(),createElementBlock("span",_hoisted_20$2,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-tag"},null,-1)),createTextVNode(toDisplayString(log.task_id.slice(-8)),1)])):createCommentVNode("",!0),createBaseVNode("span",_hoisted_21$2,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-image"},null,-1)),createTextVNode(toDisplayString(log.file_id),1)])]),log.error_code?(openBlock(),createElementBlock("div",_hoisted_22$2,[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-exclamation-triangle"},null,-1)),createTextVNode(" "+toDisplayString(log.error_code),1)])):createCommentVNode("",!0)])])],2))),128)),isLoadingMore.value?(openBlock(),createElementBlock("div",_hoisted_23$2,[_cache[9]||(_cache[9]=createBaseVNode("div",{class:"loading-spinner"},[createBaseVNode("i",{class:"fas fa-spinner fa-spin"})],-1)),createBaseVNode("span",_hoisted_24$2,toDisplayString(unref($t)("admin.vectors.loading.title"))+"...",1)])):!hasMore.value&&__props.logs.length>0?(openBlock(),createElementBlock("div",_hoisted_25$2,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-check-circle mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.logs.filters.all"))+" "+toDisplayString(unref($t)("admin.vectors.logs.title")),1)])):createCommentVNode("",!0)]))],544)])}}});const VectorLogList=_export_sfc(_sfc_main$2,[["__scopeId","data-v-a7a221c8"]]);function startVectorVerification(data){return post("/admin/vector-verification/start",data)}function getVerificationStatistics(){return get("/admin/vector-verification/statistics")}function getVerificationProgress(){return get("/admin/vector-verification/progress")}function batchRepairMissingVectors(data){return post("/admin/vector-verification/batch-repair",data)}const _hoisted_1$1={class:"vector-action-panel-simplified"},_hoisted_2$1={class:"action-grid"},_hoisted_3$1={class:"action-card primary"},_hoisted_4$1={class:"card-header"},_hoisted_5$1={class:"card-content"},_hoisted_6$1={class:"description"},_hoisted_7$1={key:0,class:"problem-stats"},_hoisted_8$1={key:0,class:"problem-item failed"},_hoisted_9$1={key:1,class:"problem-item missing"},_hoisted_10$1={key:2,class:"problem-item stuck"},_hoisted_11$1={key:3,class:"problem-item stuck"},_hoisted_12$1={key:4,class:"no-problems"},_hoisted_13$1={class:"card-actions"},_hoisted_14$1={class:"action-card secondary"},_hoisted_15$1={class:"card-header"},_hoisted_16$1={class:"card-content"},_hoisted_17$1={class:"description"},_hoisted_18$1={key:0,class:"verification-info"},_hoisted_19$1={class:"card-actions"},_hoisted_20$1={class:"action-card danger"},_hoisted_21$1={class:"card-header"},_hoisted_22$1={class:"card-content"},_hoisted_23$1={class:"description"},_hoisted_24$1={class:"warning-text"},_hoisted_25$1={class:"card-actions"},_hoisted_26$1={class:"action-card secondary"},_hoisted_27={class:"card-header"},_hoisted_28={class:"card-content"},_hoisted_29={class:"description"},_hoisted_30={class:"card-actions"},_hoisted_31={key:0,class:"mt-6 overflow-hidden rounded-xl border border-indigo-600/20 bg-gradient-to-r from-indigo-800/50 to-purple-700/30"},_hoisted_32={class:"border-b border-indigo-600/20 bg-gradient-to-r from-indigo-600/20 to-purple-600/10 px-6 py-4"},_hoisted_33={class:"flex items-center text-lg font-semibold text-indigo-400"},_hoisted_34={class:"p-6"},_hoisted_35={class:"mb-4"},_hoisted_36={class:"mb-2 flex items-center justify-between"},_hoisted_37={class:"text-sm font-medium text-slate-300"},_hoisted_38={class:"text-sm font-bold text-indigo-400"},_hoisted_39={class:"h-3 w-full overflow-hidden rounded-full border border-slate-600/30 bg-slate-700/50"},_hoisted_40={class:"mt-2 flex items-center justify-between"},_hoisted_41={class:"text-xs text-slate-400"},_hoisted_42={class:"text-xs text-slate-400"},_hoisted_43={class:"rounded-lg border border-slate-600/30 bg-slate-800/40 p-3"},_hoisted_44={class:"flex items-center justify-between"},_hoisted_45={class:"flex items-center"},_hoisted_46={class:"text-sm font-medium text-slate-300"},_hoisted_47={class:"text-right"},_hoisted_48={class:"text-sm font-semibold text-indigo-400"},_hoisted_49={class:"text-xs text-slate-400"},_hoisted_50={class:"confirm-content"},_hoisted_51={class:"confirm-text"},_hoisted_52={class:"message-lines"},_hoisted_53={class:"flex w-full justify-end gap-2 p-2"},_sfc_main$1=defineComponent({__name:"VectorActionPanelSimplified",props:{processing:{type:Boolean,default:!1},stats:{default:()=>null}},emits:["regenerate-all","refresh","verification-completed"],setup(__props,{emit:__emit}){const toast=useToast(),{$t}=useTexts(),wsStore=useWebSocketStore(),isPaused=computed(()=>wsStore.vectorStats?.runtime?.paused===!0),props=__props,emit=__emit,verificationProcessing=ref(!1),currentVerificationTask=ref(null),verificationStats=ref(null),verificationInterval=ref(null),showConfirmDialog=ref(!1),confirmData=ref({title:"",message:[],type:"primary",confirmText:$t("admin.vectors.actions.confirm"),action:""}),problemStats=computed(()=>{if(!props.stats&&!verificationStats.value)return null;const failed=props.stats?.failed_count||0,stuck=props.stats?.running_count||0,missing=verificationStats.value?.missing_count||0,unknown=verificationStats.value?.unknown_count||0,total=failed+stuck+missing+unknown;return{failed,stuck,missing,unknown,total}}),handleSmartFix=()=>{if(!problemStats.value||problemStats.value.total===0){toast.info($t("admin.vectors.toast.noData"));return}const problems=[];problemStats.value.failed>0&&problems.push(`${problemStats.value.failed} ${$t("admin.vectors.status.error")}`),problemStats.value.stuck>0&&problems.push(`${problemStats.value.stuck} ${$t("admin.vectors.status.processing")}`),problemStats.value.missing>0&&problems.push(`${problemStats.value.missing} ${$t("admin.vectors.status.indexing")}`),problemStats.value.unknown>0&&problems.push(`${problemStats.value.unknown} ${$t("admin.vectors.filter.options.all")}`),confirmData.value={title:$t("admin.vectors.confirm.reindex.title"),message:[`${$t("admin.vectors.actions.rebuild")}ï¼š`,"",...problems,"",`${$t("admin.vectors.confirm.reindex.message")}?`],type:"primary",confirmText:$t("admin.vectors.buttons.save"),action:"smart-fix"},showConfirmDialog.value=!0},executeSmartFix=async()=>{try{verificationProcessing.value=!0;let fixCount=0;if(problemStats.value?.failed>0&&(emit("retry-all-failed"),fixCount+=problemStats.value.failed),problemStats.value?.stuck>0){const result=await recoverStuckTasks();result.success&&(fixCount+=result.data?.affected_count||0)}if(problemStats.value?.missing>0||problemStats.value?.unknown>0){const result=await batchRepairMissingVectors({});result.success&&(fixCount+=result.data?.affected_count||0)}toast.success(`${$t("admin.vectors.buttons.save")} ${fixCount} ${$t("admin.vectors.settings.indexingSettings.indexTimeout")}`),isPaused.value&&toast.info($t("admin.vectors.qdrant.systemInfo")),emit("verification-completed")}catch(error){toast.error(error.message||$t("admin.vectors.actions.smartFixFailed"))}finally{verificationProcessing.value=!1}},handleStartVerification=async()=>{try{verificationProcessing.value=!0;const result=await startVectorVerification({task_type:"manual",needs_verification:!0});result.success&&result.data&&(currentVerificationTask.value=result.data,toast.success($t("admin.vectors.toast.validationStarted")),startProgressMonitoring())}catch(error){toast.error(error.message||$t("admin.vectors.actions.startVerificationFailed"))}finally{verificationProcessing.value=!1}},handleRegenerateAll=()=>{confirmData.value={title:$t("admin.vectors.actions.fullRebuildWarningTitle"),message:[$t("admin.vectors.actions.dangerWarning"),"",$t("admin.vectors.actions.fullRebuildConfirm"),$t("admin.vectors.actions.thisWill"),$t("admin.vectors.actions.clearAllVectors"),$t("admin.vectors.actions.reprocessAllFiles"),$t("admin.vectors.actions.mayTakeLongTime"),"",$t("admin.vectors.actions.confirmContinue")],type:"danger",confirmText:$t("admin.vectors.actions.confirmRebuild"),action:"regenerate-all"},showConfirmDialog.value=!0},handleReconcileMissing=async()=>{try{const res=await reconcileMissing({limit:1e3,dry_run:!1});res.success&&(toast.success($t("admin.vectors.toast.missingVectorsFound").replace("{found}",(res.data?.found??0).toString()).replace("{enqueued}",(res.data?.enqueued??0).toString())),emit("refresh"))}catch(e){toast.error(e?.message||$t("admin.vectors.actions.reconcileMissingFailed"))}},handleCleanOrphans=async()=>{try{const res=await cleanOrphans({limit:1e3,dry_run:!1});res.success&&(toast.success($t("admin.vectors.toast.orphansRemoved").replace("{found}",(res.data?.found??0).toString()).replace("{removed}",(res.data?.removed??0).toString())),emit("refresh"))}catch(e){toast.error(e?.message||$t("admin.vectors.actions.cleanOrphansFailed"))}},handleRebuildStale=async()=>{try{const res=await rebuildStale({limit:1e3});res.success&&(toast.success($t("admin.vectors.toast.outdatedRebuilt").replace("{enqueued}",(res.data?.enqueued??0).toString())),emit("refresh"))}catch(e){toast.error(e?.message||$t("admin.vectors.actions.rebuildStaleFailed"))}},executeConfirmedAction=()=>{switch(showConfirmDialog.value=!1,confirmData.value.action){case"smart-fix":executeSmartFix();break;case"regenerate-all":emit("regenerate-all");break}},startProgressMonitoring=()=>{verificationInterval.value||(verificationInterval.value=window.setInterval(async()=>{try{const result=await getVerificationProgress();result.data&&result.data.is_running?currentVerificationTask.value=result.data.task:(currentVerificationTask.value=null,stopProgressMonitoring(),await loadVerificationStats(),emit("verification-completed"),toast.success($t("admin.vectors.toast.validationCompleted")))}catch{}},2e3))},stopProgressMonitoring=()=>{verificationInterval.value&&(clearInterval(verificationInterval.value),verificationInterval.value=null)},loadVerificationStats=async()=>{try{const result=await getVerificationStatistics();result.data&&(verificationStats.value=result.data)}catch{}};onMounted(()=>{loadVerificationStats()}),onUnmounted(()=>{stopProgressMonitoring()});const formatNumber=num=>num.toLocaleString(),getSyncStatusClass=()=>{if(!verificationStats.value)return"";const ratio=verificationStats.value.sync_ratio||0;return ratio>=95?"sync-excellent":ratio>=80?"sync-good":"sync-poor"},getSyncIcon=()=>{if(!verificationStats.value)return"fas fa-question-circle";const ratio=verificationStats.value.sync_ratio||0;return ratio>=95?"fas fa-check-circle":ratio>=80?"fas fa-exclamation-circle":"fas fa-times-circle"};return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-magic"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("admin.vectors.buttons.reset")),1)]),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("p",_hoisted_6$1,toDisplayString(unref($t)("admin.vectors.qdrant.systemInfo")),1),problemStats.value?(openBlock(),createElementBlock("div",_hoisted_7$1,[problemStats.value.failed>0?(openBlock(),createElementBlock("span",_hoisted_8$1,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-times-circle"},null,-1)),createTextVNode(toDisplayString(problemStats.value.failed)+" "+toDisplayString(unref($t)("admin.vectors.status.error")),1)])):createCommentVNode("",!0),problemStats.value.missing>0?(openBlock(),createElementBlock("span",_hoisted_9$1,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-exclamation-triangle"},null,-1)),createTextVNode(toDisplayString(problemStats.value.missing)+" "+toDisplayString(unref($t)("admin.vectors.status.indexing")),1)])):createCommentVNode("",!0),problemStats.value.stuck>0?(openBlock(),createElementBlock("span",_hoisted_10$1,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-hourglass-half"},null,-1)),createTextVNode(toDisplayString(problemStats.value.stuck)+" "+toDisplayString(unref($t)("admin.vectors.status.processing")),1)])):createCommentVNode("",!0),problemStats.value.unknown>0?(openBlock(),createElementBlock("span",_hoisted_11$1,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-hourglass-half"},null,-1)),createTextVNode(toDisplayString(problemStats.value.unknown)+" "+toDisplayString(unref($t)("admin.vectors.filter.options.all")),1)])):createCommentVNode("",!0),problemStats.value.total===0?(openBlock(),createElementBlock("span",_hoisted_12$1,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-check-circle"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.toast.noData")),1)])):createCommentVNode("",!0)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_13$1,[createVNode(_component_CyberButton,{type:"primary",loading:__props.processing,disabled:!problemStats.value||problemStats.value.total===0,onClick:handleSmartFix,class:"action-button"},{default:withCtx(()=>[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-magic mr-1"},null,-1)),createTextVNode(" "+toDisplayString(problemStats.value?.total>0?`${unref($t)("admin.vectors.buttons.reset")} ${problemStats.value.total} ${unref($t)("admin.vectors.settings.indexingSettings.indexTimeout")}`:unref($t)("admin.vectors.empty.action")),1)]),_:1},8,["loading","disabled"])])]),createBaseVNode("div",_hoisted_14$1,[createBaseVNode("div",_hoisted_15$1,[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-search-plus"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("admin.vectors.settings.monitoringSettings.logLevel")),1)]),createBaseVNode("div",_hoisted_16$1,[createBaseVNode("p",_hoisted_17$1,toDisplayString(unref($t)("admin.vectors.qdrant.description")),1),verificationStats.value?(openBlock(),createElementBlock("div",_hoisted_18$1,[createBaseVNode("div",{class:normalizeClass(["sync-status",getSyncStatusClass()])},[createBaseVNode("i",{class:normalizeClass(getSyncIcon())},null,2),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.actions.syncRatio",{ratio:verificationStats.value.sync_ratio?.toFixed(1)||0})),1)],2)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_19$1,[createVNode(_component_CyberButton,{type:"secondary",loading:verificationProcessing.value,onClick:handleStartVerification,class:"action-button"},{default:withCtx(()=>[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-search-plus mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.startVerification")),1)]),_:1},8,["loading"])])]),createBaseVNode("div",_hoisted_20$1,[createBaseVNode("div",_hoisted_21$1,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-sync-alt"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("admin.vectors.actions.fullRebuild")),1)]),createBaseVNode("div",_hoisted_22$1,[createBaseVNode("p",_hoisted_23$1,toDisplayString(unref($t)("admin.vectors.actions.fullRebuildDesc")),1),createBaseVNode("div",_hoisted_24$1,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-exclamation-triangle"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.actions.fullRebuildWarning")),1)])]),createBaseVNode("div",_hoisted_25$1,[createVNode(_component_CyberButton,{type:"danger",loading:__props.processing,onClick:handleRegenerateAll,class:"action-button"},{default:withCtx(()=>[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-sync-alt mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.fullRebuild")),1)]),_:1},8,["loading"])])]),createBaseVNode("div",_hoisted_26$1,[createBaseVNode("div",_hoisted_27,[_cache[14]||(_cache[14]=createBaseVNode("i",{class:"fas fa-balance-scale"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("admin.vectors.actions.dataAlignment")),1)]),createBaseVNode("div",_hoisted_28,[createBaseVNode("p",_hoisted_29,toDisplayString(unref($t)("admin.vectors.actions.dataAlignmentDesc")),1)]),createBaseVNode("div",_hoisted_30,[createVNode(_component_CyberButton,{type:"secondary",loading:__props.processing,onClick:handleReconcileMissing,class:"action-button"},{default:withCtx(()=>[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-plus-circle mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.reconcileMissing")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"danger",loading:__props.processing,onClick:handleCleanOrphans,class:"action-button"},{default:withCtx(()=>[_cache[16]||(_cache[16]=createBaseVNode("i",{class:"fas fa-broom mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.cleanOrphans")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"primary",loading:__props.processing,onClick:handleRebuildStale,class:"action-button"},{default:withCtx(()=>[_cache[17]||(_cache[17]=createBaseVNode("i",{class:"fas fa-recycle mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.rebuildStale")),1)]),_:1},8,["loading"])])])]),currentVerificationTask.value&&currentVerificationTask.value.status==="running"?(openBlock(),createElementBlock("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,[createBaseVNode("h4",_hoisted_33,[_cache[18]||(_cache[18]=createBaseVNode("div",{class:"mr-3 flex h-6 w-6 items-center justify-center"},[createBaseVNode("i",{class:"fas fa-spinner fa-spin text-indigo-500"})],-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.actions.verificationInProgress")),1)])]),createBaseVNode("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[createBaseVNode("div",_hoisted_36,[createBaseVNode("span",_hoisted_37,toDisplayString(unref($t)("admin.vectors.actions.processingProgress")),1),createBaseVNode("span",_hoisted_38,toDisplayString(((currentVerificationTask.value.processed_count||0)/Math.max(currentVerificationTask.value.total_count||1,1)*100).toFixed(1))+"% ",1)]),createBaseVNode("div",_hoisted_39,[createBaseVNode("div",{class:"relative h-full overflow-hidden rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300 ease-out",style:normalizeStyle({width:`${(currentVerificationTask.value.processed_count||0)/Math.max(currentVerificationTask.value.total_count||1,1)*100}%`})},[..._cache[19]||(_cache[19]=[createBaseVNode("div",{class:"absolute inset-0 skew-x-12 animate-pulse bg-gradient-to-r from-transparent via-white/30 to-transparent"},null,-1)])],4)]),createBaseVNode("div",_hoisted_40,[createBaseVNode("span",_hoisted_41,toDisplayString(unref($t)("admin.vectors.actions.processed",{count:formatNumber(currentVerificationTask.value.processed_count||0)})),1),createBaseVNode("span",_hoisted_42,toDisplayString(unref($t)("admin.vectors.actions.total",{count:formatNumber(currentVerificationTask.value.total_count||0)})),1)])]),createBaseVNode("div",_hoisted_43,[createBaseVNode("div",_hoisted_44,[createBaseVNode("div",_hoisted_45,[_cache[20]||(_cache[20]=createBaseVNode("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-full bg-indigo-500/20"},[createBaseVNode("i",{class:"fas fa-tachometer-alt text-sm text-indigo-400"})],-1)),createBaseVNode("span",_hoisted_46,toDisplayString(unref($t)("admin.vectors.actions.realtimeStats")),1)]),createBaseVNode("div",_hoisted_47,[createBaseVNode("div",_hoisted_48,toDisplayString(currentVerificationTask.value.processed_count||0)+"/"+toDisplayString(currentVerificationTask.value.total_count||0),1),createBaseVNode("div",_hoisted_49,toDisplayString(unref($t)("admin.vectors.actions.remaining",{count:(currentVerificationTask.value.total_count||0)-(currentVerificationTask.value.processed_count||0)})),1)])])])])])):createCommentVNode("",!0),createVNode(_component_CyberDialog,{modelValue:showConfirmDialog.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>showConfirmDialog.value=$event),title:confirmData.value.title,width:"400"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_53,[createVNode(_component_CyberButton,{type:"outlined",onClick:_cache[0]||(_cache[0]=$event=>showConfirmDialog.value=!1)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.vectors.actions.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:confirmData.value.type,loading:__props.processing,onClick:executeConfirmedAction},{default:withCtx(()=>[createTextVNode(toDisplayString(confirmData.value.confirmText),1)]),_:1},8,["type","loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_50,[createBaseVNode("div",_hoisted_51,[_cache[21]||(_cache[21]=createBaseVNode("i",{class:"confirm-icon fas fa-exclamation-triangle text-warning"},null,-1)),createBaseVNode("div",_hoisted_52,[(openBlock(!0),createElementBlock(Fragment,null,renderList(confirmData.value.message,line=>(openBlock(),createElementBlock("p",{key:line,class:"message-line"},toDisplayString(line),1))),128))])])])]),_:1},8,["modelValue","title"])])}}});const VectorActionPanelSimplified=_export_sfc(_sfc_main$1,[["__scopeId","data-v-80b8c8cc"]]);function useVectorData(){const toast=useToast(),{$t}=useTexts(),vectors=ref([]),qdrantRealStats=ref(null),logs=ref([]),availableModels=ref([]),pagination=ref({page:1,page_size:10,total:0,total_page:0}),logPagination=ref({page:1,page_size:20,total:0,total_page:0}),isLoading=ref(!1),selectedFileId=ref("");return{vectors,qdrantRealStats,logs,availableModels,pagination,logPagination,isLoading,selectedFileId,loadVectors:async filters=>{try{isLoading.value=!0;const result=await getVectorList(filters);if(result&&(result.success===!0||result.code===200)&&result.data&&typeof result.data=="object"){const dataArray=Array.isArray(result.data.data)?result.data.data:[];result.data.pagination&&(vectors.value=dataArray,pagination.value={page:result.data.pagination.page||1,page_size:result.data.pagination.page_size||10,total:result.data.pagination.total||0,total_page:result.data.pagination.total_page||0})}}catch{toast.error($t("admin.vectors.toast.loadFailed"))}finally{isLoading.value=!1}},loadQdrantStats:async()=>{try{const result=await getQdrantRealStats();result&&(result.success===!0||result.code===200)&&result.data&&typeof result.data=="object"&&(qdrantRealStats.value={qdrant_vector_count:result.data.qdrant_vector_count||0,qdrant_indexed_count:result.data.qdrant_indexed_count||0,mysql_total_count:result.data.mysql_total_count||0,mysql_completed_count:result.data.mysql_completed_count||0,sync_ratio:result.data.sync_ratio||0,is_healthy:result.data.is_healthy||!1,collection_status:result.data.collection_status||"unknown",last_checked:result.data.last_checked||new Date().toISOString()})}catch{}},loadAvailableModels:async()=>{try{const result=await getAvailableModels();(result.success||result.code===200)&&result.data&&(availableModels.value=result.data.models||[])}catch{availableModels.value=["text-embedding-3-small","text-embedding-3-large"]}},loadVectorLogs:async(fileId,page=1,append=!1)=>{try{const params={page,page_size:logPagination.value.page_size};fileId&&(params.file_id=fileId);const result=await getVectorLogs(params);if((result.success||result.code===200)&&result.data){const newLogs=Array.isArray(result.data.data)?result.data.data:[];append?logs.value=[...logs.value,...newLogs]:logs.value=newLogs,logPagination.value=result.data.pagination||{page,page_size:20,total:0,total_page:0}}}catch{}},cleanup:()=>{}}}function useVectorActions(){const toast=useToast(),{$t}=useTexts(),isProcessing=ref(!1);return{isProcessing,handleRetryVector:async(fileId,onSuccess)=>{if(!fileId){toast.error($t("admin.vectors.toast.fileIdRequired"));return}try{isProcessing.value=!0;const result=await retryVector({file_id:fileId});if(result&&result.success)toast.success($t("admin.vectors.toast.retrySubmitted")),setTimeout(()=>{onSuccess?.()},1e3);else throw new Error(result?.message||$t("admin.vectors.errors.retryFailed"))}catch(error){toast.error($t("admin.vectors.toast.retryFailed").replace("{message}",error.message))}finally{isProcessing.value=!1}},handleBatchActionExecute:async(fileIds,action,onSuccess)=>{try{isProcessing.value=!0;const actionText={reset:$t("admin.vectors.actions.reset"),retry:$t("admin.vectors.actions.retry"),delete:$t("admin.vectors.actions.delete")}[action],result=await batchVectorAction({file_ids:fileIds,action});if(result&&result.success)toast.success($t("admin.vectors.toast.batchActionSuccess").replace("{action}",actionText).replace("{count}",fileIds.length.toString())),setTimeout(()=>{onSuccess?.()},1e3);else throw new Error(result?.message||$t("admin.vectors.errors.batchActionFailed",{action:actionText}))}catch(error){toast.error($t("admin.vectors.toast.batchActionFailed").replace("{message}",error.message))}finally{isProcessing.value=!1}}}}function useVectorDialogs(){const showDeleteConfirm=ref(!1),showBatchConfirm=ref(!1),showRegenerateConfirm=ref(!1),showRetryFailedConfirm=ref(!1),deleteConfirmData=ref({count:0,expectedText:"",fileIds:[]}),batchConfirmData=ref({action:"reset",message:"",fileIds:[]}),regenerateConfirmData=ref({message:[]}),retryFailedConfirmData=ref({message:"",count:0});return{showDeleteConfirm,showBatchConfirm,showRegenerateConfirm,showRetryFailedConfirm,deleteConfirmData,batchConfirmData,regenerateConfirmData,retryFailedConfirmData}}const _hoisted_1={class:"admin-vectors-page admin-page-container"},_hoisted_2={class:"flex items-center gap-2"},_hoisted_3={class:"text-xs"},_hoisted_4={class:"flex items-center gap-2"},_hoisted_5={class:"whitespace-nowrap text-xs"},_hoisted_6={class:"w-6 text-center text-xs"},_hoisted_7={class:"module-wrapper"},_hoisted_8={class:"module-header"},_hoisted_9={class:"module-title"},_hoisted_10={class:"module-content"},_hoisted_11={class:"module-wrapper"},_hoisted_12={class:"module-header"},_hoisted_13={class:"module-title"},_hoisted_14={class:"module-content"},_hoisted_15={class:"module-wrapper"},_hoisted_16={class:"module-header"},_hoisted_17={class:"module-title"},_hoisted_18={class:"module-content"},_hoisted_19={class:"module-wrapper"},_hoisted_20={class:"module-header"},_hoisted_21={class:"module-title"},_hoisted_22={class:"module-content"},_hoisted_23={key:0,class:"module-wrapper module-wrapper-last"},_hoisted_24={class:"module-header"},_hoisted_25={class:"module-title"},_hoisted_26={class:"module-content"},_sfc_main=defineComponent({name:"VectorManagePage",__name:"index",setup(__props){const toast=useToast(),{$t}=useTexts(),{vectors,qdrantRealStats,logs,availableModels,pagination,logPagination,isLoading,selectedFileId,loadVectors,loadQdrantStats,loadAvailableModels,loadVectorLogs,cleanup:cleanupData}=useVectorData(),{isProcessing,handleRetryVector:retryVector2,handleBatchActionExecute}=useVectorActions(),{showDeleteConfirm,showBatchConfirm,showRegenerateConfirm,showRetryFailedConfirm,deleteConfirmData,batchConfirmData,regenerateConfirmData,retryFailedConfirmData}=useVectorDialogs(),showFilter=ref(!1),showLogs=ref(!0),autoEnabled=ref(!0),updatingAuto=ref(!1),concurrency=ref(0),filters=reactive({page:1,page_size:10,status:void 0,model:void 0,keyword:void 0}),deleteInputLabel=computed(()=>`${$t("admin.vectors.confirm.delete.message")} "${deleteConfirmData.value.expectedText}"`),deleteConfirmMessage=computed(()=>[`âš ï¸ ${$t("admin.vectors.error.title")}`,"",`${$t("admin.vectors.confirm.batchDelete.messagePrefix")} ${deleteConfirmData.value.count} ${$t("admin.vectors.vectors.title")}ï¼`,$t("admin.vectors.confirm.delete.message"),"",$t("admin.vectors.form.placeholders.collectionName")]),isStatusSelecting=ref(!1),handleStatusSelect=async status=>{try{isStatusSelecting.value=!0,filters.status=status==="all"?void 0:status,filters.page=1,await loadVectors(filters)}catch{}finally{isStatusSelecting.value=!1}},handleFilter=newFilters=>{Object.assign(filters,newFilters),filters.page=1,loadVectors(filters),showFilter.value=!1},handlePageChange=page=>{filters.page=page,loadVectors(filters)},handlePageSizeChange=size=>{filters.page_size=size,filters.page=1,loadVectors(filters)},handleLogLoadMore=async()=>{const nextPage=logPagination.value.page+1;await loadVectorLogs(selectedFileId.value,nextPage,!0)},handleLogRefresh=()=>{loadVectorLogs(selectedFileId.value)},handleClearLogFilter=()=>{selectedFileId.value="",loadVectorLogs(),toast.success($t("admin.vectors.logs.actions.clear"))},handleViewDetail=fileId=>{selectedFileId.value=fileId,showLogs.value=!0,loadVectorLogs(fileId,1),toast.info(`${$t("admin.vectors.logs.actions.viewDetails")} ${fileId}`)},handleRefresh=()=>{loadVectors(filters),loadQdrantStats(),toast.info($t("admin.vectors.buttons.refresh"))},handleVerificationCompleted=()=>{handleRefresh()},handleRetryVector=async fileId=>{await retryVector2(fileId,()=>{handleRefresh()})},handleBatchAction=async(fileIds,action)=>{action==="delete"?(deleteConfirmData.value={count:fileIds.length,expectedText:$t("admin.vectors.buttons.confirm"),fileIds:[...fileIds]},showDeleteConfirm.value=!0):(batchConfirmData.value={action,message:`${$t("admin.vectors.batchOperations.confirm.delete")} ${fileIds.length} ${$t(action==="retry"?"admin.vectors.actions.search":"admin.vectors.actions.rebuild")} ${$t("admin.vectors.vectors.title")}ã€‚`,fileIds:[...fileIds]},showBatchConfirm.value=!0)},handleRegenerateAll=async()=>{regenerateConfirmData.value={message:[`âš ï¸ ${$t("admin.vectors.confirm.reindex.title")}`,"",$t("admin.vectors.confirm.reindex.message"),$t("admin.vectors.confirm.reindex.stepsIntro"),`1. ${$t("admin.vectors.confirm.delete.message")}`,`2. ${$t("admin.vectors.actions.rebuild")}${$t("admin.vectors.vectors.title")}`,`3. ${$t("admin.vectors.loading.processing")}`,"",`${$t("admin.vectors.confirm.reindex.message")}?`]},showRegenerateConfirm.value=!0},handleRetryAllFailed=async()=>{const failedCount=useWebSocketStore().vectorStats?.queue_stats.failed_count||0;if(failedCount===0){toast.info($t("admin.vectors.toast.noData"));return}retryFailedConfirmData.value={message:`${$t("admin.vectors.batchOperations.confirm.reindex")} ${failedCount} ${$t("admin.vectors.status.error")} ${$t("admin.vectors.vectors.title")}ã€‚${$t("admin.vectors.confirm.reindex.message")}`,count:failedCount},showRetryFailedConfirm.value=!0},handleDeleteConfirm=inputValue=>{inputValue===deleteConfirmData.value.expectedText?(showDeleteConfirm.value=!1,handleBatchActionExecute(deleteConfirmData.value.fileIds,"delete",handleRefresh)):toast.error($t("admin.vectors.toast.confirmFailed"))},handleBatchConfirm=()=>{showBatchConfirm.value=!1,handleBatchActionExecute(batchConfirmData.value.fileIds,batchConfirmData.value.action,handleRefresh)},handleRegenerateConfirm=async()=>{try{showRegenerateConfirm.value=!1;const res=await regenerateAllVectors({});res.success?(toast.success($t("admin.vectors.toast.reindexed")),setTimeout(handleRefresh,2e3)):toast.error(res.message||$t("admin.vectors.toast.reindexFailed"))}catch(e){toast.error(e?.message||$t("admin.vectors.toast.reindexFailed"))}},handleRetryFailedConfirm=async()=>{try{showRetryFailedConfirm.value=!1;const res=await retryAllFailedVectors();res.success?(toast.success($t("admin.vectors.toast.batchReindexed")),setTimeout(handleRefresh,1500)):toast.error(res.message||$t("admin.vectors.toast.reindexFailed"))}catch(e){toast.error(e?.message||$t("admin.vectors.toast.reindexFailed"))}},handleDialogCancel=()=>{showDeleteConfirm.value=!1,showBatchConfirm.value=!1,showRegenerateConfirm.value=!1,showRetryFailedConfirm.value=!1,toast.info($t("admin.vectors.buttons.cancel"))};return onMounted(async()=>{try{await Promise.allSettled([loadAvailableModels(),loadVectors(filters),loadQdrantStats(),loadVectorLogs()]);try{const{data}=await getSettings({group:"vector"}),map=Object.fromEntries((data.settings||[]).map(s=>[s.key,s.value]));typeof map.vector_auto_processing_enabled=="boolean"&&(autoEnabled.value=map.vector_auto_processing_enabled),typeof map.vector_concurrency=="number"&&(concurrency.value=map.vector_concurrency)}catch{}try{const st=await getAutoProcessing();st.success&&(autoEnabled.value=!!st.data?.enabled);const rt=useWebSocketStore().vectorStats?.runtime;rt&&typeof rt.configured_concurrency=="number"&&(concurrency.value=rt.configured_concurrency)}catch{}}catch{toast.error($t("admin.vectors.error.networkError"))}}),onUnmounted(()=>{cleanupData()}),(_ctx,_cache)=>{const _component_CyberSwitch=resolveComponent("CyberSwitch"),_component_CyberSlider=resolveComponent("CyberSlider"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_CyberConfirmDialog=resolveComponent("CyberConfirmDialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.vectors.title"),subtitle:unref($t)("admin.vectors.subtitle"),icon:"fas fa-vector-square"},{actions:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createBaseVNode("span",_hoisted_3,toDisplayString(unref($t)("admin.vectors.qdrant.systemInfo")),1),createVNode(_component_CyberSwitch,{modelValue:autoEnabled.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>autoEnabled.value=$event),disabled:updatingAuto.value,onChange:_cache[1]||(_cache[1]=async v=>{try{updatingAuto.value=!0,await unref(batchUpsertSettings)([{key:"vector_auto_processing_enabled",value:v,type:"boolean",group:"vector",description:unref($t)("admin.vectors.settings.autoProcessingDesc")}]),await unref(setAutoProcessing)(v)}finally{updatingAuto.value=!1}})},null,8,["modelValue","disabled"])]),_cache[9]||(_cache[9]=createBaseVNode("div",{class:"bg-cyber-border mx-3 h-4 w-px"},null,-1)),createBaseVNode("div",_hoisted_4,[createBaseVNode("span",_hoisted_5,toDisplayString(unref($t)("admin.vectors.qdrant.throughput")),1),createVNode(_component_CyberSlider,{modelValue:concurrency.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>concurrency.value=$event),min:1,max:30,step:1,class:"w-20",onChange:_cache[3]||(_cache[3]=async()=>{try{await unref(batchUpsertSettings)([{key:"vector_concurrency",value:concurrency.value,type:"number",group:"vector",description:unref($t)("admin.vectors.settings.concurrencyDesc")}]),await unref(setConcurrency)(concurrency.value)}catch{}})},null,8,["modelValue"]),createBaseVNode("span",_hoisted_6,toDisplayString(concurrency.value),1)])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[createBaseVNode("h3",_hoisted_9,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-chart-bar mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.overview.title")),1)])]),createBaseVNode("div",_hoisted_10,[createVNode(VectorStatusCard,{"selected-status":filters.status,"is-loading":isStatusSelecting.value,onSelect:handleStatusSelect},null,8,["selected-status","is-loading"])])]),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",_hoisted_12,[createBaseVNode("h3",_hoisted_13,[_cache[11]||(_cache[11]=createBaseVNode("span",{class:"icon"},"ðŸ”",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.qdrant.title")),1)])]),createBaseVNode("div",_hoisted_14,[createVNode(QdrantStatsCard,{"qdrant-stats":unref(qdrantRealStats)},null,8,["qdrant-stats"])])]),createBaseVNode("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[createBaseVNode("h3",_hoisted_17,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-cogs mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.vectors.vectorActions")),1)])]),createBaseVNode("div",_hoisted_18,[createVNode(VectorActionPanelSimplified,{processing:unref(isProcessing),onRegenerateAll:handleRegenerateAll,onRetryAllFailed:handleRetryAllFailed,onRefresh:handleRefresh,onVerificationCompleted:handleVerificationCompleted},null,8,["processing"])])]),createBaseVNode("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[createBaseVNode("h3",_hoisted_21,[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-list mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.vectors.title")),1)])]),createBaseVNode("div",_hoisted_22,[createVNode(VectorList,{vectors:unref(vectors),"is-loading":unref(isLoading),pagination:unref(pagination),processing:unref(isProcessing),"show-filter":showFilter.value,"available-models":unref(availableModels),filters,onRetry:handleRetryVector,onBatchAction:handleBatchAction,onPageChange:handlePageChange,onPageSizeChange:handlePageSizeChange,onViewDetail:handleViewDetail,onToggleFilter:_cache[4]||(_cache[4]=$event=>showFilter.value=!showFilter.value),onFilter:handleFilter},null,8,["vectors","is-loading","pagination","processing","show-filter","available-models","filters"])])]),showLogs.value?(openBlock(),createElementBlock("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createBaseVNode("h3",_hoisted_25,[_cache[14]||(_cache[14]=createBaseVNode("i",{class:"fas fa-history mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.vectors.logs.title")),1)])]),createBaseVNode("div",_hoisted_26,[createVNode(VectorLogList,{logs:unref(logs),pagination:unref(logPagination),"selected-file-id":unref(selectedFileId),onLoadMore:handleLogLoadMore,onRefresh:handleLogRefresh,onClearFilter:handleClearLogFilter},null,8,["logs","pagination","selected-file-id"])])])):createCommentVNode("",!0)]),_:1},8,["title","subtitle"]),createVNode(_component_CyberConfirmDialog,{modelValue:unref(showDeleteConfirm),"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>isRef(showDeleteConfirm)?showDeleteConfirm.value=$event:null),type:"danger",title:unref($t)("admin.vectors.confirm.delete.title"),message:deleteConfirmMessage.value,"require-input":!0,"input-label":deleteInputLabel.value,"input-placeholder":unref(deleteConfirmData).expectedText,"expected-input":unref(deleteConfirmData).expectedText,"confirm-text":unref($t)("admin.vectors.confirm.delete.confirm"),"cancel-text":unref($t)("admin.vectors.confirm.delete.cancel"),onConfirm:handleDeleteConfirm,onCancel:handleDialogCancel},null,8,["modelValue","title","message","input-label","input-placeholder","expected-input","confirm-text","cancel-text"]),createVNode(_component_CyberConfirmDialog,{modelValue:unref(showBatchConfirm),"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>isRef(showBatchConfirm)?showBatchConfirm.value=$event:null),type:"warning",title:unref($t)("admin.vectors.batchOperations.title"),message:[unref(batchConfirmData).message],"confirm-text":unref($t)("admin.vectors.buttons.confirm"),"cancel-text":unref($t)("admin.vectors.buttons.cancel"),onConfirm:handleBatchConfirm,onCancel:handleDialogCancel},null,8,["modelValue","title","message","confirm-text","cancel-text"]),createVNode(_component_CyberConfirmDialog,{modelValue:unref(showRegenerateConfirm),"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>isRef(showRegenerateConfirm)?showRegenerateConfirm.value=$event:null),type:"danger",title:unref($t)("admin.vectors.confirm.reindex.title"),message:unref(regenerateConfirmData).message,"confirm-text":unref($t)("admin.vectors.confirm.reindex.confirm"),"cancel-text":unref($t)("admin.vectors.confirm.reindex.cancel"),onConfirm:handleRegenerateConfirm,onCancel:handleDialogCancel},null,8,["modelValue","title","message","confirm-text","cancel-text"]),createVNode(_component_CyberConfirmDialog,{modelValue:unref(showRetryFailedConfirm),"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>isRef(showRetryFailedConfirm)?showRetryFailedConfirm.value=$event:null),type:"warning",title:unref($t)("admin.vectors.confirm.reindex.title"),message:[unref(retryFailedConfirmData).message],"confirm-text":unref($t)("admin.vectors.confirm.reindex.confirm"),"cancel-text":unref($t)("admin.vectors.confirm.reindex.cancel"),onConfirm:handleRetryFailedConfirm,onCancel:handleDialogCancel},null,8,["modelValue","title","message","confirm-text","cancel-text"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-cccf8011"]]);export{index as default};
