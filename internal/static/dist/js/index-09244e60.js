import{aj as del,ai as put,x as get,ah as post,j as useTexts,a3 as getValidationRules,a6 as Validator,q as useToast,_ as _export_sfc,X as __unplugin_components_0,ay as formatDate}from"./index-4d0dab4c.js";import{s as showConfirm}from"./dialog-476153c4.js";import{b as be}from"./editor-markdown-0b2e1ce5.js";import{u as uploadAdminFile}from"./index-e54e76bf.js";import{d as defineComponent,r as ref,w as watch,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,ab as createTextVNode,c as computed,aa as withKeys,b as onMounted,h,a as reactive,R as normalizeClass,A as createBlock,K as createCommentVNode}from"./vue-vendor-31320f47.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";function createAnnouncement(data){return post("/admin/announcements",data)}function updateAnnouncement(id,data){return put(`/admin/announcements/${id}`,data)}function deleteAnnouncement(id){return del(`/admin/announcements/${id}`)}function getAnnouncementList(params){return get("/admin/announcements",params)}function getAnnouncementSettings(){return get("/admin/announcements/settings")}function updateAnnouncementSettings(data){return put("/admin/announcements/settings",data)}function toggleAnnouncementPin(id){return put(`/admin/announcements/${id}/toggle-pin`,{})}const _hoisted_1$3={class:"announcement-form-content"},_hoisted_2$3={class:"form-section"},_hoisted_3$3={class:"form-item"},_hoisted_4$3={class:"form-label required"},_hoisted_5$3={class:"form-item"},_hoisted_6$3={class:"form-label"},_hoisted_7$3={class:"form-section"},_hoisted_8$3={class:"form-item"},_hoisted_9$3={class:"form-label required"},_hoisted_10$2={class:"markdown-editor-wrapper"},_hoisted_11$1={class:"form-hint"},_hoisted_12$1={class:"form-section"},_hoisted_13$1={class:"form-row"},_hoisted_14$1={class:"form-item flex-1"},_hoisted_15$1={class:"form-label required"},_hoisted_16$1={class:"form-item flex-1"},_hoisted_17={class:"form-label"},_hoisted_18={class:"checkbox-inline-hint"},_hoisted_19={class:"inline-hint"},_sfc_main$3=defineComponent({__name:"AnnouncementForm",props:{modelValue:{},isCreating:{type:Boolean},loading:{type:Boolean}},emits:["submit","update:modelValue"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),form=ref({title:"",content:"",summary:"",is_pinned:!1,status:"draft"});function initForm(){props.modelValue?form.value={title:props.modelValue.title,content:props.modelValue.content,summary:props.modelValue.summary,is_pinned:props.modelValue.is_pinned,status:props.modelValue.status}:form.value={title:"",content:"",summary:"",is_pinned:!1,status:"draft"}}const R=getValidationRules($t);function validateForm(){const titleCheck=Validator.validate(form.value.title||"",[R.required,R.maxLength(255)],$t);if(!titleCheck.valid)return toast.error(titleCheck.message||$t("utils.validation.errors.required")),!1;const contentCheck=Validator.validate(form.value.content||"",[R.required],$t);if(!contentCheck.valid)return toast.error(contentCheck.message||$t("utils.validation.errors.required")),!1;if((form.value.summary||"").length>500){const msg=R.maxLength(500).message;return toast.error(msg||$t("utils.validation.errors.maxLength",{n:"500"})),!1}return!0}async function submitForm(){if(validateForm())try{if(!props.isCreating&&props.modelValue){const res=await updateAnnouncement(props.modelValue.id,form.value);res.code===200?(toast.success($t("admin.announcements.messages.updateSuccess")),emit("submit")):toast.error($t("admin.announcements.messages.updateError")+res.message)}else{const res=await createAnnouncement(form.value);res.code===200?(toast.success($t("admin.announcements.messages.createSuccess")),emit("submit")):toast.error($t("admin.announcements.messages.createError")+res.message)}}catch(error){toast.error($t("admin.announcements.messages.operationError")+error.message)}}async function handleUploadImg(files,callback){try{const uploadPromises=files.map(async file=>{const res=await uploadAdminFile(file);if(res.code===200&&res.data)return res.data.full_url;throw new Error(res.message||$t("admin.announcements.messages.uploadFailed"))}),urls=await Promise.all(uploadPromises);callback(urls),toast.success($t("admin.announcements.messages.uploadSuccess").replace("{count}",urls.length.toString()))}catch(error){toast.error($t("admin.announcements.messages.uploadError")+error.message),callback([])}}return __expose({submitForm,validateForm}),watch(()=>props.modelValue,()=>{initForm()},{immediate:!0,deep:!0}),(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberRadioGroup=resolveComponent("CyberRadioGroup"),_component_CyberCheckbox=resolveComponent("CyberCheckbox");return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("label",_hoisted_4$3,toDisplayString(unref($t)("admin.announcements.form.title.label")),1),createVNode(_component_CyberInput,{modelValue:form.value.title,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>form.value.title=$event),placeholder:unref($t)("admin.announcements.form.title.placeholder"),maxlength:255},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_5$3,[createBaseVNode("label",_hoisted_6$3,toDisplayString(unref($t)("admin.announcements.form.summary.label")),1),createVNode(_component_CyberInput,{modelValue:form.value.summary,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>form.value.summary=$event),type:"textarea",placeholder:unref($t)("admin.announcements.form.summary.placeholder"),rows:3,maxlength:500},null,8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_7$3,[createBaseVNode("div",_hoisted_8$3,[createBaseVNode("label",_hoisted_9$3,toDisplayString(unref($t)("admin.announcements.form.content.label")),1),createBaseVNode("div",_hoisted_10$2,[createVNode(unref(be),{modelValue:form.value.content,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>form.value.content=$event),language:"zh-CN",placeholder:unref($t)("admin.announcements.form.content.placeholder"),"preview-theme":"github","code-theme":"github","toolbars-exclude":["github","pageFullscreen"],"on-upload-img":handleUploadImg,"show-code-row-number":!0,"auto-focus":!1,"tab-width":2,style:{height:"600px"}},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_11$1,toDisplayString(unref($t)("admin.announcements.form.content.hint")),1)])]),createBaseVNode("div",_hoisted_12$1,[createBaseVNode("div",_hoisted_13$1,[createBaseVNode("div",_hoisted_14$1,[createBaseVNode("label",_hoisted_15$1,toDisplayString(unref($t)("admin.announcements.form.status.label")),1),createVNode(_component_CyberRadioGroup,{modelValue:form.value.status,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>form.value.status=$event),options:[{label:unref($t)("admin.announcements.status.draft"),value:"draft"},{label:unref($t)("admin.announcements.status.published"),value:"published"},{label:unref($t)("admin.announcements.status.archived"),value:"archived"}],layout:"horizontal"},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_16$1,[createBaseVNode("label",_hoisted_17,toDisplayString(unref($t)("admin.announcements.form.options.label")),1),createBaseVNode("div",_hoisted_18,[createVNode(_component_CyberCheckbox,{modelValue:form.value.is_pinned,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>form.value.is_pinned=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.announcements.form.options.pinned")),1)]),_:1},8,["modelValue"]),createBaseVNode("span",_hoisted_19,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-info-circle"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.form.options.pinnedHint")),1)])])])])])])}}});const AnnouncementForm=_export_sfc(_sfc_main$3,[["__scopeId","data-v-a7f5ac34"]]),_hoisted_1$2={class:"filter-panel"},_hoisted_2$2={class:"filter-row"},_hoisted_3$2={class:"filter-item"},_hoisted_4$2={class:"filter-label"},_hoisted_5$2={class:"filter-item"},_hoisted_6$2={class:"filter-label"},_hoisted_7$2={class:"filter-item flex-1"},_hoisted_8$2={class:"filter-label"},_hoisted_9$2={class:"filter-actions"},_sfc_main$2=defineComponent({__name:"AnnouncementFilterPanel",props:{initialFilters:{}},emits:["filter"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),statusOptions=computed(()=>[{label:$t("admin.announcements.filter.status.all"),value:"all"},{label:$t("admin.announcements.status.draft"),value:"draft"},{label:$t("admin.announcements.status.published"),value:"published"},{label:$t("admin.announcements.status.archived"),value:"archived"}]),pinnedOptions=computed(()=>[{label:$t("admin.announcements.filter.pinned.all"),value:"all"},{label:$t("admin.announcements.filter.pinned.onlyPinned"),value:"true"},{label:$t("admin.announcements.filter.pinned.notPinned"),value:"false"}]),internalStatus=ref(props.initialFilters.status||"all"),internalIsPinned=ref(props.initialFilters.is_pinned===void 0?"all":String(props.initialFilters.is_pinned)),keyword=ref(props.initialFilters.keyword||""),localFilters=computed(()=>({status:internalStatus.value==="all"?void 0:internalStatus.value,is_pinned:internalIsPinned.value==="all"?void 0:internalIsPinned.value==="true",keyword:keyword.value}));function applyFilters(){emit("filter",{...localFilters.value})}function resetFilters(){internalStatus.value="all",internalIsPinned.value="all",keyword.value="",applyFilters()}return watch(()=>props.initialFilters,newFilters=>{internalStatus.value=newFilters.status||"all",internalIsPinned.value=newFilters.is_pinned===void 0?"all":String(newFilters.is_pinned),keyword.value=newFilters.keyword||""},{deep:!0}),(_ctx,_cache)=>{const _component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("label",_hoisted_4$2,toDisplayString(unref($t)("admin.announcements.filter.status.label")),1),createVNode(_component_CyberDropdown,{modelValue:internalStatus.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>internalStatus.value=$event),options:statusOptions.value,placeholder:unref($t)("admin.announcements.filter.status.all"),width:"150px",clearable:!1},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("label",_hoisted_6$2,toDisplayString(unref($t)("admin.announcements.filter.pinned.label")),1),createVNode(_component_CyberDropdown,{modelValue:internalIsPinned.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>internalIsPinned.value=$event),options:pinnedOptions.value,placeholder:unref($t)("admin.announcements.filter.pinned.all"),width:"150px",clearable:!1},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_7$2,[createBaseVNode("label",_hoisted_8$2,toDisplayString(unref($t)("admin.announcements.filter.search.label")),1),createVNode(_component_CyberInput,{modelValue:keyword.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>keyword.value=$event),placeholder:unref($t)("admin.announcements.filter.search.placeholder"),onKeypress:withKeys(applyFilters,["enter"])},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_9$2,[createVNode(_component_CyberButton,{type:"primary",size:"small",onClick:applyFilters},{default:withCtx(()=>[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-search mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.filter.actions.query")),1)]),_:1}),createVNode(_component_CyberButton,{type:"secondary",size:"small",onClick:resetFilters},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-redo mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.filter.actions.reset")),1)]),_:1})])])])}}});const AnnouncementFilterPanel=_export_sfc(_sfc_main$2,[["__scopeId","data-v-4aabb242"]]),_hoisted_1$1={class:"announcement-settings-card"},_hoisted_2$1={key:0,class:"card-loading"},_hoisted_3$1={key:1,class:"card-content"},_hoisted_4$1={class:"setting-item"},_hoisted_5$1={class:"setting-label"},_hoisted_6$1={class:"setting-item"},_hoisted_7$1={class:"setting-label"},_hoisted_8$1={class:"setting-item"},_hoisted_9$1={class:"setting-label"},_hoisted_10$1={class:"slider-wrapper"},_hoisted_11={class:"slider-value"},_hoisted_12={class:"setting-item"},_hoisted_13={class:"setting-label"},_hoisted_14={class:"slider-wrapper"},_hoisted_15={class:"slider-value"},_hoisted_16={class:"setting-item save-button"},_sfc_main$1=defineComponent({name:"AnnouncementSettings",__name:"AnnouncementSettings",setup(__props){const{$t}=useTexts(),toast=useToast(),loading=ref(!1),saving=ref(!1),settings=ref({announcement_enabled:!0,announcement_drawer_position:"right",announcement_drawer_width:"450px",announcement_display_limit:10,announcement_auto_show_delay:3}),fetchSettings=async()=>{loading.value=!0;try{const result=await getAnnouncementSettings();if(result.code===200&&result.data){let drawerWidth=result.data.announcement_drawer_width??600;typeof drawerWidth=="number"&&(drawerWidth=`${drawerWidth}px`),settings.value={announcement_enabled:result.data.announcement_enabled??!0,announcement_drawer_position:result.data.announcement_drawer_position??"right",announcement_drawer_width:drawerWidth,announcement_display_limit:result.data.announcement_display_limit??10,announcement_auto_show_delay:result.data.announcement_auto_show_delay??3}}}catch(error){console.error($t("admin.announcements.settings.messages.fetchError"),error)}finally{loading.value=!1}},saveSettings=async()=>{if(settings.value.announcement_display_limit<1||settings.value.announcement_display_limit>20){toast.error($t("admin.announcements.settings.messages.limitRange"));return}saving.value=!0;try{const updateData={announcement_enabled:settings.value.announcement_enabled,announcement_drawer_position:settings.value.announcement_drawer_position,announcement_drawer_width:"450px",announcement_display_limit:settings.value.announcement_display_limit,announcement_auto_show_delay:settings.value.announcement_auto_show_delay},result=await updateAnnouncementSettings(updateData);result.code===200?toast.success($t("admin.announcements.settings.messages.saveSuccess")):toast.error($t("admin.announcements.settings.messages.saveError")+result.message)}catch(error){toast.error($t("admin.announcements.settings.messages.saveError")+error.message)}finally{saving.value=!1}};return onMounted(()=>{fetchSettings()}),(_ctx,_cache)=>{const _component_CyberSkeleton=__unplugin_components_0,_component_CyberSwitch=resolveComponent("CyberSwitch"),_component_CyberRadioGroup=resolveComponent("CyberRadioGroup"),_component_CyberSlider=resolveComponent("CyberSlider"),_component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$1,[loading.value?(openBlock(),createElementBlock("div",_hoisted_2$1,[createVNode(_component_CyberSkeleton,{type:"text",count:1})])):(openBlock(),createElementBlock("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("label",_hoisted_5$1,toDisplayString(unref($t)("admin.announcements.settings.systemToggle")),1),createVNode(_component_CyberSwitch,{modelValue:settings.value.announcement_enabled,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>settings.value.announcement_enabled=$event)},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_6$1,[createBaseVNode("label",_hoisted_7$1,toDisplayString(unref($t)("admin.announcements.settings.drawerPosition.label")),1),createVNode(_component_CyberRadioGroup,{modelValue:settings.value.announcement_drawer_position,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>settings.value.announcement_drawer_position=$event),options:[{label:unref($t)("admin.announcements.settings.drawerPosition.left"),value:"left"},{label:unref($t)("admin.announcements.settings.drawerPosition.right"),value:"right"}],layout:"horizontal"},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("label",_hoisted_9$1,toDisplayString(unref($t)("admin.announcements.settings.displayLimit")),1),createBaseVNode("div",_hoisted_10$1,[createVNode(_component_CyberSlider,{modelValue:settings.value.announcement_display_limit,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>settings.value.announcement_display_limit=$event),min:1,max:20,step:1,width:"150px"},null,8,["modelValue"]),createBaseVNode("span",_hoisted_11,toDisplayString(settings.value.announcement_display_limit),1)])]),createBaseVNode("div",_hoisted_12,[createBaseVNode("label",_hoisted_13,toDisplayString(unref($t)("admin.announcements.settings.autoShowDelay")),1),createBaseVNode("div",_hoisted_14,[createVNode(_component_CyberSlider,{modelValue:settings.value.announcement_auto_show_delay,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>settings.value.announcement_auto_show_delay=$event),min:0,max:10,step:1,width:"150px"},null,8,["modelValue"]),createBaseVNode("span",_hoisted_15,toDisplayString(settings.value.announcement_auto_show_delay)+toDisplayString(unref($t)("admin.announcements.settings.units.second")),1)])]),createBaseVNode("div",_hoisted_16,[createVNode(_component_CyberButton,{type:"primary",size:"small",loading:saving.value,onClick:saveSettings},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-save mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.settings.saveButton")),1)]),_:1},8,["loading"])])]))])}}});const AnnouncementSettings=_export_sfc(_sfc_main$1,[["__scopeId","data-v-425366d3"]]),_hoisted_1={class:"admin-announcements-page admin-page-container"},_hoisted_2={class:"admin-content-wrapper"},_hoisted_3={class:"table-container"},_hoisted_4={class:"table-wrapper"},_hoisted_5={key:1,class:"empty-state"},_hoisted_6={class:"empty-content animate-slide-up"},_hoisted_7={class:"empty-title"},_hoisted_8={class:"empty-desc"},_hoisted_9={key:0,class:"pagination-wrapper"},_hoisted_10={class:"flex justify-end gap-3 p-4"},_sfc_main=defineComponent({name:"AdminAnnouncements",__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),getStatusConfig=status=>{const statusMap={draft:{text:$t("admin.announcements.status.draft"),color:"var(--color-content-muted)",bgColor:"rgba(var(--color-content-muted-rgb), 0.2)"},published:{text:$t("admin.announcements.status.published"),color:"var(--color-success-400)",bgColor:"rgba(var(--color-success-rgb), 0.2)"},archived:{text:$t("admin.announcements.status.archived"),color:"var(--color-warning-400)",bgColor:"rgba(var(--color-warning-rgb), 0.2)"}};return statusMap[status]||statusMap.draft},dataTableColumns=computed(()=>[{key:"title",title:$t("admin.announcements.table.title"),width:280,align:"left",render:(value,record)=>h("div",{class:"flex items-center gap-2"},[h("div",{class:"flex flex-col gap-1"},[h("div",{class:"flex items-center gap-2"},[h("span",{class:"font-medium",style:{color:"var(--color-content-default)"}},record.title),record.is_pinned?h("span",{class:"px-1.5 py-0.5 text-xs rounded font-medium",style:{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)"}},$t("admin.announcements.actions.pin")):null]),h("div",{class:"text-xs",style:{color:"var(--color-content-muted)"}},`ID: ${record.id}`)])])},{key:"summary",title:$t("admin.announcements.table.summary"),dataIndex:"summary",width:300,align:"left",ellipsis:!0,render:value=>h("span",{style:{color:"var(--color-content-muted)"}},value||$t("admin.announcements.table.noSummary"))},{key:"status",title:$t("admin.announcements.table.status"),width:90,align:"center",render:(value,record)=>{const config=getStatusConfig(record.status);return h("span",{class:"inline-block px-2 py-1 text-xs rounded font-medium whitespace-nowrap",style:{background:config.bgColor,color:config.color}},config.text)}},{key:"view_count",title:$t("admin.announcements.table.viewCount"),width:90,align:"center",render:value=>h("span",{class:"font-mono",style:{color:"var(--color-success-400)"}},value||0)},{key:"published_at",title:$t("admin.announcements.table.publishedAt"),width:160,align:"center",render:value=>h("span",{style:{color:"var(--color-content-muted)"}},value?formatDate(value):$t("admin.announcements.table.notSet"))},{key:"created_at",title:$t("admin.announcements.table.createdAt"),width:160,align:"center",render:value=>h("span",{style:{color:"var(--color-content-muted)"}},formatDate(value))},{key:"actions",title:$t("admin.announcements.table.actions"),width:160,align:"center",render:(value,record)=>h("div",{class:"flex gap-1 justify-center items-center"},[h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs rounded transition-colors",style:{background:record.is_pinned?"rgba(var(--color-warning-rgb), 0.2)":"rgba(var(--color-success-rgb), 0.2)",color:record.is_pinned?"var(--color-warning-400)":"var(--color-success-400)",border:record.is_pinned?"1px solid rgba(var(--color-warning-rgb), 0.4)":"1px solid rgba(var(--color-success-rgb), 0.4)"},title:record.is_pinned?$t("admin.announcements.actions.unpin"):$t("admin.announcements.actions.pin"),onClick:()=>togglePin(record),onMouseenter:e=>{const target=e.target;record.is_pinned?target.style.background="rgba(var(--color-warning-rgb), 0.3)":target.style.background="rgba(var(--color-success-rgb), 0.3)"},onMouseleave:e=>{const target=e.target;record.is_pinned?target.style.background="rgba(var(--color-warning-rgb), 0.2)":target.style.background="rgba(var(--color-success-rgb), 0.2)"}},[h("i",{class:(record.is_pinned,"fas fa-thumbtack")})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs rounded transition-colors",style:{background:"rgba(var(--color-brand-500-rgb), 0.2)",color:"var(--color-brand-500)",border:"1px solid rgba(var(--color-brand-500-rgb), 0.4)"},title:$t("admin.announcements.actions.edit"),onClick:()=>editAnnouncement(record),onMouseenter:e=>{const target=e.target;target.style.background="rgba(var(--color-brand-500-rgb), 0.3)"},onMouseleave:e=>{const target=e.target;target.style.background="rgba(var(--color-brand-500-rgb), 0.2)"}},[h("i",{class:"fas fa-edit"})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs rounded transition-colors",style:{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)",border:"1px solid rgba(var(--color-error-rgb), 0.3)"},title:$t("admin.announcements.actions.delete"),onClick:()=>deleteAnnouncementItem(record.id),onMouseenter:e=>{const target=e.target;target.style.background="rgba(var(--color-error-rgb), 0.3)"},onMouseleave:e=>{const target=e.target;target.style.background="rgba(var(--color-error-rgb), 0.2)"}},[h("i",{class:"fas fa-trash"})])])}]),announcements=ref([]),loading=ref(!1),saveLoading=ref(!1),totalAnnouncements=ref(0),currentPage=ref(1),pageSize=ref(20),showFilter=ref(!1),currentFilters=reactive({keyword:"",status:void 0,is_pinned:void 0}),showEditDialog=ref(!1),currentEditAnnouncement=ref(null),isCreating=ref(!1),announcementFormRef=ref(null),fetchAnnouncementList=async()=>{loading.value=!0;const params={page:currentPage.value,page_size:pageSize.value,keyword:currentFilters.keyword||void 0,status:currentFilters.status,is_pinned:currentFilters.is_pinned};try{const result=await getAnnouncementList(params);if(result.code===200){const{data}=result;announcements.value=data.data,totalAnnouncements.value=data.pagination.total}else toast.error($t("admin.announcements.messages.fetchError")+result.message)}catch(error){toast.error($t("admin.announcements.messages.fetchError")+error.message)}loading.value=!1},handleFilter=filters=>{Object.assign(currentFilters,filters),currentPage.value=1,fetchAnnouncementList(),showFilter.value=!1},handlePageChange=page=>{currentPage.value=page,fetchAnnouncementList()},handlePageSizeChange=size=>{pageSize.value=size,currentPage.value=1,fetchAnnouncementList()},createAnnouncement2=()=>{isCreating.value=!0,currentEditAnnouncement.value=null,showEditDialog.value=!0},editAnnouncement=announcement=>{isCreating.value=!1,currentEditAnnouncement.value=JSON.parse(JSON.stringify(announcement)),showEditDialog.value=!0},deleteAnnouncementItem=async id=>{if(showConfirm($t("admin.announcements.messages.deleteConfirm")))try{const result=await deleteAnnouncement(id);result.code===200?(toast.success($t("admin.announcements.messages.deleteSuccess")),fetchAnnouncementList()):toast.error($t("admin.announcements.messages.deleteError")+result.message)}catch(error){toast.error($t("admin.announcements.messages.deleteError")+error.message)}},togglePin=async announcement=>{const action=announcement.is_pinned?$t("admin.announcements.actions.unpin"):$t("admin.announcements.actions.pin");try{const result=await toggleAnnouncementPin(announcement.id);result.code===200?(toast.success($t("admin.announcements.messages.pinSuccess").replace("{action}",action)),fetchAnnouncementList()):toast.error($t("admin.announcements.messages.pinError").replace("{action}",action)+result.message)}catch(error){toast.error($t("admin.announcements.messages.pinError").replace("{action}",action)+error.message)}},handleRefresh=()=>{fetchAnnouncementList()},handleFormSuccess=()=>{showEditDialog.value=!1,fetchAnnouncementList()},handleConfirm=async()=>{announcementFormRef.value&&await announcementFormRef.value.submitForm()},handleCancel=()=>{showEditDialog.value=!1};return onMounted(()=>{fetchAnnouncementList()}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberSkeleton=__unplugin_components_0,_component_CyberDataTable=resolveComponent("CyberDataTable"),_component_CyberPagination=resolveComponent("CyberPagination"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.announcements.title"),subtitle:unref($t)("admin.announcements.subtitle"),icon:"fas fa-bullhorn","show-topbar":showFilter.value},{actions:withCtx(()=>[createVNode(_component_CyberButton,{type:"primary",onClick:createAnnouncement2},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-plus mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.actions.create")),1)]),_:1}),createVNode(_component_CyberButton,{type:"secondary",loading:loading.value,onClick:handleRefresh},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-sync-alt mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.announcements.actions.refresh")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"secondary",class:normalizeClass({"border-brand-400 text-brand-400":showFilter.value}),onClick:_cache[0]||(_cache[0]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-filter mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.announcements.actions.filter")),1)]),_:1},8,["class"])]),topbar:withCtx(()=>[createVNode(AnnouncementFilterPanel,{"initial-filters":currentFilters,onFilter:handleFilter},null,8,["initial-filters"])]),content:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(AnnouncementSettings),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createVNode(_component_CyberSkeleton,{type:"table",count:pageSize.value,loading:loading.value},null,8,["count","loading"]),!loading.value&&announcements.value.length>0?(openBlock(),createBlock(_component_CyberDataTable,{key:0,data:announcements.value,columns:dataTableColumns.value,loading:loading.value,selectable:!1,hoverable:!0,striped:!0,bordered:!0,size:"small","row-key":"id","loading-text":unref($t)("admin.announcements.table.loadingText")},null,8,["data","columns","loading","loading-text"])):createCommentVNode("",!0),!loading.value&&announcements.value.length===0?(openBlock(),createElementBlock("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[_cache[7]||(_cache[7]=createBaseVNode("div",{class:"empty-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-bullhorn empty-icon"})],-1)),createBaseVNode("h3",_hoisted_7,toDisplayString(unref($t)("admin.announcements.empty.title")),1),createBaseVNode("p",_hoisted_8,toDisplayString(unref($t)("admin.announcements.empty.description")),1)])])):createCommentVNode("",!0)]),totalAnnouncements.value>0?(openBlock(),createElementBlock("div",_hoisted_9,[createVNode(_component_CyberPagination,{"current-page":currentPage.value,"onUpdate:currentPage":[_cache[1]||(_cache[1]=$event=>currentPage.value=$event),handlePageChange],total:totalAnnouncements.value,"page-size":pageSize.value,"show-page-size-selector":!0,"show-quick-jumper":!0,class:"compact-pagination","onUpdate:pageSize":handlePageSizeChange},null,8,["current-page","total","page-size"])])):createCommentVNode("",!0)])])]),_:1},8,["title","subtitle","show-topbar"]),createVNode(_component_CyberDialog,{modelValue:showEditDialog.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>showEditDialog.value=$event),title:isCreating.value?unref($t)("admin.announcements.dialog.createTitle"):unref($t)("admin.announcements.dialog.editTitle"),width:"1200px","max-width":"95vw","close-on-click-overlay":!1,loading:saveLoading.value},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_10,[createVNode(_component_CyberButton,{type:"secondary",size:"medium",onClick:handleCancel},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.announcements.actions.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",size:"medium",loading:saveLoading.value,onClick:handleConfirm},{default:withCtx(()=>[createTextVNode(toDisplayString(isCreating.value?unref($t)("admin.announcements.actions.create"):unref($t)("admin.announcements.actions.update")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createVNode(AnnouncementForm,{ref_key:"announcementFormRef",ref:announcementFormRef,modelValue:currentEditAnnouncement.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>currentEditAnnouncement.value=$event),"is-creating":isCreating.value,onSubmit:handleFormSuccess},null,8,["modelValue","is-creating"])]),_:1},8,["modelValue","title","loading"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-36c37df7"]]);export{index as default};
