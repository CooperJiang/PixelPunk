import{c as computed,r as ref,d as defineComponent,A as createBlock,L as withCtx,E as resolveComponent,z as openBlock,a0 as createBaseVNode,f as createVNode,ab as createTextVNode,a1 as toDisplayString,I as createElementBlock,K as createCommentVNode,aa as withKeys,u as unref,J as renderSlot,ac as createStaticVNode,R as normalizeClass,H as withDirectives,$ as vShow,F as Fragment,M as renderList,w as watch,b as onMounted,n as nextTick,o as onUnmounted,j as onBeforeUnmount,S as watchEffect,a6 as Transition,T as Teleport,Q as normalizeStyle,a5 as withModifiers,a9 as vModelText,a3 as useRouter,i as isRef,a4 as useRoute}from"./vue-vendor-31320f47.js";import{_ as _export_sfc,j as useTexts,Z as StorageUtil,J as getCurrentLocale,ay as formatDate,m as useSettingsStore,aF as Z_INDEX,L as LAYOUT,aG as debounce,q as useToast}from"./index-38202212.js";import{d as useBreakpoints,e as useMediaQuery,b as useWindowSize,f as useElementSize}from"./vueuse-2480d07f.js";import{F as FolderBreadcrumb}from"./FolderBreadcrumb-d1d81a6e.js";import{e as getPublicShare,v as verifySharePassword,f as submitVisitorInfo}from"./index-33da10ff.js";import{a as saveScrollPosition,r as restoreScrollPosition,s as setCssVariable,t as toggleGlobalClass}from"./domUtils-0c63d6d8.js";import{J as JSZip}from"./jszip-101de1ae.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const getShareSortOptions=$t=>[{value:"date",label:$t("constants.share.sortOptions.date")},{value:"name",label:$t("constants.share.sortOptions.name")},{value:"size",label:$t("constants.share.sortOptions.size")}],SORT_DIRECTIONS={ASC:"asc",DESC:"desc"},getLayoutOptions=$t=>[{value:"grid",label:$t("constants.share.layoutOptions.grid.label"),icon:"fas fa-th",description:$t("constants.share.layoutOptions.grid.description")},{value:"waterfall",label:$t("constants.share.layoutOptions.waterfall.label"),icon:"fas fa-stream",description:$t("constants.share.layoutOptions.waterfall.description")},{value:"masonry",label:$t("constants.share.layoutOptions.masonry.label"),icon:"fas fa-th-large",description:$t("constants.share.layoutOptions.masonry.description")},{value:"large",label:$t("constants.share.layoutOptions.large.label"),icon:"fas fa-image",description:$t("constants.share.layoutOptions.large.description")}],LAYOUT_MODES={GRID:"grid",WATERFALL:"waterfall",MASONRY:"masonry",LARGE:"large"},INITIAL_LOAD_COUNT=24,PAGE_SIZE=24,STORAGE_KEYS={GRID_SIZE:"grid_size_preference",LAYOUT_MODE:"share_layout_mode",DYNAMIC_BG:"dynamic_bg_enabled",VISITOR_DIALOG_DISMISSED:"visitor_dialog_dismissed_"},DEFAULTS={GRID_SIZE:250},breakpoints={xs:0,sm:640,md:768,lg:1024,xl:1280,"2xl":1536};function useDevice(){const{width,height}=useWindowSize(),breakpointObj=useBreakpoints(breakpoints),isPortrait=useMediaQuery("(orientation: portrait)"),isTouchScreen=useMediaQuery("(hover: none) and (pointer: coarse)"),breakpointState={xs:breakpointObj.between("xs","sm"),sm:breakpointObj.between("sm","md"),md:breakpointObj.between("md","lg"),lg:breakpointObj.between("lg","xl"),xl:breakpointObj.between("xl","2xl"),"2xl":breakpointObj.greater("2xl")},isMobile=computed(()=>width.value<breakpoints.sm),isTablet=computed(()=>width.value>=breakpoints.sm&&width.value<breakpoints.lg),isDesktop=computed(()=>width.value>=breakpoints.lg),deviceType=computed(()=>isMobile.value?"mobile":isTablet.value?"tablet":"desktop");return{width,height,deviceType,isMobile,isTablet,isDesktop,isPortrait,isTouchScreen,breakpointState,isBreakpoint:bp=>breakpointState[bp],isMin:bp=>breakpointObj.greater(bp),isMax:bp=>breakpointObj.smaller(bp)}}function useImagePreload(){const preloadedUrls=ref(new Set),preloadImage=url=>preloadedUrls.value.has(url)?Promise.resolve():new Promise((resolve,reject)=>{const img=new Image;img.onload=()=>{preloadedUrls.value.add(url),resolve()},img.onerror=()=>{reject(new Error(`Failed to preload image: ${url}`))},img.src=url});return{preloadImage,preloadImages:urls=>{const urlsToLoad=urls.filter(url=>!preloadedUrls.value.has(url));return urlsToLoad.length===0?Promise.resolve([]):Promise.all(urlsToLoad.map(url=>preloadImage(url)))},isPreloaded:url=>preloadedUrls.value.has(url),clearPreloadCache:()=>{preloadedUrls.value.clear()},preloadedUrls}}const processFileUrls=(image,accessToken)=>{const processedImage={...image};return processedImage.ai_info&&processedImage.ai_info.description&&!processedImage.description&&(processedImage.description=processedImage.ai_info.description),accessToken&&["url","full_url","thumb_url","full_thumb_url"].forEach(field=>{if(processedImage[field]){const url=processedImage[field],hasQuery=url.includes("?");processedImage[field]=`${url}${hasQuery?"&":"?"}access_token=${accessToken}`}}),processedImage},getFileDownloadUrl=(image,accessToken)=>{const url=image.full_url||image.url||"";if(!url)return"";if(accessToken){const hasQuery=url.includes("?");return`${url}${hasQuery?"&":"?"}access_token=${accessToken}`}return url},estimateImageHeight=item=>{if(item.width&&item.height){const scaledHeight=200/(item.width/item.height);return Math.max(150,Math.min(scaledHeight,400))}if(item.format){const format=item.format.toLowerCase();if(["jpg","jpeg","png"].includes(format))return 220;if(["gif"].includes(format))return 250}return 200},_hoisted_1$f={class:"password-dialog"},_hoisted_2$d={class:"dialog-content"},_hoisted_3$b={key:0,class:"share-name"},_hoisted_4$a={class:"dialog-message"},_hoisted_5$9={class:"password-form"},_hoisted_6$7={class:"dialog-footer p-4"},_sfc_main$f=defineComponent({__name:"PasswordDialog",props:{modelValue:{type:Boolean,default:!1},shareName:{type:String,default:""}},emits:["update:modelValue","verify"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,visible=computed({get:()=>props.modelValue,set:value=>emit("update:modelValue",value)}),password=ref(""),verifying=ref(!1),handleVerify=async()=>{password.value&&(verifying.value=!0,emit("verify",password.value),setTimeout(()=>{verifying.value=!1},500))};return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>visible.value=$event),title:_ctx.$t("share.passwordDialog.title"),width:"400px","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"close-on-click-overlay":!1,"show-close-button":!1},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_6$7,[createVNode(_component_CyberButton,{type:"secondary",loading:verifying.value,disabled:!password.value,onClick:handleVerify},{default:withCtx(()=>[createTextVNode(toDisplayString(_ctx.$t("share.passwordDialog.verify")),1)]),_:1},8,["loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$f,[_cache[2]||(_cache[2]=createBaseVNode("div",{class:"dialog-icon"},[createBaseVNode("i",{class:"fas fa-lock"})],-1)),createBaseVNode("div",_hoisted_2$d,[__props.shareName?(openBlock(),createElementBlock("div",_hoisted_3$b,toDisplayString(__props.shareName),1)):createCommentVNode("",!0),createBaseVNode("p",_hoisted_4$a,toDisplayString(_ctx.$t("share.passwordDialog.message")),1),createBaseVNode("div",_hoisted_5$9,[createVNode(_component_CyberInput,{modelValue:password.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>password.value=$event),type:"password",placeholder:_ctx.$t("share.passwordDialog.placeholder"),onKeyup:withKeys(handleVerify,["enter"])},null,8,["modelValue","placeholder"])])])])]),_:1},8,["modelValue","title"])}}});const PasswordDialog=_export_sfc(_sfc_main$f,[["__scopeId","data-v-9023c903"]]),_hoisted_1$e={class:"visitor-dialog"},_hoisted_2$c={class:"dialog-header"},_hoisted_3$a={class:"welcome-title"},_hoisted_4$9={class:"dialog-content"},_hoisted_5$8={class:"dialog-message"},_hoisted_6$6={class:"visitor-form"},_hoisted_7$5={class:"form-item"},_hoisted_8$4={class:"form-item"},_hoisted_9$2={class:"dialog-footer gap-2 p-4"},_sfc_main$e=defineComponent({__name:"VisitorInfoDialog",props:{modelValue:{type:Boolean,default:!1},shareKey:{type:String,default:""}},emits:["update:modelValue","submit","dismiss"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,visible=computed({get:()=>props.modelValue,set:value=>emit("update:modelValue",value)}),name=ref(""),email=ref(""),submitting=ref(!1),getStorageKey=()=>`visitor_dialog_dismissed_${props.shareKey}`,markDialogDismissed=()=>{props.shareKey&&StorageUtil.set(getStorageKey(),!0,24)},handleSubmit=async()=>{if(name.value)try{submitting.value=!0;const visitorInfo={name:name.value,...email.value?{email:email.value}:{}};markDialogDismissed(),emit("submit",visitorInfo)}finally{setTimeout(()=>{submitting.value=!1},500)}},handleDismiss=()=>{markDialogDismissed(),emit("dismiss"),visible.value=!1};return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>visible.value=$event),title:unref($t)("share.visitor.dialogTitle"),width:"400px","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"close-on-click-overlay":!1,"show-close-button":!1},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_9$2,[createBaseVNode("button",{class:"skip-button",onClick:handleDismiss},toDisplayString(unref($t)("share.visitor.dismiss")),1),createVNode(_component_CyberButton,{type:"primary",loading:submitting.value,disabled:!name.value,onClick:handleSubmit},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("share.visitor.submit")),1)]),_:1},8,["loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$e,[createBaseVNode("div",_hoisted_2$c,[_cache[3]||(_cache[3]=createBaseVNode("div",{class:"dialog-icon"},[createBaseVNode("i",{class:"fas fa-handshake"})],-1)),createBaseVNode("h3",_hoisted_3$a,toDisplayString(unref($t)("share.visitor.welcomeTitle")),1)]),createBaseVNode("div",_hoisted_4$9,[createBaseVNode("p",_hoisted_5$8,toDisplayString(unref($t)("share.visitor.message")),1),createBaseVNode("div",_hoisted_6$6,[createBaseVNode("div",_hoisted_7$5,[createBaseVNode("label",null,toDisplayString(unref($t)("share.visitor.name.label")),1),createVNode(_component_CyberInput,{modelValue:name.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>name.value=$event),placeholder:unref($t)("share.visitor.name.placeholder")},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_8$4,[createBaseVNode("label",null,toDisplayString(unref($t)("share.visitor.email.label")),1),createVNode(_component_CyberInput,{modelValue:email.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>email.value=$event),placeholder:unref($t)("share.visitor.email.placeholder")},null,8,["modelValue","placeholder"])])])])])]),_:1},8,["modelValue","title"])}}});const VisitorInfoDialog=_export_sfc(_sfc_main$e,[["__scopeId","data-v-bde7e90d"]]),_hoisted_1$d={key:0,class:"mobile-fixed-header"},_hoisted_2$b={class:"mobile-header-top"},_hoisted_3$9={class:"mobile-title-area"},_hoisted_4$8={class:"mobile-title"},_hoisted_5$7={key:0},_hoisted_6$5={key:1},_hoisted_7$4={key:0,class:"mobile-badges"},_hoisted_8$3={key:0,class:"mobile-user-info"},_hoisted_9$1={key:0,class:"mobile-avatar"},_hoisted_10=["src","alt"],_hoisted_11={key:1,class:"mobile-avatar-fallback h-full w-full"},_hoisted_12={key:0,class:"mobile-quick-info"},_hoisted_13={key:0,class:"quick-info-item"},_hoisted_14={key:1,class:"quick-info-item"},_hoisted_15={class:"quick-info-item"},_hoisted_16={key:2,class:"quick-info-item"},_hoisted_17={key:1,class:"share-header-card"},_hoisted_18={class:"share-header-main"},_hoisted_19={class:"share-title-section"},_hoisted_20={class:"share-title"},_hoisted_21={key:0},_hoisted_22={key:1},_hoisted_23={key:0,class:"share-badges"},_hoisted_24={key:0,class:"badge"},_hoisted_25={class:"share-info-row"},_hoisted_26={key:0,class:"share-user-section"},_hoisted_27={class:"user-info"},_hoisted_28={key:0,class:"user-avatar"},_hoisted_29=["src","alt"],_hoisted_30={key:1,class:"user-avatar"},_hoisted_31={class:"avatar-fallback"},_hoisted_32={class:"user-details"},_hoisted_33={class:"username"},_hoisted_34={key:0,class:"share-date"},_hoisted_35={key:1,class:"share-metrics-section"},_hoisted_36={class:"metrics-grid"},_hoisted_37={key:0,class:"metric-item"},_hoisted_38={class:"metric-data"},_hoisted_39={class:"metric-value"},_hoisted_40={class:"metric-label"},_hoisted_41={key:1,class:"metric-item"},_hoisted_42={class:"metric-data"},_hoisted_43={class:"metric-value"},_hoisted_44={class:"metric-label"},_hoisted_45={key:2,class:"metric-item"},_hoisted_46={class:"metric-data"},_hoisted_47={class:"metric-value"},_hoisted_48={class:"metric-label"},_hoisted_49={key:0,class:"share-description-section"},_hoisted_50={class:"description-container"},_hoisted_51={class:"share-description"},_hoisted_52={key:2,class:"mobile-description-section"},_hoisted_53={class:"mobile-description-content"},_sfc_main$d=defineComponent({__name:"ShareHeader",props:{share:{type:Object,default:()=>({})},user:{type:Object,default:()=>({})}},setup(__props){const avatarError=ref(!1),{isMobile}=useDevice(),showDescription=ref(!1),handleAvatarError=()=>{avatarError.value=!0},toggleDescription=()=>{showDescription.value=!showDescription.value},getUserInitial=username=>username?username.charAt(0).toUpperCase():"?",formatDate2=dateString=>dateString?new Date(dateString).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"):"",{$t}=useTexts(),formatDateShort=dateString=>dateString?new Date(dateString).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-"):$t("share.header.permanent");return(_ctx,_cache)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["share-header-container",{"is-mobile":unref(isMobile)}])},[unref(isMobile)?(openBlock(),createElementBlock("div",_hoisted_1$d,[createBaseVNode("div",_hoisted_2$b,[createBaseVNode("div",_hoisted_3$9,[createBaseVNode("h1",_hoisted_4$8,[__props.share&&__props.share.name?(openBlock(),createElementBlock("span",_hoisted_5$7,toDisplayString(__props.share.name),1)):(openBlock(),createElementBlock("span",_hoisted_6$5,toDisplayString(unref($t)("share.header.title")),1))]),__props.share&&__props.share.has_password?(openBlock(),createElementBlock("div",_hoisted_7$4,[..._cache[0]||(_cache[0]=[createBaseVNode("i",{class:"fas fa-lock"},null,-1)])])):createCommentVNode("",!0)]),__props.user?(openBlock(),createElementBlock("div",_hoisted_8$3,[__props.user.avatar&&!avatarError.value?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("img",{src:__props.user.avatar,alt:unref($t)("share.header.avatar"),onError:handleAvatarError},null,40,_hoisted_10)])):(openBlock(),createElementBlock("div",_hoisted_11,toDisplayString(getUserInitial(__props.user.username)),1))])):createCommentVNode("",!0)]),renderSlot(_ctx.$slots,"breadcrumb",{},void 0,!0),__props.share?(openBlock(),createElementBlock("div",_hoisted_12,[__props.share.current_views!==void 0?(openBlock(),createElementBlock("div",_hoisted_13,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-eye"},null,-1)),createTextVNode(" "+toDisplayString(__props.share.current_views),1)])):createCommentVNode("",!0),__props.share&&__props.share.max_views>0?(openBlock(),createElementBlock("div",_hoisted_14,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-stop-circle"},null,-1)),createTextVNode(" "+toDisplayString(__props.share.max_views),1)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_15,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-clock"},null,-1)),createTextVNode(" "+toDisplayString(formatDateShort(__props.share.expired_at)),1)]),__props.user?(openBlock(),createElementBlock("div",_hoisted_16,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-user"},null,-1)),createTextVNode(" "+toDisplayString(__props.user.username),1)])):createCommentVNode("",!0)])):createCommentVNode("",!0)])):createCommentVNode("",!0),unref(isMobile)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_17,[createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createBaseVNode("h1",_hoisted_20,[__props.share&&__props.share.name?(openBlock(),createElementBlock("span",_hoisted_21,toDisplayString(__props.share.name),1)):(openBlock(),createElementBlock("span",_hoisted_22,toDisplayString(unref($t)("share.header.title")),1))]),__props.share?(openBlock(),createElementBlock("div",_hoisted_23,[__props.share.has_password?(openBlock(),createElementBlock("div",_hoisted_24,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-lock"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.header.passwordProtected")),1)])):createCommentVNode("",!0)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_25,[__props.user?(openBlock(),createElementBlock("div",_hoisted_26,[createBaseVNode("div",_hoisted_27,[__props.user.avatar&&!avatarError.value?(openBlock(),createElementBlock("div",_hoisted_28,[createBaseVNode("img",{src:__props.user.avatar,alt:unref($t)("share.header.userAvatar"),onError:handleAvatarError},null,40,_hoisted_29)])):(openBlock(),createElementBlock("div",_hoisted_30,[createBaseVNode("div",_hoisted_31,toDisplayString(getUserInitial(__props.user.username)),1)])),createBaseVNode("div",_hoisted_32,[createBaseVNode("span",_hoisted_33,toDisplayString(__props.user.username),1),__props.share&&__props.share.created_at?(openBlock(),createElementBlock("span",_hoisted_34,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-calendar-alt"},null,-1)),createTextVNode(" "+toDisplayString(formatDate2(__props.share.created_at)),1)])):createCommentVNode("",!0)])])])):createCommentVNode("",!0),__props.share?(openBlock(),createElementBlock("div",_hoisted_35,[createBaseVNode("div",_hoisted_36,[__props.share.current_views!==void 0?(openBlock(),createElementBlock("div",_hoisted_37,[_cache[7]||(_cache[7]=createBaseVNode("div",{class:"metric-icon"},[createBaseVNode("i",{class:"fas fa-eye"})],-1)),createBaseVNode("div",_hoisted_38,[createBaseVNode("div",_hoisted_39,toDisplayString(__props.share.current_views),1),createBaseVNode("div",_hoisted_40,toDisplayString(unref($t)("share.header.viewCount")),1)])])):createCommentVNode("",!0),__props.share&&__props.share.max_views>0?(openBlock(),createElementBlock("div",_hoisted_41,[_cache[8]||(_cache[8]=createBaseVNode("div",{class:"metric-icon"},[createBaseVNode("i",{class:"fas fa-stop-circle"})],-1)),createBaseVNode("div",_hoisted_42,[createBaseVNode("div",_hoisted_43,toDisplayString(__props.share.max_views),1),createBaseVNode("div",_hoisted_44,toDisplayString(unref($t)("share.header.maxViews")),1)])])):createCommentVNode("",!0),__props.share?(openBlock(),createElementBlock("div",_hoisted_45,[_cache[9]||(_cache[9]=createBaseVNode("div",{class:"metric-icon"},[createBaseVNode("i",{class:"fas fa-clock"})],-1)),createBaseVNode("div",_hoisted_46,[createBaseVNode("div",_hoisted_47,toDisplayString(formatDateShort(__props.share.expired_at)),1),createBaseVNode("div",_hoisted_48,toDisplayString(unref($t)("share.header.validUntil")),1)])])):createCommentVNode("",!0)])])):createCommentVNode("",!0)]),__props.share&&__props.share.description?(openBlock(),createElementBlock("div",_hoisted_49,[createBaseVNode("div",_hoisted_50,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-quote-left description-icon"},null,-1)),createBaseVNode("p",_hoisted_51,toDisplayString(__props.share.description),1)])])):createCommentVNode("",!0)]),_cache[11]||(_cache[11]=createStaticVNode('<div class="decoration corner-tl" data-v-3258f6e7></div><div class="decoration corner-tr" data-v-3258f6e7></div><div class="decoration corner-bl" data-v-3258f6e7></div><div class="decoration corner-br" data-v-3258f6e7></div><div class="glow-effect" data-v-3258f6e7></div>',5))])),unref(isMobile)&&__props.share&&__props.share.description?(openBlock(),createElementBlock("div",_hoisted_52,[createBaseVNode("button",{class:"mobile-description-toggle",onClick:toggleDescription},[createBaseVNode("span",null,toDisplayString(unref($t)("share.header.description")),1),createBaseVNode("i",{class:normalizeClass(showDescription.value?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)]),withDirectives(createBaseVNode("div",_hoisted_53,[createBaseVNode("p",null,toDisplayString(__props.share.description),1)],512),[[vShow,showDescription.value]])])):createCommentVNode("",!0)],2))}});const ShareHeader=_export_sfc(_sfc_main$d,[["__scopeId","data-v-3258f6e7"]]),_hoisted_1$c={class:"error-container"},_hoisted_2$a={class:"error-icon"},_hoisted_3$8={class:"error-content"},_hoisted_4$7={class:"error-title"},_hoisted_5$6={class:"error-message"},_hoisted_6$4={class:"error-actions"},_hoisted_7$3={class:"cyber-home-link-wrapper"},_hoisted_8$2={class:"cyber-link-content"},_hoisted_9={key:0,class:"fas fa-home"},_sfc_main$c=defineComponent({__name:"ErrorState",props:{type:{type:String,default:"error",validator:value=>["error","expired","max-views","not-found","unauthorized"].includes(value)},title:{type:String,default:""},message:{type:String,default:""},actionText:{type:String,default:""},homeIcon:{type:Boolean,default:!0}},emits:["home-click"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,displayTitle=computed(()=>props.title||$t("share.error.defaultTitle")),displayMessage=computed(()=>props.message||$t("share.error.defaultMessage")),displayActionText=computed(()=>props.actionText||$t("share.error.backHome")),iconClass=computed(()=>{switch(props.type){case"expired":return"fas fa-hourglass-end";case"max-views":return"fas fa-eye-slash";case"not-found":return"fas fa-unlink";case"unauthorized":return"fas fa-lock";default:return"fas fa-exclamation-triangle"}}),errorClass=computed(()=>`error-type-${props.type}`);return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$c,[createBaseVNode("div",{class:normalizeClass(["error-card",errorClass.value])},[createBaseVNode("div",_hoisted_2$a,[createBaseVNode("i",{class:normalizeClass(iconClass.value)},null,2),_cache[1]||(_cache[1]=createBaseVNode("div",{class:"error-glow"},null,-1))]),createBaseVNode("div",_hoisted_3$8,[createBaseVNode("h2",_hoisted_4$7,toDisplayString(displayTitle.value),1),createBaseVNode("p",_hoisted_5$6,toDisplayString(displayMessage.value),1),createBaseVNode("div",_hoisted_6$4,[renderSlot(_ctx.$slots,"actions",{},()=>[createBaseVNode("div",_hoisted_7$3,[createBaseVNode("div",{class:"cyber-home-link",onClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("home-click"))},[createBaseVNode("div",_hoisted_8$2,[__props.homeIcon?(openBlock(),createElementBlock("i",_hoisted_9)):createCommentVNode("",!0),createBaseVNode("span",null,toDisplayString(displayActionText.value),1)]),_cache[2]||(_cache[2]=createBaseVNode("div",{class:"cyber-link-glow"},null,-1))]),_cache[3]||(_cache[3]=createBaseVNode("div",{class:"cyber-link-lines"},[createBaseVNode("div",{class:"link-line line-left"}),createBaseVNode("div",{class:"link-line line-right"})],-1))])],!0)])]),_cache[4]||(_cache[4]=createStaticVNode('<div class="decoration-line line-top" data-v-79b6f437></div><div class="decoration-line line-bottom" data-v-79b6f437></div><div class="decoration-dots" data-v-79b6f437><div class="dot dot-1" data-v-79b6f437></div><div class="dot dot-2" data-v-79b6f437></div><div class="dot dot-3" data-v-79b6f437></div><div class="dot dot-4" data-v-79b6f437></div></div>',3))],2)]))}});const ErrorState=_export_sfc(_sfc_main$c,[["__scopeId","data-v-79b6f437"]]),_hoisted_1$b={class:"mobile-share-info"},_hoisted_2$9={key:1,class:"info-item"},_hoisted_3$7={class:"info-item"},_sfc_main$b=defineComponent({__name:"MobileShareInfo",props:{showBackButton:{type:Boolean,default:!1},viewCount:{type:Number,default:0},createdAt:{type:String,required:!0}},emits:["back-click"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,formattedDate=computed(()=>formatDate(props.createdAt,"YYYY-MM-DD")),handleBackClick=()=>{emit("back-click")};return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$b,[__props.showBackButton?(openBlock(),createElementBlock("button",{key:0,class:"back-button",onClick:handleBackClick},[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-arrow-left"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.mobile.backToRoot")),1)])):(openBlock(),createElementBlock("div",_hoisted_2$9,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-eye"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.mobile.viewCount",{count:__props.viewCount||0})),1)])),createBaseVNode("div",_hoisted_3$7,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-calendar-alt"},null,-1)),createBaseVNode("span",null,toDisplayString(formattedDate.value),1)])]))}});const MobileShareInfo=_export_sfc(_sfc_main$b,[["__scopeId","data-v-8921dea3"]]),_hoisted_1$a={key:0,class:"share-section folders-section"},_hoisted_2$8={class:"section-header"},_hoisted_3$6={class:"section-title"},_hoisted_4$6={class:"count-badge"},_hoisted_5$5={class:"folders-grid"},_sfc_main$a=defineComponent({__name:"FolderSection",props:{folders:{type:Array,default:()=>[]}},emits:["folder-click"],setup(__props,{emit:__emit}){const{$t}=useTexts(),emit=__emit,handleFolderClick=folder=>{emit("folder-click",folder)};return(_ctx,_cache)=>{const _component_CyberShareFolder=resolveComponent("CyberShareFolder");return __props.folders&&__props.folders.length>0?(openBlock(),createElementBlock("div",_hoisted_1$a,[createBaseVNode("div",_hoisted_2$8,[createBaseVNode("div",_hoisted_3$6,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-folder"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.folder.title")),1),createBaseVNode("span",_hoisted_4$6,toDisplayString(__props.folders.length),1)])]),createBaseVNode("div",_hoisted_5$5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.folders,folder=>(openBlock(),createBlock(_component_CyberShareFolder,{key:folder.id,folder,onClick:handleFolderClick},null,8,["folder"]))),128))])])):createCommentVNode("",!0)}}});const FolderSection=_export_sfc(_sfc_main$a,[["__scopeId","data-v-109dcb8f"]]),_hoisted_1$9={class:"section-header"},_hoisted_2$7={class:"section-title"},_hoisted_3$5={class:"count-badge"},_hoisted_4$5={class:"sort-options"},_hoisted_5$4=["onClick"],_hoisted_6$3=["title"],_hoisted_7$2=["title"],_hoisted_8$1=["title"],_sfc_main$9=defineComponent({__name:"SortBar",props:{title:{type:String,default:""},count:{type:Number,default:0},currentSort:{type:String,default:"date"},sortDirection:{type:String,default:"desc"},sortOptions:{type:Array,default:()=>[]},layoutMode:{type:String,default:"grid"},isFullScreen:{type:Boolean,default:!1},isSelectionMode:{type:Boolean,default:!1}},emits:["sort-change","toggle-fullscreen","toggle-selection","open-grid-size","open-layout"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),displayTitle=computed(()=>props.title||$t("share.file.title")),displaySortOptions=computed(()=>props.sortOptions.length>0?props.sortOptions:[{value:"date",label:$t("share.sort.date")},{value:"name",label:$t("share.sort.name")},{value:"size",label:$t("share.sort.size")}]),handleSortChange=sortType=>{emit("sort-change",sortType)},toggleFullScreen=()=>{emit("toggle-fullscreen")},toggleSelectionMode=()=>{emit("toggle-selection")},openGridSizePopover=e=>{e.stopPropagation(),emit("open-grid-size",e)},openLayoutPopover=e=>{e.stopPropagation(),emit("open-layout",e)},getLayoutIcon=computed(()=>{switch(props.layoutMode){case"waterfall":return"fas fa-stream";case"masonry":return"fas fa-th-large";case"large":return"fas fa-image";default:return"fas fa-th"}});return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$9,[createBaseVNode("div",_hoisted_2$7,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-images"},null,-1)),createBaseVNode("span",null,toDisplayString(displayTitle.value),1),createBaseVNode("span",_hoisted_3$5,toDisplayString(__props.count),1)]),createBaseVNode("div",_hoisted_4$5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(displaySortOptions.value,option=>(openBlock(),createElementBlock("button",{key:option.value,class:normalizeClass([{active:__props.currentSort===option.value},"sort-btn"]),onClick:$event=>handleSortChange(option.value)},[createTextVNode(toDisplayString(option.label)+" ",1),__props.currentSort===option.value?(openBlock(),createElementBlock("i",{key:0,class:normalizeClass(__props.sortDirection==="asc"?"fas fa-sort-up":"fas fa-sort-down")},null,2)):createCommentVNode("",!0)],10,_hoisted_5$4))),128)),createBaseVNode("button",{class:"sort-btn grid-size-btn",title:unref($t)("share.sort.adjustGridSize"),onClick:openGridSizePopover},[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-sliders-h"},null,-1)])],8,_hoisted_6$3),createBaseVNode("button",{class:"sort-btn fullscreen-btn",title:__props.isFullScreen?unref($t)("share.sort.exitFullscreen"):unref($t)("share.sort.fullscreen"),onClick:toggleFullScreen},[createBaseVNode("i",{class:normalizeClass(__props.isFullScreen?"fas fa-compress":"fas fa-expand")},null,2)],8,_hoisted_7$2),createBaseVNode("button",{class:"sort-btn layout-btn",title:unref($t)("share.sort.selectLayout"),onClick:openLayoutPopover},[createBaseVNode("i",{class:normalizeClass(getLayoutIcon.value)},null,2)],8,_hoisted_8$1),createBaseVNode("button",{class:normalizeClass(["sort-btn selection-btn",{active:__props.isSelectionMode}]),onClick:toggleSelectionMode},[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-check-square"},null,-1)),createTextVNode(" "+toDisplayString(__props.isSelectionMode?unref($t)("share.sort.exitSelect"):unref($t)("share.sort.multiSelect")),1)],2)])]))}});const SortBar=_export_sfc(_sfc_main$9,[["__scopeId","data-v-00e47904"]]),_hoisted_1$8={key:0,class:"selection-toolbar"},_hoisted_2$6={class:"selection-info"},_hoisted_3$4={class:"selection-actions"},_hoisted_4$4=["disabled"],_hoisted_5$3=["disabled"],_hoisted_6$2=["disabled"],_hoisted_7$1={key:0},_hoisted_8={key:1},_sfc_main$8=defineComponent({__name:"SelectionToolbar",props:{visible:{type:Boolean,default:!1},selectedCount:{type:Number,default:0},totalCount:{type:Number,default:0}},emits:["select-all","deselect-all","download"],setup(__props,{emit:__emit}){const emit=__emit,selectAll=()=>{emit("select-all")},deselectAll=()=>{emit("deselect-all")},downloadSelected=()=>{emit("download")};return(_ctx,_cache)=>__props.visible?(openBlock(),createElementBlock("div",_hoisted_1$8,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("span",null,toDisplayString(_ctx.$t("share.selectionToolbar.selectedPrefix"))+" "+toDisplayString(__props.selectedCount)+" "+toDisplayString(_ctx.$t("share.selectionToolbar.selectedSuffix")),1)]),createBaseVNode("div",_hoisted_3$4,[createBaseVNode("button",{class:"action-btn",disabled:__props.totalCount===0,onClick:selectAll},[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-check-double"},null,-1)),createBaseVNode("span",null,toDisplayString(_ctx.$t("share.selectionToolbar.selectAll")),1)],8,_hoisted_4$4),createBaseVNode("button",{class:"action-btn",disabled:__props.selectedCount===0,onClick:deselectAll},[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-times"},null,-1)),createBaseVNode("span",null,toDisplayString(_ctx.$t("actions.cancel")),1)],8,_hoisted_5$3),createBaseVNode("button",{class:"action-btn download-btn",disabled:__props.selectedCount===0,onClick:downloadSelected},[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-download"},null,-1)),__props.selectedCount<=1?(openBlock(),createElementBlock("span",_hoisted_7$1,toDisplayString(_ctx.$t("actions.download")),1)):(openBlock(),createElementBlock("span",_hoisted_8,toDisplayString(_ctx.$t("share.selectionToolbar.batchDownload"))+" ("+toDisplayString(__props.selectedCount)+")",1))],8,_hoisted_6$2)])])):createCommentVNode("",!0)}});const SelectionToolbar=_export_sfc(_sfc_main$8,[["__scopeId","data-v-883e8203"]]),_hoisted_1$7={key:0,class:"loading-indicator"},_hoisted_2$5={key:1,class:"load-more-info"},_hoisted_3$3={class:"count-info"},_hoisted_4$3={key:2,class:"all-loaded"},_sfc_main$7=defineComponent({__name:"AutoLoader",props:{current:{type:Number,required:!0},total:{type:Number,required:!0},disabled:{type:Boolean,default:!1},threshold:{type:Number,default:.5},throttle:{type:Number,default:500},externalLoading:{type:Boolean,default:!1},canLoadMore:{type:Boolean,default:!0}},emits:["load-more"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,loaderRef=ref(null),loading=ref(!1),observer=ref(null),needsRecheck=ref(!1);let lastLoadTime=0;const isComplete=computed(()=>props.current>=props.total||!props.canLoadMore),isInViewport=()=>{if(!loaderRef.value)return!1;const rect=loaderRef.value.getBoundingClientRect(),windowHeight=window.innerHeight||document.documentElement.clientHeight,windowWidth=window.innerWidth||document.documentElement.clientWidth;return rect.top>=0&&rect.left>=0&&rect.bottom<=windowHeight+200&&rect.right<=windowWidth},setupObserver=()=>{if(isComplete.value||props.disabled){destroyObserver();return}destroyObserver(),observer.value=new IntersectionObserver(entries=>{if(entries[0].isIntersecting&&!props.externalLoading&&!loading.value&&props.canLoadMore){const now=Date.now();now-lastLoadTime>props.throttle&&(loadMore(),lastLoadTime=now)}},{root:null,rootMargin:"200px",threshold:[0,props.threshold,1]}),loaderRef.value&&observer.value.observe(loaderRef.value)},destroyObserver=()=>{observer.value&&(observer.value.disconnect(),observer.value=null)},loadMore=()=>{isComplete.value||props.externalLoading||loading.value||props.disabled||!props.canLoadMore||(loading.value=!0,needsRecheck.value=!1,emit("load-more"))},recheckLoadMore=()=>{props.externalLoading||loading.value||isComplete.value||props.disabled||nextTick(()=>{setTimeout(()=>{isInViewport()&&props.canLoadMore&&!isComplete.value&&loadMore()},100)})};watch(()=>props.externalLoading,(newLoading,oldLoading)=>{oldLoading&&!newLoading&&(loading.value=!1,(needsRecheck.value||isInViewport())&&recheckLoadMore())}),watch(()=>[props.current,props.total,props.disabled,props.canLoadMore],()=>{nextTick(()=>{setupObserver(),!props.externalLoading&&!loading.value&&recheckLoadMore()})});const handleScroll=()=>{if(!(props.externalLoading||loading.value||isComplete.value||props.disabled)&&isInViewport()){needsRecheck.value=!0;const now=Date.now();now-lastLoadTime>props.throttle&&(loadMore(),lastLoadTime=now)}};return onMounted(()=>{setupObserver(),window.addEventListener("scroll",handleScroll,{passive:!0}),nextTick(()=>{isInViewport()&&props.canLoadMore&&!isComplete.value&&setTimeout(()=>{!props.externalLoading&&!loading.value&&loadMore()},100)})}),onUnmounted(()=>{destroyObserver(),window.removeEventListener("scroll",handleScroll)}),(_ctx,_cache)=>(openBlock(),createElementBlock("div",{ref_key:"loaderRef",ref:loaderRef,class:"auto-loader"},[__props.externalLoading||loading.value?(openBlock(),createElementBlock("div",_hoisted_1$7,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-circle-notch fa-spin"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.autoLoader.loading")),1)])):isComplete.value?(openBlock(),createElementBlock("div",_hoisted_4$3,[createBaseVNode("span",null,toDisplayString(unref($t)("share.autoLoader.allLoaded")),1)])):(openBlock(),createElementBlock("div",_hoisted_2$5,[createBaseVNode("span",_hoisted_3$3,toDisplayString(unref($t)("share.autoLoader.loaded",{current:__props.current,total:__props.total})),1)]))],512))}});const AutoLoader=_export_sfc(_sfc_main$7,[["__scopeId","data-v-4f2bfea6"]]),_hoisted_1$6={class:"section-header"},_hoisted_2$4={key:0,class:"section-title"},_hoisted_3$2={class:"count-badge"},_hoisted_4$2={key:1,class:"images-grid"},_hoisted_5$2={key:3,class:"images-grid masonry"},_hoisted_6$1={key:4,class:"images-grid large"},_sfc_main$6=defineComponent({__name:"FileSection",props:{images:{type:Array,default:()=>[]},displayImages:{type:Array,default:()=>[]},isRootImages:{type:Boolean,default:!1},layoutMode:{type:String,default:"grid"},isSelectionMode:{type:Boolean,default:!1},selectedIds:{type:Array,default:()=>[]},initialLoadCount:{type:Number,default:20},currentSort:{type:String,default:"created_at"},sortDirection:{type:String,default:"desc"},waterfallColumns:{type:Number,default:4},waterfallColumnWidth:{type:Number,default:240},showLoadMoreButton:{type:Boolean,default:!1},currentPage:{type:Number,default:1},pageSize:{type:Number,default:50},getImageHeight:{type:Function,default:()=>200},isFullScreen:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},canLoadMore:{type:Boolean,default:!0},shareKey:{type:String,required:!0},accessToken:{type:String,default:""}},emits:["image-click","toggle-selection","toggle-selection-mode","select-all","deselect-all","download-selected","sort-change","open-grid-size","toggle-immersive","open-layout","load-more","toggle-fullscreen"],setup(__props,{emit:__emit}){const{$t}=useTexts(),SHARE_SORT_OPTIONS=computed(()=>getShareSortOptions($t)),props=__props,selectedCount=computed(()=>props.selectedIds.length),isImageSelected=fileId=>props.selectedIds.includes(fileId),sortOptions=SHARE_SORT_OPTIONS;return(_ctx,_cache)=>{const _component_CyberShareFile=resolveComponent("CyberShareFile"),_component_CyberWaterfallLayout=resolveComponent("CyberWaterfallLayout");return __props.images&&__props.images.length>0?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["share-section images-section",{"root-images":__props.isRootImages}])},[createBaseVNode("div",_hoisted_1$6,[__props.isRootImages?(openBlock(),createElementBlock("div",_hoisted_2$4,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-images"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("share.file.rootFiles")),1),createBaseVNode("span",_hoisted_3$2,toDisplayString(__props.images.length),1)])):createCommentVNode("",!0),__props.isRootImages?createCommentVNode("",!0):(openBlock(),createBlock(SortBar,{key:1,"current-sort":__props.currentSort,"sort-direction":__props.sortDirection,"sort-options":unref(sortOptions),"layout-mode":__props.layoutMode,"is-selection-mode":__props.isSelectionMode,"is-full-screen":__props.isFullScreen,title:unref($t)("share.file.title"),count:__props.images.length,class:"fixed-sort-bar",onSortChange:_cache[0]||(_cache[0]=$event=>_ctx.$emit("sort-change",$event)),onOpenGridSize:_cache[1]||(_cache[1]=$event=>_ctx.$emit("open-grid-size",$event)),onToggleImmersive:_cache[2]||(_cache[2]=$event=>_ctx.$emit("toggle-immersive")),onOpenLayout:_cache[3]||(_cache[3]=$event=>_ctx.$emit("open-layout",$event)),onToggleSelection:_cache[4]||(_cache[4]=$event=>_ctx.$emit("toggle-selection-mode")),onToggleFullscreen:_cache[5]||(_cache[5]=$event=>_ctx.$emit("toggle-fullscreen"))},null,8,["current-sort","sort-direction","sort-options","layout-mode","is-selection-mode","is-full-screen","title","count"]))]),!__props.isRootImages&&__props.isSelectionMode?(openBlock(),createBlock(SelectionToolbar,{key:0,visible:__props.isSelectionMode,"selected-count":selectedCount.value,"total-count":__props.images.length,onSelectAll:_cache[6]||(_cache[6]=$event=>_ctx.$emit("select-all")),onDeselectAll:_cache[7]||(_cache[7]=$event=>_ctx.$emit("deselect-all")),onDownload:_cache[8]||(_cache[8]=$event=>_ctx.$emit("download-selected"))},null,8,["visible","selected-count","total-count"])):createCommentVNode("",!0),__props.layoutMode==="grid"?(openBlock(),createElementBlock("div",_hoisted_4$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.displayImages,image=>(openBlock(),createBlock(_component_CyberShareFile,{key:image.id,file:image,"share-key":__props.shareKey,"access-token":__props.accessToken,selectable:__props.isSelectionMode,selected:isImageSelected(image.id),onClick:$event=>_ctx.$emit("image-click",image),onSelect:$event=>_ctx.$emit("toggle-selection",image.id)},null,8,["file","share-key","access-token","selectable","selected","onClick","onSelect"]))),128))])):__props.layoutMode==="waterfall"?(openBlock(),createBlock(_component_CyberWaterfallLayout,{key:2,items:__props.displayImages,"column-count":__props.waterfallColumns,"column-width":Number(__props.waterfallColumnWidth),selectable:__props.isSelectionMode,"selected-ids":__props.selectedIds,"initial-load-count":__props.initialLoadCount,"lazy-load":!0,"share-key":__props.shareKey,"access-token":__props.accessToken,class:"images-waterfall",onImageClick:_cache[9]||(_cache[9]=$event=>_ctx.$emit("image-click",$event)),onSelect:_cache[10]||(_cache[10]=$event=>_ctx.$emit("toggle-selection",$event))},null,8,["items","column-count","column-width","selectable","selected-ids","initial-load-count","share-key","access-token"])):__props.layoutMode==="masonry"?(openBlock(),createElementBlock("div",_hoisted_5$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.displayImages,image=>(openBlock(),createBlock(_component_CyberShareFile,{key:image.id,file:image,"share-key":__props.shareKey,"access-token":__props.accessToken,selectable:__props.isSelectionMode,selected:isImageSelected(image.id),onClick:$event=>_ctx.$emit("image-click",image),onSelect:$event=>_ctx.$emit("toggle-selection",image.id)},null,8,["file","share-key","access-token","selectable","selected","onClick","onSelect"]))),128))])):__props.layoutMode==="large"?(openBlock(),createElementBlock("div",_hoisted_6$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.displayImages,image=>(openBlock(),createBlock(_component_CyberShareFile,{key:image.id,file:image,"share-key":__props.shareKey,"access-token":__props.accessToken,selectable:__props.isSelectionMode,selected:isImageSelected(image.id),onClick:$event=>_ctx.$emit("image-click",image),onSelect:$event=>_ctx.$emit("toggle-selection",image.id)},null,8,["file","share-key","access-token","selectable","selected","onClick","onSelect"]))),128))])):createCommentVNode("",!0),!__props.isRootImages&&__props.showLoadMoreButton?(openBlock(),createBlock(AutoLoader,{key:5,current:Math.min(__props.currentPage*__props.pageSize,__props.images.length),total:__props.images.length,"external-loading":__props.isLoading,"can-load-more":__props.canLoadMore,onLoadMore:_cache[11]||(_cache[11]=$event=>_ctx.$emit("load-more"))},null,8,["current","total","external-loading","can-load-more"])):createCommentVNode("",!0)],2)):createCommentVNode("",!0)}}});const FileSection=_export_sfc(_sfc_main$6,[["__scopeId","data-v-0820c815"]]),_hoisted_1$5={class:"empty-state"},_sfc_main$5=defineComponent({__name:"ShareEmptyState",setup(__props){const{$t}=useTexts();return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$5,[_cache[0]||(_cache[0]=createBaseVNode("div",{class:"empty-icon"},[createBaseVNode("i",{class:"fas fa-folder-open"})],-1)),createBaseVNode("h3",null,toDisplayString(unref($t)("share.emptyState.title")),1),createBaseVNode("p",null,toDisplayString(unref($t)("share.emptyState.description")),1)]))}});const ShareEmptyState=_export_sfc(_sfc_main$5,[["__scopeId","data-v-f5722626"]]),_hoisted_1$4={class:"share-footer"},_hoisted_2$3=["innerHTML"],_sfc_main$4=defineComponent({__name:"ShareFooter",setup(__props){const settingsStore=useSettingsStore(),{$t}=useTexts(),footerText=computed(()=>$t("share.footer.poweredBy").replace("{siteName}",`<a href="/" class="brand-link">${settingsStore.siteName}</a>`));return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",{class:"copyright",innerHTML:footerText.value},null,8,_hoisted_2$3)]))}});const ShareFooter=_export_sfc(_sfc_main$4,[["__scopeId","data-v-d0ddd101"]]),_hoisted_1$3={style:{display:"none"}},_sfc_main$3=defineComponent({__name:"FullscreenControls",props:{enabled:{type:Boolean,default:!1}},emits:["update:enabled"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,isFullScreen=ref(!1),isImmersiveMode=ref(!1),toggleFullScreen=async()=>{try{if(isFullScreen.value){const doc=document;doc.exitFullscreen?await doc.exitFullscreen():doc.mozCancelFullScreen?await doc.mozCancelFullScreen():doc.webkitExitFullscreen?await doc.webkitExitFullscreen():doc.msExitFullscreen&&await doc.msExitFullscreen(),isImmersiveMode.value=!1,document.body.classList.remove("immersive-mode")}else{const elem=document.documentElement;elem.requestFullscreen?await elem.requestFullscreen():elem.mozRequestFullScreen?await elem.mozRequestFullScreen():elem.webkitRequestFullscreen?await elem.webkitRequestFullscreen():elem.msRequestFullscreen&&await elem.msRequestFullscreen(),isImmersiveMode.value=!0,document.body.classList.add("immersive-mode")}emit("update:enabled",isFullScreen.value)}catch{isImmersiveMode.value=!isImmersiveMode.value,isImmersiveMode.value?document.body.classList.add("immersive-mode"):document.body.classList.remove("immersive-mode"),emit("update:enabled",isImmersiveMode.value)}},handleFullscreenChange=()=>{isFullScreen.value=document.fullscreenElement!==null,emit("update:enabled",isFullScreen.value)};return watch(()=>props.enabled,enabled=>{enabled!==isFullScreen.value&&toggleFullScreen()}),onMounted(()=>{document.addEventListener("fullscreenchange",handleFullscreenChange),document.addEventListener("webkitfullscreenchange",handleFullscreenChange),document.addEventListener("mozfullscreenchange",handleFullscreenChange),document.addEventListener("MSFullscreenChange",handleFullscreenChange),isFullScreen.value=document.fullscreenElement!==null}),onBeforeUnmount(()=>{if(document.removeEventListener("fullscreenchange",handleFullscreenChange),document.removeEventListener("webkitfullscreenchange",handleFullscreenChange),document.removeEventListener("mozfullscreenchange",handleFullscreenChange),document.removeEventListener("MSFullscreenChange",handleFullscreenChange),isFullScreen.value||isImmersiveMode.value)try{const doc=document;doc.exitFullscreen?doc.exitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen?doc.webkitExitFullscreen():doc.msExitFullscreen&&doc.msExitFullscreen(),document.body.classList.remove("immersive-mode"),isImmersiveMode.value=!1}catch{}}),__expose({toggleFullScreen}),(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$3))}}),_hoisted_1$2={class:"layout-header"},_hoisted_2$2={class:"layout-options"},_hoisted_3$1=["onClick"],_hoisted_4$1={class:"option-icon"},_hoisted_5$1={class:"option-content"},_hoisted_6={class:"option-label"},_hoisted_7={class:"option-desc"},_sfc_main$2=defineComponent({__name:"LayoutSelector",props:{visible:{type:Boolean,default:!1},modelValue:{type:String,default:"grid"},layoutOptions:{type:Array,default:()=>[]},triggerRef:{type:Object,default:null}},emits:["update:modelValue","close"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,dropdownStyle=ref({position:"fixed",top:"170px",right:"100px",zIndex:Z_INDEX.DROPDOWN}),handleOutsideClick=e=>{const{target}=e,isLayoutBtn=target.closest(".layout-btn"),isDropdown=target.closest(".layout-dropdown");!isLayoutBtn&&!isDropdown&&close()},close=()=>{emit("close")},selectLayout=value=>{emit("update:modelValue",value),StorageUtil.set(STORAGE_KEYS.LAYOUT_MODE,value),close()},updatePosition=()=>{const layoutBtn=document.querySelector(".layout-btn");if(layoutBtn){const rect=layoutBtn.getBoundingClientRect();dropdownStyle.value={position:"fixed",top:`${rect.bottom+20}px`,left:`${rect.left-222}px`,zIndex:Z_INDEX.DROPDOWN}}};return watchEffect(()=>{props.visible?(setTimeout(updatePosition,0),document.addEventListener("click",handleOutsideClick),window.addEventListener("scroll",updatePosition),window.addEventListener("resize",updatePosition)):(document.removeEventListener("click",handleOutsideClick),window.removeEventListener("scroll",updatePosition),window.removeEventListener("resize",updatePosition))}),onBeforeUnmount(()=>{document.removeEventListener("click",handleOutsideClick),window.removeEventListener("scroll",updatePosition),window.removeEventListener("resize",updatePosition)}),(_ctx,_cache)=>(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(Transition,{name:"dropdown-fade"},{default:withCtx(()=>[__props.visible?(openBlock(),createElementBlock("div",{key:0,class:"layout-dropdown",style:normalizeStyle(dropdownStyle.value),onClick:_cache[0]||(_cache[0]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("span",null,toDisplayString(unref($t)("share.layout.title")),1),createBaseVNode("button",{class:"close-btn",onClick:close},[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])])]),createBaseVNode("div",_hoisted_2$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.layoutOptions,option=>(openBlock(),createElementBlock("button",{key:option.value,class:normalizeClass(["layout-option-btn",{active:__props.modelValue===option.value}]),onClick:$event=>selectLayout(option.value)},[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("i",{class:normalizeClass(option.icon)},null,2)]),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("div",_hoisted_6,toDisplayString(option.label),1),createBaseVNode("div",_hoisted_7,toDisplayString(option.description),1)])],10,_hoisted_3$1))),128))])],4)):createCommentVNode("",!0)]),_:1})]))}});const LayoutSelector=_export_sfc(_sfc_main$2,[["__scopeId","data-v-31856d79"]]),_hoisted_1$1={class:"grid-size-header"},_hoisted_2$1={class:"size-options"},_hoisted_3={class:"size-slider"},_hoisted_4=["min","max","step"],_hoisted_5={class:"size-value"},_sfc_main$1=defineComponent({__name:"GridSizeSelector",props:{visible:{type:Boolean,default:!1},modelValue:{type:[Number,String],default:LAYOUT.GRID.DEFAULT_SIZE},triggerRef:{type:Object,default:null}},emits:["update:modelValue","close"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,localValue=ref(Number(props.modelValue));watchEffect(()=>{localValue.value=Number(props.modelValue)});const dropdownStyle=ref({position:"fixed",top:"170px",right:"100px",zIndex:Z_INDEX.DROPDOWN}),handleOutsideClick=e=>{const{target}=e,isGridSizeBtn=target.closest(".grid-size-btn"),isDropdown=target.closest(".grid-size-dropdown");!isGridSizeBtn&&!isDropdown&&close()},close=()=>{emit("close")},updateValue=()=>{emit("update:modelValue",localValue.value),StorageUtil.set(STORAGE_KEYS.GRID_SIZE,localValue.value)},updatePosition=()=>{const triggerBtn=document.querySelector(".grid-size-btn");if(triggerBtn){const rect=triggerBtn.getBoundingClientRect();dropdownStyle.value={position:"fixed",top:`${rect.bottom+10}px`,right:`${window.innerWidth-rect.right}px`,zIndex:Z_INDEX.DROPDOWN}}};return watchEffect(()=>{props.visible?(setTimeout(updatePosition,0),document.addEventListener("click",handleOutsideClick),window.addEventListener("scroll",updatePosition),window.addEventListener("resize",updatePosition)):(document.removeEventListener("click",handleOutsideClick),window.removeEventListener("scroll",updatePosition),window.removeEventListener("resize",updatePosition))}),onMounted(()=>{localValue.value=Number(props.modelValue)}),onBeforeUnmount(()=>{document.removeEventListener("click",handleOutsideClick),window.removeEventListener("scroll",updatePosition),window.removeEventListener("resize",updatePosition)}),(_ctx,_cache)=>(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(Transition,{name:"dropdown-fade"},{default:withCtx(()=>[__props.visible?(openBlock(),createElementBlock("div",{key:0,class:"grid-size-dropdown grid-size-popover",style:normalizeStyle(dropdownStyle.value),onClick:_cache[1]||(_cache[1]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("span",null,toDisplayString(unref($t)("share.gridSize.title")),1),createBaseVNode("button",{class:"close-btn",onClick:close},[..._cache[2]||(_cache[2]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])])]),createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>localValue.value=$event),type:"range",min:unref(LAYOUT).GRID.MIN_SIZE,max:unref(LAYOUT).GRID.MAX_SIZE,step:unref(LAYOUT).GRID.STEP,onInput:updateValue},null,40,_hoisted_4),[[vModelText,localValue.value]]),_cache[3]||(_cache[3]=createBaseVNode("div",{class:"size-preview"},[createBaseVNode("div",{class:"small-icon"},[createBaseVNode("i",{class:"fas fa-th"})]),createBaseVNode("div",{class:"large-icon"},[createBaseVNode("i",{class:"fas fa-th-large"})])],-1))]),createBaseVNode("div",_hoisted_5,toDisplayString(localValue.value)+"px",1)])],4)):createCommentVNode("",!0)]),_:1})]))}});const GridSizeSelector=_export_sfc(_sfc_main$1,[["__scopeId","data-v-a2ad6d62"]]);function useShareData(route,onError){const router=useRouter(),{$t}=useTexts(),initialLoading=ref(!0),folderLoading=ref(!1),error=ref(!1),errorTitle=ref(""),errorMessage=ref(""),errorType=ref("error"),shareData=ref(null),shareKey=ref(""),accessToken=ref(""),shareName=ref(""),passwordDialogVisible=ref(!1),visitorDialogVisible=ref(!1),folders=ref([]),images=ref([]),rootImages=ref([]),isVisitorDialogDismissed=()=>{if(!shareKey.value)return!1;const storageKey=`${STORAGE_KEYS.VISITOR_DIALOG_DISMISSED}${shareKey.value}`;return StorageUtil.has(storageKey)},handleVisitorDismiss=()=>{if(visitorDialogVisible.value=!1,shareKey.value){const storageKey=`${STORAGE_KEYS.VISITOR_DIALOG_DISMISSED}${shareKey.value}`;StorageUtil.set(storageKey,!0,24)}},loadShareData=async(currentFolderId,isInitial=!1)=>{if(!shareKey.value){onError($t("components.share.errors.invalidLink"),$t("components.share.errors.invalidLinkDesc"),"not-found");return}isInitial?initialLoading.value=!0:currentFolderId&&(folderLoading.value=!0),error.value=!1;try{const params={};accessToken.value&&(params.access_token=accessToken.value),currentFolderId&&(params.folder_id=currentFolderId);try{const result=await getPublicShare(shareKey.value,params);if(result.success){const{data}=result;if(data.require_password){shareName.value=data.name||$t("components.share.defaults.shareName"),passwordDialogVisible.value=!0,initialLoading.value=!1,folderLoading.value=!1;return}shareData.value=data,folders.value=data.folders||[];const processedFiles=(data.files||[]).map(file=>{const processedFile=processFileUrls(file,accessToken.value);return processedFile.ai_info?.description&&(processedFile.description=processedFile.ai_info.description),processedFile});images.value=processedFiles,(isInitial||!currentFolderId)&&(rootImages.value=[...processedFiles]),data.share.collect_visitor_info&&!isVisitorDialogDismissed()&&(visitorDialogVisible.value=!0),updatePageMetadata()}else onError($t("components.share.errors.loadFailed"),result.message||$t("components.share.errors.loadFailedDesc"))}catch(apiError){if(apiError.code===403)apiError.message&&apiError.message.includes($t("composables.useShareData.backendErrors.maxViewsKeyword"))?onError($t("components.share.errors.maxViewsReached"),$t("components.share.errors.maxViewsReachedDesc"),"max-views"):apiError.message&&apiError.message.includes($t("composables.useShareData.backendErrors.expiredKeyword"))?onError($t("components.share.errors.shareExpired"),$t("components.share.errors.shareExpiredDesc"),"expired"):onError($t("components.share.errors.accessRestricted"),apiError.message||$t("components.share.errors.accessRestrictedDesc"),"unauthorized");else throw apiError}}catch(error2){const errorMessage2=error2?.message||error2?.msg||String(error2);error2?.code===404||errorMessage2.includes("404")||errorMessage2.includes("Not Found")?onError($t("components.share.errors.shareNotFound"),$t("components.share.errors.shareNotFoundDesc"),"not-found"):error2?.code===403||errorMessage2.includes("403")?onError($t("components.share.errors.accessRestricted"),$t("components.share.errors.accessRestrictedDesc"),"unauthorized"):error2?.code===109||errorMessage2.includes($t("composables.useShareData.backendErrors.invalidKeyword"))?onError($t("components.share.errors.shareInvalid"),$t("components.share.errors.shareInvalidDesc"),"expired"):onError($t("components.share.errors.loadFailed"),errorMessage2||$t("components.share.errors.loadFailedDesc"))}finally{initialLoading.value=!1,folderLoading.value=!1}},handlePasswordVerify=async(password,onSuccess,onError2)=>{try{const result=await verifySharePassword(shareKey.value,password);if(result.success){const{data}=result;passwordDialogVisible.value=!1,data&&data.access_token?(accessToken.value=data.access_token,router.replace({path:route.path,query:{access_token:accessToken.value}}),onSuccess&&onSuccess($t("components.share.errors.passwordVerifySuccess")),loadShareData(void 0,!0)):onError2?.($t("components.share.errors.passwordVerifyNoToken"))}else onError2?.(result.message||$t("components.share.errors.passwordVerifyFailed"))}catch(error2){onError2?.(error2.value?.message||$t("components.share.errors.passwordVerifyFailedRetry"))}},handleVisitorSubmit=async(visitorInfo,onSuccess,onError2)=>{try{const result=await submitVisitorInfo(shareKey.value,visitorInfo);if(result.success){if(visitorDialogVisible.value=!1,shareKey.value){const storageKey=`${STORAGE_KEYS.VISITOR_DIALOG_DISMISSED}${shareKey.value}`;StorageUtil.set(storageKey,!0,24)}onSuccess&&onSuccess($t("components.share.errors.visitorSubmitSuccess"))}else onError2&&onError2(result.message||$t("components.share.errors.visitorSubmitFailed"))}catch(error2){onError2&&onError2(error2.value?.message||$t("components.share.errors.visitorSubmitFailed"))}},updatePageMetadata=()=>{if(!shareData.value)return;const{share}=shareData.value,title=share.name||$t("components.share.defaults.shareTitle"),description=share.description||$t("components.share.defaults.shareDescription",{count:images.value.length});let previewImageUrl="";if(images.value&&images.value.length>0){const firstImage=images.value[0];previewImageUrl=firstImage.full_url||firstImage.url||""}const currentUrl=window.location.href;document.title=title,[{name:"description",content:description},{property:"og:title",content:title},{property:"og:description",content:description},{property:"og:type",content:"website"},{property:"og:url",content:currentUrl},{property:"og:image",content:previewImageUrl},{property:"twitter:card",content:"summary_large_image"},{property:"twitter:title",content:title},{property:"twitter:description",content:description},{property:"twitter:image",content:previewImageUrl}].forEach(tag=>{const selector=tag.name?`meta[name="${tag.name}"]`:`meta[property="${tag.property}"]`;let element=document.querySelector(selector);element?element.content=tag.content:(element=document.createElement("meta"),tag.name?element.name=tag.name:tag.property&&element.setAttribute("property",tag.property),element.content=tag.content,document.head.appendChild(element))})};return watch(()=>route.params.key,newKey=>{if(newKey&&typeof newKey=="string"){shareKey.value=newKey;const queryAccessToken=route.query.access_token;queryAccessToken&&typeof queryAccessToken=="string"&&(accessToken.value=queryAccessToken),loadShareData(void 0,!0)}},{immediate:!0}),{initialLoading,folderLoading,error,errorTitle,errorMessage,errorType,shareData,shareKey,accessToken,shareName,passwordDialogVisible,visitorDialogVisible,folders,images,rootImages,loadShareData,handlePasswordVerify,handleVisitorSubmit,handleVisitorDismiss,updatePageMetadata}}function useShareNavigation(){const currentFolderId=ref(),breadcrumbItems=ref([]),scrollPositions=ref({root:0}),getCurrentFolderKey=()=>currentFolderId.value||"root",saveCurrentScrollPosition=()=>{const key=getCurrentFolderKey();scrollPositions.value=saveScrollPosition(key,scrollPositions.value)};return{currentFolderId,breadcrumbItems,scrollPositions,getCurrentFolderKey,saveCurrentScrollPosition,restoreCurrentScrollPosition:()=>{const key=getCurrentFolderKey();restoreScrollPosition(key,scrollPositions.value)},handleFolderClick:(folder,callback)=>{saveCurrentScrollPosition(),currentFolderId.value=folder.id,breadcrumbItems.value.push({id:folder.id,name:folder.name}),callback&&callback()},handleBreadcrumbClick:(item,callback)=>{if(saveCurrentScrollPosition(),item===null)currentFolderId.value=void 0,breadcrumbItems.value=[];else{const index2=breadcrumbItems.value.findIndex(bread=>bread.id===item.id);index2!==-1&&(currentFolderId.value=item.id,breadcrumbItems.value=breadcrumbItems.value.slice(0,index2+1))}callback&&callback()}}}function useShareLayout(onLayoutChange){const layoutMode=ref(LAYOUT_MODES.WATERFALL),gridSizeValue=ref(DEFAULTS.GRID_SIZE),showGridSizePopover=ref(!1),gridSizePopoverStyle=ref({top:"40px",left:"auto",right:"0"}),showLayoutPopover=ref(!1),settingsLoaded=ref(!1),containerRef=ref(null),{width:containerWidth}=useElementSize(containerRef),waterfallColumns=computed(()=>{if(containerWidth.value){const columnWidth=Math.max(Math.round(gridSizeValue.value*1.2),180),gap=20;return Math.max(1,Math.floor(containerWidth.value/(columnWidth+gap)))}const width=window.innerWidth;return width<768?2:width<1024?3:width<1440?4:width<1600?5:6}),largeColumns=computed(()=>{const width=window.innerWidth;return width<768?1:width<1024?2:3}),loadLayoutSettings=()=>{const savedLayoutMode=StorageUtil.get(STORAGE_KEYS.LAYOUT_MODE);savedLayoutMode&&(layoutMode.value=savedLayoutMode);const savedGridSize=StorageUtil.get(STORAGE_KEYS.GRID_SIZE);savedGridSize&&(gridSizeValue.value=savedGridSize),updateGridSize(!1),settingsLoaded.value=!0,nextTick(()=>{initContainer()})},debouncedSaveGridSize=debounce(size=>{settingsLoaded.value&&StorageUtil.set(STORAGE_KEYS.GRID_SIZE,size)},300),updateGridSize=(shouldSave=!0)=>{setCssVariable("grid-item-size",`${gridSizeValue.value}px`,document.documentElement,!0),layoutMode.value==="waterfall"&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},50),shouldSave&&debouncedSaveGridSize(gridSizeValue.value)};watch(gridSizeValue,()=>{settingsLoaded.value&&updateGridSize()});const openGridSizePopover=e=>{if(e&&typeof e.stopPropagation=="function"&&e.stopPropagation(),showGridSizePopover.value=!0,e&&e.target){const button=e.target.closest("button");if(button){const rect=button.getBoundingClientRect();setTimeout(()=>{const popup=document.querySelector(".grid-size-popover");if(popup){const top=rect.bottom+10,right=window.innerWidth-rect.right,maxTop=window.innerHeight-popup.offsetHeight-20,finalTop=Math.min(top,maxTop);popup.style.transformOrigin=`top ${window.innerWidth-right}px`,popup.style.opacity="0",popup.style.transform="scale(0.9) translateY(-10px)",popup.style.top=`${finalTop}px`,popup.style.right=`${right}px`,requestAnimationFrame(()=>{popup.style.opacity="1",popup.style.transform="scale(1) translateY(0)"})}},0)}}},closeGridSizePopover=()=>{showGridSizePopover.value=!1},openLayoutPopover=e=>{e&&typeof e.stopPropagation=="function"&&e.stopPropagation(),showLayoutPopover.value=!0},closeLayoutPopover=()=>{showLayoutPopover.value=!1},changeLayout=value=>{layoutMode.value=value,showLayoutPopover.value=!1,nextTick(()=>{updateGridSize(!1)}),StorageUtil.set(STORAGE_KEYS.LAYOUT_MODE,value),onLayoutChange&&onLayoutChange(value)},isImmersiveMode=ref(!1),toggleImmersiveMode=value=>{const newValue=value!==void 0?value:!isImmersiveMode.value;isImmersiveMode.value=newValue,toggleGlobalClass("immersive-mode",newValue)},cleanup=()=>{isImmersiveMode.value&&toggleImmersiveMode(!1),containerRef.value=null},initContainer=()=>{if(!containerRef.value){const contentEl=document.querySelector(".share-content")||document.body;containerRef.value=contentEl}};return onMounted(()=>{nextTick(()=>{initContainer()})}),{layoutMode,gridSizeValue,showGridSizePopover,gridSizePopoverStyle,showLayoutPopover,waterfallColumns,largeColumns,isImmersiveMode,settingsLoaded,containerRef,loadLayoutSettings,updateGridSize,openGridSizePopover,closeGridSizePopover,openLayoutPopover,closeLayoutPopover,changeLayout,toggleImmersiveMode,cleanup}}function useShareSorting(sourceList){const currentSort=ref("date"),sortDirection=ref(SORT_DIRECTIONS.DESC),handleSortChange=sortType=>{currentSort.value===sortType?sortDirection.value=sortDirection.value===SORT_DIRECTIONS.ASC?SORT_DIRECTIONS.DESC:SORT_DIRECTIONS.ASC:(currentSort.value=sortType,sortDirection.value=sortType==="date"?SORT_DIRECTIONS.DESC:SORT_DIRECTIONS.ASC)},sortedList=computed(()=>!sourceList.value||sourceList.value.length===0?[]:[...sourceList.value].sort((a,b)=>{switch(currentSort.value){case"date":return sortDirection.value===SORT_DIRECTIONS.ASC?new Date(a.created_at).getTime()-new Date(b.created_at).getTime():new Date(b.created_at).getTime()-new Date(a.created_at).getTime();case"name":const nameA=a.display_name||a.original_name||"",nameB=b.display_name||b.original_name||"";return sortDirection.value===SORT_DIRECTIONS.ASC?nameA.localeCompare(nameB):nameB.localeCompare(nameA);case"size":const sizeA=a.size||0,sizeB=b.size||0;return sortDirection.value===SORT_DIRECTIONS.ASC?sizeA-sizeB:sizeB-sizeA;default:return 0}}));return{currentSort,sortDirection,handleSortChange,sortedList}}function useSharePagination(sourceList,preloadImageFn){const currentPage=ref(1),showAllImages=ref(!1),isLoading=ref(!1),pendingLoadMore=ref(!1),paginatedList=computed(()=>showAllImages.value?sourceList.value:sourceList.value.slice(0,currentPage.value*PAGE_SIZE)),canLoadMore=computed(()=>!showAllImages.value&&currentPage.value*PAGE_SIZE<sourceList.value.length&&!isLoading.value),loadMoreImages=async()=>{if(isLoading.value){pendingLoadMore.value=!0;return}if(showAllImages.value||currentPage.value*PAGE_SIZE>=sourceList.value.length){showAllImages.value=!0,pendingLoadMore.value=!1;return}isLoading.value=!0,pendingLoadMore.value=!1;try{if(currentPage.value++,preloadImageFn){await nextTick();const start=(currentPage.value-1)*PAGE_SIZE,end=Math.min(currentPage.value*PAGE_SIZE,sourceList.value.length),preloadPromises=[];for(let i=start;i<end;i++){const image=sourceList.value[i];if(image){const imageUrl=image.full_thumb_url||image.thumb_url||image.full_url||image.url;imageUrl&&preloadPromises.push(preloadImageFn(imageUrl))}}if(preloadPromises.length>0)try{await Promise.allSettled(preloadPromises)}catch(error){console.warn(":",error)}}currentPage.value*PAGE_SIZE>=sourceList.value.length&&(showAllImages.value=!0)}finally{isLoading.value=!1,pendingLoadMore.value&&canLoadMore.value&&nextTick(()=>{loadMoreImages()})}},showLoadMoreButton=computed(()=>sourceList.value.length>PAGE_SIZE&&!showAllImages.value);return{currentPage,showAllImages,paginatedList,loadMoreImages,showLoadMoreButton,resetPagination:()=>{currentPage.value=1,showAllImages.value=!1,isLoading.value=!1,pendingLoadMore.value=!1},preloadInitialImages:()=>{preloadImageFn&&nextTick(()=>{const count=Math.min(INITIAL_LOAD_COUNT,sourceList.value.length);for(let i=0;i<count;i++){const image=sourceList.value[i];if(image){const imageUrl=image.full_thumb_url||image.thumb_url||image.full_url||image.url;imageUrl&&preloadImageFn(imageUrl)}}})},isLoading,canLoadMore,pendingLoadMore}}function useSharePreview(allImages,onPreviewChange,preloadFileFn){const previewDialogVisible=ref(!1),previewImage=ref({id:"",url:"",display_name:""}),currentPreviewIndex=ref(0),handleImageClick=image=>{previewImage.value={...image};const index2=allImages.value.findIndex(img=>img.id===image.id);index2!==-1?(currentPreviewIndex.value=index2,preloadAdjacentImages(index2),onPreviewChange&&onPreviewChange(index2)):currentPreviewIndex.value=0,previewDialogVisible.value=!0},preloadAdjacentImages=index2=>{if(preloadFileFn)for(let i=-3;i<=3;i++){if(i===0)continue;const preloadIndex=index2+i;if(preloadIndex>=0&&preloadIndex<allImages.value.length){const preloadFile=allImages.value[preloadIndex],preloadFileUrl=preloadFile.full_thumb_url||preloadFile.thumb_url||preloadFile.full_url||preloadFile.url;preloadFileUrl&&preloadFileFn(preloadFileUrl)}}},handlePreviewChange=index2=>{if(!(index2<0||index2>=allImages.value.length)){if(currentPreviewIndex.value=index2,previewImage.value=allImages.value[index2],preloadFileFn&&index2+1<allImages.value.length){const nextFile=allImages.value[index2+1];if(nextFile){const fileUrl=nextFile.full_thumb_url||nextFile.thumb_url||nextFile.full_url||nextFile.url;fileUrl&&preloadFileFn(fileUrl)}}onPreviewChange&&onPreviewChange(index2)}},handlePreviewClose=()=>{previewDialogVisible.value=!1},showPreviousImage=()=>{currentPreviewIndex.value>0&&handlePreviewChange(currentPreviewIndex.value-1)},showNextImage=()=>{currentPreviewIndex.value<allImages.value.length-1&&handlePreviewChange(currentPreviewIndex.value+1)};return{previewDialogVisible,previewImage,currentPreviewIndex,handleImageClick,handlePreviewChange,handlePreviewClose,showPreviousImage,showNextImage,handleKeydown:e=>{previewDialogVisible.value&&(e.key==="ArrowLeft"?showPreviousImage():e.key==="ArrowRight"?showNextImage():e.key==="Escape"&&handlePreviewClose())},handlePrevImage:_index=>{},handleNextImage:_index=>{}}}function useShareSelection(allImages,accessToken,onError,onSuccess,onInfo){const{$t}=useTexts(),isSelectionMode=ref(!1),selectedImagesSet=ref(new Set),selectedImages=ref([]),toggleSelectionMode=value=>{isSelectionMode.value=value!==void 0?value:!isSelectionMode.value,isSelectionMode.value||(selectedImagesSet.value.clear(),selectedImages.value=[])},toggleImageSelection=fileId=>{if(!isSelectionMode.value)return;const id=typeof fileId=="string"?fileId:fileId&&fileId.id?fileId.id:null;if(!id)return;selectedImagesSet.value.has(id)?selectedImagesSet.value.delete(id):selectedImagesSet.value.add(id),selectedImages.value=Array.from(selectedImagesSet.value)},isImageSelected=fileId=>selectedImagesSet.value.has(fileId),selectAll=()=>{selectedImagesSet.value=new Set(allImages.value.map(image=>image.id)),selectedImages.value=Array.from(selectedImagesSet.value)},deselectAll=()=>{selectedImagesSet.value.clear(),selectedImages.value=[]},getSelectedImagesData=()=>{const selectedIds=selectedImagesSet.value;return allImages.value.filter(img=>selectedIds.has(img.id))},downloadSelected=async()=>{if(selectedImages.value.length===0){onInfo&&onInfo($t("pages.share.selection.noFilesSelected"));return}try{const selectedImagesData=getSelectedImagesData();if(selectedImagesData.length===1){const accessTokenValue=accessToken?.value||"",fileUrl=getFileDownloadUrl(selectedImagesData[0],accessTokenValue);downloadSingleFile(fileUrl,selectedImagesData[0].display_name||"file");return}onInfo&&onInfo($t("pages.share.selection.preparing",{count:selectedImagesData.length.toString()}));const zip=new JSZip,imagesFolder=zip.folder("images");if(!imagesFolder){onError&&onError($t("pages.share.selection.createZipFailed"));return}let completedCount=0;const totalCount=selectedImagesData.length,downloadPromises=selectedImagesData.map(async(image,index2)=>{try{const accessTokenValue=accessToken?.value||"",fileUrl=getFileDownloadUrl(image,accessTokenValue);let filename=image.display_name||`image-${index2+1}`;if(!filename.match(/\.(jpg|jpeg|png|gif|webp|bmp)$/i)){const extension=fileUrl.split(".").pop()?.split("?")[0]||"jpg";filename+=`.${extension}`}const response=await fetch(fileUrl);if(!response.ok)throw new Error(`Failed to fetch ${filename}`);const blob=await response.blob();return imagesFolder.file(filename,blob),completedCount++,(completedCount%3===0||completedCount===totalCount)&&onInfo&&onInfo($t("pages.share.selection.progress",{completed:completedCount.toString(),total:totalCount.toString()})),!0}catch{return!1}});await Promise.all(downloadPromises);const zipContent=await zip.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}}),zipUrl=URL.createObjectURL(zipContent),a=document.createElement("a");a.href=zipUrl,a.download=`selected_images_${new Date().getTime()}.zip`,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(zipUrl)},100),onSuccess&&onSuccess($t("pages.share.selection.successSummary",{count:selectedImagesData.length.toString()}))}catch{onError&&onError($t("pages.share.selection.packFailedRetry"))}},downloadSingleFile=(url,filename)=>{url&&fetch(url).then(response=>response.blob()).then(blob=>{const blobUrl=URL.createObjectURL(blob),a=document.createElement("a");a.href=blobUrl,a.download=filename||"image",a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(blobUrl)},100),onSuccess&&onSuccess($t("pages.share.selection.downloadSuccess"))}).catch(()=>{onError&&onError($t("pages.share.selection.downloadFailed"));try{const a=document.createElement("a");a.href=url,a.download=filename||"image",a.target="_blank",a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch{}})};return{isSelectionMode,selectedImages,toggleSelectionMode,toggleImageSelection,isImageSelected,selectAll,deselectAll,getSelectedImagesData,downloadSelected}}const _hoisted_1={class:"breadcrumb-container"},_hoisted_2={class:"share-content"},_sfc_main=defineComponent({__name:"index",setup(__props){const{$t}=useTexts(),LAYOUT_OPTIONS=computed(()=>getLayoutOptions($t)),route=useRoute(),router=useRouter(),toast=useToast(),{isMobile}=useDevice(),{preloadImage}=useImagePreload(),showError=(title,message,type="error")=>{error.value=!0,errorTitle.value=title,errorMessage.value=message,errorType.value=type,initialLoading.value=!1,folderLoading.value=!1},{initialLoading,folderLoading,error,errorTitle,errorMessage,errorType,shareData,shareKey,accessToken,shareName,passwordDialogVisible,visitorDialogVisible,folders,images,rootImages,loadShareData,handlePasswordVerify:doPasswordVerify,handleVisitorSubmit,handleVisitorDismiss}=useShareData(route,showError),{currentFolderId,breadcrumbItems,restoreCurrentScrollPosition,handleFolderClick:doFolderClick,handleBreadcrumbClick:doBreadcrumbClick}=useShareNavigation(),handleFolderClick=folder=>{doFolderClick(folder,()=>{loadShareData(currentFolderId.value)})},handleBreadcrumbClick=item=>{if(item&&item.id===null){doBreadcrumbClick(null,()=>{loadShareData(currentFolderId.value)});return}doBreadcrumbClick(item,()=>{loadShareData(currentFolderId.value)})},handlePasswordVerify=password=>{doPasswordVerify(password,message=>toast.success(message),message=>toast.error(message))},{currentSort,sortDirection,handleSortChange,sortedList}=useShareSorting(images),{currentPage,paginatedList,loadMoreImages,showLoadMoreButton,isLoading:paginationLoading,canLoadMore}=useSharePagination(sortedList,preloadImage),allImages=computed(()=>currentFolderId.value?sortedList.value:[...sortedList.value,...rootImages.value].filter((img,index2,self)=>index2===self.findIndex(t=>t.id===img.id))),{previewDialogVisible,previewImage,handleImageClick,handlePreviewClose,handleKeydown}=useSharePreview(allImages,()=>{},preloadImage),{layoutMode,gridSizeValue,showGridSizePopover,showLayoutPopover,waterfallColumns,isImmersiveMode,loadLayoutSettings,openGridSizePopover,closeGridSizePopover,openLayoutPopover,closeLayoutPopover,toggleImmersiveMode,cleanup:cleanupLayout}=useShareLayout(()=>{nextTick(()=>{restoreCurrentScrollPosition()})}),{isSelectionMode,selectedImages,toggleSelectionMode,toggleImageSelection,selectAll,deselectAll,downloadSelected}=useShareSelection(allImages,computed(()=>accessToken.value),message=>toast.error(message),message=>toast.success(message),message=>toast.info(message)),fullscreenRef=ref(null),handleToggleFullscreen=()=>{fullscreenRef.value?fullscreenRef.value.toggleFullScreen():toggleImmersiveMode()},getImageHeight=item=>estimateImageHeight(item),goHome=()=>{router.push("/")};onMounted(()=>{window.addEventListener("keydown",handleKeydown),loadLayoutSettings(),document.addEventListener("click",closePopoversByOutsideClick)}),onBeforeUnmount(()=>{window.removeEventListener("keydown",handleKeydown),cleanupLayout(),document.removeEventListener("click",closePopoversByOutsideClick)});const pageSize=PAGE_SIZE,initialLoadCount=INITIAL_LOAD_COUNT,layoutOptions=LAYOUT_OPTIONS,closePopoversByOutsideClick=e=>{if(showLayoutPopover.value||showGridSizePopover.value){const layoutPopover=document.querySelector(".layout-popover"),gridSizePopover=document.querySelector(".grid-size-popover");e.composedPath().some(el=>el===layoutPopover||el===gridSizePopover)||(closeLayoutPopover(),closeGridSizePopover())}};return(_ctx,_cache)=>{const _component_CyberLoading=resolveComponent("CyberLoading"),_component_CyberMobileNavigation=resolveComponent("CyberMobileNavigation"),_component_cyberFileViewer=resolveComponent("cyberFileViewer");return openBlock(),createElementBlock("div",{class:normalizeClass(["share-page",{"is-mobile":unref(isMobile)}])},[createVNode(_component_CyberLoading,{visible:unref(initialLoading),text:unref($t)("status.loading")},null,8,["visible","text"]),unref(isMobile)&&!unref(initialLoading)&&!unref(error)&&unref(shareData)?(openBlock(),createBlock(_component_CyberMobileNavigation,{key:0,items:unref(breadcrumbItems).length>0?unref(breadcrumbItems):[],title:unref(shareData)?.share?.name,"has-password":unref(shareData)?.share?.has_password,"show-navigation":unref(breadcrumbItems).length>0,class:"mobile-navigation",onClick:handleBreadcrumbClick},null,8,["items","title","has-password","show-navigation"])):createCommentVNode("",!0),createVNode(_component_cyberFileViewer,{modelValue:unref(previewDialogVisible),"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>isRef(previewDialogVisible)?previewDialogVisible.value=$event:null),file:unref(previewImage),onClose:unref(handlePreviewClose)},null,8,["modelValue","file","onClose"]),createVNode(PasswordDialog,{modelValue:unref(passwordDialogVisible),"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>isRef(passwordDialogVisible)?passwordDialogVisible.value=$event:null),"share-name":unref(shareName),onVerify:handlePasswordVerify},null,8,["modelValue","share-name"]),createVNode(VisitorInfoDialog,{modelValue:unref(visitorDialogVisible),"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>isRef(visitorDialogVisible)?visitorDialogVisible.value=$event:null),"share-key":unref(shareKey),onSubmit:unref(handleVisitorSubmit),onDismiss:unref(handleVisitorDismiss)},null,8,["modelValue","share-key","onSubmit","onDismiss"]),!unref(initialLoading)&&unref(shareData)?(openBlock(),createElementBlock(Fragment,{key:1},[unref(isMobile)?createCommentVNode("",!0):(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(ShareHeader,{share:unref(shareData).share,user:unref(shareData).user},null,8,["share","user"]),createBaseVNode("div",_hoisted_1,[createVNode(FolderBreadcrumb,{items:unref(breadcrumbItems),"show-icon":!0,"auto-add-root":!0,onClick:handleBreadcrumbClick},null,8,["items"])])],64)),createVNode(_sfc_main$3,{ref_key:"fullscreenRef",ref:fullscreenRef,enabled:unref(isImmersiveMode),"onUpdate:enabled":_cache[3]||(_cache[3]=value=>isImmersiveMode.value=value)},null,8,["enabled"]),createBaseVNode("div",_hoisted_2,[unref(isMobile)&&unref(shareData)?(openBlock(),createBlock(MobileShareInfo,{key:0,"show-back-button":unref(breadcrumbItems).length>0,"view-count":unref(shareData).share.current_views,"created-at":unref(shareData).share.created_at,onBackClick:_cache[4]||(_cache[4]=$event=>handleBreadcrumbClick(null))},null,8,["show-back-button","view-count","created-at"])):createCommentVNode("",!0),createVNode(FolderSection,{folders:unref(folders),onFolderClick:handleFolderClick},null,8,["folders"]),unref(images)&&unref(images).length>0?(openBlock(),createBlock(FileSection,{key:1,images:unref(images),"display-images":unref(paginatedList),"is-root-images":!unref(currentFolderId),"layout-mode":unref(layoutMode),"is-selection-mode":unref(isSelectionMode),"selected-ids":Array.from(unref(selectedImages)),"initial-load-count":unref(initialLoadCount),"current-sort":unref(currentSort),"sort-direction":unref(sortDirection),"waterfall-columns":unref(waterfallColumns),"waterfall-column-width":Number(unref(gridSizeValue)),"show-load-more-button":unref(showLoadMoreButton),"current-page":unref(currentPage),"page-size":unref(pageSize),"get-image-height":getImageHeight,"is-full-screen":unref(isImmersiveMode),"is-loading":unref(paginationLoading),"can-load-more":unref(canLoadMore),"share-key":unref(shareKey),"access-token":unref(accessToken),onImageClick:unref(handleImageClick),onToggleSelection:unref(toggleImageSelection),onToggleSelectionMode:unref(toggleSelectionMode),onSelectAll:unref(selectAll),onDeselectAll:unref(deselectAll),onDownloadSelected:unref(downloadSelected),onSortChange:unref(handleSortChange),onOpenGridSize:unref(openGridSizePopover),onToggleImmersive:unref(toggleImmersiveMode),onOpenLayout:unref(openLayoutPopover),onLoadMore:unref(loadMoreImages),onToggleFullscreen:handleToggleFullscreen},null,8,["images","display-images","is-root-images","layout-mode","is-selection-mode","selected-ids","initial-load-count","current-sort","sort-direction","waterfall-columns","waterfall-column-width","show-load-more-button","current-page","page-size","is-full-screen","is-loading","can-load-more","share-key","access-token","onImageClick","onToggleSelection","onToggleSelectionMode","onSelectAll","onDeselectAll","onDownloadSelected","onSortChange","onOpenGridSize","onToggleImmersive","onOpenLayout","onLoadMore"])):createCommentVNode("",!0),(!unref(folders)||unref(folders).length===0)&&(!unref(images)||unref(images).length===0)&&!unref(initialLoading)&&!unref(folderLoading)?(openBlock(),createBlock(ShareEmptyState,{key:2})):createCommentVNode("",!0),createVNode(ShareFooter),createVNode(GridSizeSelector,{modelValue:unref(gridSizeValue),"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>isRef(gridSizeValue)?gridSizeValue.value=$event:null),visible:unref(showGridSizePopover),onClose:unref(closeGridSizePopover)},null,8,["modelValue","visible","onClose"]),createVNode(LayoutSelector,{modelValue:unref(layoutMode),"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>isRef(layoutMode)?layoutMode.value=$event:null),visible:unref(showLayoutPopover),"layout-options":unref(layoutOptions),onClose:unref(closeLayoutPopover)},null,8,["modelValue","visible","layout-options","onClose"])])],64)):createCommentVNode("",!0),unref(error)?(openBlock(),createBlock(ErrorState,{key:2,type:unref(errorType),title:unref(errorTitle),message:unref(errorMessage),"action-text":unref($t)("share.error.backHome"),onHomeClick:goHome},null,8,["type","title","message","action-text"])):createCommentVNode("",!0)],2)}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-6c6c54a4"]]);export{index as default};
