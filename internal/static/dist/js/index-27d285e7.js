import{y as get,ai as post,j as useTexts,L as LAYOUT,_ as _export_sfc,K as getCurrentLocale,q as useToast,p as processParams,Y as __unplugin_components_0}from"./index-ac67a30c.js";import{d as defineComponent,a as reactive,r as ref,w as watch,c as computed,b as onMounted,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,ab as createTextVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,R as normalizeClass,H as withDirectives,Q as normalizeStyle,K as createCommentVNode,n as nextTick,$ as vShow,G as resolveDirective,a5 as withModifiers,A as createBlock,F as Fragment,M as renderList,a4 as useRoute,a3 as useRouter,j as onBeforeUnmount}from"./vue-vendor-31320f47.js";import{c as getAdminSortOptions,a as getResolutionOptions}from"./filterOptions-1ed3ac9a.js";import{b as getStorageTypeOptions}from"./storageOptions-66a07ca4.js";/* empty css                                                           */import{u as useResponsivePageSize}from"./useResponsivePageSize-3b6a8f45.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";function getAdminFileList(params){return get("/admin/files/list",params)}function getAdminTagList(page,size){return get("/admin/files/tags",{page,size})}function getAdminColorList(page,size){return get("/admin/files/colors",{page,size})}function setFileRecommendation(file_id){return post("/admin/files/recommend",{file_id})}function batchSetFileRecommendation(file_ids,is_recommended){return post("/admin/files/batch-recommend",{file_ids,is_recommended})}function deleteAdminFile(file_id){return post("/admin/files/delete",{file_id})}function batchDeleteAdminFiles(file_ids){return post("/admin/files/batch-delete",{file_ids})}const _hoisted_1$3={class:"image-filter-panel mb-4 rounded-xl border border-subtle bg-background-600 p-3"},_hoisted_2$3={class:"mb-3 flex items-center justify-between"},_hoisted_3$3={class:"text-base font-bold text-content-heading"},_hoisted_4$3={class:"flex space-x-1.5"},_hoisted_5$3={class:"grid grid-cols-1 gap-x-3 gap-y-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6"},_hoisted_6$3={class:"filter-item"},_hoisted_7$3={class:"mb-0.5 block text-xs text-content"},_hoisted_8$3={class:"filter-item"},_hoisted_9$3={class:"mb-0.5 block text-xs text-content"},_hoisted_10$3={class:"filter-item"},_hoisted_11$3={class:"mb-0.5 block text-xs text-content"},_hoisted_12$2=["onClick"],_hoisted_13$2={class:"checkbox-wrapper"},_hoisted_14$2={class:"checkbox"},_hoisted_15$2={class:"fas fa-check"},_hoisted_16$1={class:"ml-2 text-sm"},_hoisted_17$1={class:"filter-item"},_hoisted_18$1={class:"mb-0.5 block text-xs text-content"},_hoisted_19$1={class:"filter-item"},_hoisted_20$1={class:"mb-0.5 block text-xs text-content"},_hoisted_21$1={class:"filter-item"},_hoisted_22$1={class:"mb-0.5 block text-xs text-content"},_hoisted_23$1={class:"filter-item col-span-1 flex sm:col-span-2 md:col-span-1"},_hoisted_24$1={class:"flex h-full flex-col justify-center"},_hoisted_25$1={class:"mb-1.5 block text-xs text-content"},_hoisted_26$1={class:"flex space-x-4"},_hoisted_27$1={class:"flex items-center"},_hoisted_28$1={class:"mr-2 text-xs text-content"},_hoisted_29$1={class:"flex items-center"},_hoisted_30$1={class:"mr-2 text-xs text-content"},_hoisted_31={class:"mt-2"},_hoisted_32={key:0,class:"mt-2 grid grid-cols-1 gap-x-3 gap-y-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6"},_hoisted_33={class:"filter-item"},_hoisted_34={class:"mb-0.5 block text-xs text-content"},_hoisted_35={class:"filter-item col-span-1 sm:col-span-2 md:col-span-1"},_hoisted_36={class:"mb-0.5 block text-xs text-content"},_hoisted_37={class:"flex items-center gap-1"},_hoisted_38={class:"filter-item"},_hoisted_39={class:"mb-0.5 block text-xs text-content"},_sfc_main$3=defineComponent({__name:"FileFilterPanel",props:{initialFilters:{type:Object,default:()=>({})}},emits:["filter"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),filters=reactive({page:1,size:LAYOUT.DEFAULT_PAGE_SIZE,sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",is_nsfw:!1,is_recommended:!1,storage_type:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0,user_id:void 0,status:void 0}),selectedColors=ref([]),selectedTags=ref([]);watch(selectedColors,(newVal,oldVal)=>{newVal.length>oldVal.length&&nextTick(()=>{scrollToLatestSelection(".selected-tags")})},{deep:!0}),watch(selectedTags,(newVal,oldVal)=>{newVal.length>oldVal.length&&nextTick(()=>{scrollToLatestSelection(".selected-tags")})},{deep:!0});const scrollToLatestSelection=selector=>{document.querySelectorAll(selector).forEach(container=>{container&&(container.scrollLeft=container.scrollWidth)})};computed(()=>selectedColors.value.length?selectedColors.value.map(color=>{const colorOption=colorOptions.value.find(opt=>opt.value===color);return colorOption||{value:color,label:color,color}}):"");const showAdvanced=ref(!1),tags=ref([]),tagOptions=computed(()=>(tags.value||[]).map(tag=>({label:`${tag.name} (${tag.count})`,value:tag.id.toString()}))),colors=ref([]),colorOptions=computed(()=>(colors.value||[]).map(color=>({label:color,value:color,color}))),sortOptions=computed(()=>getAdminSortOptions($t)),resolutionOptions=computed(()=>getResolutionOptions($t)),storageOptions=computed(()=>getStorageTypeOptions($t)),statusOptions=computed(()=>[{label:$t("admin.files.filter.statusOptions.active"),value:"active"},{label:$t("admin.files.filter.statusOptions.pendingReview"),value:"pending_review"},{label:$t("admin.files.filter.statusOptions.deleted"),value:"deleted"}]),loadTags=async()=>{try{const result=await getAdminTagList();result.success&&(tags.value=result.data?.items||[])}catch{tags.value=[]}},loadColors=async()=>{try{const result=await getAdminColorList();result.success&&(colors.value=result.data?.items||[])}catch{colors.value=[]}},applyFilters=()=>{filters.dominant_color=selectedColors.value.join(","),filters.tags=selectedTags.value.join(","),emit("filter",{...filters})},resetFilters=()=>{selectedColors.value=[],selectedTags.value=[],Object.assign(filters,{page:1,size:LAYOUT.DEFAULT_PAGE_SIZE,sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",is_nsfw:!1,is_recommended:!1,storage_type:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0,user_id:void 0}),applyFilters()};return onMounted(async()=>{if(await Promise.all([loadTags(),loadColors()]),props.initialFilters){if(Object.assign(filters,props.initialFilters),filters.tags){const tagIds=filters.tags.split(",");selectedTags.value=tagIds}filters.dominant_color&&(selectedColors.value=filters.dominant_color.split(","))}}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberSwitch=resolveComponent("CyberSwitch");return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("h3",_hoisted_3$3,[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-filter mr-1.5 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.filter.title")),1)]),createBaseVNode("div",_hoisted_4$3,[createVNode(_component_CyberButton,{type:"secondary",class:"px-2 py-1 text-xs",onClick:resetFilters},{default:withCtx(()=>[_cache[14]||(_cache[14]=createBaseVNode("i",{class:"fas fa-undo-alt mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",class:"px-2 py-1 text-xs",onClick:applyFilters},{default:withCtx(()=>[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-search mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.applyFilter")),1)]),_:1})])]),createBaseVNode("div",_hoisted_5$3,[createBaseVNode("div",_hoisted_6$3,[createBaseVNode("label",_hoisted_7$3,toDisplayString(unref($t)("admin.files.filter.keyword")),1),createVNode(_component_CyberInput,{modelValue:filters.keyword,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>filters.keyword=$event),placeholder:unref($t)("admin.files.filter.keywordPlaceholder")},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_8$3,[createBaseVNode("label",_hoisted_9$3,toDisplayString(unref($t)("admin.files.filter.tags")),1),createVNode(_component_CyberDropdown,{modelValue:selectedTags.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>selectedTags.value=$event),options:tagOptions.value,placeholder:unref($t)("admin.files.filter.tagsPlaceholder"),multiple:"",searchable:"",class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_10$3,[createBaseVNode("label",_hoisted_11$3,toDisplayString(unref($t)("admin.files.filter.dominantColor")),1),createVNode(_component_CyberDropdown,{modelValue:selectedColors.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>selectedColors.value=$event),options:colorOptions.value,placeholder:unref($t)("admin.files.filter.colorPlaceholder"),"is-color-mode":"",multiple:"",class:"compact"},{option:withCtx(({option,isSelected,onSelect})=>[createBaseVNode("div",{class:normalizeClass(["cyber-dropdown-option color-option-row",{"is-selected":isSelected}]),onClick:onSelect},[createBaseVNode("div",_hoisted_13$2,[createBaseVNode("span",_hoisted_14$2,[withDirectives(createBaseVNode("i",_hoisted_15$2,null,512),[[vShow,isSelected]])])]),createBaseVNode("div",{class:"color-item h-6 w-6 rounded",style:normalizeStyle({backgroundColor:option.color})},null,4),createBaseVNode("span",_hoisted_16$1,toDisplayString(option.label),1)],10,_hoisted_12$2)]),_:1},8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_17$1,[createBaseVNode("label",_hoisted_18$1,toDisplayString(unref($t)("admin.files.filter.sortBy")),1),createVNode(_component_CyberDropdown,{modelValue:filters.sort,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>filters.sort=$event),options:sortOptions.value,placeholder:unref($t)("admin.files.filter.sortPlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_19$1,[createBaseVNode("label",_hoisted_20$1,toDisplayString(unref($t)("admin.files.filter.resolution")),1),createVNode(_component_CyberDropdown,{modelValue:filters.resolution,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>filters.resolution=$event),options:resolutionOptions.value,placeholder:unref($t)("admin.files.filter.resolutionPlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_21$1,[createBaseVNode("label",_hoisted_22$1,toDisplayString(unref($t)("admin.files.filter.status")),1),createVNode(_component_CyberDropdown,{modelValue:filters.status,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>filters.status=$event),options:statusOptions.value,placeholder:unref($t)("admin.files.filter.statusPlaceholder"),class:"compact",clearable:""},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_23$1,[createBaseVNode("div",_hoisted_24$1,[createBaseVNode("label",_hoisted_25$1,toDisplayString(unref($t)("admin.files.filter.quickOptions")),1),createBaseVNode("div",_hoisted_26$1,[createBaseVNode("div",_hoisted_27$1,[createBaseVNode("label",_hoisted_28$1,toDisplayString(unref($t)("admin.files.filter.isNsfw")),1),createVNode(_component_CyberSwitch,{modelValue:filters.is_nsfw,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>filters.is_nsfw=$event),class:"scale-75"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_29$1,[createBaseVNode("label",_hoisted_30$1,toDisplayString(unref($t)("admin.files.filter.isRecommended")),1),createVNode(_component_CyberSwitch,{modelValue:filters.is_recommended,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>filters.is_recommended=$event),class:"scale-75"},null,8,["modelValue"])])])])])]),createBaseVNode("div",_hoisted_31,[createBaseVNode("div",{class:"flex cursor-pointer items-center text-xs text-content transition-colors hover:text-error-500",onClick:_cache[8]||(_cache[8]=$event=>showAdvanced.value=!showAdvanced.value)},[createBaseVNode("i",{class:normalizeClass(["fas mr-1",[showAdvanced.value?"fa-chevron-up":"fa-chevron-down"]])},null,2),createBaseVNode("span",null,toDisplayString(showAdvanced.value?unref($t)("admin.files.filter.hideAdvanced"):unref($t)("admin.files.filter.showAdvanced")),1)]),showAdvanced.value?(openBlock(),createElementBlock("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createBaseVNode("label",_hoisted_34,toDisplayString(unref($t)("admin.files.filter.advanced.userId")),1),createVNode(_component_CyberInput,{modelValue:filters.user_id,"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>filters.user_id=$event),modelModifiers:{number:!0},placeholder:unref($t)("admin.files.filter.advanced.userIdPlaceholder"),type:"number"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_35,[createBaseVNode("label",_hoisted_36,toDisplayString(unref($t)("admin.files.filter.advanced.size")),1),createBaseVNode("div",_hoisted_37,[createVNode(_component_CyberInput,{modelValue:filters.min_width,"onUpdate:modelValue":_cache[10]||(_cache[10]=$event=>filters.min_width=$event),modelModifiers:{number:!0},placeholder:unref($t)("admin.files.filter.advanced.minWidth"),type:"number",class:"w-full"},null,8,["modelValue","placeholder"]),_cache[16]||(_cache[16]=createBaseVNode("span",{class:"text-content-content-disabled mx-1"},"×",-1)),createVNode(_component_CyberInput,{modelValue:filters.min_height,"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>filters.min_height=$event),modelModifiers:{number:!0},placeholder:unref($t)("admin.files.filter.advanced.minHeight"),type:"number",class:"w-full"},null,8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_38,[createBaseVNode("label",_hoisted_39,toDisplayString(unref($t)("admin.files.filter.advanced.storageType")),1),createVNode(_component_CyberDropdown,{modelValue:filters.storage_type,"onUpdate:modelValue":_cache[12]||(_cache[12]=$event=>filters.storage_type=$event),options:storageOptions.value,placeholder:unref($t)("admin.files.filter.advanced.storageTypePlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])])])):createCommentVNode("",!0)])])}}});const FileFilter=_export_sfc(_sfc_main$3,[["__scopeId","data-v-1c9bde84"]]),_hoisted_1$2={key:0,class:"selected-indicator"},_hoisted_2$2={class:"relative"},_hoisted_3$2={key:0,class:"nsfw-overlay absolute inset-0 z-10 flex flex-col items-center justify-center p-3 backdrop-blur-sm"},_hoisted_4$2={class:"text-center text-sm text-content-heading"},_hoisted_5$2={class:"image-wrapper relative aspect-[4/3]"},_hoisted_6$2={class:"overlay pointer-events-none absolute inset-0 flex flex-col justify-end bg-gradient-to-t from-background-900 to-transparent p-3 opacity-0 group-hover:opacity-100"},_hoisted_7$2={class:"mb-1 flex items-center justify-between"},_hoisted_8$2={class:"truncate text-xs text-content"},_hoisted_9$2={class:"text-xs text-content"},_hoisted_10$2={class:"flex items-center justify-between"},_hoisted_11$2={class:"flex items-center space-x-1"},_hoisted_12$1={class:"text-xs text-content"},_hoisted_13$1=["title"],_hoisted_14$1={class:"pointer-events-none absolute left-2 top-2 flex flex-col items-start space-y-1"},_hoisted_15$1={class:"pointer-events-none absolute right-2 top-2 flex flex-col items-end space-y-1"},_hoisted_16={key:0,class:"quality-badge rounded bg-error-800 px-2 py-0.5 text-xs text-content-heading backdrop-blur-sm"},_hoisted_17={key:1,class:"quality-badge rounded bg-brand-800 px-2 py-0.5 text-xs text-content-heading backdrop-blur-sm"},_hoisted_18={key:2,class:"quality-badge rounded bg-warning-800 px-2 py-0.5 text-xs text-content-heading backdrop-blur-sm"},_hoisted_19={class:"p-2.5"},_hoisted_20={class:"mb-1.5"},_hoisted_21=["title"],_hoisted_22={class:"truncate text-xs text-content-muted"},_hoisted_23={key:0,class:"tags-list mb-1.5"},_hoisted_24={class:"tags-container"},_hoisted_25={class:"flex items-center justify-between"},_hoisted_26={class:"text-xs text-content-muted"},_hoisted_27={key:0,class:"action-buttons flex gap-1.5"},_hoisted_28=["title"],_hoisted_29=["title"],_hoisted_30=["title"],_sfc_main$2=defineComponent({__name:"FileCard",props:{fileData:{},selectMode:{type:Boolean},selected:{type:Boolean}},emits:["view","delete","recommend","details","select"],setup(__props,{emit:__emit}){const props=__props,{$t}=useTexts(),isFileLoading=ref(!1),emit=__emit,isNsfw=computed(()=>props.fileData.ai_info?.is_nsfw),showNsfwContent=ref(!1),handleCardClick=()=>{if(props.selectMode)emit("select",props.fileData.id);else{if(isNsfw.value&&!showNsfwContent.value)return;emit("view",props.fileData.id)}},viewNsfwImage=()=>{showNsfwContent.value=!0,emit("view",props.fileData.id)},deleteImage=()=>{emit("delete",props.fileData.id)},toggleRecommend=()=>{emit("recommend",props.fileData.id,!props.fileData.is_recommended)},viewDetails=()=>{emit("details",props.fileData.id)},formatFileSize=bytes=>{if(bytes===0)return"0 B";const k=1024,sizes=["B","KB","MB","GB"],i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`},formatDate=dateString=>new Date(dateString).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"2-digit",day:"2-digit"});return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberFile=resolveComponent("CyberFile"),_component_cyber_file_expiry_tag=resolveComponent("cyber-file-expiry-tag"),_component_CyberTag=resolveComponent("CyberTag"),_directive_loading=resolveDirective("loading");return openBlock(),createElementBlock("div",{class:normalizeClass(["image-card hover:shadow-glow group overflow-hidden rounded-lg border border-subtle bg-background-800",{"is-nsfw":isNsfw.value,selected:__props.selected,"select-mode":__props.selectMode}]),onClick:handleCardClick},[__props.selectMode&&__props.selected?(openBlock(),createElementBlock("div",_hoisted_1$2,[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-check"},null,-1)])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$2,[isNsfw.value&&!__props.selectMode?(openBlock(),createElementBlock("div",_hoisted_3$2,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-eye-slash mb-2 text-2xl text-error-500"},null,-1)),createBaseVNode("p",_hoisted_4$2,toDisplayString(unref($t)("admin.files.fileCard.nsfwOverlay.warning")),1),createVNode(_component_CyberButton,{type:"primary",class:"mt-3",onClick:withModifiers(viewNsfwImage,["stop"])},{default:withCtx(()=>[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-eye mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.fileCard.nsfwOverlay.viewFile")),1)]),_:1})])):createCommentVNode("",!0),withDirectives((openBlock(),createElementBlock("div",_hoisted_5$2,[createVNode(_component_CyberFile,{src:__props.fileData.full_thumb_url||__props.fileData.thumb_url,alt:__props.fileData.display_name||__props.fileData.original_name,class:"h-full w-full object-cover",loading:"lazy",onLoading:_cache[0]||(_cache[0]=$event=>isFileLoading.value=$event)},null,8,["src","alt"]),createBaseVNode("div",_hoisted_6$2,[createBaseVNode("div",_hoisted_7$2,[createBaseVNode("span",_hoisted_8$2,toDisplayString(formatFileSize(__props.fileData.size)),1),createBaseVNode("span",_hoisted_9$2,toDisplayString(__props.fileData.width)+" × "+toDisplayString(__props.fileData.height),1)]),createBaseVNode("div",_hoisted_10$2,[createBaseVNode("div",_hoisted_11$2,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-tag text-xs text-brand-700"},null,-1)),createBaseVNode("span",_hoisted_12$1,toDisplayString(__props.fileData.ai_info?.tags?.length||0),1)]),createBaseVNode("div",{class:"h-5 w-5 rounded-full",style:normalizeStyle({backgroundColor:__props.fileData.ai_info?.dominant_color||"#333"}),title:__props.fileData.ai_info?.dominant_color},null,12,_hoisted_13$1)])]),createBaseVNode("div",_hoisted_14$1,[__props.fileData.is_time_limited?(openBlock(),createBlock(_component_cyber_file_expiry_tag,{key:0,"expires-at":__props.fileData.expires_at,"storage-duration":__props.fileData.storage_duration,"is-time-limited":__props.fileData.is_time_limited,position:"top-left",mode:"both","show-icon":!0},null,8,["expires-at","storage-duration","is-time-limited"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_15$1,[__props.fileData.ai_info?.is_nsfw?(openBlock(),createElementBlock("div",_hoisted_16," NSFW ")):createCommentVNode("",!0),__props.fileData.is_recommended?(openBlock(),createElementBlock("div",_hoisted_17,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-star mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.fileCard.badges.recommended")),1)])):createCommentVNode("",!0),__props.fileData.is_duplicate?(openBlock(),createElementBlock("div",_hoisted_18,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-copy mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.fileCard.badges.duplicate")),1)])):createCommentVNode("",!0)])])),[[_directive_loading,isFileLoading.value]])]),createBaseVNode("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[createBaseVNode("h3",{class:"truncate text-sm font-medium text-content-heading",title:__props.fileData.display_name||__props.fileData.original_name},toDisplayString(__props.fileData.display_name||__props.fileData.original_name),9,_hoisted_21),createBaseVNode("p",_hoisted_22,toDisplayString(__props.fileData.format.toUpperCase())+" | "+toDisplayString(unref($t)("admin.files.fileCard.uploader"))+": "+toDisplayString(__props.fileData.user_name),1)]),__props.fileData.ai_info?.tags?.length?(openBlock(),createElementBlock("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.fileData.ai_info.tags.slice(0,2),(tag,index2)=>(openBlock(),createBlock(_component_CyberTag,{key:index2,variant:"primary",size:"small",truncate:""},{default:withCtx(()=>[createTextVNode(toDisplayString(tag),1)]),_:2},1024))),128)),__props.fileData.ai_info.tags.length>2?(openBlock(),createBlock(_component_CyberTag,{key:0,variant:"secondary",size:"small"},{default:withCtx(()=>[createTextVNode(" +"+toDisplayString(__props.fileData.ai_info.tags.length-2),1)]),_:1})):createCommentVNode("",!0)])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_25,[createBaseVNode("div",_hoisted_26,toDisplayString(formatDate(__props.fileData.created_at)),1),__props.selectMode?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_27,[createBaseVNode("button",{class:normalizeClass(["cyber-action-btn",{active:__props.fileData.is_recommended}]),title:unref($t)("admin.files.fileCard.actions.recommend"),onClick:withModifiers(toggleRecommend,["stop"])},[..._cache[7]||(_cache[7]=[createBaseVNode("i",{class:"fas fa-star"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],10,_hoisted_28),__props.fileData.ai_info?(openBlock(),createElementBlock("button",{key:0,class:"cyber-action-btn info-btn",title:unref($t)("admin.files.fileCard.actions.details"),onClick:withModifiers(viewDetails,["stop"])},[..._cache[8]||(_cache[8]=[createBaseVNode("i",{class:"fas fa-info-circle"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_29)):createCommentVNode("",!0),createBaseVNode("button",{class:"cyber-action-btn danger-btn",title:unref($t)("admin.files.fileCard.actions.delete"),onClick:withModifiers(deleteImage,["stop"])},[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-trash-alt"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_30)]))])])],2)}}});const FileCard=_export_sfc(_sfc_main$2,[["__scopeId","data-v-212f97e5"]]),_hoisted_1$1={class:"p-3"},_hoisted_2$1={class:"text-sm text-content-heading"},_hoisted_3$1={class:"flex justify-end space-x-2 p-4"},_hoisted_4$1={class:"p-3"},_hoisted_5$1={class:"mb-3 flex items-center"},_hoisted_6$1={class:"text-sm font-medium text-content-heading"},_hoisted_7$1={class:"mt-1 text-xs text-content-muted"},_hoisted_8$1={class:"rounded border border-subtle bg-background-400 p-3"},_hoisted_9$1={class:"text-xs text-content"},_hoisted_10$1={class:"ml-4 mt-2 space-y-1 text-xs text-content-muted"},_hoisted_11$1={class:"flex justify-end space-x-2 p-4"},_sfc_main$1=defineComponent({__name:"AdminModals",props:{showDetailModal:{type:Boolean},showDeleteConfirm:{type:Boolean},showBatchDeleteConfirm:{type:Boolean},selectedFile:{},selectedCount:{},isDeleting:{type:Boolean},isBatchProcessing:{type:Boolean}},emits:["update:showDetailModal","update:showDeleteConfirm","update:showBatchDeleteConfirm","delete","batchDelete","recommend","confirmDelete"],setup(__props){const{$t}=useTexts();return(_ctx,_cache)=>{const _component_CyberFileDetailModal=resolveComponent("CyberFileDetailModal"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",null,[createVNode(_component_CyberFileDetailModal,{"model-value":__props.showDetailModal,"file-info":__props.selectedFile,"is-admin":"","onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>_ctx.$emit("update:showDetailModal",$event)),onClose:_cache[1]||(_cache[1]=$event=>_ctx.$emit("update:showDetailModal",!1)),onDelete:_cache[2]||(_cache[2]=$event=>_ctx.$emit("confirmDelete",__props.selectedFile?.id)),onRecommend:_cache[3]||(_cache[3]=$event=>_ctx.$emit("recommend",$event,!__props.selectedFile?.is_recommended))},null,8,["model-value","file-info"]),createVNode(_component_CyberDialog,{"model-value":__props.showDeleteConfirm,title:unref($t)("admin.files.modals.deleteConfirm.title"),"show-footer":!0,class:"text-sm","onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>_ctx.$emit("update:showDeleteConfirm",$event))},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_3$1,[createVNode(_component_CyberButton,{type:"secondary",onClick:_cache[4]||(_cache[4]=$event=>_ctx.$emit("update:showDeleteConfirm",!1))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.files.modals.deleteConfirm.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"danger",loading:__props.isDeleting,onClick:_cache[5]||(_cache[5]=$event=>_ctx.$emit("delete"))},{default:withCtx(()=>[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-trash-alt mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.modals.deleteConfirm.confirm")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("p",_hoisted_2$1,toDisplayString(unref($t)("admin.files.modals.deleteConfirm.message")),1)])]),_:1},8,["model-value","title"]),createVNode(_component_CyberDialog,{"model-value":__props.showBatchDeleteConfirm,title:unref($t)("admin.files.modals.batchDeleteConfirm.title"),"show-footer":!0,class:"text-sm","onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>_ctx.$emit("update:showBatchDeleteConfirm",$event))},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_11$1,[createVNode(_component_CyberButton,{type:"secondary",onClick:_cache[7]||(_cache[7]=$event=>_ctx.$emit("update:showBatchDeleteConfirm",!1))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.files.modals.batchDeleteConfirm.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"danger",loading:__props.isBatchProcessing,onClick:_cache[8]||(_cache[8]=$event=>_ctx.$emit("batchDelete"))},{default:withCtx(()=>[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-trash-alt mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.modals.batchDeleteConfirm.confirm",{count:__props.selectedCount})),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("div",_hoisted_5$1,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-3 text-xl text-warning"},null,-1)),createBaseVNode("div",null,[createBaseVNode("p",_hoisted_6$1,toDisplayString(unref($t)("admin.files.modals.batchDeleteConfirm.message",{count:__props.selectedCount})),1),createBaseVNode("p",_hoisted_7$1,toDisplayString(unref($t)("admin.files.modals.batchDeleteConfirm.warning")),1)])]),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("p",_hoisted_9$1,[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-info-circle mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.files.modals.batchDeleteConfirm.info")),1)]),createBaseVNode("ul",_hoisted_10$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref($t)("admin.files.modals.batchDeleteConfirm.consequences"),(consequence,index2)=>(openBlock(),createElementBlock("li",{key:index2}," • "+toDisplayString(consequence),1))),128))])])])]),_:1},8,["model-value","title"])])}}});function useFileSelection(){const selectMode=ref(!1),selectedImages=ref([]);return{selectMode,selectedImages,startSelectMode:()=>{selectMode.value=!0},cancelSelectMode:()=>{selectMode.value=!1,selectedImages.value=[]},toggleImageSelection:id=>{const index2=selectedImages.value.indexOf(id);index2>-1?selectedImages.value.splice(index2,1):selectedImages.value.push(id)},createSelectionHelpers:images=>{const isAllSelected=computed(()=>{if(images().length===0)return!1;const currentIds=new Set(images().map(i=>i.id));for(const id of currentIds)if(!selectedImages.value.includes(id))return!1;return!0}),hasCrossPageSelection=computed(()=>{if(selectedImages.value.length===0)return!1;const currentIds=new Set(images().map(i=>i.id));return selectedImages.value.some(id=>!currentIds.has(id))}),canInvertSelection=computed(()=>!hasCrossPageSelection.value);return{isAllSelected,hasCrossPageSelection,canInvertSelection,toggleSelectAll:()=>{const currentIds=images().map(img=>img.id);if(isAllSelected.value)selectedImages.value=selectedImages.value.filter(id=>!currentIds.includes(id));else{const set=new Set(selectedImages.value);currentIds.forEach(id=>set.add(id)),selectedImages.value=Array.from(set)}},selectInvert:()=>{if(!canInvertSelection.value)return;const allIds=images().map(img=>img.id),set=new Set(selectedImages.value),invertedCurrent=[];for(const id of allIds)set.has(id)||invertedCurrent.push(id);const otherPageSelected=selectedImages.value.filter(id=>!allIds.includes(id));selectedImages.value=[...otherPageSelected,...invertedCurrent]}}}}}function useUrlParams(pageSizeRef,currentPageRef,filtersRef){const route=useRoute(),router=useRouter(),toast=useToast(),{$t}=useTexts();return{syncUrlParams:(currentPage,pageSize,filters)=>{const query={};route.query.tag_id&&(query.tag_id=route.query.tag_id),route.query.tag_name&&(query.tag_name=route.query.tag_name),currentPage>1&&(query.page=currentPage),pageSize!==24&&(query.size=pageSize),filters.sort!=="newest"&&(query.sort=filters.sort),filters.keyword&&(query.keyword=filters.keyword),filters.tags&&(query.tags=filters.tags),filters.dominant_color&&(query.dominant_color=filters.dominant_color),filters.resolution&&(query.resolution=filters.resolution),filters.is_nsfw!==void 0&&(query.is_nsfw=filters.is_nsfw),filters.is_recommended!==void 0&&(query.is_recommended=filters.is_recommended),filters.storage_type&&(query.storage_type=filters.storage_type),filters.min_width&&(query.min_width=filters.min_width),filters.max_width&&(query.max_width=filters.max_width),filters.min_height&&(query.min_height=filters.min_height),filters.max_height&&(query.max_height=filters.max_height),filters.user_id&&(query.user_id=filters.user_id),router.replace({query})},clearUrlParams:()=>{router.replace({query:{}})},restoreFromUrlParams:()=>{const{query}=route;if(query.size){const newSize=Number(query.size);pageSizeRef.value=newSize,filtersRef.size=newSize}if(query.page){const pageNum=Number(query.page);currentPageRef.value=pageNum,filtersRef.page=pageNum}query.keyword&&(filtersRef.keyword=String(query.keyword)),query.tags&&(filtersRef.tags=String(query.tags)),query.dominant_color&&(filtersRef.dominant_color=String(query.dominant_color)),query.resolution&&(filtersRef.resolution=String(query.resolution)),query.is_nsfw!==void 0&&(filtersRef.is_nsfw=query.is_nsfw==="true"),query.is_recommended!==void 0&&(filtersRef.is_recommended=query.is_recommended==="true"),query.storage_type&&(filtersRef.storage_type=String(query.storage_type)),query.min_width&&(filtersRef.min_width=Number(query.min_width)),query.max_width&&(filtersRef.max_width=Number(query.max_width)),query.min_height&&(filtersRef.min_height=Number(query.min_height)),query.max_height&&(filtersRef.max_height=Number(query.max_height)),query.user_id&&(filtersRef.user_id=Number(query.user_id)),query.sort&&(filtersRef.sort=String(query.sort));const tagId=query.tag_id,tagName=query.tag_name;if(tagId)if(filtersRef.tags=Array.isArray(tagId)?tagId.join(","):String(tagId),tagName){const displayName=Array.isArray(tagName)?tagName.join(", "):tagName;toast.info($t("admin.files.urlParams.tagFiltered").replace("{name}",displayName))}else toast.info($t("admin.files.urlParams.tagIdFiltered").replace("{id}",filtersRef.tags))},checkRouteParams:()=>!!route.query.tag_id}}function useBatchOperations(){const toast=useToast(),{$t}=useTexts(),isDeleting=ref(!1),isBatchProcessing=ref(!1),showBatchDeleteConfirm=ref(!1);return{isDeleting,isBatchProcessing,showBatchDeleteConfirm,batchSetRecommendation:async(selectedImages,recommended,images,onSuccess)=>{if(selectedImages.length!==0){isBatchProcessing.value=!0;try{const result=await batchSetFileRecommendation(selectedImages,recommended);if(!result.success){toast.error($t("admin.files.batch.operationFailed"));return}const{data}=result;if(data.success_count>0){const action=$t(recommended?"admin.files.actions.recommend":"admin.files.actions.unrecommend"),failPart=data.fail_count>0?$t("admin.files.batch.failCount",{count:data.fail_count}):"";toast.success($t("admin.files.batch.recommendSuccess",{action,successCount:data.success_count,failPart})),data.updated_files.forEach(updatedFile=>{const imageIndex=images.findIndex(img=>img.id===updatedFile.id);imageIndex!==-1&&(images[imageIndex].is_recommended=updatedFile.is_recommended)})}if(data.fail_count>0&&data.success_count===0){const action=$t(recommended?"admin.files.actions.recommend":"admin.files.actions.unrecommend");toast.error($t("admin.files.batch.recommendFailed",{action}))}onSuccess?.()}catch{toast.error($t("admin.files.batch.operationError"))}finally{isBatchProcessing.value=!1}}},confirmBatchDelete:selectedImages=>{selectedImages.length!==0&&(showBatchDeleteConfirm.value=!0)},batchDelete:async(selectedImages,images,onSuccess)=>{if(selectedImages.length!==0){isBatchProcessing.value=!0;try{const result=await batchDeleteAdminFiles(selectedImages);if(!result.success){toast.error($t("admin.files.batch.deleteFailed"));return}const{data}=result;if(data.success_count>0){const failPart=data.fail_count>0?$t("admin.files.batch.failCount",{count:data.fail_count}):"";toast.success($t("admin.files.batch.deleteSuccess",{successCount:data.success_count,failPart}));const _newImages=images.filter(img=>!data.success_ids.includes(img.id));onSuccess?.(data.success_ids)}data.fail_count>0&&data.success_count===0&&toast.error($t("admin.files.batch.deleteFailed")),showBatchDeleteConfirm.value=!1}catch{toast.error($t("admin.files.batch.deleteError"))}finally{isBatchProcessing.value=!1}}},deleteImage:async(fileId,onSuccess)=>{if(fileId){isDeleting.value=!0;try{if(!(await deleteAdminFile(fileId)).success){toast.error($t("admin.files.single.deleteFailed"));return}toast.success($t("admin.files.single.deleteSuccess")),onSuccess?.()}catch{toast.error($t("admin.files.single.deleteError"))}finally{isDeleting.value=!1}}},toggleRecommendation:async(id,recommended,images)=>{try{const result=await setFileRecommendation(id);if(!result.success){const action2=$t(recommended?"admin.files.actions.recommend":"admin.files.actions.unrecommend");toast.error($t("admin.files.single.toggleFailed",{action:action2}));return}const{data}=result,action=data.is_recommended?$t("admin.files.actions.recommend"):$t("admin.files.actions.unrecommend");toast.success($t("admin.files.single.toggleSuccess",{action}));const imageIndex=images.findIndex(img=>img.id===id);imageIndex!==-1&&(images[imageIndex].is_recommended=data.is_recommended)}catch{toast.error($t("admin.files.single.toggleError"))}}}}const _hoisted_1={class:"admin-files-page admin-page-container admin-files"},_hoisted_2={class:"selection-info"},_hoisted_3={class:"selection-count"},_hoisted_4={class:"admin-content-wrapper"},_hoisted_5={class:"images-content"},_hoisted_6={key:0,class:"selection-toolbar"},_hoisted_7=["title"],_hoisted_8=["disabled","title"],_hoisted_9={class:"images-grid-container"},_hoisted_10={class:"images-grid"},_hoisted_11={key:1,class:"pagination-wrapper"},_hoisted_12={key:2,class:"empty-state"},_hoisted_13={class:"empty-content"},_hoisted_14={class:"empty-title"},_hoisted_15={class:"empty-desc"},_sfc_main=defineComponent({name:"AdminFiles",__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),route=useRoute(),router=useRouter(),showFilter=ref(!1),isLoading=ref(!1),showSkeleton=ref(!0),currentPage=ref(1),pageSize=ref(24),{pageSize:autoPageSize,recalc}=useResponsivePageSize({containerSelector:".images-grid",gridSelector:".images-grid",childSelector:".image-card",itemMinWidth:187,columnGap:16,rowMultiple:4,defaultSize:24,debug:!1,preferCssColumns:!0,mode:"once"}),pageSizeOptions=computed(()=>{const base=autoPageSize.value||pageSize.value||24,list=[base,base*2,base*3,base*20].map(n=>Math.max(1,Math.floor(n)));return Array.from(new Set(list)).sort((a,b)=>a-b)}),totalFiles=ref(0),files=ref([]),filters=reactive({page:1,size:24,sort:"newest",tags:""}),isInitialized=ref(!1),{selectMode,selectedImages,startSelectMode,cancelSelectMode,toggleImageSelection,createSelectionHelpers}=useFileSelection(),{syncUrlParams,clearUrlParams,restoreFromUrlParams}=useUrlParams(pageSize,currentPage,filters),{isDeleting,isBatchProcessing,showBatchDeleteConfirm,batchSetRecommendation:batchSetRecommendationAction,confirmBatchDelete,batchDelete:batchDeleteAction,deleteImage:_deleteImageAction,toggleRecommendation:_toggleRecommendationAction}=useBatchOperations(),{isAllSelected,hasCrossPageSelection:_hasCrossPageSelection,canInvertSelection,toggleSelectAll,selectInvert}=createSelectionHelpers(()=>files.value),currentPreviewIndex=computed(()=>selectedFile.value&&files.value.findIndex(img=>img.id===selectedFile.value?.id)||0),handlePrevImage=()=>{const currentIndex=currentPreviewIndex.value;currentIndex>0&&(selectedFile.value=files.value[currentIndex-1])},handleNextImage=()=>{const currentIndex=currentPreviewIndex.value;currentIndex<files.value.length-1&&(selectedFile.value=files.value[currentIndex+1])},showDetailModal=ref(!1),showDeleteConfirm=ref(!1),showFilePreview=ref(!1),selectedFile=ref(null),selectedFileId=ref(null),batchSetRecommendation=async recommended=>{await batchSetRecommendationAction(selectedImages.value,recommended,files.value,()=>{selectedImages.value=[],selectMode.value=!1})},batchDelete=async()=>{await batchDeleteAction(selectedImages.value,files.value,deletedIds=>{files.value=files.value.filter(img=>!deletedIds.includes(img.id)),files.value.length===0&&currentPage.value>1?(currentPage.value--,syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles()):files.value.length===0&&loadFiles(),selectedImages.value=[],selectMode.value=!1})},handlePageSizeChange=newSize=>{isInitialized.value&&(pageSize.value=newSize,filters.size=newSize,filters.page=1,currentPage.value=1,selectedImages.value=[],syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles())},loadFiles=async()=>{if(!isLoading.value){isLoading.value=!0,showSkeleton.value=!0;try{const params=processParams({...filters,page:currentPage.value,size:pageSize.value},{booleanFields:["is_recommended","is_nsfw"],removeUndefined:!0,removeEmpty:!0}),result=await getAdminFileList(params);if(result.success){const{data}=result;files.value=data?.items||[],totalFiles.value=data?.pagination?.total||0}}finally{isLoading.value=!1,showSkeleton.value=!1}}},goToUpload=()=>{router.push("/upload")},handleFilter=newFilters=>{Object.assign(filters,newFilters),isInitialized.value?(filters.page=1,currentPage.value=1):filters.page=currentPage.value,selectedImages.value=[],syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles(),showFilter.value=!1},resetFilter=()=>{Object.assign(filters,{page:1,size:pageSize.value,sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",nsfw_max_score:void 0,is_nsfw:void 0,is_recommended:void 0,storage_type:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0,user_id:void 0}),currentPage.value=1,selectedImages.value=[],syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles()},handlePageChange=page=>{isInitialized.value&&(currentPage.value=page,filters.page=page,syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles())},viewFileDetails=id=>{const file=files.value.find(img=>img.id===id);file&&(selectedFile.value=file,showDetailModal.value=!0)},viewFile=id=>{const file=files.value.find(img=>img.id===id);file&&(selectedFile.value=file,showFilePreview.value=!0)},confirmDeleteFile=id=>{selectedFileId.value=id||selectedFile.value?.id||null,showDeleteConfirm.value=!0,showDetailModal.value=!1},deleteFile=async()=>{if(selectedFileId.value){isDeleting.value=!0;try{if(!(await deleteAdminFile(selectedFileId.value)).success){toast.error($t("admin.files.messages.deleteFailed"));return}toast.success($t("admin.files.messages.deleteSuccess")),showDeleteConfirm.value=!1,files.value=files.value.filter(img=>img.id!==selectedFileId.value),selectedImages.value=selectedImages.value.filter(id=>id!==selectedFileId.value),files.value.length===0&&currentPage.value>1?(currentPage.value--,filters.page=currentPage.value,syncUrlParams(currentPage.value,pageSize.value,filters),loadFiles()):files.value.length===0&&loadFiles()}catch{toast.error($t("admin.files.messages.deleteError"))}finally{isDeleting.value=!1,selectedFileId.value=null}}},toggleRecommendation=async(id,_recommended)=>{try{const result=await setFileRecommendation(id);if(!result.success){toast.error($t("admin.files.messages.operationFailed"));return}const{data}=result;toast.success(data.is_recommended?$t("admin.files.messages.recommendSuccess"):$t("admin.files.messages.cancelRecommendSuccess"));const index2=files.value.findIndex(img=>img.id===id);index2!==-1&&(files.value[index2].is_recommended=data.is_recommended),selectedFile.value&&selectedFile.value.id===id&&(selectedFile.value.is_recommended=data.is_recommended)}catch{toast.error($t("admin.files.messages.operationError"))}};return watch([()=>route.query,()=>route.params],([newQuery,newParams],[oldQuery,oldParams])=>{isInitialized.value&&(route.name==="adminImages"||route.name==="adminImagesByTags")&&(JSON.stringify(newQuery)!==JSON.stringify(oldQuery)||JSON.stringify(newParams)!==JSON.stringify(oldParams))&&(restoreFromUrlParams(),loadImages())},{immediate:!1}),watch(()=>route.name,(newName,oldName)=>{(oldName==="adminImages"||oldName==="adminImagesByTags")&&newName!=="adminImages"&&newName!=="adminImagesByTags"&&(clearUrlParams(),isInitialized.value=!1)},{immediate:!1}),onMounted(()=>{restoreFromUrlParams(),recalc(),autoPageSize.value&&autoPageSize.value!==pageSize.value&&(pageSize.value=autoPageSize.value,filters.size=autoPageSize.value),loadFiles(),isInitialized.value=!0}),onBeforeUnmount(()=>{clearUrlParams(),isInitialized.value=!1}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberSkeleton=__unplugin_components_0,_component_CyberPagination=resolveComponent("CyberPagination"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_cyberFileViewer=resolveComponent("cyberFileViewer");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.files.title"),subtitle:unref($t)("admin.files.subtitle"),icon:"fas fa-file","show-topbar":showFilter.value},{actions:withCtx(()=>[createVNode(_component_CyberButton,{type:"primary",onClick:goToUpload},{default:withCtx(()=>[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-upload mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.upload")),1)]),_:1}),unref(selectMode)?(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_2,[createBaseVNode("span",_hoisted_3,[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-file mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.selection.selected"))+" "+toDisplayString(unref(selectedImages).length)+" "+toDisplayString(unref($t)("admin.files.selection.selectedCount")),1)])]),createVNode(_component_CyberButton,{type:"success",disabled:unref(selectedImages).length===0||unref(isBatchProcessing),onClick:_cache[0]||(_cache[0]=$event=>batchSetRecommendation(!0))},{default:withCtx(()=>[_cache[16]||(_cache[16]=createBaseVNode("i",{class:"fas fa-star mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.batchActions.recommend")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{type:"warning",disabled:unref(selectedImages).length===0||unref(isBatchProcessing),onClick:_cache[1]||(_cache[1]=$event=>batchSetRecommendation(!1))},{default:withCtx(()=>[_cache[17]||(_cache[17]=createBaseVNode("i",{class:"far fa-star mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.batchActions.cancelRecommend")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{type:"danger",disabled:unref(selectedImages).length===0||unref(isBatchProcessing),onClick:_cache[2]||(_cache[2]=$event=>unref(confirmBatchDelete)(unref(selectedImages)))},{default:withCtx(()=>[_cache[18]||(_cache[18]=createBaseVNode("i",{class:"fas fa-trash mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.batchActions.batchDelete")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{type:"outlined",onClick:unref(cancelSelectMode)},{default:withCtx(()=>[_cache[19]||(_cache[19]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.cancel")),1)]),_:1},8,["onClick"])],64)):(openBlock(),createBlock(_component_CyberButton,{key:0,type:"outlined",onClick:unref(startSelectMode)},{default:withCtx(()=>[_cache[14]||(_cache[14]=createBaseVNode("i",{class:"fas fa-tasks mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.batchOperation")),1)]),_:1},8,["onClick"])),createVNode(_component_CyberButton,{type:"outlined",class:normalizeClass({"border-error-500 text-error-500":showFilter.value}),onClick:_cache[3]||(_cache[3]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[_cache[20]||(_cache[20]=createBaseVNode("i",{class:"fas fa-filter mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.files.buttons.filter")),1)]),_:1},8,["class"])]),topbar:withCtx(()=>[createVNode(FileFilter,{"initial-filters":filters,onFilter:handleFilter},null,8,["initial-filters"])]),content:withCtx(()=>[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[(files.value.length>0||isLoading.value)&&unref(selectMode)?(openBlock(),createElementBlock("div",_hoisted_6,[createBaseVNode("button",{class:normalizeClass(["select-btn select-all-btn",{active:unref(isAllSelected)}]),title:unref(isAllSelected)?unref($t)("admin.files.selection.deselectAll"):unref($t)("admin.files.selection.selectAll"),onClick:_cache[4]||(_cache[4]=(...args)=>unref(toggleSelectAll)&&unref(toggleSelectAll)(...args))},[createBaseVNode("i",{class:normalizeClass(["fas",unref(isAllSelected)?"fa-check-double":"fa-check"])},null,2),createTextVNode(" "+toDisplayString(unref(isAllSelected)?unref($t)("admin.files.selection.deselectAll"):unref($t)("admin.files.selection.selectAll")),1)],10,_hoisted_7),createBaseVNode("button",{class:"select-btn invert-btn",disabled:!unref(canInvertSelection),title:unref(canInvertSelection)?unref($t)("admin.files.selection.invertSelection"):unref($t)("admin.files.selection.invertDisabledTip"),onClick:_cache[5]||(_cache[5]=(...args)=>unref(selectInvert)&&unref(selectInvert)(...args))},[_cache[21]||(_cache[21]=createBaseVNode("i",{class:"fas fa-exchange-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.files.selection.invertSelection")),1)],8,_hoisted_8)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createVNode(_component_CyberSkeleton,{type:"card",count:24,loading:showSkeleton.value},null,8,["loading"]),!isLoading.value&&files.value.length>0?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(files.value,file=>(openBlock(),createBlock(FileCard,{key:file.id,"file-data":file,"select-mode":unref(selectMode),selected:unref(selectedImages).includes(file.id),class:"image-card",onView:viewFile,onDelete:confirmDeleteFile,onRecommend:toggleRecommendation,onDetails:viewFileDetails,onSelect:unref(toggleImageSelection)},null,8,["file-data","select-mode","selected","onSelect"]))),128)):createCommentVNode("",!0)])]),!showSkeleton.value&&!isLoading.value&&files.value.length>0?(openBlock(),createElementBlock("div",_hoisted_11,[createVNode(_component_CyberPagination,{"current-page":currentPage.value,"onUpdate:currentPage":[_cache[6]||(_cache[6]=$event=>currentPage.value=$event),handlePageChange],"page-size":pageSize.value,"onUpdate:pageSize":[_cache[7]||(_cache[7]=$event=>pageSize.value=$event),handlePageSizeChange],total:totalFiles.value,"page-size-options":pageSizeOptions.value,"show-page-size-selector":!0,"show-quick-jumper":!0,"show-total":!0},null,8,["current-page","page-size","total","page-size-options"])])):createCommentVNode("",!0),!showSkeleton.value&&!isLoading.value&&files.value.length===0?(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[_cache[23]||(_cache[23]=createBaseVNode("div",{class:"empty-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-images empty-icon"})],-1)),createBaseVNode("h3",_hoisted_14,toDisplayString(unref($t)("admin.files.empty.title")),1),createBaseVNode("p",_hoisted_15,toDisplayString(unref($t)("admin.files.empty.description")),1),createVNode(_component_CyberButton,{type:"secondary",onClick:resetFilter},{default:withCtx(()=>[_cache[22]||(_cache[22]=createBaseVNode("i",{class:"fas fa-redo mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.files.buttons.resetFilters")),1)]),_:1})])])):createCommentVNode("",!0)])])]),_:1},8,["title","subtitle","show-topbar"]),createVNode(_component_cyberFileViewer,{modelValue:showFilePreview.value,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>showFilePreview.value=$event),file:selectedFile.value,files:files.value,"initial-index":currentPreviewIndex.value,"show-side-nav":!0,"show-keyboard-tips":!0,onClose:_cache[9]||(_cache[9]=$event=>showFilePreview.value=!1),onPrev:handlePrevImage,onNext:handleNextImage},null,8,["modelValue","file","files","initial-index"]),createVNode(_sfc_main$1,{"show-detail-modal":showDetailModal.value,"show-delete-confirm":showDeleteConfirm.value,"show-batch-delete-confirm":unref(showBatchDeleteConfirm),"selected-file":selectedFile.value,"selected-count":unref(selectedImages).length,"is-deleting":unref(isDeleting),"is-batch-processing":unref(isBatchProcessing),"onUpdate:showDetailModal":_cache[10]||(_cache[10]=$event=>showDetailModal.value=$event),"onUpdate:showDeleteConfirm":_cache[11]||(_cache[11]=$event=>showDeleteConfirm.value=$event),"onUpdate:showBatchDeleteConfirm":_cache[12]||(_cache[12]=$event=>showBatchDeleteConfirm.value=$event),onDelete:deleteFile,onBatchDelete:batchDelete,onRecommend:toggleRecommendation,onConfirmDelete:confirmDeleteFile},null,8,["show-detail-modal","show-delete-confirm","show-batch-delete-confirm","selected-file","selected-count","is-deleting","is-batch-processing"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-d23b4919"]]);export{index as default};
