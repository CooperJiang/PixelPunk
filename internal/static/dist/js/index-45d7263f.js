import{d as defineComponent,c as computed,r as ref,w as watch,A as createBlock,L as withCtx,u as unref,E as resolveComponent,z as openBlock,a0 as createBaseVNode,f as createVNode,ab as createTextVNode,a1 as toDisplayString,R as normalizeClass,H as withDirectives,an as vModelRadio,a5 as withModifiers,n as nextTick,a as reactive,I as createElementBlock,K as createCommentVNode,F as Fragment,M as renderList,G as resolveDirective,a3 as useRouter,b as onMounted,o as onUnmounted,a4 as useRoute}from"./vue-vendor-31320f47.js";import{j as useTexts,a3 as getValidationRules,a4 as updateFolder,a5 as createFolder,a6 as Validator,q as useToast,_ as _export_sfc,a7 as __unplugin_components_1,J as getCurrentLocale,a8 as getFolderList,a9 as moveFolder,i as useLayoutStore,Z as StorageUtil,aa as getFolderDetail,w as useFolderPath,$ as TOKEN_KEY,ab as reorderFolders,ac as reorderFiles,ad as getFolderListWithImages,ae as deleteFolder,af as visibilityFolder,r as downloadFileQuick,a1 as deleteFile,a2 as toggleAccessLevel,ag as batchDeleteFiles,k as useBreadcrumbStore}from"./index-4d0dab4c.js";import{S as ShareButton,C as CreateShareDialog}from"./CreateShareDialog-552bdda3.js";import{l as lo}from"./draggable-5c726607.js";import{F as FilesGridView}from"./FilesGridView-714078a5.js";import{F as FolderBreadcrumb}from"./FolderBreadcrumb-729222da.js";import{c as copyToClipboard}from"./clipboard-b54d9428.js";/* empty css                                                           */import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";import"./index-8277663f.js";import"./dialog-476153c4.js";const _hoisted_1$9={class:"form-item"},_hoisted_2$8={class:"form-label"},_hoisted_3$6={class:"form-control"},_hoisted_4$5={class:"form-item"},_hoisted_5$4={class:"form-label"},_hoisted_6$4={class:"form-control"},_hoisted_7$4={class:"permission-options"},_hoisted_8$4={class:"permission-details"},_hoisted_9$4={class:"permission-name"},_hoisted_10$4={class:"permission-desc"},_hoisted_11$4={class:"permission-details"},_hoisted_12$4={class:"permission-name"},_hoisted_13$3={class:"permission-desc"},_hoisted_14$3={class:"form-item"},_hoisted_15$3={class:"form-label"},_hoisted_16$3={class:"form-control"},_hoisted_17$3={class:"flex justify-end gap-3 p-4"},_sfc_main$9=defineComponent({__name:"CreateFolderDialog",props:{modelValue:{type:Boolean},parentId:{},mode:{},folder:{}},emits:["update:modelValue","created","updated"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,isEditMode=computed(()=>props.mode==="edit"),{$t}=useTexts(),form=ref({name:"",permission:"public",description:"",parent_id:props.parentId}),errors=ref({name:""}),confirmLoading=ref(!1),nameInput=ref(null),R=getValidationRules($t),validateName=()=>{const check=Validator.validate(form.value?.name||"",[R.required,R.maxLength(30)],$t);return errors.value.name=check.valid?"":check.message||$t("validation.errors.custom"),check.valid},isFormValid=computed(()=>form.value?.name?.trim()!==""&&!errors.value.name),visible=computed({get:()=>props.modelValue,set:value=>emit("update:modelValue",value)}),toast=useToast(),resetForm=()=>{form.value={name:"",permission:"public",description:"",parent_id:props.parentId},errors.value={name:""}},initEditForm=()=>{props.folder&&(form.value={name:props.folder.name||"",parent_id:props.folder.parent_id,permission:props.folder.permission||"public",description:props.folder.description||""})},handleConfirm=async()=>{if(!(!validateName()||confirmLoading.value)){confirmLoading.value=!0;try{if(isEditMode.value&&props.folder?.id){const result=await updateFolder({folderId:props.folder.id,...form.value});if(result.success){const updatedFolder={...result.data};emit("updated",updatedFolder),resetForm(),visible.value=!1,toast.success($t("folders.createFolderDialog.toast.updateSuccess"))}}else{const result=await createFolder(form.value);if(result.success){const newFolder={...result.data,...form.value};emit("created",newFolder),resetForm(),visible.value=!1,toast.success($t("folders.createFolderDialog.toast.createSuccess"))}}}catch(error){console.error($t("folders.createFolderDialog.toast.operationFailed"),error)}confirmLoading.value=!1}},handleCancel=()=>{resetForm(),visible.value=!1};return watch(()=>visible.value,newVal=>{newVal&&nextTick(()=>{nameInput.value?.focus(),isEditMode.value?initEditForm():resetForm()})}),watch(()=>props.parentId,newVal=>{!isEditMode.value&&form.value&&(form.value.parent_id=newVal)}),watch(()=>props.folder,newVal=>{isEditMode.value&&newVal&&initEditForm()}),(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:visible.value,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>visible.value=$event),title:isEditMode.value?unref($t)("folders.createFolderDialog.title.edit"):unref($t)("folders.createFolderDialog.title.create"),loading:confirmLoading.value,width:"450px",onConfirm:handleConfirm,onCancel:handleCancel},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_17$3,[createVNode(_component_CyberButton,{type:"outlined",size:"medium",onClick:handleCancel},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("actions.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",size:"medium",icon:isEditMode.value?"edit":"folder-plus",loading:confirmLoading.value,disabled:!isFormValid.value,onClick:handleConfirm},{default:withCtx(()=>[createTextVNode(toDisplayString(isEditMode.value?unref($t)("folders.createFolderDialog.actions.save"):unref($t)("folders.createFolderDialog.actions.create")),1)]),_:1},8,["icon","loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("form",{class:"create-folder-form",onSubmit:withModifiers(handleConfirm,["prevent"])},[createBaseVNode("div",_hoisted_1$9,[createBaseVNode("label",_hoisted_2$8,[_cache[5]||(_cache[5]=createBaseVNode("span",{class:"required"},"*",-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.createFolderDialog.form.name.label")),1)]),createBaseVNode("div",_hoisted_3$6,[createVNode(_component_CyberInput,{ref_key:"nameInput",ref:nameInput,modelValue:form.value.name,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>form.value.name=$event),placeholder:unref($t)("folders.createFolderDialog.form.name.placeholder"),error:!!errors.value.name,"error-message":errors.value.name,clearable:"",onInput:validateName,onEnter:handleConfirm},null,8,["modelValue","placeholder","error","error-message"])])]),createBaseVNode("div",_hoisted_4$5,[createBaseVNode("label",_hoisted_5$4,toDisplayString(unref($t)("folders.createFolderDialog.form.permission.label")),1),createBaseVNode("div",_hoisted_6$4,[createBaseVNode("div",_hoisted_7$4,[createBaseVNode("label",{class:normalizeClass(["permission-option",{active:form.value.permission==="public"}])},[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>form.value.permission=$event),type:"radio",name:"permission",value:"public"},null,512),[[vModelRadio,form.value.permission]]),_cache[6]||(_cache[6]=createBaseVNode("div",{class:"permission-icon"},[createBaseVNode("i",{class:"fas fa-globe"})],-1)),createBaseVNode("div",_hoisted_8$4,[createBaseVNode("div",_hoisted_9$4,toDisplayString(unref($t)("folders.createFolderDialog.form.permission.public.name")),1),createBaseVNode("div",_hoisted_10$4,toDisplayString(unref($t)("folders.createFolderDialog.form.permission.public.desc")),1)])],2),createBaseVNode("label",{class:normalizeClass(["permission-option",{active:form.value.permission==="private"}])},[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>form.value.permission=$event),type:"radio",name:"permission",value:"private"},null,512),[[vModelRadio,form.value.permission]]),_cache[7]||(_cache[7]=createBaseVNode("div",{class:"permission-icon"},[createBaseVNode("i",{class:"fas fa-lock"})],-1)),createBaseVNode("div",_hoisted_11$4,[createBaseVNode("div",_hoisted_12$4,toDisplayString(unref($t)("folders.createFolderDialog.form.permission.private.name")),1),createBaseVNode("div",_hoisted_13$3,toDisplayString(unref($t)("folders.createFolderDialog.form.permission.private.desc")),1)])],2)])])]),createBaseVNode("div",_hoisted_14$3,[createBaseVNode("label",_hoisted_15$3,toDisplayString(unref($t)("folders.createFolderDialog.form.description.label")),1),createBaseVNode("div",_hoisted_16$3,[createVNode(_component_CyberInput,{modelValue:form.value.description,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>form.value.description=$event),type:"textarea",placeholder:unref($t)("folders.createFolderDialog.form.description.placeholder"),rows:3},null,8,["modelValue","placeholder"])])])],32)]),_:1},8,["modelValue","title","loading"])}}});const CreateFolderDialog=_export_sfc(_sfc_main$9,[["__scopeId","data-v-6af5195c"]]),_hoisted_1$8={key:0,class:"section-container"},_hoisted_2$7={class:"section-header"},_hoisted_3$5={class:"section-title"},_hoisted_4$4={class:"item-count"},_hoisted_5$3={key:0,class:"drag-tip"},_hoisted_6$3={key:0,class:"section-actions"},_hoisted_7$3={class:"select-actions"},_hoisted_8$3=["onClick","onContextmenu"],_hoisted_9$3={key:0,class:"selected-indicator selectable-check"},_hoisted_10$3=["title","aria-label","onClick"],_hoisted_11$3={class:"folder-card-content"},_hoisted_12$3={class:"folder-details"},_hoisted_13$2=["title"],_hoisted_14$2={class:"folder-meta"},_hoisted_15$2={class:"folder-meta-item"},_hoisted_16$2={class:"meta-text"},_hoisted_17$2={key:0,class:"folder-meta-item"},_hoisted_18$1={class:"meta-text"},_hoisted_19$1={key:2,class:"folder-card-actions"},_hoisted_20$1=["title","onClick"],_hoisted_21$1=["onClick"],_sfc_main$8=defineComponent({name:"FolderGrid",__name:"index",props:{folders:{},selectMode:{type:Boolean},isAllFoldersSelected:{type:Boolean},isFolderSelected:{type:Function},preview:{type:Boolean}},emits:["folder-click","folder-double-click","toggle-folder-select","toggle-select-all-folders","invert-folder-selection","delete-folder","edit-folder","toggle-folder-visibility","folder-drag-start","folder-drag-end","folder-moved"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,toast=useToast(),{$t}=useTexts(),mutableFolders=ref([...props.folders]);watch(()=>props.folders,newFolders=>{mutableFolders.value=[...newFolders]},{deep:!0});const handleFolderClick=folder=>{props.selectMode&&!props.preview?emit("toggle-folder-select",folder):emit("folder-click",folder)},showContextMenu=ref(!1),contextMenuPosition=reactive({x:0,y:0}),selectedFolder=ref(null),contextMenuItems=ref([]),buildFolderMenuItem=folder=>({key:`folder-${folder.id}`,label:folder.name,icon:"fas fa-folder",onClick:async()=>{if(selectedFolder.value)try{await moveFolder(selectedFolder.value.id,folder.id),toast.success($t("folders.folderGrid.toast.moveSuccess",{name:folder.name})),emit("folder-moved",selectedFolder.value.id,folder.id)}catch{toast.error($t("folders.folderGrid.toast.moveFailed"))}},hasAsyncChildren:folder.has_children,loadChildren:folder.has_children?async()=>{const res=await getFolderList(folder.id);return res.success&&res.data?res.data.map(buildFolderMenuItem):[]}:void 0}),loadRootAsMenu=async()=>{const res=await getFolderList(),list=res.success&&res.data?res.data.map(buildFolderMenuItem):[];return[{key:"root",label:$t("folders.folderGrid.contextMenu.root"),icon:"fas fa-home",onClick:async()=>{if(selectedFolder.value)try{await moveFolder(selectedFolder.value.id,void 0),toast.success($t("folders.folderGrid.toast.moveToRootSuccess")),emit("folder-moved",selectedFolder.value.id,void 0)}catch{toast.error($t("folders.folderGrid.toast.moveFailed"))}}},...list]},handleFolderContextMenu=async(event,folder)=>{event.preventDefault(),event.stopPropagation(),selectedFolder.value=folder,contextMenuItems.value=[{key:"move-to",label:$t("folders.folderGrid.contextMenu.moveTo"),icon:"fas fa-arrows-alt",hasAsyncChildren:!0,loadChildren:loadRootAsMenu},{key:"divider-1",label:"",divided:!0},{key:"edit",label:$t("folders.folderGrid.contextMenu.rename"),icon:"fas fa-edit",onClick:()=>{selectedFolder.value&&emit("edit-folder",selectedFolder.value)}},{key:"delete",label:$t("folders.folderGrid.contextMenu.delete"),icon:"fas fa-trash",onClick:()=>{selectedFolder.value&&emit("delete-folder",selectedFolder.value)},danger:!0}],contextMenuPosition.x=event.clientX,contextMenuPosition.y=event.clientY,showContextMenu.value=!0},formatDate=dateStr=>new Date(dateStr).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"short",day:"numeric"});return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberContextMenu=__unplugin_components_1;return __props.folders.length>0?(openBlock(),createElementBlock("div",_hoisted_1$8,[createBaseVNode("div",_hoisted_2$7,[createBaseVNode("h2",_hoisted_3$5,[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-folder"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.folderGrid.sectionTitle"))+" ",1),createBaseVNode("span",_hoisted_4$4,toDisplayString(__props.folders.length),1),!__props.selectMode&&!__props.preview&&__props.folders.length>1?(openBlock(),createElementBlock("span",_hoisted_5$3,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-arrows-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.folderGrid.dragTip")),1)])):createCommentVNode("",!0)]),__props.selectMode&&!__props.preview?(openBlock(),createElementBlock("div",_hoisted_6$3,[createBaseVNode("div",_hoisted_7$3,[createVNode(_component_CyberButton,{type:"ghost",icon:__props.isAllFoldersSelected?"check-double":"check",title:__props.isAllFoldersSelected?unref($t)("folders.folderGrid.actions.deselectAllTitle"):unref($t)("folders.folderGrid.actions.selectAllTitle"),class:normalizeClass({active:__props.isAllFoldersSelected}),onClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("toggle-select-all-folders"))},{default:withCtx(()=>[createTextVNode(toDisplayString(__props.isAllFoldersSelected?unref($t)("folders.folderGrid.actions.deselectAll"):unref($t)("folders.folderGrid.actions.selectAll")),1)]),_:1},8,["icon","title","class"]),createVNode(_component_CyberButton,{type:"ghost",icon:"exchange-alt",title:unref($t)("folders.folderGrid.actions.invertTitle"),onClick:_cache[1]||(_cache[1]=$event=>_ctx.$emit("invert-folder-selection"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.folderGrid.actions.invert")),1)]),_:1},8,["title"])])])):createCommentVNode("",!0)]),createVNode(unref(lo),{modelValue:mutableFolders.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>mutableFolders.value=$event),animation:"150","ghost-class":"folder-ghost","chosen-class":"folder-chosen","drag-class":"folder-drag",disabled:__props.selectMode||__props.preview,class:"folder-cards",onStart:_cache[3]||(_cache[3]=$event=>_ctx.$emit("folder-drag-start")),onEnd:_cache[4]||(_cache[4]=event=>_ctx.$emit("folder-drag-end",{event,sortedFolders:mutableFolders.value}))},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(mutableFolders.value,folder=>(openBlock(),createElementBlock("div",{key:folder.id,class:normalizeClass(["folder-card selectable-item",{selected:__props.selectMode&&__props.isFolderSelected?.(folder),"is-selected":__props.selectMode&&__props.isFolderSelected?.(folder),selectable:__props.selectMode}]),onClick:$event=>handleFolderClick(folder),onContextmenu:$event=>__props.preview?void 0:handleFolderContextMenu($event,folder)},[__props.selectMode&&__props.isFolderSelected?.(folder)?(openBlock(),createElementBlock("div",_hoisted_9$3,[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-check"},null,-1)])])):createCommentVNode("",!0),!__props.preview&&!__props.selectMode?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["folder-visibility",folder.permission==="private"?"private":"public"]),title:unref($t)("folders.folderGrid.visibility.toggleTitle"),"aria-label":folder.permission==="private"?unref($t)("folders.folderGrid.visibility.setPublic"):unref($t)("folders.folderGrid.visibility.setPrivate"),onClick:$event=>_ctx.$emit("toggle-folder-visibility",folder,$event)},[createBaseVNode("i",{class:normalizeClass(folder.permission==="private"?"fas fa-lock":"fas fa-globe")},null,2)],10,_hoisted_10$3)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_11$3,[_cache[12]||(_cache[12]=createBaseVNode("div",{class:"folder-icon-container"},[createBaseVNode("div",{class:"folder-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-folder"})])],-1)),createBaseVNode("div",_hoisted_12$3,[createBaseVNode("div",{class:"folder-name",title:folder.name},toDisplayString(folder.name),9,_hoisted_13$2),createBaseVNode("div",_hoisted_14$2,[createBaseVNode("div",_hoisted_15$2,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-clock"},null,-1)),createBaseVNode("span",_hoisted_16$2,toDisplayString(formatDate(folder.created_at)),1)]),folder.file_count!==void 0?(openBlock(),createElementBlock("div",_hoisted_17$2,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-image"},null,-1)),createBaseVNode("span",_hoisted_18$1,toDisplayString(unref($t)("folders.folderGrid.fileCount",{count:folder.file_count||0})),1)])):createCommentVNode("",!0)])])]),!__props.preview&&!__props.selectMode?(openBlock(),createElementBlock("div",_hoisted_19$1,[createBaseVNode("button",{class:"folder-action-btn delete-btn",title:unref($t)("folders.folderGrid.actions.deleteTitle"),onClick:withModifiers($event=>_ctx.$emit("delete-folder",folder),["stop"])},[..._cache[13]||(_cache[13]=[createBaseVNode("i",{class:"fas fa-trash"},null,-1)])],8,_hoisted_20$1),createBaseVNode("button",{class:"folder-action-btn edit-btn",onClick:withModifiers($event=>_ctx.$emit("edit-folder",folder),["stop"])},[..._cache[14]||(_cache[14]=[createBaseVNode("i",{class:"fas fa-edit"},null,-1)])],8,_hoisted_21$1)])):createCommentVNode("",!0),_cache[15]||(_cache[15]=createBaseVNode("div",{class:"folder-highlight"},null,-1))],42,_hoisted_8$3))),128))]),_:1},8,["modelValue","disabled"]),createVNode(_component_CyberContextMenu,{modelValue:showContextMenu.value,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>showContextMenu.value=$event),items:contextMenuItems.value,x:contextMenuPosition.x,y:contextMenuPosition.y,onClose:_cache[6]||(_cache[6]=$event=>showContextMenu.value=!1)},null,8,["modelValue","items","x","y"])])):createCommentVNode("",!0)}}});const FolderGrid=_export_sfc(_sfc_main$8,[["__scopeId","data-v-999f75fa"]]),_hoisted_1$7={class:"images-list"},_hoisted_2$6={class:"list-header"},_hoisted_3$4={class:"col-preview"},_hoisted_4$3={class:"col-filename"},_hoisted_5$2={class:"col-size"},_hoisted_6$2={class:"col-dimensions"},_hoisted_7$2={class:"col-date"},_hoisted_8$2={class:"col-actions"},_hoisted_9$2={class:"list-body"},_hoisted_10$2=["onClick"],_hoisted_11$2={class:"col-preview"},_hoisted_12$2={class:"item-preview"},_hoisted_13$1={class:"col-filename"},_hoisted_14$1={class:"filename-content"},_hoisted_15$1=["title"],_hoisted_16$1={class:"file-meta"},_hoisted_17$1={class:"file-format"},_hoisted_18=["title"],_hoisted_19={class:"col-size"},_hoisted_20={class:"col-dimensions"},_hoisted_21={key:0},_hoisted_22={key:1,class:"text-content-muted"},_hoisted_23={class:"col-date"},_hoisted_24={class:"col-actions"},_hoisted_25={key:0,class:"selected-indicator"},_hoisted_26={key:1,class:"action-buttons"},_hoisted_27=["title","onClick"],_hoisted_28=["title","onClick"],_hoisted_29=["title","onClick"],_hoisted_30=["title","onClick"],_hoisted_31={key:0,class:"list-empty"},_sfc_main$7=defineComponent({name:"FilesListView",__name:"FilesListView",props:{images:{},selectMode:{type:Boolean},batchMode:{type:Boolean},isAllImagesSelected:{type:Boolean},isImageSelected:{type:Function},isBatchImageSelected:{type:Function},preview:{type:Boolean}},emits:["preview-image","view-details","copy-link","download-image","delete-image","toggle-image-select","toggle-batch-image-select","toggle-select-all-images"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,imageLoadingStates=ref({}),handleItemClick=image=>{(props.selectMode||props.batchMode)&&!props.preview?props.batchMode?emit("toggle-batch-image-select",image):props.selectMode&&emit("toggle-image-select",image):emit("preview-image",image)},getImageUrl=(url,_accessLevel)=>url,getAccessIcon=accessLevel=>{switch(accessLevel){case"private":return"fas fa-lock";case"protected":return"fas fa-shield-alt";default:return"fas fa-globe"}},formatFileSize=size=>size?size<1024?`${size} B`:size<1024*1024?`${(size/1024).toFixed(1)} KB`:`${(size/(1024*1024)).toFixed(1)} MB`:"0 B",formatDate=dateStr=>new Date(dateStr).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"2-digit",day:"2-digit"});return(_ctx,_cache)=>{const _component_CyberFile=resolveComponent("CyberFile"),_directive_loading=resolveDirective("loading");return openBlock(),createElementBlock("div",_hoisted_1$7,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$4,toDisplayString(unref($t)("folders.fileGrid.listView.columns.preview")),1),createBaseVNode("div",_hoisted_4$3,toDisplayString(unref($t)("folders.fileGrid.listView.columns.filename")),1),createBaseVNode("div",_hoisted_5$2,toDisplayString(unref($t)("folders.fileGrid.listView.columns.size")),1),createBaseVNode("div",_hoisted_6$2,toDisplayString(unref($t)("folders.fileGrid.listView.columns.dimensions")),1),createBaseVNode("div",_hoisted_7$2,toDisplayString(unref($t)("folders.fileGrid.listView.columns.date")),1),createBaseVNode("div",_hoisted_8$2,toDisplayString(unref($t)("folders.fileGrid.listView.columns.actions")),1)]),createBaseVNode("div",_hoisted_9$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.images,image=>(openBlock(),createElementBlock("div",{key:image.id,class:normalizeClass(["list-item",{"is-selected":__props.selectMode&&__props.isImageSelected?.(image)||__props.batchMode&&__props.isBatchImageSelected?.(image)}]),onClick:$event=>handleItemClick(image)},[withDirectives((openBlock(),createElementBlock("div",_hoisted_11$2,[createBaseVNode("div",_hoisted_12$2,[createVNode(_component_CyberFile,{src:getImageUrl(image.full_thumb_url,image.access_level),alt:image.display_name,"fit-mode":"cover","retry-count":2,"is-nsfw":image.is_nsfw,onLoading:$event=>imageLoadingStates.value[image.id]=$event,onClick:$event=>_ctx.$emit("preview-image",image)},null,8,["src","alt","is-nsfw","onLoading","onClick"]),image.access_level&&image.access_level!=="public"?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["access-badge",`access-${image.access_level}`])},[createBaseVNode("i",{class:normalizeClass(getAccessIcon(image.access_level))},null,2)],2)):createCommentVNode("",!0)])])),[[_directive_loading,imageLoadingStates.value[image.id]]]),createBaseVNode("div",_hoisted_13$1,[createBaseVNode("div",_hoisted_14$1,[createBaseVNode("div",{class:"file-name",title:image.display_name},toDisplayString(image.display_name),9,_hoisted_15$1),createBaseVNode("div",_hoisted_16$1,[createBaseVNode("span",_hoisted_17$1,"."+toDisplayString(image.format?.toUpperCase()||"UNKNOWN"),1),image.is_duplicate?(openBlock(),createElementBlock("span",{key:0,class:"duplicate-indicator",title:unref($t)("folders.fileGrid.meta.duplicateFile")},[..._cache[0]||(_cache[0]=[createBaseVNode("i",{class:"fas fa-clone"},null,-1)])],8,_hoisted_18)):createCommentVNode("",!0)])])]),createBaseVNode("div",_hoisted_19,toDisplayString(formatFileSize(image.size)),1),createBaseVNode("div",_hoisted_20,[image.width&&image.height?(openBlock(),createElementBlock("span",_hoisted_21,toDisplayString(image.width)+" Ã— "+toDisplayString(image.height),1)):(openBlock(),createElementBlock("span",_hoisted_22,"-"))]),createBaseVNode("div",_hoisted_23,toDisplayString(formatDate(image.created_at)),1),createBaseVNode("div",_hoisted_24,[(__props.selectMode||__props.batchMode)&&(__props.selectMode&&__props.isImageSelected?.(image)||__props.batchMode&&__props.isBatchImageSelected?.(image))?(openBlock(),createElementBlock("div",_hoisted_25,[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-check"},null,-1)])])):!__props.selectMode&&!__props.batchMode?(openBlock(),createElementBlock("div",_hoisted_26,[image.ai_info?(openBlock(),createElementBlock("button",{key:0,class:"action-btn info-btn",title:unref($t)("folders.fileGrid.actions.aiInfo"),onClick:withModifiers($event=>_ctx.$emit("view-details",image),["stop"])},[..._cache[2]||(_cache[2]=[createBaseVNode("i",{class:"fas fa-info-circle"},null,-1)])],8,_hoisted_27)):createCommentVNode("",!0),createBaseVNode("button",{class:"action-btn copy-btn",title:unref($t)("folders.fileGrid.actions.copyLink"),onClick:withModifiers($event=>_ctx.$emit("copy-link",image),["stop"])},[..._cache[3]||(_cache[3]=[createBaseVNode("i",{class:"fas fa-link"},null,-1)])],8,_hoisted_28),createBaseVNode("button",{class:"action-btn download-btn",title:unref($t)("folders.fileGrid.actions.download"),onClick:withModifiers($event=>_ctx.$emit("download-image",image),["stop"])},[..._cache[4]||(_cache[4]=[createBaseVNode("i",{class:"fas fa-download"},null,-1)])],8,_hoisted_29),__props.preview?createCommentVNode("",!0):(openBlock(),createElementBlock("button",{key:1,class:"action-btn delete-btn",title:unref($t)("folders.fileGrid.actions.delete"),onClick:withModifiers($event=>_ctx.$emit("delete-image",image),["stop"])},[..._cache[5]||(_cache[5]=[createBaseVNode("i",{class:"fas fa-trash"},null,-1)])],8,_hoisted_30))])):createCommentVNode("",!0)])],10,_hoisted_10$2))),128)),__props.images.length===0?(openBlock(),createElementBlock("div",_hoisted_31,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-images"},null,-1)),createBaseVNode("p",null,toDisplayString(unref($t)("folders.fileGrid.listView.empty")),1)])):createCommentVNode("",!0)])])}}});const FilesListView=_export_sfc(_sfc_main$7,[["__scopeId","data-v-5f8cc023"]]),_hoisted_1$6={key:0,class:"section-container"},_hoisted_2$5={class:"section-header"},_hoisted_3$3={class:"section-title"},_hoisted_4$2={class:"item-count"},_hoisted_5$1={key:0,class:"drag-tip"},_hoisted_6$1={class:"section-actions"},_hoisted_7$1={key:0,class:"batch-actions"},_hoisted_8$1=["title"],_hoisted_9$1={key:1,class:"batch-mode-controls"},_hoisted_10$1={class:"batch-selection-info"},_hoisted_11$1={class:"batch-count bg-error-200 text-error-500"},_hoisted_12$1=["disabled","title"],_hoisted_13=["title"],_hoisted_14={key:2,class:"select-actions"},_hoisted_15={class:"view-actions"},_hoisted_16=["title"],_hoisted_17=["title"],_sfc_main$6=defineComponent({name:"FileGrid",__name:"index",props:{files:{},selectedBatchFiles:{},isAllFilesSelected:{type:Boolean},isFileSelected:{type:Function},isBatchFileSelected:{type:Function},images:{},selectedBatchImages:{},isAllImagesSelected:{type:Boolean},isImageSelected:{type:Function},isBatchImageSelected:{type:Function},pagination:{},selectMode:{type:Boolean},batchMode:{type:Boolean},viewMode:{},preview:{type:Boolean}},emits:["preview-file","copy-link","download-file","delete-file","toggle-file-visibility","toggle-file-select","toggle-batch-file-select","toggle-select-all-files","invert-file-selection","start-batch-mode","cancel-batch-mode","batch-delete","change-view-mode","file-drag-start","file-drag-end","file-moved","file-deleted","preview-image","view-details","download-image","delete-image","toggle-image-visibility","toggle-image-select","toggle-batch-image-select","toggle-select-all-images","invert-image-selection","image-drag-start","image-drag-end","image-moved","image-deleted"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,images=computed(()=>props.files||props.images||[]),selectedBatchImages=computed(()=>props.selectedBatchFiles||props.selectedBatchImages||[]),isAllImagesSelected=computed(()=>props.isAllFilesSelected??props.isAllImagesSelected??!1),isImageSelected=computed(()=>props.isFileSelected||props.isImageSelected),isBatchImageSelected=computed(()=>props.isBatchFileSelected||props.isBatchImageSelected);return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return images.value.length>0?(openBlock(),createElementBlock("div",_hoisted_1$6,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("h2",_hoisted_3$3,[_cache[28]||(_cache[28]=createBaseVNode("i",{class:"fas fa-images"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.fileGrid.sectionTitle"))+" ",1),createBaseVNode("span",_hoisted_4$2,toDisplayString(__props.pagination?.total||images.value.length),1),!__props.selectMode&&!__props.batchMode&&!__props.preview&&images.value.length>1&&__props.viewMode==="grid"?(openBlock(),createElementBlock("span",_hoisted_5$1,[_cache[27]||(_cache[27]=createBaseVNode("i",{class:"fas fa-arrows-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.fileGrid.dragTip")),1)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_6$1,[!__props.batchMode&&!__props.selectMode&&!__props.preview?(openBlock(),createElementBlock("div",_hoisted_7$1,[createBaseVNode("button",{class:"batch-btn",title:unref($t)("folders.fileGrid.actions.batchMode"),onClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("start-batch-mode"))},[_cache[29]||(_cache[29]=createBaseVNode("i",{class:"fas fa-tasks"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.fileGrid.actions.batchMode")),1)],8,_hoisted_8$1)])):__props.batchMode&&!__props.preview?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("div",_hoisted_10$1,[createBaseVNode("span",_hoisted_11$1,[_cache[30]||(_cache[30]=createBaseVNode("i",{class:"fas fa-image"},null,-1)),createTextVNode(toDisplayString(unref($t)("folders.fileGrid.selectedCount",{count:selectedBatchImages.value.length})),1)])]),createBaseVNode("button",{class:"batch-btn danger-btn",disabled:selectedBatchImages.value.length===0,title:unref($t)("folders.fileGrid.actions.batchDelete"),onClick:_cache[1]||(_cache[1]=$event=>_ctx.$emit("batch-delete"))},[_cache[31]||(_cache[31]=createBaseVNode("i",{class:"fas fa-trash"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.fileGrid.actions.batchDelete")),1)],8,_hoisted_12$1),createBaseVNode("button",{class:"batch-btn cancel-btn",title:unref($t)("folders.fileGrid.actions.cancelBatch"),onClick:_cache[2]||(_cache[2]=$event=>_ctx.$emit("cancel-batch-mode"))},[_cache[32]||(_cache[32]=createBaseVNode("i",{class:"fas fa-times"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("actions.cancel")),1)],8,_hoisted_13)])):createCommentVNode("",!0),(__props.selectMode||__props.batchMode)&&!__props.preview?(openBlock(),createElementBlock("div",_hoisted_14,[createVNode(_component_CyberButton,{type:"ghost",icon:isAllImagesSelected.value?"check-double":"check",title:isAllImagesSelected.value?unref($t)("folders.fileGrid.actions.deselectAllTitle"):unref($t)("folders.fileGrid.actions.selectAllTitle"),class:normalizeClass({active:isAllImagesSelected.value}),onClick:_cache[3]||(_cache[3]=$event=>_ctx.$emit("toggle-select-all-images"))},{default:withCtx(()=>[createTextVNode(toDisplayString(isAllImagesSelected.value?unref($t)("folders.fileGrid.actions.deselectAll"):unref($t)("folders.fileGrid.actions.selectAll")),1)]),_:1},8,["icon","title","class"]),createVNode(_component_CyberButton,{type:"ghost",icon:"exchange-alt",title:unref($t)("folders.fileGrid.actions.invertTitle"),onClick:_cache[4]||(_cache[4]=$event=>_ctx.$emit("invert-image-selection"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.fileGrid.actions.invert")),1)]),_:1},8,["title"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_15,[createBaseVNode("button",{class:normalizeClass(["view-toggle-btn",{active:__props.viewMode==="grid"}]),title:unref($t)("folders.fileGrid.actions.gridView"),onClick:_cache[5]||(_cache[5]=$event=>_ctx.$emit("change-view-mode","grid"))},[..._cache[33]||(_cache[33]=[createBaseVNode("i",{class:"fas fa-th"},null,-1)])],10,_hoisted_16),createBaseVNode("button",{class:normalizeClass(["view-toggle-btn",{active:__props.viewMode==="list"}]),title:unref($t)("folders.fileGrid.actions.listView"),onClick:_cache[6]||(_cache[6]=$event=>_ctx.$emit("change-view-mode","list"))},[..._cache[34]||(_cache[34]=[createBaseVNode("i",{class:"fas fa-list"},null,-1)])],10,_hoisted_17)])])]),__props.viewMode==="grid"?(openBlock(),createBlock(FilesGridView,{key:0,images:images.value,"select-mode":__props.selectMode,"batch-mode":__props.batchMode,"is-image-selected":isImageSelected.value,"is-batch-image-selected":isBatchImageSelected.value,preview:__props.preview,onPreviewImage:_cache[7]||(_cache[7]=$event=>_ctx.$emit("preview-image",$event)),onViewDetails:_cache[8]||(_cache[8]=$event=>_ctx.$emit("view-details",$event)),onCopyLink:_cache[9]||(_cache[9]=$event=>_ctx.$emit("copy-link",$event)),onDownloadImage:_cache[10]||(_cache[10]=$event=>_ctx.$emit("download-image",$event)),onDeleteImage:_cache[11]||(_cache[11]=$event=>_ctx.$emit("delete-image",$event)),onToggleImageVisibility:_cache[12]||(_cache[12]=$event=>_ctx.$emit("toggle-image-visibility",$event)),onToggleImageSelect:_cache[13]||(_cache[13]=$event=>_ctx.$emit("toggle-image-select",$event)),onToggleBatchImageSelect:_cache[14]||(_cache[14]=$event=>_ctx.$emit("toggle-batch-image-select",$event)),onImageDragStart:_cache[15]||(_cache[15]=$event=>_ctx.$emit("image-drag-start")),onImageDragEnd:_cache[16]||(_cache[16]=$event=>_ctx.$emit("image-drag-end",$event)),onImageMoved:_cache[17]||(_cache[17]=$event=>_ctx.$emit("image-moved",$event[0],$event[1])),onImageDeleted:_cache[18]||(_cache[18]=$event=>_ctx.$emit("image-deleted",$event))},null,8,["images","select-mode","batch-mode","is-image-selected","is-batch-image-selected","preview"])):(openBlock(),createBlock(FilesListView,{key:1,images:images.value,"select-mode":__props.selectMode,"batch-mode":__props.batchMode,"is-all-images-selected":isAllImagesSelected.value,"is-image-selected":isImageSelected.value,"is-batch-image-selected":isBatchImageSelected.value,preview:__props.preview,onPreviewImage:_cache[19]||(_cache[19]=$event=>_ctx.$emit("preview-image",$event)),onViewDetails:_cache[20]||(_cache[20]=$event=>_ctx.$emit("view-details",$event)),onCopyLink:_cache[21]||(_cache[21]=$event=>_ctx.$emit("copy-link",$event)),onDownloadImage:_cache[22]||(_cache[22]=$event=>_ctx.$emit("download-image",$event)),onDeleteImage:_cache[23]||(_cache[23]=$event=>_ctx.$emit("delete-image",$event)),onToggleImageSelect:_cache[24]||(_cache[24]=$event=>_ctx.$emit("toggle-image-select",$event)),onToggleBatchImageSelect:_cache[25]||(_cache[25]=$event=>_ctx.$emit("toggle-batch-image-select",$event)),onToggleSelectAllImages:_cache[26]||(_cache[26]=$event=>_ctx.$emit("toggle-select-all-images"))},null,8,["images","select-mode","batch-mode","is-all-images-selected","is-image-selected","is-batch-image-selected","preview"]))])):createCommentVNode("",!0)}}});const FileGrid=_export_sfc(_sfc_main$6,[["__scopeId","data-v-63402a76"]]),_hoisted_1$5={class:"empty-state"},_hoisted_2$4={class:"empty-title"},_hoisted_3$2={class:"empty-desc"},_sfc_main$5=defineComponent({name:"FolderEmptyState",__name:"index",emits:["create-folder"],setup(__props){const{$t}=useTexts();return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$5,[_cache[1]||(_cache[1]=createBaseVNode("div",{class:"empty-icon"},[createBaseVNode("i",{class:"fas fa-folder-open"})],-1)),createBaseVNode("h3",_hoisted_2$4,toDisplayString(unref($t)("folders.emptyState.title")),1),createBaseVNode("p",_hoisted_3$2,toDisplayString(unref($t)("folders.emptyState.description")),1),createVNode(_component_CyberButton,{type:"secondary",icon:"folder-plus",onClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("create-folder"))},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.emptyState.createButton")),1)]),_:1})])}}});const FolderEmptyState=_export_sfc(_sfc_main$5,[["__scopeId","data-v-d3e58687"]]),_hoisted_1$4={class:"mixed-content-panel"},_hoisted_2$3={class:"content-body"},_sfc_main$4=defineComponent({name:"FolderContentView",__name:"index",props:{folders:{},images:{},pagination:{},selectMode:{type:Boolean},batchMode:{type:Boolean},viewMode:{},selectedBatchImages:{},isAllFoldersSelected:{type:Boolean},isAllImagesSelected:{type:Boolean},isFolderSelected:{type:Function},isImageSelected:{type:Function},isBatchImageSelected:{type:Function},preview:{type:Boolean}},emits:["folder-click","folder-double-click","start-batch-mode","cancel-batch-mode","batch-delete","toggle-select-all-images","toggle-select-all-folders","invert-folder-selection","invert-image-selection","toggle-batch-image-select","toggle-image-select","toggle-folder-select","change-view-mode","preview-image","view-details","copy-link","download-image","delete-image","delete-folder","edit-folder","toggle-image-visibility","toggle-folder-visibility","create-folder","folder-drag-start","folder-drag-end","image-drag-start","image-drag-end","image-moved","image-deleted"],setup(__props,{emit:__emit}){return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$3,[__props.folders.length>0?(openBlock(),createBlock(FolderGrid,{key:0,folders:__props.folders,"select-mode":__props.selectMode&&!__props.preview,"is-all-folders-selected":__props.isAllFoldersSelected,"is-folder-selected":__props.isFolderSelected,preview:__props.preview,onFolderClick:_cache[0]||(_cache[0]=$event=>_ctx.$emit("folder-click",$event)),onFolderDoubleClick:_cache[1]||(_cache[1]=$event=>_ctx.$emit("folder-double-click",$event)),onToggleFolderSelect:_cache[2]||(_cache[2]=$event=>_ctx.$emit("toggle-folder-select",$event)),onToggleSelectAllFolders:_cache[3]||(_cache[3]=$event=>_ctx.$emit("toggle-select-all-folders")),onInvertFolderSelection:_cache[4]||(_cache[4]=$event=>_ctx.$emit("invert-folder-selection")),onDeleteFolder:_cache[5]||(_cache[5]=$event=>_ctx.$emit("delete-folder",$event)),onEditFolder:_cache[6]||(_cache[6]=$event=>_ctx.$emit("edit-folder",$event)),onToggleFolderVisibility:_cache[7]||(_cache[7]=(...args)=>_ctx.$emit("toggle-folder-visibility",...args)),onFolderDragStart:_cache[8]||(_cache[8]=$event=>_ctx.$emit("folder-drag-start")),onFolderDragEnd:_cache[9]||(_cache[9]=$event=>_ctx.$emit("folder-drag-end",$event)),onFolderMoved:_cache[10]||(_cache[10]=$event=>_ctx.$emit("folder-moved",$event[0],$event[1]))},null,8,["folders","select-mode","is-all-folders-selected","is-folder-selected","preview"])):createCommentVNode("",!0),__props.images.length>0?(openBlock(),createBlock(FileGrid,{key:1,images:__props.images,pagination:__props.pagination,"select-mode":__props.selectMode&&!__props.preview,"batch-mode":__props.batchMode&&!__props.preview,"view-mode":__props.viewMode,"selected-batch-images":__props.selectedBatchImages,"is-all-images-selected":__props.isAllImagesSelected,"is-image-selected":__props.isImageSelected,"is-batch-image-selected":__props.isBatchImageSelected,preview:__props.preview,onPreviewImage:_cache[11]||(_cache[11]=$event=>_ctx.$emit("preview-image",$event)),onViewDetails:_cache[12]||(_cache[12]=$event=>_ctx.$emit("view-details",$event)),onCopyLink:_cache[13]||(_cache[13]=$event=>_ctx.$emit("copy-link",$event)),onDownloadImage:_cache[14]||(_cache[14]=$event=>_ctx.$emit("download-image",$event)),onDeleteImage:_cache[15]||(_cache[15]=$event=>_ctx.$emit("delete-image",$event)),onToggleImageVisibility:_cache[16]||(_cache[16]=$event=>_ctx.$emit("toggle-image-visibility",$event)),onToggleImageSelect:_cache[17]||(_cache[17]=$event=>_ctx.$emit("toggle-image-select",$event)),onToggleBatchImageSelect:_cache[18]||(_cache[18]=$event=>_ctx.$emit("toggle-batch-image-select",$event)),onToggleSelectAllImages:_cache[19]||(_cache[19]=$event=>_ctx.$emit("toggle-select-all-images")),onInvertImageSelection:_cache[20]||(_cache[20]=$event=>_ctx.$emit("invert-image-selection")),onStartBatchMode:_cache[21]||(_cache[21]=$event=>_ctx.$emit("start-batch-mode")),onCancelBatchMode:_cache[22]||(_cache[22]=$event=>_ctx.$emit("cancel-batch-mode")),onBatchDelete:_cache[23]||(_cache[23]=$event=>_ctx.$emit("batch-delete")),onChangeViewMode:_cache[24]||(_cache[24]=$event=>_ctx.$emit("change-view-mode",$event)),onImageDragStart:_cache[25]||(_cache[25]=$event=>_ctx.$emit("image-drag-start")),onImageDragEnd:_cache[26]||(_cache[26]=$event=>_ctx.$emit("image-drag-end",$event)),onImageMoved:_cache[27]||(_cache[27]=$event=>_ctx.$emit("image-moved",$event[0],$event[1])),onImageDeleted:_cache[28]||(_cache[28]=$event=>_ctx.$emit("image-deleted",$event))},null,8,["images","pagination","select-mode","batch-mode","view-mode","selected-batch-images","is-all-images-selected","is-image-selected","is-batch-image-selected","preview"])):createCommentVNode("",!0),!__props.folders.length&&!__props.images.length?(openBlock(),createBlock(FolderEmptyState,{key:2,onCreateFolder:_cache[29]||(_cache[29]=$event=>_ctx.$emit("create-folder"))})):createCommentVNode("",!0)])]))}});const FolderContentView=_export_sfc(_sfc_main$4,[["__scopeId","data-v-347e75c3"]]),_hoisted_1$3={class:"page-header py-2"},_hoisted_2$2={key:0,class:"header-left"},_hoisted_3$1={class:"page-title"},_hoisted_4$1={class:"header-actions"},_sfc_main$3=defineComponent({name:"PageHeader",__name:"PageHeader",props:{breadcrumbItems:{},folders:{},images:{},currentFolderId:{},selectMode:{type:Boolean}},emits:["breadcrumb-click","navigate-to-upload","show-create-dialog","update:select-mode","update:share-dialog-visible"],setup(__props,{expose:__expose,emit:__emit}){const{$t}=useTexts(),props=__props,layoutStore=useLayoutStore(),isLeftLayout=computed(()=>layoutStore.mode==="left"),topLayoutBreadcrumbItems=computed(()=>props.breadcrumbItems.length===0||props.breadcrumbItems[0].id!==null?[{id:null,name:$t("folders.rootFolder")},...props.breadcrumbItems]:props.breadcrumbItems),emit=__emit,shareButtonRef=ref(),uploadButtonText=computed(()=>{const currentFolder=props.breadcrumbItems;if(currentFolder.length<=1)return $t("folders.pageHeader.upload.default");const currentFolderName=currentFolder[currentFolder.length-1]?.name;return currentFolderName&&currentFolderName.length>8?$t("folders.pageHeader.upload.toFolder",{name:`${currentFolderName.substring(0,6)}...`}):currentFolderName?$t("folders.pageHeader.upload.toFolder",{name:currentFolderName}):$t("folders.pageHeader.upload.default")}),handleBreadcrumbClick=item=>{emit("breadcrumb-click",item)},handleNavigateToUpload=()=>{emit("navigate-to-upload")},handleShowCreateDialog=()=>{emit("show-create-dialog")},handleSelectModeChange=value=>{emit("update:select-mode",value)},handleShareDialogVisibleChange=value=>{emit("update:share-dialog-visible",value)};return __expose({shareButtonRef}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$3,[isLeftLayout.value?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_2$2,[createBaseVNode("h1",_hoisted_3$1,toDisplayString(unref($t)("folders.pageHeader.title")),1),createVNode(FolderBreadcrumb,{items:topLayoutBreadcrumbItems.value,"show-icon":!0,class:"breadcrumb",onClick:handleBreadcrumbClick},null,8,["items"])])),_cache[0]||(_cache[0]=createBaseVNode("div",null,null,-1)),createBaseVNode("div",_hoisted_4$1,[createVNode(ShareButton,{ref_key:"shareButtonRef",ref:shareButtonRef,folders:__props.folders,images:__props.images,"onUpdate:selectMode":handleSelectModeChange,"onUpdate:shareDialogVisible":handleShareDialogVisibleChange},null,8,["folders","images"]),createVNode(_component_CyberButton,{type:"primary",icon:"upload","custom-class":"upload-btn",onClick:handleNavigateToUpload},{default:withCtx(()=>[createTextVNode(toDisplayString(uploadButtonText.value),1)]),_:1}),createVNode(_component_CyberButton,{type:"outlined",icon:"folder-plus","custom-class":"new-folder-btn",onClick:handleShowCreateDialog},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("folders.pageHeader.actions.newFolder")),1)]),_:1})])])}}});const PageHeader=_export_sfc(_sfc_main$3,[["__scopeId","data-v-c9a8509f"]]),_hoisted_1$2={key:0,class:"share-select-tip"},_sfc_main$2=defineComponent({name:"ShareSelectTip",__name:"ShareSelectTip",props:{visible:{type:Boolean}},setup(__props){return(_ctx,_cache)=>__props.visible?(openBlock(),createElementBlock("div",_hoisted_1$2,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-hand-pointer mr-2"},null,-1)),createTextVNode(" "+toDisplayString(_ctx.$t("folders.shareSelectTip.message")),1)])):createCommentVNode("",!0)}});const ShareSelectTip=_export_sfc(_sfc_main$2,[["__scopeId","data-v-3916949e"]]),_hoisted_1$1={class:"delete-confirm-content"},_hoisted_2$1={class:"warning-icon"},_hoisted_3={key:0,class:"fas fa-folder-minus"},_hoisted_4={key:1,class:"fas fa-image"},_hoisted_5={class:"warning-text"},_hoisted_6={key:0,class:"delete-message"},_hoisted_7={key:1,class:"delete-message"},_hoisted_8={class:"warning-note"},_hoisted_9={class:"delete-confirm-content"},_hoisted_10={class:"warning-text"},_hoisted_11={class:"delete-message"},_hoisted_12={class:"warning-note"},_sfc_main$1=defineComponent({name:"DeleteConfirmDialogs",__name:"DeleteConfirmDialogs",props:{deleteDialogVisible:{type:Boolean},deleteType:{},deleteTarget:{},isDeleting:{type:Boolean},batchDeleteDialogVisible:{type:Boolean},selectedBatchImagesCount:{},isBatchDeleting:{type:Boolean}},emits:["update:delete-dialog-visible","update:batch-delete-dialog-visible","confirm-delete","confirm-batch-delete","cancel-delete","cancel-batch-delete"],setup(__props,{emit:__emit}){const{$t}=useTexts(),emit=__emit,handleDeleteDialogUpdate=value=>{emit("update:delete-dialog-visible",value)},handleBatchDeleteDialogUpdate=value=>{emit("update:batch-delete-dialog-visible",value)},handleConfirmDelete=()=>{emit("confirm-delete")},handleConfirmBatchDelete=()=>{emit("confirm-batch-delete")},handleCancelDelete=()=>{emit("cancel-delete")},handleCancelBatchDelete=()=>{emit("cancel-batch-delete")};return(_ctx,_cache)=>{const _component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock(Fragment,null,[createVNode(_component_CyberDialog,{"model-value":__props.deleteDialogVisible,title:__props.deleteType==="folder"?unref($t)("folders.deleteConfirmDialogs.title.folder"):unref($t)("folders.deleteConfirmDialogs.title.file"),width:"420px","max-width":"90vw","show-default-footer":!0,"confirm-text":unref($t)("folders.deleteConfirmDialogs.confirmText"),"cancel-text":unref($t)("actions.cancel"),loading:__props.isDeleting,"onUpdate:modelValue":handleDeleteDialogUpdate,onConfirm:handleConfirmDelete,onCancel:handleCancelDelete},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[__props.deleteType==="folder"?(openBlock(),createElementBlock("i",_hoisted_3)):(openBlock(),createElementBlock("i",_hoisted_4))]),createBaseVNode("div",_hoisted_5,[__props.deleteType==="folder"?(openBlock(),createElementBlock("p",_hoisted_6,toDisplayString(unref($t)("folders.deleteConfirmDialogs.message.folder",{name:__props.deleteTarget?.name})),1)):(openBlock(),createElementBlock("p",_hoisted_7,toDisplayString(unref($t)("folders.deleteConfirmDialogs.message.file",{name:__props.deleteTarget?.display_name})),1)),createBaseVNode("p",_hoisted_8,[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-exclamation-triangle warning-note-icon"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.deleteConfirmDialogs.warning")),1)])])])]),_:1},8,["model-value","title","confirm-text","cancel-text","loading"]),createVNode(_component_CyberDialog,{"model-value":__props.batchDeleteDialogVisible,title:unref($t)("folders.deleteConfirmDialogs.title.batchFile"),width:"420px","max-width":"90vw","show-default-footer":!0,"confirm-text":unref($t)("folders.deleteConfirmDialogs.confirmText"),"cancel-text":unref($t)("actions.cancel"),loading:__props.isBatchDeleting,"onUpdate:modelValue":handleBatchDeleteDialogUpdate,onConfirm:handleConfirmBatchDelete,onCancel:handleCancelBatchDelete},{default:withCtx(()=>[createBaseVNode("div",_hoisted_9,[_cache[2]||(_cache[2]=createBaseVNode("div",{class:"warning-icon"},[createBaseVNode("i",{class:"fas fa-images"})],-1)),createBaseVNode("div",_hoisted_10,[createBaseVNode("p",_hoisted_11,toDisplayString(unref($t)("folders.deleteConfirmDialogs.message.batchFile",{count:__props.selectedBatchImagesCount})),1),createBaseVNode("p",_hoisted_12,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-exclamation-triangle warning-note-icon"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("folders.deleteConfirmDialogs.warning")),1)])])])]),_:1},8,["model-value","title","confirm-text","cancel-text","loading"])],64)}}});const DeleteConfirmDialogs=_export_sfc(_sfc_main$1,[["__scopeId","data-v-2496f601"]]);function useKeyboardEvents(selectMode,shareButtonRef){const handleKeydown=event=>{event.key==="Escape"&&selectMode.value&&(shareButtonRef.value?.cancelSelectMode(),event.preventDefault())};return{handleKeydown,setupKeyboardEvents:()=>{window.addEventListener("keydown",handleKeydown)},cleanupKeyboardEvents:()=>{window.removeEventListener("keydown",handleKeydown)}}}const VIEW_MODE_KEY="folder_view_mode";function useViewMode(){const viewMode=ref(StorageUtil.get(VIEW_MODE_KEY)||"grid");return{viewMode,toggleViewMode:mode=>{viewMode.value=mode,StorageUtil.set(VIEW_MODE_KEY,mode,24*7)}}}function useFileNavigation(){const router=useRouter(),{getFolderPath}=useFolderPath(),currentFolderId=ref(null),breadcrumbItems=ref([]),getRouteNames=()=>({base:"folders",withPath:"foldersWithPath"}),buildCompleteBreadcrumbPath=async folder=>await getFolderPath(folder.id),buildBreadcrumbFromPath=async path=>{if(!path||path==="/"){breadcrumbItems.value=[],currentFolderId.value=null;return}try{const folderIds=path.split("/").filter(id=>id);try{const lastFolderId=folderIds[folderIds.length-1],newBreadcrumbs2=await getFolderPath(lastFolderId);breadcrumbItems.value=newBreadcrumbs2,currentFolderId.value=lastFolderId;return}catch(error){console.warn("[useFileNavigation] Unified path hook failed, falling back to legacy method:",error)}const newBreadcrumbs=[];for(const folderId of folderIds)try{const result=await getFolderDetail(folderId);if(result.success)newBreadcrumbs.push(result.data);else{console.warn(`æ–‡ä»¶å¤¹ ${folderId} èŽ·å–å¤±è´¥`);break}}catch{console.warn(`æ–‡ä»¶å¤¹ ${folderId} ä¸å­˜åœ¨æˆ–æ— æƒè®¿é—®`);break}breadcrumbItems.value=newBreadcrumbs,currentFolderId.value=newBreadcrumbs.length>0?newBreadcrumbs[newBreadcrumbs.length-1].id:null}catch{breadcrumbItems.value=[],currentFolderId.value=null,updateURL()}},updateURL=()=>{const pathSegments=breadcrumbItems.value.map(item=>item.id),routeNames=getRouteNames();if(pathSegments.length===0)router.replace({name:routeNames.base});else{const folderPath=pathSegments.join("/");router.replace({name:routeNames.withPath,params:{folderPath}})}};return{currentFolderId,breadcrumbItems,buildBreadcrumbFromPath,updateURL,navigateToFolder:async folder=>{if(folder===null)currentFolderId.value=null,breadcrumbItems.value=[];else{currentFolderId.value=folder.id;const existingIndex=breadcrumbItems.value.findIndex(item=>item.id===folder.id);existingIndex!==-1?breadcrumbItems.value=breadcrumbItems.value.slice(0,existingIndex+1):breadcrumbItems.value=await buildCompleteBreadcrumbPath(folder)}updateURL()},handleBreadcrumbClick:folder=>{if(folder===null||folder.id===null)currentFolderId.value=null,breadcrumbItems.value=[];else{const index2=breadcrumbItems.value.findIndex(item=>item.id===folder.id);index2!==-1&&(currentFolderId.value=folder.id,breadcrumbItems.value=breadcrumbItems.value.slice(0,index2+1))}updateURL()}}}function useSelectionMode(){const toast=useToast(),{$t}=useTexts(),selectMode=ref(!1),batchMode=ref(!1),selectedBatchFiles=ref([]),isBatchProcessing=ref(!1),startBatchMode=()=>{batchMode.value=!0,selectedBatchFiles.value=[]},cancelBatchMode=()=>{batchMode.value=!1,selectedBatchFiles.value=[],isBatchProcessing.value=!1},isBatchFileSelected=file=>selectedBatchFiles.value.includes(file.id),checkLoginStatus=(requireLogin=!0)=>requireLogin&&!StorageUtil.get(TOKEN_KEY)?(toast.warning($t("common.auth.loginRequired")),!1):!0,toggleBatchFileSelect=file=>{const fileId=file.id,index2=selectedBatchFiles.value.indexOf(fileId);index2>-1?selectedBatchFiles.value.splice(index2,1):selectedBatchFiles.value.push(fileId)},isAllFoldersSelected=computed(()=>_folders=>!1),isAllFilesSelected=computed(()=>files=>batchMode.value?files.length>0&&selectedBatchFiles.value.length===files.length:!1);return{selectMode,batchMode,selectedBatchFiles,isBatchProcessing,startBatchMode,cancelBatchMode,isBatchFileSelected,toggleBatchFileSelect,isAllFoldersSelected,isAllFilesSelected,toggleSelectAllFiles:(files,_requireLogin=!0)=>{batchMode.value&&(selectedBatchFiles.value.length===files.length?selectedBatchFiles.value=[]:selectedBatchFiles.value=files.map(file=>file.id))},invertFileSelection:(files,_requireLogin=!0)=>{if(batchMode.value){const allIds=files.map(file=>file.id);selectedBatchFiles.value=allIds.filter(id=>!selectedBatchFiles.value.includes(id))}},checkLoginStatus}}function useDragSort(){const toast=useToast(),{$t}=useTexts(),isDragging=ref(!1),dragTimeout=ref(null),isFileDragging=ref(!1),fileDragTimeout=ref(null);return{isDragging,isFileDragging,onFolderDragStart:_event=>{isDragging.value=!0},onFolderDragEnd:async(event,folders,currentFolderId,onReloadData)=>{const{oldIndex,newIndex}=event;isDragging.value=!1,oldIndex!==newIndex&&(dragTimeout.value&&clearTimeout(dragTimeout.value),dragTimeout.value=setTimeout(async()=>{try{const orderedFolderIds=folders.map(folder=>folder.id);await reorderFolders({parent_id:currentFolderId||"",folder_ids:orderedFolderIds}),await onReloadData(),toast.success($t("folders.dragSort.folderSortUpdated"))}catch(error){console.error("Folder sort failed:",error),await onReloadData()}},500))},onFileDragStart:_event=>{isFileDragging.value=!0},onFileDragEnd:async(event,files,currentFolderId,onReloadData)=>{const{oldIndex,newIndex}=event;isFileDragging.value=!1,oldIndex!==newIndex&&(fileDragTimeout.value&&clearTimeout(fileDragTimeout.value),fileDragTimeout.value=setTimeout(async()=>{try{const orderedFileIds=files.map(file=>file.id);await reorderFiles({folder_id:currentFolderId||"",file_ids:orderedFileIds}),await onReloadData(),toast.success($t("folders.dragSort.fileSortUpdated"))}catch(error){console.error("File sort failed:",error),await onReloadData()}},500))},cleanup:()=>{dragTimeout.value&&(clearTimeout(dragTimeout.value),dragTimeout.value=null),fileDragTimeout.value&&(clearTimeout(fileDragTimeout.value),fileDragTimeout.value=null)}}}function useFolderManagement(){const toast=useToast(),{$t}=useTexts(),folders=ref([]),images=ref([]),pagination=ref(null),loading=ref(!1),createDialogVisible=ref(!1),deleteDialogVisible=ref(!1),deleteTarget=ref(null),deleteType=ref("folder"),dialogMode=ref("create"),currentFolder=ref(),isDeleting=ref(!1),loadFolders=async currentFolderId=>{try{loading.value=!0;const result=await getFolderListWithImages(currentFolderId);if(result.success){const{data}=result;folders.value=data.folders||[];const files=data.files||data.images||data.items||[];images.value=files,pagination.value=data.pagination}}catch(error){console.error("Load folders failed:",error)}finally{setTimeout(()=>{loading.value=!1},300)}},showCreateDialog=()=>{dialogMode.value="create",currentFolder.value=void 0,createDialogVisible.value=!0},handleEdit=folder=>{dialogMode.value="edit",currentFolder.value=folder,createDialogVisible.value=!0},handleFolderCreated=(folder,currentFolderId)=>{loadFolders(currentFolderId)},handleFolderUpdated=(folder,currentFolderId)=>{loadFolders(currentFolderId)},showDeleteDialog=(target,type)=>{deleteTarget.value=target,deleteType.value=type,deleteDialogVisible.value=!0};return{folders,images,pagination,loading,createDialogVisible,deleteDialogVisible,deleteTarget,deleteType,dialogMode,currentFolder,isDeleting,loadFolders,showCreateDialog,handleEditFolder:handleEdit,handleFolderCreated,handleFolderUpdated,showDeleteDialog,confirmDelete:async currentFolderId=>{if(deleteTarget.value){isDeleting.value=!0;try{deleteType.value==="folder"&&(await deleteFolder(deleteTarget.value.id),toast.success($t("folders.folderManagement.deleteSuccess",{name:deleteTarget.value.name})),loadFolders(currentFolderId))}catch{}finally{isDeleting.value=!1}deleteDialogVisible.value=!1,deleteTarget.value=null}},cancelDelete:()=>{deleteDialogVisible.value=!1,deleteTarget.value=null},handleDeleteFolder:async folder=>{showDeleteDialog(folder,"folder")},handleToggleFolderVisibility:async(folder,event,currentFolderId)=>{event.stopPropagation();try{await visibilityFolder(folder.id);const newVisibility=folder.permission==="public"?$t("folders.folderManagement.visibility.private"):$t("folders.folderManagement.visibility.public");toast.success($t("folders.folderManagement.visibility.switched",{name:folder.name,level:newVisibility})),loadFolders(currentFolderId)}catch{}}}}function useFileManagement(){const toast=useToast(),{$t}=useTexts(),previewDialogVisible=ref(!1),previewImage=ref(null),previewImageIndex=ref(0),detailDialogVisible=ref(!1),detailImage=ref(null),batchDeleteDialogVisible=ref(!1),isBatchDeleting=ref(!1),getImageUrl=(fullPath,accessLevel="private")=>{if(accessLevel==="private"||accessLevel==="protected"){const token=StorageUtil.get(TOKEN_KEY);if(token){const separator=fullPath.includes("?")?"&":"?";return`${fullPath}${separator}token=${token}`}}return fullPath},getOriginalImageUrl=image=>image.full_url?getImageUrl(image.full_url,image.access_level):getImageUrl(image.full_thumb_url,image.access_level);return{previewDialogVisible,previewImage,previewImageIndex,detailDialogVisible,detailImage,batchDeleteDialogVisible,isBatchDeleting,getImageUrl,getOriginalImageUrl,formatFileSize:bytes=>{if(bytes===0)return"0 B";const k=1024,sizes=["B","KB","MB","GB"],i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`},formatDate:dateStr=>{try{const date=new Date(dateStr),month=String(date.getMonth()+1).padStart(2,"0"),day=String(date.getDate()).padStart(2,"0"),hours=String(date.getHours()).padStart(2,"0"),minutes=String(date.getMinutes()).padStart(2,"0");return`${month}-${day} ${hours}:${minutes}`}catch{return dateStr}},handlePreview:(image,images)=>{previewImage.value=image,previewImageIndex.value=images.findIndex(img=>img.id===image.id),previewImageIndex.value===-1&&(previewImageIndex.value=0),previewDialogVisible.value=!0},handlePreviewClose:()=>{previewDialogVisible.value=!1},handleViewDetails:image=>{detailImage.value=image,detailDialogVisible.value=!0},handleDetailClose:()=>{detailDialogVisible.value=!1},handleCopyLink:async image=>{if(image.access_level==="protected"){toast.warning($t("folders.fileManagement.copyLink.protectedNotSupported"));return}const url=getOriginalImageUrl(image);await copyToClipboard(url);const message=image.access_level==="public"?$t("folders.fileManagement.copyLink.publicLinkCopied"):$t("folders.fileManagement.copyLink.privateLinkCopied");toast.success(message)},handleDownload:async image=>{try{const fileName=image?.display_name||image?.original_name||`image_${image.id}`;await downloadFileQuick(image.id,fileName)?toast.success($t("folders.fileManagement.download.success",{name:fileName})):toast.error($t("folders.fileManagement.download.cancelled"))}catch(error){console.error("Download failed:",error)}},handleDeleteImage:async(image,showDeleteDialog)=>{showDeleteDialog(image,"image")},confirmDeleteImage:async(image,onReloadData)=>{try{await deleteFile(image.id),toast.success($t("folders.fileManagement.delete.success",{name:image.display_name})),await onReloadData()}catch{}},handleToggleVisibility:async(image,onReloadData)=>{try{await toggleAccessLevel(image.id);let nextLevel="";switch(image.access_level){case"public":nextLevel=$t("folders.fileManagement.accessLevel.private");break;case"private":nextLevel=$t("folders.fileManagement.accessLevel.protected");break;case"protected":nextLevel=$t("folders.fileManagement.accessLevel.public");break;default:nextLevel=$t("folders.fileManagement.accessLevel.public")}toast.success($t("folders.fileManagement.accessLevel.switched",{name:image.display_name,level:nextLevel})),await onReloadData()}catch{}},confirmBatchDeleteImages:selectedBatchImages=>{if(selectedBatchImages.length===0){toast.info($t("folders.fileManagement.delete.selectFirst"));return}batchDeleteDialogVisible.value=!0},executeBatchDelete:async(selectedBatchImages,onReloadData,cancelBatchMode,setProcessing)=>{if(selectedBatchImages.length!==0){isBatchDeleting.value=!0,setProcessing(!0);try{const response=await batchDeleteFiles(selectedBatchImages),{success_count,fail_count}=response;success_count>0&&fail_count===0?toast.success($t("folders.fileManagement.delete.batchSuccess",{successCount:success_count})):success_count>0&&fail_count>0?toast.success($t("folders.fileManagement.delete.batchPartial",{successCount:success_count,failCount:fail_count})):fail_count>0&&success_count===0&&toast.error($t("folders.fileManagement.delete.batchFailed",{failCount:fail_count})),batchDeleteDialogVisible.value=!1,await onReloadData(),cancelBatchMode()}catch(error){console.error("Batch delete error:",error)}finally{isBatchDeleting.value=!1,setProcessing(!1)}}},cancelBatchDelete:()=>{batchDeleteDialogVisible.value=!1}}}const _hoisted_1={class:"folders-page"},_hoisted_2={class:"content-area"},_sfc_main=defineComponent({name:"FoldersPage",__name:"index",setup(__props){const route=useRoute(),router=useRouter(),breadcrumbStore=useBreadcrumbStore(),viewMode=useViewMode(),navigation=useFileNavigation(),selection=useSelectionMode(),dragSort=useDragSort(),folderManagement=useFolderManagement(),imageManagement=useFileManagement(),shareDialogVisible=ref(!1),pageHeaderRef=ref(),shareButton=computed(()=>pageHeaderRef.value?.shareButtonRef),keyboardEvents=useKeyboardEvents(selection.selectMode,shareButton),{setupKeyboardEvents,cleanupKeyboardEvents}=keyboardEvents,navigateToUpload=()=>{const currentFolderId=navigation.currentFolderId.value;currentFolderId?router.push({path:"/upload",query:{folderId:currentFolderId}}):router.push("/upload")},handleToggleSelectAllImages=()=>{selection.selectMode.value?shareButton.value?.toggleSelectAllImages?.(folderManagement.images.value):selection.toggleSelectAllFiles(folderManagement.images.value)},handleInvertImageSelection=()=>{selection.selectMode.value?shareButton.value?.invertImageSelection?.(folderManagement.images.value):selection.invertFileSelection(folderManagement.images.value)},handleShareCreated=()=>{shareButton.value?.cancelSelectMode(),shareDialogVisible.value=!1},handleSelectModeChange=value=>{selection.selectMode.value=value},confirmDelete=async()=>{if(folderManagement.deleteTarget.value)if(folderManagement.deleteType.value==="folder")await folderManagement.confirmDelete(navigation.currentFolderId.value);else{folderManagement.isDeleting.value=!0;try{await imageManagement.confirmDeleteImage(folderManagement.deleteTarget.value,()=>folderManagement.loadFolders(navigation.currentFolderId.value))}finally{folderManagement.isDeleting.value=!1}folderManagement.deleteDialogVisible.value=!1,folderManagement.deleteTarget.value=null}},executeBatchDelete=async()=>{await imageManagement.executeBatchDelete(selection.selectedBatchFiles.value,()=>folderManagement.loadFolders(navigation.currentFolderId.value),selection.cancelBatchMode,processing=>selection.isBatchProcessing.value=processing)};return watch(()=>navigation.breadcrumbItems.value,newItems=>{breadcrumbStore.setItems(newItems.map(item=>({id:item.id,name:item.name,path:item.id?`/folders/${item.id}`:"/folders"})))},{immediate:!0,deep:!0}),watch(()=>route.params.folderPath,async(newPath,oldPath)=>{if(newPath!==oldPath){const pathString=Array.isArray(newPath)?newPath.join("/"):newPath||"";await navigation.buildBreadcrumbFromPath(pathString),folderManagement.loadFolders(navigation.currentFolderId.value)}},{immediate:!1}),onMounted(async()=>{const{folderPath}=route.params,pathString=Array.isArray(folderPath)?folderPath.join("/"):folderPath||"";pathString&&await navigation.buildBreadcrumbFromPath(pathString),folderManagement.loadFolders(navigation.currentFolderId.value),setupKeyboardEvents()}),onUnmounted(()=>{cleanupKeyboardEvents(),dragSort.cleanup()}),(_ctx,_cache)=>{const _component_CyberFileViewer=resolveComponent("CyberFileViewer"),_component_CyberFileDetailModal=resolveComponent("CyberFileDetailModal");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberFileViewer,{modelValue:unref(imageManagement).previewDialogVisible.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>unref(imageManagement).previewDialogVisible.value=$event),file:unref(imageManagement).previewImage.value,onClose:unref(imageManagement).handlePreviewClose},null,8,["modelValue","file","onClose"]),createVNode(PageHeader,{ref_key:"pageHeaderRef",ref:pageHeaderRef,"breadcrumb-items":unref(navigation).breadcrumbItems.value,folders:unref(folderManagement).folders.value,images:unref(folderManagement).images.value,"current-folder-id":unref(navigation).currentFolderId.value||null,"select-mode":unref(selection).selectMode.value,onBreadcrumbClick:unref(navigation).handleBreadcrumbClick,onNavigateToUpload:navigateToUpload,onShowCreateDialog:unref(folderManagement).showCreateDialog,"onUpdate:selectMode":handleSelectModeChange,"onUpdate:shareDialogVisible":_cache[1]||(_cache[1]=$event=>shareDialogVisible.value=$event)},null,8,["breadcrumb-items","folders","images","current-folder-id","select-mode","onBreadcrumbClick","onShowCreateDialog"]),createVNode(ShareSelectTip,{visible:unref(selection).selectMode.value},null,8,["visible"]),createBaseVNode("div",_hoisted_2,[createVNode(FolderContentView,{folders:unref(folderManagement).folders.value,images:unref(folderManagement).images.value,"select-mode":unref(selection).selectMode.value,"batch-mode":unref(selection).batchMode.value,"view-mode":unref(viewMode).viewMode.value,"selected-batch-images":unref(selection).selectedBatchFiles.value,"is-all-folders-selected":unref(selection).isAllFoldersSelected.value(unref(folderManagement).folders.value),"is-all-images-selected":unref(selection).isAllFilesSelected.value(unref(folderManagement).images.value),"is-folder-selected":shareButton.value?.isFolderSelected,"is-image-selected":shareButton.value?.isImageSelected,"is-batch-image-selected":unref(selection).isBatchFileSelected,onFolderClick:unref(navigation).navigateToFolder,onFolderMoved:_cache[2]||(_cache[2]=()=>unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value)),onFolderDoubleClick:unref(navigation).navigateToFolder,onStartBatchMode:unref(selection).startBatchMode,onCancelBatchMode:unref(selection).cancelBatchMode,onBatchDelete:_cache[3]||(_cache[3]=$event=>unref(imageManagement).confirmBatchDeleteImages(unref(selection).selectedBatchFiles.value)),onToggleSelectAllImages:handleToggleSelectAllImages,onToggleSelectAllFolders:_cache[4]||(_cache[4]=()=>shareButton.value?.toggleSelectAllFolders?.(unref(folderManagement).folders.value)),onInvertFolderSelection:_cache[5]||(_cache[5]=()=>shareButton.value?.invertFolderSelection?.(unref(folderManagement).folders.value)),onInvertImageSelection:handleInvertImageSelection,onToggleBatchImageSelect:unref(selection).toggleBatchFileSelect,onToggleImageSelect:_cache[6]||(_cache[6]=image=>shareButton.value?.toggleImageSelect(image)),onToggleFolderSelect:_cache[7]||(_cache[7]=folder=>shareButton.value?.toggleFolderSelect(folder)),onChangeViewMode:unref(viewMode).toggleViewMode,onPreviewImage:_cache[8]||(_cache[8]=image=>unref(imageManagement).handlePreview(image,unref(folderManagement).images.value)),onViewDetails:unref(imageManagement).handleViewDetails,onCopyLink:unref(imageManagement).handleCopyLink,onDownloadImage:unref(imageManagement).handleDownload,onDeleteImage:_cache[9]||(_cache[9]=image=>unref(imageManagement).handleDeleteImage(image,unref(folderManagement).showDeleteDialog)),onDeleteFolder:_cache[10]||(_cache[10]=folder=>unref(folderManagement).handleDeleteFolder(folder)),onEditFolder:_cache[11]||(_cache[11]=folder=>unref(folderManagement).handleEditFolder(folder)),onToggleImageVisibility:_cache[12]||(_cache[12]=image=>unref(imageManagement).handleToggleVisibility(image,()=>unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value))),onToggleFolderVisibility:_cache[13]||(_cache[13]=(folder,event)=>unref(folderManagement).handleToggleFolderVisibility(folder,event,unref(navigation).currentFolderId.value)),onCreateFolder:unref(folderManagement).showCreateDialog,onFolderDragStart:unref(dragSort).onFolderDragStart,onFolderDragEnd:_cache[14]||(_cache[14]=data=>unref(dragSort).onFolderDragEnd(data.event,data.sortedFolders,unref(navigation).currentFolderId.value,()=>unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value))),onImageDragStart:unref(dragSort).onFileDragStart,onImageDragEnd:_cache[15]||(_cache[15]=data=>unref(dragSort).onFileDragEnd(data.event,data.sortedFiles,unref(navigation).currentFolderId.value,()=>unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value))),onImageMoved:_cache[16]||(_cache[16]=(fileId,targetFolderId)=>{unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value)}),onImageDeleted:_cache[17]||(_cache[17]=fileId=>{unref(folderManagement).loadFolders(unref(navigation).currentFolderId.value)})},null,8,["folders","images","select-mode","batch-mode","view-mode","selected-batch-images","is-all-folders-selected","is-all-images-selected","is-folder-selected","is-image-selected","is-batch-image-selected","onFolderClick","onFolderDoubleClick","onStartBatchMode","onCancelBatchMode","onToggleBatchImageSelect","onChangeViewMode","onViewDetails","onCopyLink","onDownloadImage","onCreateFolder","onFolderDragStart","onImageDragStart"])]),createVNode(CreateFolderDialog,{modelValue:unref(folderManagement).createDialogVisible.value,"onUpdate:modelValue":_cache[18]||(_cache[18]=$event=>unref(folderManagement).createDialogVisible.value=$event),"parent-id":unref(navigation).currentFolderId.value,mode:unref(folderManagement).dialogMode.value,folder:unref(folderManagement).currentFolder.value,onCreated:_cache[19]||(_cache[19]=folder=>unref(folderManagement).handleFolderCreated(folder,unref(navigation).currentFolderId.value)),onUpdated:_cache[20]||(_cache[20]=folder=>unref(folderManagement).handleFolderUpdated(folder,unref(navigation).currentFolderId.value))},null,8,["modelValue","parent-id","mode","folder"]),createVNode(CreateShareDialog,{modelValue:shareDialogVisible.value,"onUpdate:modelValue":_cache[21]||(_cache[21]=$event=>shareDialogVisible.value=$event),"selected-folders":shareButton.value?.selectedFolders||[],"selected-images":shareButton.value?.selectedImages||[],onCreated:handleShareCreated},null,8,["modelValue","selected-folders","selected-images"]),createVNode(DeleteConfirmDialogs,{"delete-dialog-visible":unref(folderManagement).deleteDialogVisible.value,"delete-type":unref(folderManagement).deleteType.value,"delete-target":unref(folderManagement).deleteTarget.value,"is-deleting":unref(folderManagement).isDeleting.value,"batch-delete-dialog-visible":unref(imageManagement).batchDeleteDialogVisible.value,"selected-batch-images-count":unref(selection).selectedBatchFiles.value.length,"is-batch-deleting":unref(imageManagement).isBatchDeleting.value,"onUpdate:deleteDialogVisible":_cache[22]||(_cache[22]=$event=>unref(folderManagement).deleteDialogVisible.value=$event),"onUpdate:batchDeleteDialogVisible":_cache[23]||(_cache[23]=$event=>unref(imageManagement).batchDeleteDialogVisible.value=$event),onConfirmDelete:confirmDelete,onConfirmBatchDelete:executeBatchDelete,onCancelDelete:unref(folderManagement).cancelDelete,onCancelBatchDelete:unref(imageManagement).cancelBatchDelete},null,8,["delete-dialog-visible","delete-type","delete-target","is-deleting","batch-delete-dialog-visible","selected-batch-images-count","is-batch-deleting","onCancelDelete","onCancelBatchDelete"]),createVNode(_component_CyberFileDetailModal,{"model-value":unref(imageManagement).detailDialogVisible.value,fileInfo:unref(imageManagement).detailImage.value,"is-admin":!1,"onUpdate:modelValue":_cache[24]||(_cache[24]=$event=>unref(imageManagement).detailDialogVisible.value=$event),onDownload:_cache[25]||(_cache[25]=$event=>unref(imageManagement).handleDownload(unref(imageManagement).detailImage.value))},null,8,["model-value","fileInfo"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-ff2f4c8c"]]);export{index as default};
