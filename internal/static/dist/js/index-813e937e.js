import{ah as post,x as get,j as useTexts,_ as _export_sfc,a3 as getValidationRules,a6 as Validator,q as useToast,ay as formatDate,X as __unplugin_components_0}from"./index-4d0dab4c.js";import{s as showConfirm}from"./dialog-476153c4.js";import{d as defineComponent,r as ref,w as watch,c as computed,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,ab as createTextVNode,K as createCommentVNode,a as reactive,aa as withKeys,A as createBlock,h,b as onMounted,R as normalizeClass}from"./vue-vendor-31320f47.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const CATEGORY_SORT_BY_VALUES=["sort_order","name","usage_count","created_at"],SORT_ORDER_VALUES=["asc","desc"],CATEGORY_SORT_BY_OPTIONS=CATEGORY_SORT_BY_VALUES.map(value=>({label:`constants.categorySortBy.${value}`,value})),SORT_ORDER_OPTIONS=SORT_ORDER_VALUES.map(value=>({label:`constants.sortOrder.${value}`,value})),CATEGORY_TYPE_OPTIONS=[{label:"constants.categoryType.all",value:void 0},{label:"constants.categoryType.hot",value:!0},{label:"constants.categoryType.normal",value:!1}],DEFAULT_CATEGORY_SORT={sortBy:"sort_order",sortOrder:"asc"};function createTemplate(data){return post("/admin/category-templates/create",data)}function updateTemplate(data){return post("/admin/category-templates/update",data)}function deleteTemplate(data){return post("/admin/category-templates/delete",data)}function getTemplateList(params){return get("/admin/category-templates/list",params)}function batchUpdateSortOrder(data){return post("/admin/category-templates/batch-sort",data)}const _hoisted_1$4={key:0,class:"template-form"},_hoisted_2$4={class:"form-container"},_hoisted_3$4={class:"form-row"},_hoisted_4$4={class:"form-label"},_hoisted_5$3={class:"form-row"},_hoisted_6$3={class:"form-label"},_hoisted_7$3={class:"form-row"},_hoisted_8$3={class:"form-label"},_hoisted_9$3={class:"form-row"},_hoisted_10$3={class:"form-label"},_hoisted_11$2={class:"form-tip"},_hoisted_12$2={class:"form-row"},_hoisted_13$1={class:"form-label"},_hoisted_14$1={class:"form-tip"},_sfc_main$4=defineComponent({name:"TemplateForm",__name:"TemplateForm",props:{modelValue:{}},emits:["update:modelValue"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),formData=ref(null);watch(()=>props.modelValue,newValue=>{formData.value=newValue?{...newValue}:null},{immediate:!0}),watch(formData,newValue=>{emit("update:modelValue",newValue)},{deep:!0});const iconClassToKey=iconClass=>iconClass.replace(/^(fas|far) fa-/,"").replace(/-([a-z])/g,(_,letter)=>letter.toUpperCase()),iconValues=["fas fa-user","fas fa-users","fas fa-baby","fas fa-child","fas fa-mars","fas fa-venus","fas fa-user-circle","far fa-smile","fas fa-mask","fas fa-mountain","fas fa-tree","fas fa-leaf","fas fa-spa","fas fa-seedling","fas fa-sun","fas fa-moon","fas fa-star","fas fa-cloud","fas fa-cloud-rain","fas fa-snowflake","fas fa-water","fas fa-wave-square","fas fa-tint","fas fa-home","fas fa-building","fas fa-city","fas fa-bridge","fas fa-broadcast-tower","fas fa-church","fas fa-school","fas fa-hospital","fas fa-store","fas fa-industry","fas fa-dog","fas fa-cat","fas fa-fish","fas fa-dove","fas fa-horse","fas fa-feather","fas fa-spider","fas fa-bug","fas fa-dragon","fas fa-paw","fas fa-utensils","fas fa-hamburger","fas fa-pizza-slice","fas fa-apple-alt","fas fa-carrot","fas fa-bread-slice","fas fa-cheese","fas fa-coffee","fas fa-wine-glass","fas fa-birthday-cake","fas fa-ice-cream","fas fa-candy-cane","fas fa-car","fas fa-truck","fas fa-motorcycle","fas fa-bicycle","fas fa-plane","fas fa-rocket","fas fa-ship","fas fa-subway","fas fa-train","fas fa-bus","fas fa-book","fas fa-mobile-alt","fas fa-laptop","fas fa-camera","fas fa-music","fas fa-gamepad","fas fa-tools","fas fa-key","fas fa-wallet","fas fa-shopping-bag","fas fa-tshirt","fas fa-shoe-prints","fas fa-glasses","fas fa-clock","fas fa-paint-brush","fas fa-palette","fas fa-cut","fas fa-pencil-alt","fas fa-icons","fas fa-magic","fas fa-drafting-compass","fas fa-image","fas fa-images","fas fa-video","fas fa-football-ball","fas fa-basketball-ball","fas fa-volleyball-ball","fas fa-swimmer","fas fa-running","fas fa-biking","fas fa-skiing","fas fa-dumbbell","fas fa-trophy","fas fa-medal","fas fa-tag","fas fa-folder","fas fa-heart","fas fa-fire","fas fa-bolt","fas fa-eye","fas fa-gift","fas fa-gem","fas fa-crown","fas fa-shield-alt","fas fa-question","fas fa-exclamation","fas fa-ellipsis-h"],categoryIconOptions=computed(()=>iconValues.map(iconClass=>({label:$t(`admin.categories.iconOptions.${iconClassToKey(iconClass)}`),value:iconClass})));return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberIconPicker=resolveComponent("CyberIconPicker"),_component_CyberSwitch=resolveComponent("CyberSwitch");return formData.value?(openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("div",_hoisted_3$4,[createBaseVNode("label",_hoisted_4$4,toDisplayString(unref($t)("admin.categories.form.nameLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.name,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.value.name=$event),placeholder:unref($t)("admin.categories.form.namePlaceholder"),maxlength:50,"show-count":""},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_5$3,[createBaseVNode("label",_hoisted_6$3,toDisplayString(unref($t)("admin.categories.form.descriptionLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.description,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>formData.value.description=$event),type:"textarea",placeholder:unref($t)("admin.categories.form.descriptionPlaceholder"),maxlength:500,rows:3,"show-count":""},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_7$3,[createBaseVNode("label",_hoisted_8$3,toDisplayString(unref($t)("admin.categories.form.iconLabel")),1),createVNode(_component_CyberIconPicker,{modelValue:formData.value.icon,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.value.icon=$event),options:categoryIconOptions.value},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_9$3,[createBaseVNode("label",_hoisted_10$3,toDisplayString(unref($t)("admin.categories.form.sortOrderLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.sort_order,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>formData.value.sort_order=$event),modelModifiers:{number:!0},type:"number",placeholder:unref($t)("admin.categories.form.sortOrderPlaceholder"),min:0,max:9999},null,8,["modelValue","placeholder"]),createBaseVNode("div",_hoisted_11$2,toDisplayString(unref($t)("admin.categories.form.sortOrderTip")),1)]),createBaseVNode("div",_hoisted_12$2,[createBaseVNode("label",_hoisted_13$1,toDisplayString(unref($t)("admin.categories.form.isPopularLabel")),1),createVNode(_component_CyberSwitch,{modelValue:formData.value.is_popular,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>formData.value.is_popular=$event),"true-value":!0,"false-value":!1},{checked:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.form.popularChecked")),1)]),unchecked:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.form.popularUnchecked")),1)]),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_14$1,toDisplayString(unref($t)("admin.categories.form.popularTip")),1)])])])):createCommentVNode("",!0)}}});const TemplateForm=_export_sfc(_sfc_main$4,[["__scopeId","data-v-bbd8ab19"]]),_hoisted_1$3={class:"template-filter-panel"},_hoisted_2$3={class:"filter-container"},_hoisted_3$3={class:"filter-row"},_hoisted_4$3={class:"filter-item"},_hoisted_5$2={class:"filter-label"},_hoisted_6$2={class:"filter-item"},_hoisted_7$2={class:"filter-label"},_hoisted_8$2={class:"filter-item"},_hoisted_9$2={class:"filter-label"},_hoisted_10$2={class:"filter-item"},_hoisted_11$1={class:"filter-label"},_hoisted_12$1={class:"filter-actions"},_sfc_main$3=defineComponent({name:"TemplateFilterPanel",__name:"TemplateFilterPanel",props:{initialFilters:{}},emits:["filter"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,filters=reactive({keyword:props.initialFilters.keyword||"",is_popular:props.initialFilters.is_popular,sort_by:props.initialFilters.sort_by||DEFAULT_CATEGORY_SORT.sortBy,sort_order:props.initialFilters.sort_order||DEFAULT_CATEGORY_SORT.sortOrder}),isPopularOptions=CATEGORY_TYPE_OPTIONS,sortByOptions=CATEGORY_SORT_BY_OPTIONS,sortOrderOptions=SORT_ORDER_OPTIONS,handleFilter=()=>{emit("filter",{...filters})},handleReset=()=>{filters.keyword="",filters.is_popular=void 0,filters.sort_by=DEFAULT_CATEGORY_SORT.sortBy,filters.sort_order=DEFAULT_CATEGORY_SORT.sortOrder,handleFilter()};return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberButton=resolveComponent("CyberButton");return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$3,[createBaseVNode("label",_hoisted_5$2,toDisplayString(unref($t)("admin.categories.filterPanel.keyword")),1),createVNode(_component_CyberInput,{modelValue:filters.keyword,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>filters.keyword=$event),placeholder:unref($t)("admin.categories.filterPanel.keywordPlaceholder"),clearable:"",onKeyup:withKeys(handleFilter,["enter"])},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_6$2,[createBaseVNode("label",_hoisted_7$2,toDisplayString(unref($t)("admin.categories.filterPanel.type")),1),createVNode(_component_CyberDropdown,{modelValue:filters.is_popular,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>filters.is_popular=$event),placeholder:unref($t)("admin.categories.filterPanel.typePlaceholder"),options:unref(isPopularOptions),clearable:""},null,8,["modelValue","placeholder","options"])]),createBaseVNode("div",_hoisted_8$2,[createBaseVNode("label",_hoisted_9$2,toDisplayString(unref($t)("admin.categories.filterPanel.sortBy")),1),createVNode(_component_CyberDropdown,{modelValue:filters.sort_by,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>filters.sort_by=$event),options:unref(sortByOptions)},null,8,["modelValue","options"])]),createBaseVNode("div",_hoisted_10$2,[createBaseVNode("label",_hoisted_11$1,toDisplayString(unref($t)("admin.categories.filterPanel.sortOrder")),1),createVNode(_component_CyberDropdown,{modelValue:filters.sort_order,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>filters.sort_order=$event),options:unref(sortOrderOptions)},null,8,["modelValue","options"])])]),createBaseVNode("div",_hoisted_12$1,[createVNode(_component_CyberButton,{type:"secondary",onClick:handleReset},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-undo mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.filterPanel.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",onClick:handleFilter},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-search mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.filterPanel.filter")),1)]),_:1})])])])}}});const TemplateFilterPanel=_export_sfc(_sfc_main$3,[["__scopeId","data-v-90c62050"]]),_hoisted_1$2={class:"create-template-form"},_hoisted_2$2={class:"form-container"},_hoisted_3$2={class:"form-row"},_hoisted_4$2={class:"form-label"},_hoisted_5$1={class:"form-row"},_hoisted_6$1={class:"form-label"},_hoisted_7$1={class:"form-row"},_hoisted_8$1={class:"form-label"},_hoisted_9$1={class:"form-row"},_hoisted_10$1={class:"form-label"},_hoisted_11={class:"form-tip"},_hoisted_12={class:"form-row"},_hoisted_13={class:"form-label"},_hoisted_14={class:"form-tip"},_hoisted_15={class:"flex justify-end gap-2 p-4"},_sfc_main$2=defineComponent({name:"CreateTemplateDialog",__name:"CreateTemplateDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","template-created"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),loading=ref(!1),formData=ref({name:"",description:"",icon:"",is_popular:!1,sort_order:0}),isOpen=computed({get:()=>props.modelValue,set:value=>emit("update:modelValue",value)}),R=getValidationRules($t),isFormValid=computed(()=>Validator.validate(formData.value.name,[R.required,R.maxLength(50)],$t).valid),iconClassToKey=iconClass=>iconClass.replace(/^(fas|far) fa-/,"").replace(/-([a-z])/g,(_,letter)=>letter.toUpperCase()),iconValues=["fas fa-user","fas fa-users","fas fa-baby","fas fa-child","fas fa-mars","fas fa-venus","fas fa-user-circle","far fa-smile","fas fa-mask","fas fa-mountain","fas fa-tree","fas fa-leaf","fas fa-spa","fas fa-seedling","fas fa-sun","fas fa-moon","fas fa-star","fas fa-cloud","fas fa-cloud-rain","fas fa-snowflake","fas fa-water","fas fa-wave-square","fas fa-tint","fas fa-home","fas fa-building","fas fa-city","fas fa-bridge","fas fa-broadcast-tower","fas fa-church","fas fa-school","fas fa-hospital","fas fa-store","fas fa-industry","fas fa-dog","fas fa-cat","fas fa-fish","fas fa-dove","fas fa-horse","fas fa-feather","fas fa-spider","fas fa-bug","fas fa-dragon","fas fa-paw","fas fa-utensils","fas fa-hamburger","fas fa-pizza-slice","fas fa-apple-alt","fas fa-carrot","fas fa-bread-slice","fas fa-cheese","fas fa-coffee","fas fa-wine-glass","fas fa-birthday-cake","fas fa-ice-cream","fas fa-candy-cane","fas fa-car","fas fa-truck","fas fa-motorcycle","fas fa-bicycle","fas fa-plane","fas fa-rocket","fas fa-ship","fas fa-subway","fas fa-train","fas fa-bus","fas fa-book","fas fa-mobile-alt","fas fa-laptop","fas fa-camera","fas fa-music","fas fa-gamepad","fas fa-tools","fas fa-key","fas fa-wallet","fas fa-shopping-bag","fas fa-tshirt","fas fa-shoe-prints","fas fa-glasses","fas fa-clock","fas fa-paint-brush","fas fa-palette","fas fa-cut","fas fa-pencil-alt","fas fa-icons","fas fa-magic","fas fa-drafting-compass","fas fa-image","fas fa-images","fas fa-video","fas fa-football-ball","fas fa-basketball-ball","fas fa-volleyball-ball","fas fa-swimmer","fas fa-running","fas fa-biking","fas fa-skiing","fas fa-dumbbell","fas fa-trophy","fas fa-medal","fas fa-tag","fas fa-folder","fas fa-heart","fas fa-fire","fas fa-bolt","fas fa-eye","fas fa-gift","fas fa-gem","fas fa-crown","fas fa-shield-alt","fas fa-question","fas fa-exclamation","fas fa-ellipsis-h"],categoryIconOptions=computed(()=>iconValues.map(iconClass=>({label:$t(`admin.categories.iconOptions.${iconClassToKey(iconClass)}`),value:iconClass}))),handleCreate=async()=>{const nameCheck=Validator.validate(formData.value.name,[R.required,R.maxLength(50)],$t);if(!nameCheck.valid){toast.error(nameCheck.message||$t("admin.categories.messages.fillRequired"));return}loading.value=!0;try{const result=await createTemplate(formData.value);result.success&&(toast.success($t("admin.categories.messages.created")),emit("template-created",result.data),isOpen.value=!1,resetForm())}catch{toast.error($t("admin.categories.messages.createFailed"))}loading.value=!1},resetForm=()=>{formData.value={name:"",description:"",icon:"",is_popular:!1,sort_order:0}},handleCancel=()=>{isOpen.value=!1,resetForm()};return watch(()=>props.modelValue,newValue=>{newValue||resetForm()}),(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberIconPicker=resolveComponent("CyberIconPicker"),_component_CyberSwitch=resolveComponent("CyberSwitch"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:isOpen.value,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>isOpen.value=$event),title:unref($t)("admin.categories.createDialog.title"),width:"500px","close-on-click-outside":!1},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_15,[createVNode(_component_CyberButton,{type:"secondary",onClick:handleCancel,disabled:loading.value},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.createDialog.cancel")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{type:"primary",loading:loading.value,disabled:!isFormValid.value,onClick:handleCreate},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.createDialog.create")),1)]),_:1},8,["loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("label",_hoisted_4$2,toDisplayString(unref($t)("admin.categories.form.nameLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.name,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.value.name=$event),placeholder:unref($t)("admin.categories.form.namePlaceholder"),maxlength:50,"show-count":"",disabled:loading.value},null,8,["modelValue","placeholder","disabled"])]),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("label",_hoisted_6$1,toDisplayString(unref($t)("admin.categories.form.descriptionLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.description,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>formData.value.description=$event),type:"textarea",placeholder:unref($t)("admin.categories.form.descriptionPlaceholder"),maxlength:500,rows:3,"show-count":"",disabled:loading.value},null,8,["modelValue","placeholder","disabled"])]),createBaseVNode("div",_hoisted_7$1,[createBaseVNode("label",_hoisted_8$1,toDisplayString(unref($t)("admin.categories.form.iconLabel")),1),createVNode(_component_CyberIconPicker,{modelValue:formData.value.icon,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>formData.value.icon=$event),options:categoryIconOptions.value,disabled:loading.value},null,8,["modelValue","options","disabled"])]),createBaseVNode("div",_hoisted_9$1,[createBaseVNode("label",_hoisted_10$1,toDisplayString(unref($t)("admin.categories.form.sortOrderLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.sort_order,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>formData.value.sort_order=$event),modelModifiers:{number:!0},type:"number",placeholder:unref($t)("admin.categories.form.sortOrderPlaceholder"),min:0,max:9999,disabled:loading.value},null,8,["modelValue","placeholder","disabled"]),createBaseVNode("div",_hoisted_11,toDisplayString(unref($t)("admin.categories.form.sortOrderTipAuto")),1)]),createBaseVNode("div",_hoisted_12,[createBaseVNode("label",_hoisted_13,toDisplayString(unref($t)("admin.categories.form.isPopularLabel")),1),createVNode(_component_CyberSwitch,{modelValue:formData.value.is_popular,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>formData.value.is_popular=$event),"true-value":!0,"false-value":!1,disabled:loading.value},{checked:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.form.popularChecked")),1)]),unchecked:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.form.popularUnchecked")),1)]),_:1},8,["modelValue","disabled"]),createBaseVNode("div",_hoisted_14,toDisplayString(unref($t)("admin.categories.form.popularTip")),1)])])])]),_:1},8,["modelValue","title"])}}});const CreateTemplateDialog=_export_sfc(_sfc_main$2,[["__scopeId","data-v-5068c2b2"]]),_hoisted_1$1={key:0,class:"batch-operations"},_hoisted_2$1={class:"batch-info"},_hoisted_3$1={class:"selection-info"},_hoisted_4$1={class:"batch-actions"},_sfc_main$1=defineComponent({name:"BatchOperations",__name:"BatchOperations",props:{selectedTemplates:{},allTemplates:{}},emits:["clear-selection","batch-completed"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{$t}=useTexts(),toast=useToast(),loading=ref(!1),selectedCount=computed(()=>props.selectedTemplates.length),hasSelection=computed(()=>selectedCount.value>0),selectedTemplateData=computed(()=>props.allTemplates.filter(template=>props.selectedTemplates.includes(template.id))),handleBatchDelete=async()=>{if(!hasSelection.value)return;const confirmText=$t("admin.categories.confirm.deleteMultiple").replace("{count}",String(selectedCount.value));if(showConfirm(confirmText)){loading.value=!0;try{const deletePromises=props.selectedTemplates.map(id=>deleteTemplate({id})),results=await Promise.allSettled(deletePromises),successCount=results.filter(result=>result.status==="fulfilled"&&result.value.success).length,failCount=results.length-successCount;successCount>0&&toast.success($t("admin.categories.batchOperations.deleteSuccess").replace("{count}",String(successCount))),failCount>0&&toast.warning($t("admin.categories.batchOperations.deleteFailed").replace("{count}",String(failCount))),emit("clear-selection"),emit("batch-completed")}catch{toast.error($t("admin.categories.batchOperations.deleteError"))}loading.value=!1}},handleBatchSetPopular=async isPopular=>{if(!hasSelection.value)return;const actionText=$t(isPopular?"admin.categories.batchOperations.actionSetPopular":"admin.categories.batchOperations.actionCancelPopular"),confirmText=$t("admin.categories.confirm.setPopular").replace("{count}",String(selectedCount.value)).replace("{action}",actionText);if(showConfirm(confirmText)){loading.value=!0;try{const updatePromises=props.selectedTemplates.map(id=>updateTemplate({id,is_popular:isPopular})),results=await Promise.allSettled(updatePromises),successCount=results.filter(result=>result.status==="fulfilled"&&result.value.success).length,failCount=results.length-successCount;successCount>0&&toast.success($t("admin.categories.batchOperations.setPopularSuccess").replace("{action}",actionText).replace("{count}",String(successCount))),failCount>0&&toast.warning($t("admin.categories.batchOperations.setPopularFailed").replace("{count}",String(failCount)).replace("{action}",actionText)),emit("clear-selection"),emit("batch-completed")}catch{toast.error($t("admin.categories.batchOperations.setPopularError").replace("{action}",actionText))}loading.value=!1}},handleBatchReorder=async()=>{if(!hasSelection.value)return;const sortOrders=selectedTemplateData.value.map((template,index2)=>({id:template.id,sort_order:(index2+1)*10}));loading.value=!0;try{(await batchUpdateSortOrder({sort_orders:sortOrders})).success&&(toast.success($t("admin.categories.batchOperations.reorderSuccess")),emit("batch-completed"))}catch{toast.error($t("admin.categories.batchOperations.reorderError"))}loading.value=!1};return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton");return hasSelection.value?(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-check-circle mr-2 text-cyan-400"},null,-1)),createBaseVNode("span",null,[createTextVNode(toDisplayString(unref($t)("admin.categories.batchOperations.selected"))+" ",1),createBaseVNode("strong",null,toDisplayString(selectedCount.value),1),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.selectedCount")),1)])]),createBaseVNode("div",_hoisted_4$1,[createVNode(_component_CyberButton,{size:"sm",type:"secondary",disabled:loading.value,onClick:_cache[0]||(_cache[0]=$event=>handleBatchSetPopular(!0))},{default:withCtx(()=>[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-star mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.setPopular")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{size:"sm",type:"secondary",disabled:loading.value,onClick:_cache[1]||(_cache[1]=$event=>handleBatchSetPopular(!1))},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-star-half-alt mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.cancelPopular")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{size:"sm",type:"secondary",disabled:loading.value,onClick:handleBatchReorder},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-sort-numeric-down mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.reorder")),1)]),_:1},8,["disabled"]),createVNode(_component_CyberButton,{size:"sm",type:"danger",loading:loading.value,onClick:handleBatchDelete},{default:withCtx(()=>[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-trash mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.batchDelete")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{size:"sm",type:"secondary",disabled:loading.value,onClick:_cache[2]||(_cache[2]=$event=>emit("clear-selection"))},{default:withCtx(()=>[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-times mr-1.5"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.batchOperations.cancelSelection")),1)]),_:1},8,["disabled"])])])])):createCommentVNode("",!0)}}});const BatchOperations=_export_sfc(_sfc_main$1,[["__scopeId","data-v-e0dbf738"]]),_hoisted_1={class:"admin-categories-page admin-page-container"},_hoisted_2={class:"admin-content-wrapper"},_hoisted_3={class:"table-container"},_hoisted_4={class:"table-wrapper"},_hoisted_5={key:1,class:"empty-state"},_hoisted_6={class:"empty-content animate-slide-up"},_hoisted_7={class:"empty-title"},_hoisted_8={class:"empty-desc"},_hoisted_9={key:0,class:"pagination-wrapper"},_hoisted_10={class:"flex justify-end gap-2 p-4"},_sfc_main=defineComponent({name:"AdminCategories",__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),dataTableColumns=[{key:"name",title:$t("admin.categories.columns.name"),width:200,align:"left",render:(value,record)=>h("div",{class:"flex items-center"},[record.icon?h("i",{class:`${record.icon} mr-2`,style:{color:"var(--color-brand-500)"}}):null,h("div",{},[h("div",{class:"font-medium",style:{color:"var(--color-content-default)"}},record.name),h("div",{class:"text-xs",style:{color:"var(--color-content-muted)"}},`ID: ${record.id}`)])])},{key:"description",title:$t("admin.categories.columns.description"),dataIndex:"description",width:250,align:"left",ellipsis:!0,render:value=>value||$t("admin.categories.status.noDescription")},{key:"sort_order",title:$t("admin.categories.columns.sortOrder"),width:80,align:"center",render:value=>h("span",{class:"font-mono",style:{color:"var(--color-brand-500)"}},value)},{key:"is_popular",title:$t("admin.categories.columns.isPopular"),width:80,align:"center",render:(value,record)=>h("span",{class:"inline-block whitespace-nowrap rounded px-2 py-1 text-xs font-medium",style:record.is_popular?{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)"}:{background:"rgba(var(--color-content-muted-rgb), 0.2)",color:"var(--color-content-muted)"}},record.is_popular?$t("admin.categories.status.popular"):$t("admin.categories.status.normal"))},{key:"usage_count",title:$t("admin.categories.columns.usageCount"),width:100,align:"center",render:value=>h("span",{class:"font-mono",style:{color:"var(--color-success-400)"}},value)},{key:"created_at",title:$t("admin.categories.columns.createdAt"),width:160,align:"center",render:value=>formatDate(value)},{key:"actions",title:$t("admin.categories.columns.actions"),width:120,align:"center",render:(value,record)=>h("div",{class:"action-buttons flex gap-1 justify-center items-center"},[h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs rounded transition-colors focus:outline-none",style:{background:"rgba(var(--color-brand-500-rgb), 0.2)",color:"var(--color-brand-500)",border:"1px solid rgba(var(--color-brand-500-rgb), 0.4)"},title:$t("admin.categories.actions.editTemplate"),onClick:()=>editTemplate(record),onMouseenter:e=>{const target=e.target;target.style.background="rgba(var(--color-brand-500-rgb), 0.3)"},onMouseleave:e=>{const target=e.target;target.style.background="rgba(var(--color-brand-500-rgb), 0.2)"}},[h("i",{class:"fas fa-edit"})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs rounded transition-colors",style:{background:"rgba(var(--color-error-rgb), 0.2)",color:"var(--color-error-400)",border:"1px solid rgba(var(--color-error-rgb), 0.3)"},title:$t("admin.categories.actions.deleteTemplate"),onClick:()=>{showConfirm($t("admin.categories.confirm.deleteOne"))&&deleteTemplateItem(record.id)},onMouseenter:e=>{const target=e.target;target.style.background="rgba(var(--color-error-rgb), 0.3)"},onMouseleave:e=>{const target=e.target;target.style.background="rgba(var(--color-error-rgb), 0.2)"}},[h("i",{class:"fas fa-trash"})])])}],templates=ref([]),loading=ref(!1),saveLoading=ref(!1),totalTemplates=ref(0),currentPage=ref(1),pageSize=ref(10),showFilter=ref(!1),currentFilters=reactive({keyword:"",is_popular:void 0,sort_by:DEFAULT_CATEGORY_SORT.sortBy,sort_order:DEFAULT_CATEGORY_SORT.sortOrder}),showEditDialog=ref(!1),currentEditTemplate=ref(null),showCreateDialog=ref(!1),selectedTemplateIds=ref([]),fetchTemplateList=async()=>{loading.value=!0;const params={page:currentPage.value,size:pageSize.value,keyword:currentFilters.keyword||void 0,is_popular:currentFilters.is_popular,sort_by:currentFilters.sort_by||DEFAULT_CATEGORY_SORT.sortBy,sort_order:currentFilters.sort_order||DEFAULT_CATEGORY_SORT.sortOrder};try{const result=await getTemplateList(params);if(result.success){const{data}=result;templates.value=data.templates,totalTemplates.value=data.total,selectedTemplateIds.value=selectedTemplateIds.value.filter(id=>templates.value.some(template=>template.id===id))}}catch{toast.error($t("admin.categories.messages.fetchFailed"))}loading.value=!1},handleFilter=filters=>{Object.assign(currentFilters,filters),currentPage.value=1,selectedTemplateIds.value=[],fetchTemplateList(),showFilter.value=!1},handlePageChange=page=>{currentPage.value=page,fetchTemplateList()},handlePageSizeChange=size=>{pageSize.value=size,currentPage.value=1,fetchTemplateList()},editTemplate=template=>{currentEditTemplate.value=JSON.parse(JSON.stringify(template)),showEditDialog.value=!0},saveTemplateChanges=async()=>{if(currentEditTemplate.value){saveLoading.value=!0;try{(await updateTemplate({id:currentEditTemplate.value.id,name:currentEditTemplate.value.name,description:currentEditTemplate.value.description,icon:currentEditTemplate.value.icon,is_popular:currentEditTemplate.value.is_popular,sort_order:currentEditTemplate.value.sort_order})).success&&(toast.success($t("admin.categories.messages.updated")),showEditDialog.value=!1,fetchTemplateList())}catch{toast.error($t("admin.categories.messages.updateFailed"))}saveLoading.value=!1}},deleteTemplateItem=async id=>{try{(await deleteTemplate({id})).success&&(toast.success($t("admin.categories.messages.deleted")),fetchTemplateList())}catch{toast.error($t("admin.categories.messages.deleteFailed"))}},handleRefresh=()=>{selectedTemplateIds.value=[],fetchTemplateList()},handleTemplateCreated=_newTemplate=>{fetchTemplateList()},handleBatchCompleted=()=>{fetchTemplateList()},handleSelectionChange=selectedRows=>{selectedTemplateIds.value=selectedRows.map(id=>Number(id))},handleRowClick=(_row,_index)=>{};return onMounted(()=>{fetchTemplateList()}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberSkeleton=__unplugin_components_0,_component_CyberDataTable=resolveComponent("CyberDataTable"),_component_CyberPagination=resolveComponent("CyberPagination"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.categories.title"),subtitle:unref($t)("admin.categories.subtitle"),icon:"fas fa-tags","show-topbar":showFilter.value},{actions:withCtx(()=>[createVNode(_component_CyberButton,{type:"primary",onClick:_cache[0]||(_cache[0]=$event=>showCreateDialog.value=!0)},{default:withCtx(()=>[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-plus mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.buttons.create")),1)]),_:1}),createVNode(_component_CyberButton,{type:"secondary",loading:loading.value,onClick:handleRefresh},{default:withCtx(()=>[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-sync-alt mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.categories.buttons.refresh")),1)]),_:1},8,["loading"]),createVNode(_component_CyberButton,{type:"secondary",class:normalizeClass({"border-brand-400 text-brand-400":showFilter.value}),onClick:_cache[1]||(_cache[1]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-filter mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.categories.buttons.filter")),1)]),_:1},8,["class"])]),topbar:withCtx(()=>[createVNode(TemplateFilterPanel,{"initial-filters":currentFilters,onFilter:handleFilter},null,8,["initial-filters"])]),content:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(BatchOperations,{"selected-templates":selectedTemplateIds.value,"all-templates":templates.value,onClearSelection:_cache[2]||(_cache[2]=()=>selectedTemplateIds.value=[]),onBatchCompleted:handleBatchCompleted},null,8,["selected-templates","all-templates"]),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createVNode(_component_CyberSkeleton,{type:"table",count:pageSize.value,loading:loading.value},null,8,["count","loading"]),!loading.value&&templates.value.length>0?(openBlock(),createBlock(_component_CyberDataTable,{key:0,data:templates.value,columns:dataTableColumns,loading:loading.value,selectable:!0,hoverable:!0,striped:!0,bordered:!0,size:"small","row-key":"id","selected-row-keys":selectedTemplateIds.value,"loading-text":unref($t)("admin.categories.loading.table"),"onUpdate:selectedRowKeys":handleSelectionChange,onRowClick:handleRowClick},null,8,["data","loading","selected-row-keys","loading-text"])):createCommentVNode("",!0),!loading.value&&templates.value.length===0?(openBlock(),createElementBlock("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[_cache[11]||(_cache[11]=createBaseVNode("div",{class:"empty-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-tags empty-icon"})],-1)),createBaseVNode("h3",_hoisted_7,toDisplayString(unref($t)("admin.categories.empty.title")),1),createBaseVNode("p",_hoisted_8,toDisplayString(unref($t)("admin.categories.empty.description")),1)])])):createCommentVNode("",!0)]),totalTemplates.value>0?(openBlock(),createElementBlock("div",_hoisted_9,[createVNode(_component_CyberPagination,{"current-page":currentPage.value,"onUpdate:currentPage":[_cache[3]||(_cache[3]=$event=>currentPage.value=$event),handlePageChange],total:totalTemplates.value,"page-size":pageSize.value,"show-page-size-selector":!0,"show-quick-jumper":!0,class:"compact-pagination","onUpdate:pageSize":handlePageSizeChange},null,8,["current-page","total","page-size"])])):createCommentVNode("",!0)])])]),_:1},8,["title","subtitle","show-topbar"]),createVNode(_component_CyberDialog,{modelValue:showEditDialog.value,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>showEditDialog.value=$event),title:unref($t)("admin.categories.dialogs.edit"),width:"500px"},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_10,[createVNode(_component_CyberButton,{type:"secondary",onClick:_cache[5]||(_cache[5]=$event=>showEditDialog.value=!1)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.buttons.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",loading:saveLoading.value,onClick:saveTemplateChanges},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.categories.buttons.save")),1)]),_:1},8,["loading"])])]),default:withCtx(()=>[createVNode(TemplateForm,{modelValue:currentEditTemplate.value,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>currentEditTemplate.value=$event)},null,8,["modelValue"])]),_:1},8,["modelValue","title"]),createVNode(CreateTemplateDialog,{modelValue:showCreateDialog.value,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>showCreateDialog.value=$event),onTemplateCreated:handleTemplateCreated},null,8,["modelValue"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-abaabf5d"]]);export{index as default};
