import{j as useTexts,Y as __unplugin_components_0,_ as _export_sfc,i as useLayoutStore,e as getGlobalSettings,q as useToast,K as getFileList,Z as StorageUtil,$ as TOKEN_KEY,a0 as userVectorSearch,r as downloadFileQuick,X as __unplugin_components_0$1,a1 as deleteFile,a2 as toggleAccessLevel}from"./index-38202212.js";import{d as defineComponent,a as reactive,r as ref,w as watch,c as computed,b as onMounted,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,ab as createTextVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,K as createCommentVNode,n as nextTick,G as resolveDirective,A as createBlock,H as withDirectives,a5 as withModifiers,R as normalizeClass,a6 as Transition,F as Fragment,M as renderList,a4 as useRoute,a3 as useRouter,$ as vShow}from"./vue-vendor-31320f47.js";import{u as useResponsivePageSize}from"./useResponsivePageSize-3b6a8f45.js";import{d as getUserTagList,e as getUserColorList,f as getUserCategoryList}from"./index-1b22a359.js";import{g as getFilterSortOptions,a as getResolutionOptions}from"./filterOptions-1ed3ac9a.js";/* empty css                                                           */import{S as ShareButton,C as CreateShareDialog}from"./CreateShareDialog-bb8441b2.js";import{C as CompactSearchBar,E as EmptyState}from"./EmptyState-6f627873.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";import"./index-33da10ff.js";import"./clipboard-b54d9428.js";const _hoisted_1$2={class:"mb-4 rounded-lg border border-subtle bg-background-600 p-3"},_hoisted_2$2={class:"mb-3 flex items-center justify-between"},_hoisted_3$2={class:"text-base font-bold text-content-heading"},_hoisted_4$2={class:"flex space-x-1.5"},_hoisted_5$2={class:"grid grid-cols-1 gap-x-3 gap-y-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},_hoisted_6$2={class:"filter-item"},_hoisted_7$2={class:"mb-0.5 block text-xs text-content"},_hoisted_8$2={class:"filter-item"},_hoisted_9$2={class:"mb-0.5 block text-xs text-content"},_hoisted_10$2={class:"filter-item"},_hoisted_11$2={class:"mb-0.5 block text-xs text-content"},_hoisted_12$2={class:"filter-item"},_hoisted_13$2={class:"mb-0.5 block text-xs text-content"},_hoisted_14$1={key:0,class:"mt-2 grid grid-cols-1 gap-x-3 gap-y-2 sm:grid-cols-2 md:grid-cols-3"},_sfc_main$3=defineComponent({__name:"FileFilterPanel",emits:["filter"],setup(__props,{emit:__emit}){const emit=__emit,{$t}=useTexts(),filterForm=reactive({keyword:"",access_level:"all",sort:"newest",resolution:"",tags:"",categoryId:"",dominant_color:"",min_width:void 0,min_height:void 0}),showAdvanced=ref(!1),selectedColors=ref([]),selectedTags=ref([]),selectedCategories=ref([]);watch(selectedColors,(newVal,oldVal)=>{newVal.length>oldVal.length&&nextTick(()=>{scrollToLatestSelection(".selected-tags")}),filterForm.dominant_color=selectedColors.value.join(",")},{deep:!0}),watch(selectedTags,(newVal,oldVal)=>{newVal.length>oldVal.length&&nextTick(()=>{scrollToLatestSelection(".selected-tags")}),filterForm.tags=selectedTags.value.join(",")},{deep:!0}),watch(selectedCategories,(newVal,oldVal)=>{newVal.length>oldVal.length&&nextTick(()=>{scrollToLatestSelection(".selected-tags")}),filterForm.categoryId=selectedCategories.value.join(",")},{deep:!0});const scrollToLatestSelection=selector=>{document.querySelectorAll(selector).forEach(container=>{container&&(container.scrollLeft=container.scrollWidth)})},accessLevelOptions=computed(()=>[{label:$t("resource.filter.accessLevel.all"),value:"all"},{label:$t("resource.filter.accessLevel.public"),value:"public"},{label:$t("resource.filter.accessLevel.private"),value:"private"},{label:$t("resource.filter.accessLevel.protected"),value:"protected"}]);computed(()=>getFilterSortOptions($t));const resolutionOptions=computed(()=>getResolutionOptions($t)),tags=ref([]),tagOptions=computed(()=>tags.value?.map(tag=>({label:`${tag.name}`,value:tag.name}))||[]),colors=ref([]);computed(()=>colors.value?.map(color=>({label:color,value:color,color}))||[]);const categories=ref([]),categoryOptions=computed(()=>categories.value?.map(category=>({label:`${category.name} (${category.file_count})`,value:String(category.id)}))||[]),loadTags=async()=>{try{const result=await getUserTagList();result.success&&result.data&&(tags.value=result.data.items||[])}catch(error2){console.error("Failed to load tags:",error2)}},loadColors=async()=>{try{const result=await getUserColorList();result.success&&result.data&&(colors.value=result.data.items||[])}catch(error2){console.error("Failed to load colors:",error2)}},loadCategories=async()=>{try{const result=await getUserCategoryList();result.success&&result.data&&(categories.value=result.data.items||[])}catch(error2){console.error("Failed to load categories:",error2)}},applyFilter=()=>{emit("filter",{...filterForm})},resetFilter=()=>{filterForm.keyword="",filterForm.access_level="all",filterForm.sort="newest",filterForm.resolution="",filterForm.tags="",filterForm.categoryId="",filterForm.dominant_color="",filterForm.min_width=void 0,filterForm.min_height=void 0,selectedColors.value=[],selectedTags.value=[],selectedCategories.value=[],emit("filter",{...filterForm})};return onMounted(()=>{loadTags(),loadColors(),loadCategories()}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberDropdown=resolveComponent("CyberDropdown");return openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("h3",_hoisted_3$2,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-filter mr-1.5 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("resource.filter.title")),1)]),createBaseVNode("div",_hoisted_4$2,[createVNode(_component_CyberButton,{type:"secondary",class:"px-2 py-1 text-xs",onClick:resetFilter},{default:withCtx(()=>[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-undo-alt mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("resource.filter.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",class:"px-2 py-1 text-xs",onClick:applyFilter},{default:withCtx(()=>[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-search mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("resource.filter.apply")),1)]),_:1})])]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$2,[createBaseVNode("label",_hoisted_7$2,toDisplayString(unref($t)("resource.filter.accessLevelLabel")),1),createVNode(_component_CyberDropdown,{modelValue:filterForm.access_level,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>filterForm.access_level=$event),options:accessLevelOptions.value,placeholder:unref($t)("resource.filter.accessLevel.all"),class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_8$2,[createBaseVNode("label",_hoisted_9$2,toDisplayString(unref($t)("resource.filter.categoryLabel")),1),createVNode(_component_CyberDropdown,{modelValue:selectedCategories.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>selectedCategories.value=$event),options:categoryOptions.value,placeholder:unref($t)("resource.filter.categoryPlaceholder"),multiple:"",searchable:"",class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_10$2,[createBaseVNode("label",_hoisted_11$2,toDisplayString(unref($t)("resource.filter.tagLabel")),1),createVNode(_component_CyberDropdown,{modelValue:selectedTags.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>selectedTags.value=$event),options:tagOptions.value,placeholder:unref($t)("resource.filter.tagPlaceholder"),multiple:"",searchable:"",class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_12$2,[createBaseVNode("label",_hoisted_13$2,toDisplayString(unref($t)("resource.filter.resolutionLabel")),1),createVNode(_component_CyberDropdown,{modelValue:filterForm.resolution,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>filterForm.resolution=$event),options:resolutionOptions.value,placeholder:unref($t)("resource.filter.resolutionPlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])])]),showAdvanced.value?(openBlock(),createElementBlock("div",_hoisted_14$1)):createCommentVNode("",!0)])}}}),_hoisted_1$1={key:1,class:"selected-indicator"},_hoisted_2$1={class:"image-thumbnail"},_hoisted_3$1={key:2,class:"image-hover-overlay"},_hoisted_4$1={class:"hover-actions"},_hoisted_5$1=["title"],_hoisted_6$1=["title"],_hoisted_7$1=["title"],_hoisted_8$1=["title"],_hoisted_9$1={class:"image-info"},_hoisted_10$1=["title"],_hoisted_11$1={class:"image-meta"},_hoisted_12$1={class:"image-size"},_hoisted_13$1={key:0,class:"image-dimensions"},_sfc_main$2=defineComponent({__name:"FileCard",props:{imageData:{},selectMode:{type:Boolean},isSelected:{type:Boolean},isVectorSearch:{type:Boolean}},emits:["view","copy","download","delete","visibility","details","select"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,isImageLoading=ref(!1),handleClick=_event=>{props.selectMode?emit("select",props.imageData):emit("view",props.imageData.id)},handleToggleVisibility=()=>{emit("visibility",props.imageData.id,props.imageData.access_level)},formatFileSize=bytes=>{if(bytes===0)return"0 B";const k=1024,sizes=["B","KB","MB","GB"],i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`};return(_ctx,_cache)=>{const _component_CyberBadge=resolveComponent("CyberBadge"),_component_CyberFile=resolveComponent("CyberFile"),_component_CyberAccessLevelToggle=resolveComponent("CyberAccessLevelToggle"),_component_DuplicateBadge=__unplugin_components_0,_directive_loading=resolveDirective("loading");return openBlock(),createElementBlock("div",{class:normalizeClass(["image-card",{selected:__props.isSelected,"select-mode":__props.selectMode}]),onClick:handleClick},[__props.isVectorSearch&&__props.imageData.similarity!==void 0?(openBlock(),createBlock(_component_CyberBadge,{key:0,text:__props.imageData.similarity?.toFixed(2),color:"var(--color-badge-primary-bg)",position:"top-left"},null,8,["text"])):__props.selectMode&&__props.isSelected?(openBlock(),createElementBlock("div",_hoisted_1$1,[..._cache[5]||(_cache[5]=[createBaseVNode("i",{class:"fas fa-check"},null,-1)])])):createCommentVNode("",!0),withDirectives((openBlock(),createElementBlock("div",_hoisted_2$1,[createVNode(_component_CyberFile,{src:__props.imageData.full_thumb_url,alt:__props.imageData.display_name,"fit-mode":"contain","maintain-aspect-ratio":!0,"retry-count":2,"is-nsfw":__props.imageData.is_nsfw,"error-text":_ctx.$t("resource.fileCard.loadError"),class:"image-thumbnail-img",onLoading:_cache[0]||(_cache[0]=$event=>isImageLoading.value=$event)},null,8,["src","alt","is-nsfw","error-text"]),__props.selectMode?createCommentVNode("",!0):(openBlock(),createBlock(_component_CyberAccessLevelToggle,{key:0,"access-level":__props.imageData.access_level,type:"image",size:"medium",onToggle:handleToggleVisibility},null,8,["access-level"])),__props.imageData.is_duplicate?(openBlock(),createBlock(_component_DuplicateBadge,{key:1,position:"top-left",icon:"fas fa-clone",text:_ctx.$t("resource.fileCard.duplicate")},null,8,["text"])):createCommentVNode("",!0),__props.selectMode?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4$1,[__props.imageData.ai_info?(openBlock(),createElementBlock("button",{key:0,class:"cyber-action-btn info-btn",title:_ctx.$t("resource.fileCard.aiInfo"),onClick:_cache[1]||(_cache[1]=withModifiers($event=>_ctx.$emit("details",__props.imageData.id),["stop"]))},[..._cache[6]||(_cache[6]=[createBaseVNode("i",{class:"fas fa-info-circle"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_5$1)):createCommentVNode("",!0),createBaseVNode("button",{class:"cyber-action-btn preview-btn",title:_ctx.$t("resource.fileCard.preview"),onClick:_cache[2]||(_cache[2]=withModifiers($event=>_ctx.$emit("view",__props.imageData.id),["stop"]))},[..._cache[7]||(_cache[7]=[createBaseVNode("i",{class:"fas fa-eye"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_6$1),createBaseVNode("button",{class:"cyber-action-btn copy-btn",title:_ctx.$t("resource.fileCard.copyLink"),onClick:_cache[3]||(_cache[3]=withModifiers($event=>_ctx.$emit("copy",__props.imageData),["stop"]))},[..._cache[8]||(_cache[8]=[createBaseVNode("i",{class:"fas fa-link"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_7$1),createBaseVNode("button",{class:"cyber-action-btn download-btn",title:_ctx.$t("resource.fileCard.download"),onClick:_cache[4]||(_cache[4]=withModifiers($event=>_ctx.$emit("download",__props.imageData.id,__props.imageData),["stop"]))},[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-download"},null,-1),createBaseVNode("div",{class:"cyber-btn-glow"},null,-1)])],8,_hoisted_8$1)])]))])),[[_directive_loading,isImageLoading.value]]),createBaseVNode("div",_hoisted_9$1,[createBaseVNode("div",{class:"image-name",title:__props.imageData.display_name},toDisplayString(__props.imageData.display_name),9,_hoisted_10$1),createBaseVNode("div",_hoisted_11$1,[createBaseVNode("span",_hoisted_12$1,toDisplayString(formatFileSize(__props.imageData.size)),1),__props.imageData.width&&__props.imageData.height?(openBlock(),createElementBlock("span",_hoisted_13$1,toDisplayString(__props.imageData.width)+"x"+toDisplayString(__props.imageData.height),1)):createCommentVNode("",!0)])])],2)}}});const FileCard=_export_sfc(_sfc_main$2,[["__scopeId","data-v-8d8bb369"]]),_sfc_main$1=defineComponent({__name:"FileModals",props:{showDetailModal:{type:Boolean,default:!1},selectedImage:{type:Object,default:null}},emits:["update:showDetailModal","download"],setup(__props,{emit:__emit}){const props=__props,emit=__emit;return computed({get:()=>props.showDetailModal,set:value=>emit("update:showDetailModal",value)}),(_ctx,_cache)=>{const _component_CyberFileDetailModal=resolveComponent("CyberFileDetailModal");return openBlock(),createElementBlock("div",null,[createVNode(_component_CyberFileDetailModal,{"model-value":__props.showDetailModal,fileInfo:__props.selectedImage,"is-admin":!1,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>_ctx.$emit("update:showDetailModal",$event)),onDownload:_cache[1]||(_cache[1]=$event=>_ctx.$emit("download",__props.selectedImage?.id))},null,8,["model-value","fileInfo"])])}}}),_hoisted_1={class:"resource-container"},_hoisted_2={class:"mb-3 flex items-center justify-between"},_hoisted_3={class:"page-title text-xl font-bold"},_hoisted_4={class:"flex items-center space-x-2"},_hoisted_5={key:0,class:"mb-3 flex items-center justify-between px-1 text-xs"},_hoisted_6={class:"flex items-center gap-2"},_hoisted_7=["innerHTML"],_hoisted_8={key:0,class:"flex items-center gap-2"},_hoisted_9=["title"],_hoisted_10=["title"],_hoisted_11={key:1,class:"mb-4 flex items-center justify-center py-8"},_hoisted_12={key:2,class:"mb-4"},_hoisted_13={key:0,class:"images-grid"},_hoisted_14={key:1,class:"images-grid relative"},_hoisted_15={key:0,class:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-background-800 backdrop-blur-sm"},_hoisted_16={class:"pointer-events-auto text-center"},_hoisted_17={class:"mb-2"},_hoisted_18={key:2,class:"mt-6 flex justify-center"},_sfc_main=defineComponent({__name:"index",setup(__props){const showFilter=ref(!1),route=useRoute(),router=useRouter(),layoutStore=useLayoutStore(),toast=useToast(),{$t}=useTexts(),isLoading=ref(!1),currentPage=ref(1),showSkeleton=ref(!1),images=ref([]),pagination=ref({total:0,size:18,current_page:1,last_page:1}),{pageSize:autoPageSize,recalc}=useResponsivePageSize({containerSelector:".resource-container",gridSelector:".images-grid",childSelector:void 0,itemMinWidth:200,columnGap:15,rowMultiple:3,defaultSize:18,preferCssColumns:!0,debug:!1,mode:"once"}),pageSizeOptions=computed(()=>{const base=autoPageSize.value||pagination.value.size||18,list=[base,base*2,base*3,base*20].map(n=>Math.max(1,Math.floor(n)));return Array.from(new Set(list)).sort((a,b)=>a-b)});watch(()=>pagination.value.size,(newSize,oldSize)=>{newSize!==oldSize&&(currentPage.value=1,filterParams.size=newSize,loadImages())});const searchKeyword=ref(""),searchMode=ref("vector"),isSearching=ref(!1),isVectorSearchMode=ref(!1),lastVectorSearchQuery=ref(""),filterParams=reactive({page:1,size:18,access_level:"",sort:"newest",keyword:"",tags:"",categoryId:"",dominant_color:"",resolution:"",min_width:void 0,min_height:void 0}),showFilePreview=ref(!1),showDetailModal=ref(!1);ref(null);const selectedImageDetails=ref(null),shareDialogVisible=ref(!1),shareButton=ref(),currentPreviewIndex=ref(0),selectMode=ref(!1),handleSelectModeChange=value=>{selectMode.value=value},isImageSelected=image=>shareButton.value?.isImageSelected?.(image),handleImageSelect=image=>{shareButton.value?.toggleImageSelect(image)},loadImages=async()=>{isLoading.value=!0,showSkeleton.value=!0;const params={page:currentPage.value,size:pagination.value.size,access_level:filterParams.visibility==="all"?"":filterParams.visibility,sort:filterParams.sort,keyword:filterParams.keyword,tags:filterParams.tags,categoryId:filterParams.categoryId,dominant_color:filterParams.dominant_color,resolution:filterParams.resolution,min_width:filterParams.min_width,min_height:filterParams.min_height};try{const result=await getFileList(params);if(result.success){const{data}=result,token=StorageUtil.get(TOKEN_KEY);if(!data?.items)return;images.value=data.items.map(image=>{let processedImage=image;if(image.access_level==="private"&&token){const separator=image.full_url.includes("?")?"&":"?";processedImage={...image,full_url:`${image.full_url}${separator}token=${token}`,full_thumb_url:`${image.full_thumb_url}${separator}token=${token}`}}return processedImage.ai_info?.description&&(processedImage.description=processedImage.ai_info.description),processedImage}),pagination.value=data.pagination}}catch{}finally{isLoading.value=!1,showSkeleton.value=!1}},handleFilter=newFilters=>{Object.assign(filterParams,newFilters),currentPage.value=1,isVectorSearchMode.value?clearVectorSearch():loadImages(),showFilter.value=!1},handleSearch=async payload=>{const{keyword,mode}=payload,query=keyword.trim();if(!query){searchKeyword.value="",searchMode.value=mode,isVectorSearchMode.value=!1,resetFilter();return}searchKeyword.value=keyword,searchMode.value=mode,currentPage.value=1,mode==="vector"?await handleVectorSearch(query):await handleNormalSearch(query)},handleNormalSearch=async query=>{isSearching.value=!0,isLoading.value=!0,showSkeleton.value=!0,isVectorSearchMode.value=!1,images.value=[],filterParams.keyword=query,await loadImages(),isSearching.value=!1},handleVectorSearch=async query=>{isSearching.value=!0,isLoading.value=!0,showSkeleton.value=!0,images.value=[];try{const result=await userVectorSearch({query,page:currentPage.value});if(result&&result.data){const{data}=result,token=StorageUtil.get(TOKEN_KEY);data.items&&Array.isArray(data.items)&&data.items.length>0?(images.value=data.items.map(item=>{const processedImage={...item};if(processedImage.access_level==="private"&&token){const separator=processedImage.full_url?.includes("?")?"&":"?";processedImage.full_url&&(processedImage.full_url=`${processedImage.full_url}${separator}token=${token}`),processedImage.full_thumb_url&&(processedImage.full_thumb_url=`${processedImage.full_thumb_url}${separator}token=${token}`)}return processedImage.ai_info?.description&&(processedImage.description=processedImage.ai_info.description),item.similarity!==void 0&&(processedImage.similarity=item.similarity),processedImage}),pagination.value=data.pagination,isVectorSearchMode.value=!0,lastVectorSearchQuery.value=query,toast.success($t("resource.toast.vectorSearchSuccess",{count:data.pagination.total}))):(images.value=[],pagination.value={total:0,size:pagination.value.size,current_page:1,last_page:1},isVectorSearchMode.value=!0,lastVectorSearchQuery.value=query,toast.info($t("resource.toast.vectorSearchEmpty")))}else images.value=[],pagination.value={total:0,size:pagination.value.size,current_page:1,last_page:1},toast.info($t("resource.toast.vectorSearchEmpty"))}catch{images.value=[],toast.error($t("resource.toast.vectorSearchFailed"))}finally{isSearching.value=!1,isLoading.value=!1,showSkeleton.value=!1}},handleVectorSearchPageChange=async page=>{if(!(!isVectorSearchMode.value||!lastVectorSearchQuery.value)){currentPage.value=page,isLoading.value=!0,showSkeleton.value=!0;try{const result=await userVectorSearch({query:lastVectorSearchQuery.value,page});if(result&&result.data&&result.data.items){const{data}=result,token=StorageUtil.get(TOKEN_KEY);images.value=data.items.map(item=>{const processedImage={...item};if(processedImage.access_level==="private"&&token){const separator=processedImage.full_url?.includes("?")?"&":"?";processedImage.full_url&&(processedImage.full_url=`${processedImage.full_url}${separator}token=${token}`),processedImage.full_thumb_url&&(processedImage.full_thumb_url=`${processedImage.full_thumb_url}${separator}token=${token}`)}return processedImage.ai_info?.description&&(processedImage.description=processedImage.ai_info.description),item.similarity!==void 0&&(processedImage.similarity=item.similarity),processedImage}),pagination.value=data.pagination}}catch{toast.error($t("resource.toast.loadFailed"))}finally{isLoading.value=!1,showSkeleton.value=!1}}},resetFilter=()=>{Object.assign(filterParams,{page:1,size:18,visibility:"",sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",min_width:void 0,min_height:void 0}),currentPage.value=1,loadImages()},handlePageChange=page=>{currentPage.value=page,isVectorSearchMode.value?handleVectorSearchPageChange(page):loadImages()},viewImage=id=>{const imageIndex=images.value.findIndex(img=>img.id===id);imageIndex!==-1&&(currentPreviewIndex.value=imageIndex,selectedImageDetails.value=images.value[imageIndex],showFilePreview.value=!0)},handlePreviewChange=index2=>{index2<0||index2>=images.value.length||(currentPreviewIndex.value=index2,selectedImageDetails.value=images.value[index2])},handlePrevImage=()=>{currentPreviewIndex.value>0&&handlePreviewChange(currentPreviewIndex.value-1)},handleNextImage=()=>{currentPreviewIndex.value<images.value.length-1&&handlePreviewChange(currentPreviewIndex.value+1)},handleImageChange=(image,index2)=>{handlePreviewChange(index2)},handleShareCreated=()=>{shareButton.value?.cancelSelectMode(),shareDialogVisible.value=!1,toast.success($t("resource.toast.shareCreated"))},handleCopyLink=async image=>{if(image.access_level==="protected"){toast.warning($t("resource.toast.protectedFileWarning"));return}let url=image.full_url;if(image.access_level==="private"){const token=StorageUtil.get(TOKEN_KEY);token&&(url=`${url}?token=${token}`)}await navigator.clipboard.writeText(url);const message=image.access_level==="public"?$t("resource.toast.publicLinkCopied"):$t("resource.toast.privateLinkCopied");toast.success(message)},handleDownload=async(fileId,image)=>{try{const fileName=image?.display_name||image?.original_name||`image_${fileId}`;await downloadFileQuick(fileId,fileName)?toast.success($t("resource.toast.downloadSuccess",{fileName})):toast.error($t("resource.toast.downloadCancelled"))}catch{toast.error($t("resource.toast.downloadFailed"))}},deleteImage=async id=>{isLoading.value=!0;try{(await deleteFile(id)).success&&(toast.success($t("resource.toast.deleteSuccess")),loadImages())}catch{}finally{isLoading.value=!1}},handleToggleVisibility=async(id,currentAccessLevel)=>{const imageIndex=images.value.findIndex(img=>img.id===id);if(imageIndex!==-1)try{if((await toggleAccessLevel(id)).success){let nextLevel="",nextAccessLevel="";switch(currentAccessLevel){case"public":nextLevel=$t("resource.accessLevel.private"),nextAccessLevel="private";break;case"private":nextLevel=$t("resource.accessLevel.protected"),nextAccessLevel="protected";break;case"protected":nextLevel=$t("resource.accessLevel.public"),nextAccessLevel="public";break;default:nextLevel=$t("resource.accessLevel.public"),nextAccessLevel="public"}if(images.value[imageIndex].access_level=nextAccessLevel,nextAccessLevel==="private"){const token=StorageUtil.get(TOKEN_KEY);if(token){const addTokenToUrl=url=>{if(url&&!url.includes("token=")){const separator=url.includes("?")?"&":"?";return`${url}${separator}token=${token}`}return url};images.value[imageIndex].full_url&&(images.value[imageIndex].full_url=addTokenToUrl(images.value[imageIndex].full_url)),images.value[imageIndex].full_thumb_url&&(images.value[imageIndex].full_thumb_url=addTokenToUrl(images.value[imageIndex].full_thumb_url))}}else if(currentAccessLevel==="private"&&nextAccessLevel!=="private"){const removeTokenFromUrl=url=>url&&url.includes("token=")?url.replace(/[?&]token=[^&]*/,"").replace(/\?$/,""):url;images.value[imageIndex].full_url&&(images.value[imageIndex].full_url=removeTokenFromUrl(images.value[imageIndex].full_url)),images.value[imageIndex].full_thumb_url&&(images.value[imageIndex].full_thumb_url=removeTokenFromUrl(images.value[imageIndex].full_thumb_url))}toast.success($t("resource.toast.visibilityChanged",{level:nextLevel}))}}catch{toast.error($t("resource.toast.visibilityChangeFailed"))}},viewImageDetails=fileId=>{const image=images.value.find(img=>img.id===fileId);image&&(selectedImageDetails.value=image,showDetailModal.value=!0)},isAllImagesSelected=computed(()=>shareButton.value?.selectedImages?.length===images.value.length&&images.value.length>0),toggleSelectAllImages=()=>{selectMode.value&&shareButton.value&&shareButton.value.toggleSelectAllImages(images.value)},invertImageSelection=()=>{selectMode.value&&shareButton.value&&shareButton.value.invertImageSelection(images.value)},clearVectorSearch=()=>{searchKeyword.value="",searchMode.value="normal",isVectorSearchMode.value=!1,lastVectorSearchQuery.value="",filterParams.keyword="",currentPage.value=1,loadImages()};return onMounted(async()=>{isLoading.value=!0,showSkeleton.value=!0;try{const result=await getGlobalSettings();if(result.success&&result.data){const vectorConfig=result.data.vector;vectorConfig&&typeof vectorConfig.vector_enabled=="boolean"&&(vectorConfig.vector_enabled||(searchMode.value="normal"))}}catch{console.error("Failed to fetch global settings:",error)}const tagsParam=route.query.tags,tagNamesParam=route.query.tag_names,categoryIdParam=route.query.categoryId,categoryNameParam=route.query.category_name;tagsParam&&typeof tagsParam=="string"&&(filterParams.tags=tagsParam,tagNamesParam&&typeof tagNamesParam=="string"?toast.info($t("resource.toast.tagFilter",{tagNames:tagNamesParam})):toast.info($t("resource.toast.tagIdFilter",{tagIds:tagsParam})),await router.replace({path:route.path,query:{}})),categoryIdParam&&typeof categoryIdParam=="string"&&(filterParams.categoryId=categoryIdParam,categoryNameParam&&typeof categoryNameParam=="string"?toast.info($t("resource.toast.categoryFilter",{categoryName:categoryNameParam})):toast.info($t("resource.toast.categoryIdFilter",{categoryId:categoryIdParam})),await router.replace({path:route.path,query:{}})),await nextTick(),setTimeout(()=>{recalc(!0),autoPageSize.value&&autoPageSize.value!==pagination.value.size&&(pagination.value.size=autoPageSize.value,filterParams.size=autoPageSize.value),loadImages()},200)}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberSkeleton=__unplugin_components_0$1,_component_CyberPagination=resolveComponent("CyberPagination"),_component_cyberFileViewer=resolveComponent("cyberFileViewer");return openBlock(),createElementBlock("div",{class:normalizeClass({"container mx-auto":unref(layoutStore).isTopLayout})},[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("h1",_hoisted_3,[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-images mr-2 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("resource.title")),1)]),createBaseVNode("div",_hoisted_4,[createVNode(CompactSearchBar,{modelValue:searchKeyword.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>searchKeyword.value=$event),"search-mode":searchMode.value,"show-filter":showFilter.value,"is-searching":isSearching.value,"onUpdate:searchKeyword":_cache[1]||(_cache[1]=$event=>searchKeyword.value=$event),"onUpdate:searchMode":_cache[2]||(_cache[2]=$event=>searchMode.value=$event),"onUpdate:showFilter":_cache[3]||(_cache[3]=$event=>showFilter.value=$event),onSearch:handleSearch},null,8,["modelValue","search-mode","show-filter","is-searching"]),createVNode(ShareButton,{ref_key:"shareButton",ref:shareButton,images:images.value,"onUpdate:selectMode":handleSelectModeChange,"onUpdate:shareDialogVisible":_cache[4]||(_cache[4]=$event=>shareDialogVisible.value=$event)},null,8,["images"]),createVNode(_component_CyberButton,{type:"secondary",class:normalizeClass(["text-xs",{"border-error-500 text-error-500":showFilter.value}]),onClick:_cache[5]||(_cache[5]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[..._cache[14]||(_cache[14]=[createBaseVNode("i",{class:"fas fa-filter"},null,-1)])]),_:1},8,["class"])])]),createVNode(Transition,{name:"filter-panel","enter-active-class":"transition duration-300 ease-out","leave-active-class":"transition duration-200 ease-in","enter-from-class":"opacity-0 transform -translate-y-8","enter-to-class":"opacity-100 transform translate-y-0","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-8"},{default:withCtx(()=>[withDirectives(createVNode(_sfc_main$3,{class:"mb-4",onFilter:handleFilter},null,512),[[vShow,showFilter.value]])]),_:1}),images.value.length>0||isLoading.value?(openBlock(),createElementBlock("div",_hoisted_5,[createBaseVNode("div",_hoisted_6,[createBaseVNode("div",{class:"resource-count-text",innerHTML:unref($t)("resource.count",{count:pagination.value.total})},null,8,_hoisted_7),selectMode.value?(openBlock(),createElementBlock("div",_hoisted_8,[createBaseVNode("button",{class:normalizeClass(["select-btn select-all-btn",{active:isAllImagesSelected.value}]),title:isAllImagesSelected.value?unref($t)("resource.selection.deselectAll"):unref($t)("resource.selection.selectAll"),onClick:toggleSelectAllImages},[createBaseVNode("i",{class:normalizeClass(["fas",isAllImagesSelected.value?"fa-check-double":"fa-check"])},null,2),createTextVNode(" "+toDisplayString(isAllImagesSelected.value?unref($t)("resource.selection.deselectAll"):unref($t)("resource.selection.selectAll")),1)],10,_hoisted_9),createBaseVNode("button",{class:"select-btn invert-btn",title:unref($t)("resource.selection.invertTitle"),onClick:invertImageSelection},[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-exchange-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("resource.selection.invert")),1)],8,_hoisted_10)])):createCommentVNode("",!0)])])):createCommentVNode("",!0),!isLoading.value&&images.value.length===0?(openBlock(),createElementBlock("div",_hoisted_11,[createVNode(EmptyState,{onReset:resetFilter})])):createCommentVNode("",!0),isLoading.value||images.value.length>0?(openBlock(),createElementBlock("div",_hoisted_12,[showSkeleton.value?(openBlock(),createElementBlock("div",_hoisted_13,[createVNode(_component_CyberSkeleton,{type:"card",count:18,loading:showSkeleton.value},null,8,["loading"])])):(openBlock(),createElementBlock("div",_hoisted_14,[isLoading.value?(openBlock(),createElementBlock("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[createBaseVNode("div",_hoisted_17,[createVNode(_component_CyberSkeleton,{variant:"circular",width:"40px",height:"40px",animation:"wave",class:"mx-auto"})]),createVNode(_component_CyberSkeleton,{variant:"text",width:"120px",height:"14px",animation:"wave",class:"mx-auto"})])])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(images.value,image=>(openBlock(),createBlock(FileCard,{key:image.id,"image-data":image,"select-mode":selectMode.value,"is-selected":isImageSelected(image),"is-vector-search":isVectorSearchMode.value,class:"text-sm",onView:viewImage,onCopy:handleCopyLink,onDownload:handleDownload,onDelete:deleteImage,onVisibility:handleToggleVisibility,onDetails:viewImageDetails,onSelect:handleImageSelect},null,8,["image-data","select-mode","is-selected","is-vector-search"]))),128))])),!isLoading.value&&images.value.length>0&&pagination.value.total>pagination.value.size?(openBlock(),createElementBlock("div",_hoisted_18,[createVNode(_component_CyberPagination,{"page-size":pagination.value.size,"onUpdate:pageSize":[_cache[6]||(_cache[6]=$event=>pagination.value.size=$event),_cache[8]||(_cache[8]=size=>{pagination.value.size=size})],"current-page":currentPage.value,"onUpdate:currentPage":[_cache[7]||(_cache[7]=$event=>currentPage.value=$event),handlePageChange],total:pagination.value.total,"page-size-options":pageSizeOptions.value,"show-page-size-selector":!0,class:"text-xs"},null,8,["page-size","current-page","total","page-size-options"])])):createCommentVNode("",!0)])):createCommentVNode("",!0),createVNode(_component_cyberFileViewer,{modelValue:showFilePreview.value,"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>showFilePreview.value=$event),file:selectedImageDetails.value,files:images.value,"initial-index":currentPreviewIndex.value,"show-side-nav":!0,"show-keyboard-tips":!0,"search-scope":"user",onClose:_cache[10]||(_cache[10]=$event=>showFilePreview.value=!1),onPrev:handlePrevImage,onNext:handleNextImage,onChange:handleImageChange},null,8,["modelValue","file","files","initial-index"]),createVNode(_sfc_main$1,{"show-detail-modal":showDetailModal.value,"selected-image":selectedImageDetails.value,"onUpdate:showDetailModal":_cache[11]||(_cache[11]=$event=>showDetailModal.value=$event),onDownload:handleDownload},null,8,["show-detail-modal","selected-image"]),createVNode(CreateShareDialog,{modelValue:shareDialogVisible.value,"onUpdate:modelValue":_cache[12]||(_cache[12]=$event=>shareDialogVisible.value=$event),"selected-folders":[],"selected-images":shareButton.value?.selectedImages||[],onCreated:handleShareCreated},null,8,["modelValue","selected-images"])])],2)}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-2e26b25d"]]);export{index as default};
