import{x as get,ah as post,aj as del,j as useTexts,J as getCurrentLocale,aT as __unplugin_components_0,X as __unplugin_components_0$1,aU as __unplugin_components_2,aN as __unplugin_components_3,q as useToast,_ as _export_sfc,aQ as __unplugin_components_0$2}from"./index-4d0dab4c.js";import{r as ref,c as computed,d as defineComponent,a as reactive,w as watch,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,K as createCommentVNode,f as createVNode,L as withCtx,ab as createTextVNode,A as createBlock,R as normalizeClass,F as Fragment,M as renderList,a5 as withModifiers,n as nextTick,b as onMounted,H as withDirectives,$ as vShow,aa as withKeys,h}from"./vue-vendor-31320f47.js";import{u as useResponsivePageSize}from"./useResponsivePageSize-3b6a8f45.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const NSFW_SCORE_LEVELS={SAFE:.3,LOW:.6,MEDIUM:.8,HIGH:1},getNsfwScoreConfig=$t=>({SAFE:{threshold:NSFW_SCORE_LEVELS.SAFE,class:"nsfw-safe",color:"text-green-400",label:$t("constants.contentReview.nsfwLevels.safe")},LOW:{threshold:NSFW_SCORE_LEVELS.LOW,class:"nsfw-low",color:"text-yellow-400",label:$t("constants.contentReview.nsfwLevels.low")},MEDIUM:{threshold:NSFW_SCORE_LEVELS.MEDIUM,class:"nsfw-medium",color:"text-orange-400",label:$t("constants.contentReview.nsfwLevels.medium")},HIGH:{threshold:NSFW_SCORE_LEVELS.HIGH,class:"nsfw-high",color:"text-red-400",label:$t("constants.contentReview.nsfwLevels.high")}}),REVIEW_PAGINATION={PAGE_SIZE:20,PAGE_SIZE_OPTIONS:[10,20,50,100],MAX_PAGE_SIZE:100},getDefaultReviewReasons=$t=>({APPROVE:$t("constants.contentReview.defaultReasons.approve"),REJECT:$t("constants.contentReview.defaultReasons.reject"),BATCH_APPROVE:$t("constants.contentReview.defaultReasons.batchApprove"),BATCH_REJECT:$t("constants.contentReview.defaultReasons.batchReject")}),TEXT_TRUNCATE={REASON:40,FILENAME:20,USERNAME:15},getReviewMessages=$t=>({APPROVE_SUCCESS:$t("constants.contentReview.messages.approveSuccess"),REJECT_SUCCESS:$t("constants.contentReview.messages.rejectSuccess"),BATCH_APPROVE_SUCCESS:count=>$t("constants.contentReview.messages.batchApproveSuccess",{count}),BATCH_REJECT_SUCCESS:count=>$t("constants.contentReview.messages.batchRejectSuccess",{count}),RESTORE_SUCCESS:$t("constants.contentReview.messages.restoreSuccess"),HARD_DELETE_SUCCESS:$t("constants.contentReview.messages.hardDeleteSuccess"),BATCH_RESTORE_SUCCESS:(success,fail)=>fail>0?$t("constants.contentReview.messages.batchRestoreWithFail",{success,fail}):$t("constants.contentReview.messages.batchRestoreSuccess",{success}),BATCH_HARD_DELETE_SUCCESS:(success,fail)=>fail>0?$t("constants.contentReview.messages.batchHardDeleteWithFail",{success,fail}):$t("constants.contentReview.messages.batchHardDeleteSuccess",{success}),LOAD_ERROR:$t("constants.contentReview.messages.loadError"),OPERATION_ERROR:$t("constants.contentReview.messages.operationError"),NO_SELECTION:$t("constants.contentReview.messages.noSelection"),QUEUE_EMPTY:$t("constants.contentReview.messages.queueEmpty"),QUEUE_EMPTY_DESC:$t("constants.contentReview.messages.queueEmptyDesc"),LOGS_EMPTY:$t("constants.contentReview.messages.logsEmpty"),LOGS_EMPTY_DESC:$t("constants.contentReview.messages.logsEmptyDesc")});function getReviewQueue(params){return get("/admin/content-review/queue",params)}function getReviewLogs(params){return get("/admin/content-review/logs",params)}function getReviewStats(){return get("/admin/content-review/stats")}function reviewImage(data){return post("/admin/content-review/review",data)}function batchReview(data){return post("/admin/content-review/batch-review",data)}function hardDeleteReviewedImage(fileId){return del(`/admin/content-review/files/${fileId}/hard-delete`)}function batchHardDeleteReviewedImages(fileIds){return post("/admin/content-review/batch-hard-delete",{file_ids:fileIds})}function restoreReviewedImage(fileId){return post(`/admin/content-review/files/${fileId}/restore`,{})}function batchRestoreReviewedImages(fileIds){return post("/admin/content-review/batch-restore",{file_ids:fileIds})}function useContentReview(){const{$t}=useTexts(),NSFW_SCORE_CONFIG=getNsfwScoreConfig($t),REVIEW_MESSAGES=getReviewMessages($t),isLoading=ref(!1),currentPage=ref(1),totalPages=ref(1),pageSize=ref(REVIEW_PAGINATION.PAGE_SIZE);return{isLoading,currentPage,totalPages,pageSize,formatDateTime:dateStr=>new Date(dateStr).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),formatDate:(date,format="MM-DD HH:mm")=>{const d=new Date(date),month=(d.getMonth()+1).toString().padStart(2,"0"),day=d.getDate().toString().padStart(2,"0"),hours=d.getHours().toString().padStart(2,"0"),minutes=d.getMinutes().toString().padStart(2,"0");return format.replace("MM",month).replace("DD",day).replace("HH",hours).replace("mm",minutes)},truncateText:(text,maxLength=TEXT_TRUNCATE.REASON)=>text.length<=maxLength?text:`${text.substring(0,maxLength)}...`,getNsfwScoreClass:score=>score>=NSFW_SCORE_CONFIG.HIGH.threshold?NSFW_SCORE_CONFIG.HIGH.class:score>=NSFW_SCORE_CONFIG.MEDIUM.threshold?NSFW_SCORE_CONFIG.MEDIUM.class:score>=NSFW_SCORE_CONFIG.LOW.threshold?NSFW_SCORE_CONFIG.LOW.class:NSFW_SCORE_CONFIG.SAFE.class,handleImageError:event=>{const img=event.target;img.src="/placeholder-image.png"},getReviewQueue,getReviewLogs,getReviewStats,REVIEW_MESSAGES,TEXT_TRUNCATE}}function useReviewSelection(){const selectMode=ref(!1),selectedItems=ref([]),totalItems=ref(0),startSelectMode=()=>{selectMode.value=!0,selectedItems.value=[]},exitSelectMode=()=>{selectMode.value=!1,selectedItems.value=[],totalItems.value=0},toggleItemSelection=itemId=>{const index2=selectedItems.value.indexOf(itemId);index2>-1?selectedItems.value.splice(index2,1):selectedItems.value.push(itemId)},toggleSelectAll=items=>{totalItems.value=items.length,isAllSelected.value?selectedItems.value=[]:selectedItems.value=items.map(item=>item.id)},selectInvert=items=>{totalItems.value=items.length;const allIds=items.map(item=>item.id);selectedItems.value=allIds.filter(id=>!selectedItems.value.includes(id))},isAllSelected=computed(()=>totalItems.value>0&&selectedItems.value.length===totalItems.value),hasSelection=computed(()=>selectedItems.value.length>0);return{selectMode,selectedItems,startSelectMode,exitSelectMode,toggleItemSelection,toggleSelectAll,selectInvert,isAllSelected,hasSelection}}const _hoisted_1$2=["data-select-mode"],_hoisted_2$2={class:"queue-header"},_hoisted_3$2={class:"header-info"},_hoisted_4$1={key:0,class:"queue-count"},_hoisted_5$1={class:"header-actions"},_hoisted_6$1={key:1,class:"batch-controls"},_hoisted_7$1={class:"selection-info"},_hoisted_8$1={class:"selection-count"},_hoisted_9$1={key:0,class:"toolbar"},_hoisted_10$1={class:"toolbar-left"},_hoisted_11$1={class:"selection-controls"},_hoisted_12$1=["title"],_hoisted_13$1=["title"],_hoisted_14$1={class:"content-area"},_hoisted_15$1={class:"images-grid"},_hoisted_16$1=["onClick"],_hoisted_17$1=["src","alt"],_hoisted_18$1={key:0,class:"nsfw-badge"},_hoisted_19$1={key:0,class:"nsfw-score"},_hoisted_20$1={class:"date-overlay"},_hoisted_21$1={key:1,class:"action-overlay"},_hoisted_22$1={class:"image-info"},_hoisted_23$1=["title"],_hoisted_24$1={class:"image-meta"},_hoisted_25$1={class:"meta-item"},_hoisted_26$1={class:"meta-item"},_hoisted_27$1={key:0,class:"meta-item uploader-info"},_hoisted_28$1={key:1,class:"empty-state-container"},_hoisted_29$1={class:"empty-state"},_hoisted_30$1={class:"text-content-content-muted mb-2 text-lg"},_hoisted_31$1={class:"text-content-disabled"},_hoisted_32$1={key:0,class:"pagination-wrapper"},_hoisted_33$1={class:"space-y-4"},_hoisted_34$1={class:"text-content"},_hoisted_35$1={class:"form-item"},_hoisted_36$1={class:"mb-2 block text-sm text-content"},_hoisted_37$1={class:"form-item"},_hoisted_38$1={class:"space-y-4"},_hoisted_39$1={class:"text-content"},_hoisted_40={class:"form-item"},_hoisted_41={class:"mb-2 block text-sm text-content"},_hoisted_42={class:"rounded border border-green-500/20 bg-green-500/10 p-3"},_hoisted_43={class:"text-xs text-green-400"},_hoisted_44={class:"ml-4 mt-2 space-y-1 text-xs text-content-muted"},_hoisted_45={class:"space-y-4"},_hoisted_46={class:"text-content"},_hoisted_47={class:"form-item"},_hoisted_48={class:"mb-2 block text-sm text-content"},_hoisted_49={class:"form-item"},_hoisted_50={class:"space-y-4"},_hoisted_51={class:"text-content"},_hoisted_52={class:"form-item"},_hoisted_53={class:"mb-2 block text-sm text-content"},_hoisted_54={class:"rounded border border-green-500/20 bg-green-500/10 p-3"},_hoisted_55={class:"text-xs text-green-400"},_hoisted_56={class:"ml-4 mt-2 space-y-1 text-xs text-content-muted"},_sfc_main$2=defineComponent({__name:"ReviewQueue",props:{isActive:{type:Boolean,default:!1}},emits:["refresh-stats"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,toast=useToast(),{$t}=useTexts(),REVIEW_MESSAGES=getReviewMessages($t),DEFAULT_REVIEW_REASONS=getDefaultReviewReasons($t),{formatDate,handleImageError}=useContentReview(),{selectMode,selectedItems:selectedImages,startSelectMode,exitSelectMode,toggleItemSelection:toggleImageSelection,toggleSelectAll,selectInvert,isAllSelected}=useReviewSelection(),isLoading=ref(!1),showSkeleton=ref(!1),images=ref([]),totalImages=ref(0),currentPage=ref(1),pageSize=ref(20),sortBy=ref("newest"),processingImages=reactive({}),isBatchProcessing=ref(!1),isBatchApproving=ref(!1),isBatchRejecting=ref(!1),{pageSize:autoPageSize,recalc}=useResponsivePageSize({containerSelector:".review-queue-container",gridSelector:".images-grid",itemMinWidth:200,columnGap:16,rowMultiple:3,defaultSize:20,debug:!1,preferCssColumns:!0,mode:"once"}),showRejectDialog=ref(!1),showBatchRejectDialog=ref(!1),showBatchApproveDialog=ref(!1),showApproveDialog=ref(!1),selectedRejectImage=ref(null),selectedApproveImage=ref(null),rejectReason=ref(""),batchRejectReason=ref(""),batchApproveReason=ref(""),approveReason=ref(""),hardDeleteOnReject=ref(!1),batchHardDelete=ref(!1),isProcessingReject=ref(!1),isProcessingApprove=ref(!1),showPreview=ref(!1),previewImage=ref(null),loadData=async(page=1)=>{try{isLoading.value=!0,showSkeleton.value=!0;const params={page,size:pageSize.value,sort:sortBy.value},response=await getReviewQueue(params);response.success&&response.data?(images.value=response.data.data||[],totalImages.value=response.data.pagination?.total||0,currentPage.value=response.data.pagination?.page||1):(images.value=[],totalImages.value=0,currentPage.value=1)}catch(error){error&&typeof error=="object"&&"code"in error&&error.code===-1||(console.error("[ReviewQueue] 加载数据失败:",error),toast.error(REVIEW_MESSAGES.LOAD_ERROR),images.value=[],totalImages.value=0,currentPage.value=1)}finally{isLoading.value=!1,showSkeleton.value=!1}await loadStats()},loadStats=async()=>{try{const statsResponse=await getReviewStats();statsResponse.success&&emit("refresh-stats",statsResponse.data)}catch{}},refreshData=()=>{loadData(currentPage.value)},handleImageClick=image=>{selectMode.value?toggleImageSelection(image.id):showFilePreview(image)},confirmRejectImage=image=>{selectedRejectImage.value=image,rejectReason.value="",hardDeleteOnReject.value=!1,showRejectDialog.value=!0},executeReject=async()=>{if(selectedRejectImage.value)try{isProcessingReject.value=!0;const response=await reviewImage({file_id:selectedRejectImage.value.id,action:"reject",reason:rejectReason.value||DEFAULT_REVIEW_REASONS.REJECT,hard_delete:hardDeleteOnReject.value});response.success?(toast.success(REVIEW_MESSAGES.REJECT_SUCCESS),images.value=images.value.filter(img=>img.id!==selectedRejectImage.value?.id),totalImages.value--,showRejectDialog.value=!1,selectedRejectImage.value=null,await loadStats()):toast.error(response.message||REVIEW_MESSAGES.OPERATION_ERROR)}catch{toast.error(REVIEW_MESSAGES.OPERATION_ERROR)}finally{isProcessingReject.value=!1}},confirmBatchApprove=()=>{batchApproveReason.value="",showBatchApproveDialog.value=!0},executeBatchApprove=async()=>{if(selectedImages.value.length!==0)try{isBatchApproving.value=!0,isBatchProcessing.value=!0;const response=await batchReview({file_ids:selectedImages.value,action:"approve",reason:batchApproveReason.value||DEFAULT_REVIEW_REASONS.BATCH_APPROVE});if(response.success){const successCount=response.data?.success_count||0;toast.success(REVIEW_MESSAGES.BATCH_APPROVE_SUCCESS(successCount)),images.value=images.value.filter(img=>!selectedImages.value.includes(img.id)),totalImages.value-=successCount,showBatchApproveDialog.value=!1,exitSelectMode(),await loadStats()}else toast.error(response.message||REVIEW_MESSAGES.OPERATION_ERROR)}catch{toast.error(REVIEW_MESSAGES.OPERATION_ERROR)}finally{isBatchApproving.value=!1,isBatchProcessing.value=!1}},confirmBatchReject=()=>{batchRejectReason.value="",batchHardDelete.value=!1,showBatchRejectDialog.value=!0},executeBatchReject=async()=>{if(selectedImages.value.length!==0)try{isBatchRejecting.value=!0,isBatchProcessing.value=!0;const response=await batchReview({file_ids:selectedImages.value,action:"reject",reason:batchRejectReason.value||DEFAULT_REVIEW_REASONS.BATCH_REJECT,hard_delete:batchHardDelete.value});if(response.success){const successCount=response.data?.success_count||0;toast.success(REVIEW_MESSAGES.BATCH_REJECT_SUCCESS(successCount)),images.value=images.value.filter(img=>!selectedImages.value.includes(img.id)),totalImages.value-=successCount,showBatchRejectDialog.value=!1,exitSelectMode(),await loadStats()}else toast.error(response.message||REVIEW_MESSAGES.OPERATION_ERROR)}catch{toast.error(REVIEW_MESSAGES.OPERATION_ERROR)}finally{isBatchRejecting.value=!1,isBatchProcessing.value=!1}},confirmApproveImage=image=>{selectedApproveImage.value=image,approveReason.value="",showApproveDialog.value=!0},executeApprove=async()=>{if(selectedApproveImage.value)try{isProcessingApprove.value=!0,processingImages[selectedApproveImage.value.id]=!0;const response=await reviewImage({file_id:selectedApproveImage.value.id,action:"approve",reason:approveReason.value||DEFAULT_REVIEW_REASONS.APPROVE});response.success?(toast.success(REVIEW_MESSAGES.APPROVE_SUCCESS),images.value=images.value.filter(img=>img.id!==selectedApproveImage.value?.id),totalImages.value-=1,showApproveDialog.value=!1,await loadStats()):toast.error(response.message||REVIEW_MESSAGES.OPERATION_ERROR)}catch{toast.error(REVIEW_MESSAGES.OPERATION_ERROR)}finally{selectedApproveImage.value&&delete processingImages[selectedApproveImage.value.id],isProcessingApprove.value=!1}},showFilePreview=image=>{previewImage.value=image,showPreview.value=!0},isInitialized=ref(!1);return watch(()=>props.isActive,async newVal=>{newVal&&(isInitialized.value?loadData(1):(isLoading.value=!0,showSkeleton.value=!0,await nextTick(),setTimeout(()=>{recalc(!0),autoPageSize.value&&autoPageSize.value!==pageSize.value&&(pageSize.value=autoPageSize.value),isInitialized.value=!0,loadData(1)},200)))},{immediate:!0}),watch(currentPage,newPage=>{newPage&&newPage!==1&&loadData(newPage)}),watch(pageSize,(newSize,oldSize)=>{newSize&&newSize!==oldSize&&isInitialized.value&&(currentPage.value=1,loadData(1))}),__expose({loadData,refreshData}),(_ctx,_cache)=>{const _component_Button=__unplugin_components_0,_component_CyberSkeleton=__unplugin_components_0$1,_component_cyberCheckbox=resolveComponent("cyberCheckbox"),_component_CyberPagination=resolveComponent("CyberPagination"),_component_Input=__unplugin_components_2,_component_Dialog=__unplugin_components_3,_component_cyberFileViewer=resolveComponent("cyberFileViewer");return openBlock(),createElementBlock("div",{class:"review-queue-container","data-select-mode":unref(selectMode)},[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[!isLoading.value&&totalImages.value>0?(openBlock(),createElementBlock("span",_hoisted_4$1,toDisplayString(unref($t)("admin.contentReview.queue.selection.selectedCount",{count:totalImages.value,total:totalImages.value})),1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_5$1,[createVNode(_component_Button,{type:"secondary",loading:isLoading.value,onClick:refreshData},{default:withCtx(()=>[_cache[21]||(_cache[21]=createBaseVNode("i",{class:"fas fa-sync-alt mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.queue.buttons.refresh")),1)]),_:1},8,["loading"]),unref(selectMode)?(openBlock(),createElementBlock("div",_hoisted_6$1,[createBaseVNode("div",_hoisted_7$1,[createBaseVNode("span",_hoisted_8$1,toDisplayString(unref($t)("admin.contentReview.queue.selection.selectedCount",{count:unref(selectedImages).length,total:images.value.length})),1)]),createVNode(_component_Button,{type:"success",size:"small",disabled:unref(selectedImages).length===0||isBatchProcessing.value,loading:isBatchApproving.value,onClick:confirmBatchApprove},{default:withCtx(()=>[_cache[23]||(_cache[23]=createBaseVNode("i",{class:"fas fa-check mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.queue.batchActions.approve",{count:unref(selectedImages).length})),1)]),_:1},8,["disabled","loading"]),createVNode(_component_Button,{type:"danger",size:"small",disabled:unref(selectedImages).length===0||isBatchProcessing.value,loading:isBatchRejecting.value,onClick:confirmBatchReject},{default:withCtx(()=>[_cache[24]||(_cache[24]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.queue.batchActions.reject",{count:unref(selectedImages).length})),1)]),_:1},8,["disabled","loading"]),createVNode(_component_Button,{type:"secondary",size:"small",onClick:unref(exitSelectMode)},{default:withCtx(()=>[_cache[25]||(_cache[25]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.queue.buttons.cancel")),1)]),_:1},8,["onClick"])])):(openBlock(),createBlock(_component_Button,{key:0,type:"secondary",disabled:images.value.length===0,onClick:unref(startSelectMode)},{default:withCtx(()=>[_cache[22]||(_cache[22]=createBaseVNode("i",{class:"fas fa-tasks mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.queue.buttons.batchOperation")),1)]),_:1},8,["disabled","onClick"]))])]),unref(selectMode)?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("div",_hoisted_10$1,[createBaseVNode("div",_hoisted_11$1,[createBaseVNode("button",{class:normalizeClass(["select-btn select-all-btn",{active:unref(isAllSelected)}]),title:unref(isAllSelected)?unref($t)("admin.contentReview.queue.selection.deselectAll"):unref($t)("admin.contentReview.queue.selection.selectAll"),onClick:_cache[0]||(_cache[0]=()=>unref(toggleSelectAll)(images.value))},[createBaseVNode("i",{class:normalizeClass(["fas",unref(isAllSelected)?"fa-check-double":"fa-check"])},null,2),createTextVNode(" "+toDisplayString(unref(isAllSelected)?unref($t)("admin.contentReview.queue.selection.deselectAll"):unref($t)("admin.contentReview.queue.selection.selectAll")),1)],10,_hoisted_12$1),createBaseVNode("button",{class:"select-btn invert-btn",title:unref($t)("admin.contentReview.queue.selection.invertSelection"),onClick:_cache[1]||(_cache[1]=()=>unref(selectInvert)(images.value))},[_cache[26]||(_cache[26]=createBaseVNode("i",{class:"fas fa-exchange-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.contentReview.queue.selection.invertSelection")),1)],8,_hoisted_13$1)])])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_14$1,[createBaseVNode("div",_hoisted_15$1,[createVNode(_component_CyberSkeleton,{type:"card",count:unref(autoPageSize)||pageSize.value,loading:showSkeleton.value,simple:""},null,8,["count","loading"]),!showSkeleton.value&&images.value.length>0?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(images.value,image=>(openBlock(),createElementBlock("div",{key:image.id,class:normalizeClass(["review-image-card",{selected:unref(selectedImages).includes(image.id),processing:processingImages[image.id]}])},[unref(selectMode)?(openBlock(),createElementBlock("div",{key:0,class:"image-select",onClick:_cache[2]||(_cache[2]=withModifiers(()=>{},["stop"]))},[createVNode(_component_cyberCheckbox,{"model-value":unref(selectedImages).includes(image.id),"onUpdate:modelValue":$event=>unref(toggleImageSelection)(image.id)},null,8,["model-value","onUpdate:modelValue"])])):createCommentVNode("",!0),createBaseVNode("div",{class:"image-preview",onClick:$event=>handleImageClick(image)},[createBaseVNode("img",{src:image.full_thumb_url,alt:image.display_name||image.original_name,class:"preview-image",onError:_cache[3]||(_cache[3]=(...args)=>unref(handleImageError)&&unref(handleImageError)(...args))},null,40,_hoisted_17$1),image.ai_info?.is_nsfw||image.nsfw?(openBlock(),createElementBlock("div",_hoisted_18$1,[_cache[27]||(_cache[27]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1)),_cache[28]||(_cache[28]=createBaseVNode("span",{class:"nsfw-label"},"NSFW",-1)),image.ai_info?.nsfw_score?(openBlock(),createElementBlock("span",_hoisted_19$1,toDisplayString(Math.round(image.ai_info.nsfw_score*100))+"% ",1)):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_20$1,toDisplayString(unref(formatDate)(image.created_at,"MM-DD HH:mm")),1),unref(selectMode)?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_21$1,[createVNode(_component_Button,{type:"success",size:"small",disabled:processingImages[image.id],onClick:withModifiers($event=>confirmApproveImage(image),["stop"])},{default:withCtx(()=>[_cache[29]||(_cache[29]=createBaseVNode("i",{class:"fas fa-check mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.contentReview.queue.buttons.pass")),1)]),_:1},8,["disabled","onClick"]),createVNode(_component_Button,{type:"danger",size:"small",disabled:processingImages[image.id],onClick:withModifiers($event=>confirmRejectImage(image),["stop"])},{default:withCtx(()=>[_cache[30]||(_cache[30]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.contentReview.queue.buttons.reject")),1)]),_:1},8,["disabled","onClick"])]))],8,_hoisted_16$1),createBaseVNode("div",_hoisted_22$1,[createBaseVNode("div",{class:"image-title",title:image.display_name||image.original_name},toDisplayString(image.display_name||image.original_name),9,_hoisted_23$1),createBaseVNode("div",_hoisted_24$1,[createBaseVNode("span",_hoisted_25$1,[_cache[31]||(_cache[31]=createBaseVNode("i",{class:"fas fa-image"},null,-1)),createTextVNode(" "+toDisplayString(image.width)+"×"+toDisplayString(image.height),1)]),createBaseVNode("span",_hoisted_26$1,[_cache[32]||(_cache[32]=createBaseVNode("i",{class:"fas fa-hdd"},null,-1)),createTextVNode(" "+toDisplayString(image.size_formatted),1)]),image.uploader?(openBlock(),createElementBlock("span",_hoisted_27$1,[_cache[33]||(_cache[33]=createBaseVNode("i",{class:"fas fa-user"},null,-1)),createTextVNode(" "+toDisplayString(image.uploader.username),1)])):createCommentVNode("",!0)])])],2))),128)):!showSkeleton.value&&images.value.length===0?(openBlock(),createElementBlock("div",_hoisted_28$1,[createBaseVNode("div",_hoisted_29$1,[_cache[34]||(_cache[34]=createBaseVNode("i",{class:"fas fa-check-circle mb-4 text-6xl text-green-400/30"},null,-1)),createBaseVNode("h3",_hoisted_30$1,toDisplayString(unref($t)("admin.contentReview.queue.empty.title")),1),createBaseVNode("p",_hoisted_31$1,toDisplayString(unref($t)("admin.contentReview.queue.empty.description")),1)])])):createCommentVNode("",!0)]),totalImages.value>0?(openBlock(),createElementBlock("div",_hoisted_32$1,[createVNode(_component_CyberPagination,{"current-page":currentPage.value,"onUpdate:currentPage":_cache[4]||(_cache[4]=$event=>currentPage.value=$event),"page-size":pageSize.value,"onUpdate:pageSize":_cache[5]||(_cache[5]=$event=>pageSize.value=$event),total:totalImages.value},null,8,["current-page","page-size","total"])])):createCommentVNode("",!0)]),createVNode(_component_Dialog,{modelValue:showRejectDialog.value,"onUpdate:modelValue":_cache[8]||(_cache[8]=$event=>showRejectDialog.value=$event),title:unref($t)("admin.contentReview.dialogs.rejectSingle.title"),loading:isProcessingReject.value,onConfirm:executeReject,onCancel:_cache[9]||(_cache[9]=$event=>showRejectDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_33$1,[createBaseVNode("p",_hoisted_34$1,toDisplayString(unref($t)("admin.contentReview.dialogs.rejectSingle.message",{name:selectedRejectImage.value?.original_name})),1),createBaseVNode("div",_hoisted_35$1,[createBaseVNode("label",_hoisted_36$1,toDisplayString(unref($t)("admin.contentReview.dialogs.rejectSingle.reasonLabel")),1),createVNode(_component_Input,{modelValue:rejectReason.value,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>rejectReason.value=$event),placeholder:unref($t)("admin.contentReview.dialogs.rejectSingle.reasonPlaceholder"),type:"textarea",rows:"3"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_37$1,[createVNode(_component_cyberCheckbox,{modelValue:hardDeleteOnReject.value,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>hardDeleteOnReject.value=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.dialogs.rejectSingle.hardDelete")),1)]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_Dialog,{modelValue:showBatchApproveDialog.value,"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>showBatchApproveDialog.value=$event),title:unref($t)("admin.contentReview.dialogs.batchApprove.title"),loading:isBatchApproving.value,onConfirm:executeBatchApprove,onCancel:_cache[12]||(_cache[12]=$event=>showBatchApproveDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_38$1,[createBaseVNode("p",_hoisted_39$1,toDisplayString(unref($t)("admin.contentReview.dialogs.batchApprove.message",{count:unref(selectedImages).length})),1),createBaseVNode("div",_hoisted_40,[createBaseVNode("label",_hoisted_41,toDisplayString(unref($t)("admin.contentReview.dialogs.batchApprove.reasonLabel")),1),createVNode(_component_Input,{modelValue:batchApproveReason.value,"onUpdate:modelValue":_cache[10]||(_cache[10]=$event=>batchApproveReason.value=$event),placeholder:unref($t)("admin.contentReview.dialogs.batchApprove.reasonPlaceholder"),type:"textarea",rows:"3"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_42,[createBaseVNode("p",_hoisted_43,[_cache[35]||(_cache[35]=createBaseVNode("i",{class:"fas fa-info-circle mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.contentReview.dialogs.batchApprove.infoTitle"))+"： ",1)]),createBaseVNode("ul",_hoisted_44,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref($t)("admin.contentReview.dialogs.batchApprove.infoItems"),(item,index2)=>(openBlock(),createElementBlock("li",{key:index2},"• "+toDisplayString(item),1))),128))])])])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_Dialog,{modelValue:showBatchRejectDialog.value,"onUpdate:modelValue":_cache[15]||(_cache[15]=$event=>showBatchRejectDialog.value=$event),title:unref($t)("admin.contentReview.dialogs.batchReject.title"),loading:isBatchRejecting.value,onConfirm:executeBatchReject,onCancel:_cache[16]||(_cache[16]=$event=>showBatchRejectDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_45,[createBaseVNode("p",_hoisted_46,toDisplayString(unref($t)("admin.contentReview.dialogs.batchReject.message",{count:unref(selectedImages).length})),1),createBaseVNode("div",_hoisted_47,[createBaseVNode("label",_hoisted_48,toDisplayString(unref($t)("admin.contentReview.dialogs.batchReject.reasonLabel")),1),createVNode(_component_Input,{modelValue:batchRejectReason.value,"onUpdate:modelValue":_cache[13]||(_cache[13]=$event=>batchRejectReason.value=$event),placeholder:unref($t)("admin.contentReview.dialogs.batchReject.reasonPlaceholder"),type:"textarea",rows:"3"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_49,[createVNode(_component_cyberCheckbox,{modelValue:batchHardDelete.value,"onUpdate:modelValue":_cache[14]||(_cache[14]=$event=>batchHardDelete.value=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.dialogs.batchReject.hardDelete")),1)]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_Dialog,{modelValue:showApproveDialog.value,"onUpdate:modelValue":_cache[18]||(_cache[18]=$event=>showApproveDialog.value=$event),title:unref($t)("admin.contentReview.dialogs.approveSingle.title"),loading:isProcessingApprove.value,onConfirm:executeApprove,onCancel:_cache[19]||(_cache[19]=$event=>showApproveDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_50,[createBaseVNode("p",_hoisted_51,toDisplayString(unref($t)("admin.contentReview.dialogs.approveSingle.message")),1),createBaseVNode("div",_hoisted_52,[createBaseVNode("label",_hoisted_53,toDisplayString(unref($t)("admin.contentReview.dialogs.approveSingle.reasonLabel")),1),createVNode(_component_Input,{modelValue:approveReason.value,"onUpdate:modelValue":_cache[17]||(_cache[17]=$event=>approveReason.value=$event),placeholder:unref($t)("admin.contentReview.dialogs.approveSingle.reasonPlaceholder"),type:"textarea",rows:"3"},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_54,[createBaseVNode("p",_hoisted_55,[_cache[36]||(_cache[36]=createBaseVNode("i",{class:"fas fa-info-circle mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.contentReview.dialogs.approveSingle.infoTitle"))+"： ",1)]),createBaseVNode("ul",_hoisted_56,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref($t)("admin.contentReview.dialogs.approveSingle.infoItems"),(item,index2)=>(openBlock(),createElementBlock("li",{key:index2},"• "+toDisplayString(item),1))),128))])])])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_cyberFileViewer,{modelValue:showPreview.value,"onUpdate:modelValue":_cache[20]||(_cache[20]=$event=>showPreview.value=$event),file:previewImage.value},null,8,["modelValue","file"])],8,_hoisted_1$2)}}});const ReviewQueue=_export_sfc(_sfc_main$2,[["__scopeId","data-v-ea8a008a"]]),_hoisted_1$1={class:"review-logs-container"},_hoisted_2$1={class:"logs-header"},_hoisted_3$1={class:"header-actions"},_hoisted_4={key:1,class:"batch-controls"},_hoisted_5={class:"selection-info"},_hoisted_6={class:"selection-count"},_hoisted_7={class:"filter-panel mb-4 rounded-xl border border-subtle bg-background-600 p-4"},_hoisted_8={class:"mb-3 flex items-center justify-between"},_hoisted_9={class:"text-base font-bold text-content-heading"},_hoisted_10={class:"flex space-x-2"},_hoisted_11={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},_hoisted_12={class:"filter-item"},_hoisted_13={class:"mb-1 block text-sm text-content"},_hoisted_14={class:"filter-item"},_hoisted_15={class:"mb-1 block text-sm text-content"},_hoisted_16={class:"filter-item"},_hoisted_17={class:"mb-1 block text-sm text-content"},_hoisted_18={class:"filter-item"},_hoisted_19={class:"mb-1 block text-sm text-content"},_hoisted_20={class:"content-area"},_hoisted_21={key:1,class:"pagination-wrapper"},_hoisted_22={class:"space-y-4"},_hoisted_23={class:"warning-box"},_hoisted_24={class:"font-medium text-red-400"},_hoisted_25={class:"text-content"},_hoisted_26={class:"text-content-content-muted text-sm"},_hoisted_27={class:"space-y-4"},_hoisted_28={class:"text-content"},_hoisted_29={class:"text-content-content-muted text-sm"},_hoisted_30={class:"space-y-4"},_hoisted_31={class:"text-content"},_hoisted_32={class:"text-content-content-muted text-sm"},_hoisted_33={class:"mt-3 max-h-32 overflow-y-auto rounded bg-background-400 p-2"},_hoisted_34={class:"space-y-4"},_hoisted_35={class:"warning-box"},_hoisted_36={class:"font-medium text-red-400"},_hoisted_37={class:"text-content"},_hoisted_38={class:"text-content-content-muted text-sm"},_hoisted_39={class:"mt-3 max-h-32 overflow-y-auto rounded bg-background-400 p-2"},_sfc_main$1=defineComponent({name:"ReviewLogs",__name:"ReviewLogs",props:{isActive:{type:Boolean,default:!1}},setup(__props){const{$t}=useTexts(),props=__props,toast=useToast(),isLoading=ref(!1),showSkeleton=ref(!1),logs=ref([]),pagination=ref({page:1,page_size:10,total:0,total_page:1}),selectMode=ref(!1),selectedRows=ref([]),getSkeletonColumns=()=>[{type:"image",width:"60px",align:"center",title:$t("admin.contentReview.logs.columns.file"),imageSize:"small"},{type:"text",width:"180px",align:"center",title:$t("admin.contentReview.logs.columns.fileInfo"),textWidth:"70%"},{type:"badge",width:"120px",align:"center",title:$t("admin.contentReview.logs.columns.auditAction"),badgeStyle:"normal"},{type:"badge",width:"120px",align:"center",title:$t("admin.contentReview.logs.columns.deleteStatus"),badgeStyle:"warning"},{type:"text",width:"120px",align:"center",title:$t("admin.contentReview.logs.columns.auditor"),textWidth:"60%"},{type:"text",width:"140px",align:"center",title:$t("admin.contentReview.logs.columns.auditTime"),textWidth:"80%"},{type:"text",width:"120px",align:"center",title:$t("admin.contentReview.logs.columns.reason"),textWidth:"75%"},{type:"number",width:"100px",align:"center",title:$t("admin.contentReview.logs.columns.nsfwScore")},{type:"button",width:"120px",align:"center",title:$t("admin.contentReview.logs.columns.operations")}],getTableColumns=()=>[{key:"image",title:$t("admin.contentReview.logs.columns.file"),width:60,align:"center",render:(_value,record)=>h("div",{class:"image-cell"},[h("div",{class:"image-wrapper"},[record.image&&(record.image.full_thumb_url||record.image.thumb_url)?h("img",{src:record.image.full_thumb_url||record.image.thumb_url,alt:record.image.original_name,class:"table-image-thumb",onError:handleImageError}):h("div",{class:"image-placeholder"},[h("i",{class:"fas fa-image"})])])])},{key:"imageInfo",title:$t("admin.contentReview.logs.columns.fileInfo"),width:180,ellipsis:!0,align:"center",render:(_value,record)=>h("div",{class:"image-info-cell"},[h("div",{class:"image-name",title:record.image?.original_name||record.file_id},record.image?.original_name||$t("admin.contentReview.logs.text.fileId",{id:record.file_id})),record.image?h("div",{class:"image-meta"},[record.image.size_formatted?h("span",{class:"meta-item"},[h("i",{class:"fas fa-weight mr-1 text-xs text-brand-700"}),record.image.size_formatted]):null,record.image.width&&record.image.height?h("span",{class:"meta-item"},[h("i",{class:"fas fa-ruler-combined mr-1 text-xs text-brand-700"}),`${record.image.width}×${record.image.height}`]):null].filter(Boolean)):h("div",{class:"image-meta"},[h("span",{class:"meta-item no-info"},[h("i",{class:"fas fa-exclamation-triangle mr-1 text-xs text-yellow-400/70"}),$t("admin.contentReview.logs.text.fileInfoDeleted")])])])},{key:"action",dataIndex:"action",title:$t("admin.contentReview.logs.columns.auditAction"),width:120,align:"center",sortable:!0,render:(value,record)=>h("div",{class:"action-cell"},[h("span",{class:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${record.action==="approve"?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`},[h("i",{class:record.action==="approve"?"fas fa-check-circle mr-1":"fas fa-times-circle mr-1"}),record.action==="approve"?$t("admin.contentReview.logs.actions.approve"):$t("admin.contentReview.logs.actions.reject")])])},{key:"softDelete",title:$t("admin.contentReview.logs.columns.deleteStatus"),width:120,align:"center",sortable:!0,render:(_value,record)=>h("div",{class:"soft-delete-cell"},[record.action==="reject"&&record.delete_type?h("span",{class:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${getDeleteStatusVariant(record.delete_type,record.image?.status)}`},[h("i",{class:`${getDeleteStatusIcon(record.delete_type,record.image?.status)} mr-1`}),getDeleteStatusText(record.delete_type,record.image?.status)]):h("div",{class:"no-delete-status"},[h("span",{class:"status-placeholder"},"-")])])},{key:"auditor",dataIndex:"auditor",title:$t("admin.contentReview.logs.columns.auditor"),width:120,align:"center",sortable:!0,render:(_value,record)=>h("div",{class:"auditor-cell"},[h("div",{class:"auditor-name"},record.auditor?.username||$t("admin.contentReview.logs.text.unknownAuditor"))])},{key:"auditTime",dataIndex:"created_at",title:$t("admin.contentReview.logs.columns.auditTime"),width:140,align:"center",sortable:!0,render:(value,record)=>h("div",{class:"audit-time-cell"},[h("div",{class:"audit-time"},formatDateTime(record.created_at))])},{key:"reason",dataIndex:"reason",title:$t("admin.contentReview.logs.columns.reason"),width:120,ellipsis:!0,align:"center",render:(value,record)=>h("div",{class:"reason-cell"},[record.reason?h("div",{class:"reason-text",title:record.reason},truncateText(record.reason,40)):h("div",{class:"no-reason"},$t("admin.contentReview.logs.text.noDescription"))])},{key:"nsfw",dataIndex:"nsfw_score",title:$t("admin.contentReview.logs.columns.nsfwScore"),width:100,align:"center",sortable:!0,render:(value,record)=>h("div",{class:"nsfw-cell"},[record.nsfw_score!==null?h("div",{class:"nsfw-score"},[h("span",{class:`score-value ${getNsfwClass(record.nsfw_score)}`},`${(record.nsfw_score*100).toFixed(1)}%`)]):h("div",{class:"no-nsfw"},"-")])},{key:"operations",title:$t("admin.contentReview.logs.columns.operations"),width:120,align:"center",render:(_value,record)=>h("div",{class:"operations-cell"},[!selectMode.value&&record.action==="reject"&&record.delete_type==="soft"&&record.image?.status==="deleted"?h("div",{class:"operation-buttons"},[h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs bg-green-500/20 hover:bg-green-500/30 border border-green-500/30 text-green-400 rounded transition-all duration-200 mr-2",title:$t("admin.contentReview.logs.tooltips.restore"),disabled:isRestoring[record.file_id],onClick:e=>{e.stopPropagation(),confirmRestore(record)}},[isRestoring[record.file_id]?h("i",{class:"fas fa-spinner fa-spin"}):h("i",{class:"fas fa-undo"})]),h("button",{class:"inline-flex items-center justify-center w-7 h-7 text-xs bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 text-red-400 rounded transition-all duration-200",title:$t("admin.contentReview.logs.tooltips.hardDelete"),disabled:isHardDeleting[record.file_id],onClick:e=>{e.stopPropagation(),confirmHardDelete(record)}},[isHardDeleting[record.file_id]?h("i",{class:"fas fa-spinner fa-spin"}):h("i",{class:"fas fa-trash-alt"})])]):h("div",{class:"no-operations"},[h("span",{class:"text-xs text-content-disabled"},$t("admin.contentReview.logs.text.noOperations"))])])}],tableColumns=computed(()=>getTableColumns());computed(()=>getSkeletonColumns());const showFilter=ref(!1),searchKeyword=ref(""),actionFilter=ref(""),auditorFilter=ref(0),dateRange=ref([null,null]),actionOptions=computed(()=>[{label:$t("admin.contentReview.logs.filter.allActions"),value:""},{label:$t("admin.contentReview.logs.actions.approve"),value:"approve"},{label:$t("admin.contentReview.logs.actions.reject"),value:"reject"}]),auditorOptions=computed(()=>{const auditors=new Map;logs.value.forEach(log=>{log.auditor&&auditors.set(log.auditor.id,log.auditor)});const options=[{label:$t("admin.contentReview.logs.filter.allAuditors"),value:0}];return auditors.forEach(auditor=>{options.push({label:auditor.username,value:auditor.id})}),options}),hasValidSelection=computed(()=>selectedValidLogs.value.length>0),selectedValidLogs=computed(()=>logs.value.filter(log=>selectedRows.value.includes(log.id)&&isLogSelectable(log))),isHardDeleting=reactive({}),showHardDeleteDialog=ref(!1),selectedLog=ref(null),isExecutingHardDelete=ref(!1),isRestoring=reactive({}),showRestoreDialog=ref(!1),isExecutingRestore=ref(!1),showBatchRestoreDialog=ref(!1),isBatchRestoring=ref(!1),showBatchHardDeleteDialog=ref(!1),isBatchHardDeleting=ref(!1),handleDateRangeChange=range=>{dateRange.value=range,applyFilters()},loadData=async(page=1)=>{try{isLoading.value=!0,showSkeleton.value=!0;const params={page,size:pagination.value.page_size,keyword:searchKeyword.value||void 0,action:actionFilter.value||void 0,auditor_id:auditorFilter.value||void 0,date_from:dateRange.value[0]?formatDateForAPI(dateRange.value[0]):void 0,date_to:dateRange.value[1]?formatDateForAPI(dateRange.value[1]):void 0},response=await getReviewLogs(params);if(response.success&&response.data){logs.value=response.data.data||[];const p=response.data.pagination||{};pagination.value={page:p.page||1,page_size:p.page_size||pagination.value.page_size||10,total:p.total||0,total_page:p.total_page||1}}else logs.value=[],pagination.value={page:1,page_size:pagination.value.page_size,total:0,total_page:1}}catch{toast.error($t("admin.contentReview.logs.messages.loadError")),logs.value=[],pagination.value={page:1,page_size:pagination.value.page_size,total:0,total_page:1}}finally{isLoading.value=!1,showSkeleton.value=!1}},formatDateForAPI=date=>{const year=date.getFullYear(),month=(date.getMonth()+1).toString().padStart(2,"0"),day=date.getDate().toString().padStart(2,"0");return`${year}-${month}-${day}`},refreshData=()=>{loadData(pagination.value.page)},applyFilters=()=>{pagination.value.page=1,loadData(1)},resetFilters=()=>{searchKeyword.value="",actionFilter.value="",auditorFilter.value=0,dateRange.value=[null,null],pagination.value.page=1,loadData(1)},handlePageChange=page=>{pagination.value.page=page,loadData(page)},startSelectMode=()=>{selectMode.value=!0,selectedRows.value=[]},exitSelectMode=()=>{selectMode.value=!1,selectedRows.value=[]},isLogSelectable=log=>log.action==="reject"&&log.delete_type==="soft"&&log.image?.status==="deleted",handleRowClick=(_row,_index)=>{},confirmHardDelete=log=>{selectedLog.value=log,showHardDeleteDialog.value=!0},confirmRestore=log=>{selectedLog.value=log,showRestoreDialog.value=!0},executeRestore=async()=>{if(!selectedLog.value?.file_id)return;const fileId=selectedLog.value.file_id;try{isExecutingRestore.value=!0,isRestoring[fileId]=!0;const response=await restoreReviewedImage(fileId);response.success?(toast.success($t("admin.contentReview.logs.messages.restoreSuccess")),showRestoreDialog.value=!1,selectedLog.value=null,refreshData()):toast.error(response.message||$t("admin.contentReview.logs.messages.restoreError"))}catch{toast.error($t("admin.contentReview.logs.messages.restoreError"))}finally{isExecutingRestore.value=!1,isRestoring[fileId]=!1}},confirmBatchRestore=()=>{showBatchRestoreDialog.value=!0},executeBatchRestore=async()=>{if(selectedValidLogs.value.length!==0)try{isBatchRestoring.value=!0;const fileIds=selectedValidLogs.value.map(log=>log.file_id),response=await batchRestoreReviewedImages(fileIds);if(response.success){const successCount=response.data?.success_count||0,failCount=response.data?.fail_count||0;if(successCount>0){const failText=failCount>0?$t("admin.contentReview.logs.messages.batchRestoreSuccess",{success:successCount,failText:$t("admin.contentReview.logs.messages.failCount",{count:failCount})}):$t("admin.contentReview.logs.messages.batchRestoreSuccess",{success:successCount,failText:""});toast.success(failText)}else toast.error($t("admin.contentReview.logs.messages.batchRestoreError"))}else toast.error(response.message||$t("admin.contentReview.logs.messages.batchRestoreError"));showBatchRestoreDialog.value=!1,exitSelectMode(),refreshData()}catch{toast.error($t("admin.contentReview.logs.messages.batchRestoreError"))}finally{isBatchRestoring.value=!1}},confirmBatchHardDelete=()=>{showBatchHardDeleteDialog.value=!0},executeHardDelete=async()=>{if(!selectedLog.value?.file_id)return;const fileId=selectedLog.value.file_id;try{isExecutingHardDelete.value=!0,isHardDeleting[fileId]=!0;const response=await hardDeleteReviewedImage(fileId);response.success?(toast.success($t("admin.contentReview.logs.messages.hardDeleteSuccess")),showHardDeleteDialog.value=!1,selectedLog.value=null,refreshData()):toast.error(response.message||$t("admin.contentReview.logs.messages.hardDeleteError"))}catch{toast.error($t("admin.contentReview.logs.messages.hardDeleteError"))}finally{isExecutingHardDelete.value=!1,isHardDeleting[fileId]=!1}},executeBatchHardDelete=async()=>{if(selectedValidLogs.value.length!==0)try{isBatchHardDeleting.value=!0;const fileIds=selectedValidLogs.value.map(log=>log.file_id),response=await batchHardDeleteReviewedImages(fileIds);if(response.success){const successCount=response.data?.success_count||0,failCount=response.data?.fail_count||0;if(successCount>0){const failText=failCount>0?$t("admin.contentReview.logs.messages.batchHardDeleteSuccess",{success:successCount,failText:$t("admin.contentReview.logs.messages.failCount",{count:failCount})}):$t("admin.contentReview.logs.messages.batchHardDeleteSuccess",{success:successCount,failText:""});toast.success(failText)}else toast.error($t("admin.contentReview.logs.messages.batchHardDeleteError"))}else toast.error(response.message||$t("admin.contentReview.logs.messages.batchHardDeleteError"));showBatchHardDeleteDialog.value=!1,exitSelectMode(),refreshData()}catch{toast.error($t("admin.contentReview.logs.messages.batchHardDeleteError"))}finally{isBatchHardDeleting.value=!1}},formatDateTime=dateStr=>new Date(dateStr).toLocaleDateString(getCurrentLocale(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),getDeleteStatusVariant=(deleteType,imageStatus)=>deleteType==="hard"?"bg-red-500/20 text-red-400 border border-red-500/30":deleteType==="soft"&&imageStatus==="deleted"?"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30":"bg-blue-500/20 text-blue-400 border border-blue-500/30",getDeleteStatusIcon=(deleteType,imageStatus)=>deleteType==="hard"?"fa-trash":deleteType==="soft"?imageStatus==="deleted"?"fa-recycle":"fa-check-circle":"fa-question",getDeleteStatusText=(deleteType,imageStatus)=>$t(deleteType==="hard"?"admin.contentReview.logs.deleteStatus.hardDelete":deleteType==="soft"?imageStatus==="deleted"?"admin.contentReview.logs.deleteStatus.softDeleted":"admin.contentReview.logs.deleteStatus.restored":"admin.contentReview.logs.deleteStatus.unknown"),getNsfwClass=score=>score>=.8?"nsfw-high":score>=.6?"nsfw-medium":score>=.3?"nsfw-low":"nsfw-safe",truncateText=(text,maxLength)=>text.length<=maxLength?text:`${text.substring(0,maxLength)}...`,handleImageError=event=>{const img=event.target;img.src="/placeholder-image.png"};return watch(()=>props.isActive,newVal=>{newVal&&loadData(1)},{immediate:!0}),onMounted(()=>{props.isActive&&loadData(1)}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberDatePicker=resolveComponent("CyberDatePicker"),_component_CyberSkeleton=__unplugin_components_0$1,_component_CyberDataTable=resolveComponent("CyberDataTable"),_component_CyberPagination=resolveComponent("CyberPagination"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[_cache[19]||(_cache[19]=createBaseVNode("div",{class:"header-info"},null,-1)),createBaseVNode("div",_hoisted_3$1,[createVNode(_component_CyberButton,{type:"secondary",loading:isLoading.value,onClick:refreshData},{default:withCtx(()=>[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-sync-alt mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.refresh")),1)]),_:1},8,["loading"]),selectMode.value?(openBlock(),createElementBlock("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("span",_hoisted_6,toDisplayString(unref($t)("admin.contentReview.logs.batch.selected"))+" "+toDisplayString(unref($t)("admin.contentReview.logs.batch.selectedCount",{current:selectedRows.value.length,total:logs.value.length})),1)]),createVNode(_component_CyberButton,{type:"success",size:"small",disabled:selectedRows.value.length===0||!hasValidSelection.value,loading:isBatchRestoring.value,onClick:confirmBatchRestore},{default:withCtx(()=>[_cache[17]||(_cache[17]=createBaseVNode("i",{class:"fas fa-undo mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.batchRestore"))+" ("+toDisplayString(selectedRows.value.length)+") ",1)]),_:1},8,["disabled","loading"]),createVNode(_component_CyberButton,{type:"danger",size:"small",disabled:selectedRows.value.length===0||!hasValidSelection.value,loading:isBatchHardDeleting.value,onClick:confirmBatchHardDelete},{default:withCtx(()=>[_cache[18]||(_cache[18]=createBaseVNode("i",{class:"fas fa-trash mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.batchHardDelete"))+" ("+toDisplayString(selectedRows.value.length)+") ",1)]),_:1},8,["disabled","loading"]),createVNode(_component_CyberButton,{type:"secondary",size:"small",icon:"times",onClick:exitSelectMode},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.cancel")),1)]),_:1})])):(openBlock(),createBlock(_component_CyberButton,{key:0,type:"secondary",disabled:logs.value.length===0,onClick:startSelectMode},{default:withCtx(()=>[_cache[16]||(_cache[16]=createBaseVNode("i",{class:"fas fa-tasks mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.batchOperation")),1)]),_:1},8,["disabled"])),createVNode(_component_CyberButton,{type:"secondary",class:normalizeClass({"border-error-500 text-error-500":showFilter.value}),icon:"filter",onClick:_cache[0]||(_cache[0]=$event=>showFilter.value=!showFilter.value)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.buttons.filter")),1)]),_:1},8,["class"])])]),withDirectives(createBaseVNode("div",_hoisted_7,[createBaseVNode("div",_hoisted_8,[createBaseVNode("h4",_hoisted_9,[_cache[20]||(_cache[20]=createBaseVNode("i",{class:"fas fa-filter mr-1.5 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.filter.title")),1)]),createBaseVNode("div",_hoisted_10,[createVNode(_component_CyberButton,{type:"secondary",size:"small",icon:"undo-alt",onClick:resetFilters},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.filter.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",size:"small",icon:"search",onClick:applyFilters},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.contentReview.logs.filter.apply")),1)]),_:1})])]),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",_hoisted_12,[createBaseVNode("label",_hoisted_13,toDisplayString(unref($t)("admin.contentReview.logs.filter.keyword")),1),createVNode(_component_CyberInput,{modelValue:searchKeyword.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>searchKeyword.value=$event),placeholder:unref($t)("admin.contentReview.logs.filter.keywordPlaceholder"),onKeyup:withKeys(applyFilters,["enter"])},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_14,[createBaseVNode("label",_hoisted_15,toDisplayString(unref($t)("admin.contentReview.logs.filter.auditAction")),1),createVNode(_component_CyberDropdown,{modelValue:actionFilter.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>actionFilter.value=$event),options:actionOptions.value,placeholder:unref($t)("admin.contentReview.logs.filter.auditActionPlaceholder"),onChange:applyFilters},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_16,[createBaseVNode("label",_hoisted_17,toDisplayString(unref($t)("admin.contentReview.logs.filter.auditor")),1),createVNode(_component_CyberDropdown,{modelValue:auditorFilter.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>auditorFilter.value=$event),options:auditorOptions.value,placeholder:unref($t)("admin.contentReview.logs.filter.auditorPlaceholder"),onChange:applyFilters},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_18,[createBaseVNode("label",_hoisted_19,toDisplayString(unref($t)("admin.contentReview.logs.filter.dateRange")),1),createVNode(_component_CyberDatePicker,{modelValue:dateRange.value,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>dateRange.value=$event),type:"daterange",placeholder:unref($t)("admin.contentReview.logs.filter.dateRangePlaceholder"),"start-placeholder":unref($t)("admin.contentReview.logs.filter.startDatePlaceholder"),"end-placeholder":unref($t)("admin.contentReview.logs.filter.endDatePlaceholder"),onChange:handleDateRangeChange},null,8,["modelValue","placeholder","start-placeholder","end-placeholder"])])])],512),[[vShow,showFilter.value]]),createBaseVNode("div",_hoisted_20,[createVNode(_component_CyberSkeleton,{type:"table",count:pagination.value.page_size,loading:showSkeleton.value},null,8,["count","loading"]),showSkeleton.value?createCommentVNode("",!0):(openBlock(),createBlock(_component_CyberDataTable,{key:0,columns:tableColumns.value,data:logs.value,loading:!1,selectable:selectMode.value,"selected-row-keys":selectedRows.value,hoverable:!0,striped:!0,bordered:!0,"max-height":"calc(100vh - 350px)","empty-text":unref($t)("admin.contentReview.logs.empty.title"),"loading-text":unref($t)("admin.contentReview.logs.loading.text"),onRowClick:handleRowClick},null,8,["columns","data","selectable","selected-row-keys","empty-text","loading-text"])),pagination.value.total_page>1?(openBlock(),createElementBlock("div",_hoisted_21,[createVNode(_component_CyberPagination,{"current-page":pagination.value.page,"onUpdate:currentPage":[_cache[5]||(_cache[5]=$event=>pagination.value.page=$event),handlePageChange],"page-size":pagination.value.page_size,"onUpdate:pageSize":_cache[6]||(_cache[6]=$event=>pagination.value.page_size=$event),total:pagination.value.total},null,8,["current-page","page-size","total"])])):createCommentVNode("",!0)]),createVNode(_component_CyberDialog,{modelValue:showHardDeleteDialog.value,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>showHardDeleteDialog.value=$event),title:unref($t)("admin.contentReview.logs.dialogs.hardDelete.title"),loading:isExecutingHardDelete.value,onConfirm:executeHardDelete,onCancel:_cache[8]||(_cache[8]=$event=>showHardDeleteDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_22,[createBaseVNode("div",_hoisted_23,[_cache[21]||(_cache[21]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-2 text-red-400"},null,-1)),createBaseVNode("span",_hoisted_24,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.hardDelete.warning")),1)]),createBaseVNode("p",_hoisted_25,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.hardDelete.confirmMessage",{name:selectedLog.value?.image?.original_name})),1),createBaseVNode("p",_hoisted_26,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.hardDelete.description")),1)])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_CyberDialog,{modelValue:showRestoreDialog.value,"onUpdate:modelValue":_cache[9]||(_cache[9]=$event=>showRestoreDialog.value=$event),title:unref($t)("admin.contentReview.logs.dialogs.restore.title"),loading:isExecutingRestore.value,onConfirm:executeRestore,onCancel:_cache[10]||(_cache[10]=$event=>showRestoreDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_27,[createBaseVNode("p",_hoisted_28,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.restore.confirmMessage",{name:selectedLog.value?.image?.original_name})),1),createBaseVNode("p",_hoisted_29,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.restore.description")),1)])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_CyberDialog,{modelValue:showBatchRestoreDialog.value,"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>showBatchRestoreDialog.value=$event),title:unref($t)("admin.contentReview.logs.dialogs.batchRestore.title"),loading:isBatchRestoring.value,onConfirm:executeBatchRestore,onCancel:_cache[12]||(_cache[12]=$event=>showBatchRestoreDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_30,[createBaseVNode("p",_hoisted_31,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.batchRestore.confirmMessage",{count:selectedValidLogs.value.length})),1),createBaseVNode("p",_hoisted_32,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.batchRestore.description")),1),createBaseVNode("div",_hoisted_33,[(openBlock(!0),createElementBlock(Fragment,null,renderList(selectedValidLogs.value,log=>(openBlock(),createElementBlock("div",{key:log.id,class:"mb-1 text-xs text-content-muted"}," • "+toDisplayString(log.image?.original_name||log.file_id),1))),128))])])]),_:1},8,["modelValue","title","loading"]),createVNode(_component_CyberDialog,{modelValue:showBatchHardDeleteDialog.value,"onUpdate:modelValue":_cache[13]||(_cache[13]=$event=>showBatchHardDeleteDialog.value=$event),title:unref($t)("admin.contentReview.logs.dialogs.batchHardDelete.title"),loading:isBatchHardDeleting.value,onConfirm:executeBatchHardDelete,onCancel:_cache[14]||(_cache[14]=$event=>showBatchHardDeleteDialog.value=!1)},{default:withCtx(()=>[createBaseVNode("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[_cache[22]||(_cache[22]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-2 text-red-400"},null,-1)),createBaseVNode("span",_hoisted_36,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.batchHardDelete.warning")),1)]),createBaseVNode("p",_hoisted_37,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.batchHardDelete.confirmMessage",{count:selectedValidLogs.value.length})),1),createBaseVNode("p",_hoisted_38,toDisplayString(unref($t)("admin.contentReview.logs.dialogs.batchHardDelete.description")),1),createBaseVNode("div",_hoisted_39,[(openBlock(!0),createElementBlock(Fragment,null,renderList(selectedValidLogs.value,log=>(openBlock(),createElementBlock("div",{key:log.id,class:"mb-1 text-xs text-content-muted"}," • "+toDisplayString(log.image?.original_name||log.file_id),1))),128))])])]),_:1},8,["modelValue","title","loading"])])}}});const ReviewLogs=_export_sfc(_sfc_main$1,[["__scopeId","data-v-a9ca19c9"]]),_hoisted_1={class:"admin-content-review-page admin-page-container"},_hoisted_2={class:"tab-panel"},_hoisted_3={class:"tab-panel"},_sfc_main=defineComponent({name:"ContentReviewPage",__name:"index",setup(__props){const{$t}=useTexts(),tabs=computed(()=>[{key:"queue",name:$t("admin.contentReview.tabs.queue"),icon:"fas fa-clock",badge:"0"},{key:"logs",name:$t("admin.contentReview.tabs.logs"),icon:"fas fa-history"}]),activeTab=ref("queue"),reviewQueueRef=ref(),handleTabChange=tabId=>{activeTab.value=tabId},refreshStats=stats=>{const queueTab=tabs.value.find(tab=>tab.key==="queue");queueTab&&stats?.pending_count!==void 0&&(queueTab.badge=stats.pending_count.toString())};return(_ctx,_cache)=>{const _component_CyberSidebarNav=__unplugin_components_0$2,_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.contentReview.title"),subtitle:unref($t)("admin.contentReview.subtitle"),icon:"fas fa-gavel","sidebar-layout":!0},{sidebar:withCtx(()=>[createVNode(_component_CyberSidebarNav,{tabs:tabs.value,"active-tab":activeTab.value,onTabChange:handleTabChange},null,8,["tabs","active-tab"])]),content:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_2,[createVNode(ReviewQueue,{ref_key:"reviewQueueRef",ref:reviewQueueRef,"is-active":activeTab.value==="queue",onRefreshStats:refreshStats},null,8,["is-active"])],512),[[vShow,activeTab.value==="queue"]]),withDirectives(createBaseVNode("div",_hoisted_3,[createVNode(ReviewLogs,{"is-active":activeTab.value==="logs"},null,8,["is-active"])],512),[[vShow,activeTab.value==="logs"]])]),_:1},8,["title","subtitle"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-bf0e7fc4"]]);export{index as default};
