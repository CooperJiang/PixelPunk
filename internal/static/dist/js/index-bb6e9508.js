import{j as useTexts,_ as _export_sfc,a3 as getValidationRules,a6 as Validator,ay as formatDate,q as useToast}from"./index-38202212.js";import{g as getTagList,u as updateTag,c as createTag,b as batchOperateTags,d as deleteTag}from"./index-e88312c6.js";import{d as defineComponent,a3 as useRouter,r as ref,c as computed,b as onMounted,o as onUnmounted,w as watch,G as resolveDirective,z as openBlock,I as createElementBlock,H as withDirectives,u as unref,a0 as createBaseVNode,a1 as toDisplayString,F as Fragment,M as renderList,ab as createTextVNode,R as normalizeClass,a5 as withModifiers,K as createCommentVNode,A as createBlock,L as withCtx,E as resolveComponent,f as createVNode}from"./vue-vendor-31320f47.js";import{g as groupTagsByLetter,a as getAvailableLetters}from"./pinyin-291c7dd8.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";import"./pinyin-02edb7aa.js";const _hoisted_1$3={class:"tag-cloud-container"},_hoisted_2$3={key:0,class:"loading-state"},_hoisted_3$3={key:1,class:"empty-state"},_hoisted_4$3={class:"empty-content animate-slide-up"},_hoisted_5$3={class:"empty-title"},_hoisted_6$3={class:"empty-desc"},_hoisted_7$3={key:2,class:"tags-wrapper"},_hoisted_8$3=["data-letter-group"],_hoisted_9$3={class:"letter-group-header"},_hoisted_10$3={class:"letter-badge"},_hoisted_11$3={class:"letter-stats"},_hoisted_12$3={class:"stat-item"},_hoisted_13$3={class:"stat-item"},_hoisted_14$3={class:"tags-grid"},_hoisted_15$2=["data-tag-id","onMouseenter","onClick"],_hoisted_16$2={class:"tag-content"},_hoisted_17$2={class:"tag-name"},_hoisted_18$2={class:"tag-count"},_hoisted_19$1=["title","onClick"],_hoisted_20$1=["title","onClick"],_hoisted_21$1={class:"letter-navigation"},_hoisted_22={class:"letter-nav-inner"},_hoisted_23=["title","onClick"],_hoisted_24={key:0,class:"keyboard-hint-fixed"},_hoisted_25={class:"hint-text"},_hoisted_26={class:"kbd"},_sfc_main$3=defineComponent({__name:"TagCloud",props:{tags:{type:Array,required:!0},isLoading:{type:Boolean,default:!1},selectedTagIds:{type:Array,default:()=>[]},totalTags:{type:Number,default:0},isBatchMode:{type:Boolean,default:!1}},emits:["select","edit","delete"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,router=useRouter(),highlightedTagId=ref(null),activeLetter=ref(""),scrollContainer=ref(null),isMultiSelectMode=ref(!1),tempSelectedTags=ref([]),isMac=ref(!1),modifierKeyName=ref("Ctrl"),detectOS=()=>{const userAgent=window.navigator.userAgent.toLowerCase(),platform=window.navigator.platform.toLowerCase();isMac.value=/mac|iphone|ipad|ipod/.test(userAgent)||/mac/.test(platform),modifierKeyName.value=isMac.value?"Command":"Ctrl"},groupedTags=computed(()=>groupTagsByLetter(props.tags,"count")),availableLetters=computed(()=>getAvailableLetters(groupedTags.value)),allLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ#".split(""),getGroupInfo=letter=>{const tags=groupedTags.value[letter]||[],totalCount=tags.reduce((sum,tag)=>sum+(tag.count||0),0);return{count:tags.length,totalUsage:totalCount}},scrollToLetter=letter=>{const element=document.querySelector(`[data-letter-group="${letter}"]`);if(element&&scrollContainer.value){const containerTop=scrollContainer.value.getBoundingClientRect().top,offset=element.getBoundingClientRect().top-containerTop-20;scrollContainer.value.scrollTo({top:scrollContainer.value.scrollTop+offset,behavior:"smooth"})}},handleScroll=()=>{if(!scrollContainer.value)return;const containerTop=scrollContainer.value.getBoundingClientRect().top,groups=scrollContainer.value.querySelectorAll("[data-letter-group]");let currentLetter="";groups.forEach(group=>{group.getBoundingClientRect().top-containerTop<=100&&(currentLetter=group.getAttribute("data-letter-group")||"")}),currentLetter&&(activeLetter.value=currentLetter)},toggleTagSelection=tag=>{emit("select",tag)},goToImagesByTag=tags=>{const tagArray=Array.isArray(tags)?tags:[tags],tagIds=tagArray.map(t=>t.id).join(","),tagNames=tagArray.map(t=>t.name).join(",");router.push({name:"adminFiles",query:{tag_id:tagIds,tag_name:tagNames}})},handleTagClick=tag=>{if(props.isBatchMode){toggleTagSelection(tag);return}if(isMultiSelectMode.value){const index2=tempSelectedTags.value.indexOf(tag.id);index2===-1?tempSelectedTags.value.push(tag.id):tempSelectedTags.value.splice(index2,1);return}goToImagesByTag(tag)},checkModifierKey=event=>event.altKey||event.ctrlKey||event.metaKey,handleKeyDown=event=>{checkModifierKey(event)&&!props.isBatchMode&&(isMultiSelectMode.value=!0)},handleKeyUp=event=>{if(!event.altKey&&!event.ctrlKey&&!event.metaKey&&(isMultiSelectMode.value=!1,tempSelectedTags.value.length>0)){const selectedTags=props.tags.filter(t=>tempSelectedTags.value.includes(t.id));goToImagesByTag(selectedTags),tempSelectedTags.value=[]}},handleWindowBlur=()=>{isMultiSelectMode.value=!1,tempSelectedTags.value=[]};onMounted(()=>{detectOS(),window.addEventListener("keydown",handleKeyDown),window.addEventListener("keyup",handleKeyUp),window.addEventListener("blur",handleWindowBlur),scrollContainer.value&&scrollContainer.value.addEventListener("scroll",handleScroll)}),onUnmounted(()=>{window.removeEventListener("keydown",handleKeyDown),window.removeEventListener("keyup",handleKeyUp),window.removeEventListener("blur",handleWindowBlur),scrollContainer.value&&scrollContainer.value.removeEventListener("scroll",handleScroll)});const positionCache=ref(new Map),estimatedTagsPerRow=ref(Math.floor(window.innerWidth/200));watch(()=>props.tags.length,()=>{positionCache.value.clear(),estimatedTagsPerRow.value=Math.floor(window.innerWidth/200)});const getActionPosition=tagId=>{const cached=positionCache.value.get(tagId);if(cached)return cached;const tagIndex=props.tags.findIndex(tag=>tag.id===tagId);if(tagIndex===-1)return"actions-below";const currentRow=Math.floor(tagIndex/estimatedTagsPerRow.value),totalRows=Math.ceil(props.tags.length/estimatedTagsPerRow.value),position=currentRow<totalRows/2?"actions-below":"actions-above";return positionCache.value.set(tagId,position),position};return(_ctx,_cache)=>{const _directive_loading=resolveDirective("loading");return openBlock(),createElementBlock("div",_hoisted_1$3,[__props.isLoading?withDirectives((openBlock(),createElementBlock("div",_hoisted_2$3,null,512)),[[_directive_loading,{loading:!0,text:unref($t)("admin.tags.cloud.loading"),type:"default"}]]):__props.tags.length===0?(openBlock(),createElementBlock("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$3,[_cache[1]||(_cache[1]=createBaseVNode("div",{class:"empty-icon-wrapper"},[createBaseVNode("i",{class:"fas fa-tags empty-icon"})],-1)),createBaseVNode("h3",_hoisted_5$3,toDisplayString(unref($t)("admin.tags.cloud.emptyTitle")),1),createBaseVNode("p",_hoisted_6$3,toDisplayString(unref($t)("admin.tags.cloud.emptyDesc")),1)])])):(openBlock(),createElementBlock("div",_hoisted_7$3,[createBaseVNode("div",{ref_key:"scrollContainer",ref:scrollContainer,class:"tag-groups-container"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(availableLetters.value,letter=>(openBlock(),createElementBlock("div",{key:letter,"data-letter-group":letter,class:"letter-group"},[createBaseVNode("div",_hoisted_9$3,[createBaseVNode("div",_hoisted_10$3,toDisplayString(letter),1),createBaseVNode("div",_hoisted_11$3,[createBaseVNode("span",_hoisted_12$3,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-tags mr-1"},null,-1)),createTextVNode(" "+toDisplayString(getGroupInfo(letter).count)+" "+toDisplayString(unref($t)("admin.tags.cloud.tagsCount")),1)]),_cache[4]||(_cache[4]=createBaseVNode("span",{class:"stat-divider"},"Â·",-1)),createBaseVNode("span",_hoisted_13$3,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-chart-line mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.tags.cloud.usage"))+" "+toDisplayString(getGroupInfo(letter).totalUsage)+" "+toDisplayString(unref($t)("admin.tags.cloud.times")),1)])])]),createBaseVNode("div",_hoisted_14$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(groupedTags.value[letter],tag=>(openBlock(),createElementBlock("div",{key:tag.id,"data-tag-id":tag.id,class:normalizeClass(["tag-item",[{selected:__props.selectedTagIds.includes(tag.id)||tempSelectedTags.value.includes(tag.id)},{highlight:highlightedTagId.value===tag.id},{"multi-select-mode":isMultiSelectMode.value}]]),onMouseenter:$event=>highlightedTagId.value=tag.id,onMouseleave:_cache[0]||(_cache[0]=$event=>highlightedTagId.value=null),onClick:$event=>handleTagClick(tag)},[createBaseVNode("div",_hoisted_16$2,[createBaseVNode("span",_hoisted_17$2,toDisplayString(tag.name),1),createBaseVNode("span",_hoisted_18$2,toDisplayString(tag.count),1)]),highlightedTagId.value===tag.id&&!__props.isBatchMode&&!isMultiSelectMode.value?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["tag-actions",getActionPosition(tag.id)])},[createBaseVNode("button",{class:"action-btn edit-btn",title:unref($t)("admin.tags.cloud.editTitle"),onClick:withModifiers($event=>_ctx.$emit("edit",tag),["stop"])},[..._cache[5]||(_cache[5]=[createBaseVNode("i",{class:"fas fa-edit"},null,-1)])],8,_hoisted_19$1),createBaseVNode("button",{class:"action-btn delete-btn",title:unref($t)("admin.tags.cloud.deleteTitle"),onClick:withModifiers($event=>_ctx.$emit("delete",tag),["stop"])},[..._cache[6]||(_cache[6]=[createBaseVNode("i",{class:"fas fa-trash-alt"},null,-1)])],8,_hoisted_20$1)],2)):createCommentVNode("",!0)],42,_hoisted_15$2))),128))])],8,_hoisted_8$3))),128))],512),createBaseVNode("div",_hoisted_21$1,[createBaseVNode("div",_hoisted_22,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(allLetters),letter=>(openBlock(),createElementBlock("div",{key:letter,class:normalizeClass(["letter-nav-item",{active:activeLetter.value===letter,disabled:!availableLetters.value.includes(letter)}]),title:availableLetters.value.includes(letter)?`${letter} (${getGroupInfo(letter).count})`:`${letter} (${unref($t)("admin.tags.cloud.letterEmpty")})`,onClick:$event=>availableLetters.value.includes(letter)&&scrollToLetter(letter)},toDisplayString(letter),11,_hoisted_23))),128))])]),__props.isBatchMode?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_24,[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-keyboard mr-1.5"},null,-1)),createBaseVNode("span",_hoisted_25,[createTextVNode(toDisplayString(unref($t)("admin.tags.cloud.keyboardHint"))+" ",1),createBaseVNode("kbd",_hoisted_26,toDisplayString(modifierKeyName.value),1),_cache[7]||(_cache[7]=createTextVNode(" / ",-1)),_cache[8]||(_cache[8]=createBaseVNode("kbd",{class:"kbd"},"Alt",-1)),createTextVNode(" "+toDisplayString(unref($t)("admin.tags.cloud.keyboardHintAction")),1)])]))]))])}}});const TagCloud=_export_sfc(_sfc_main$3,[["__scopeId","data-v-7bcde2a1"]]),_hoisted_1$2={class:"tag-form"},_hoisted_2$2={class:"form-section"},_hoisted_3$2={class:"cyber-form-item"},_hoisted_4$2={class:"mb-1 block text-sm text-content-heading"},_hoisted_5$2={key:0,class:"text-accent mt-1 text-xs"},_hoisted_6$2={key:1,class:"mt-1 text-xs text-content-muted"},_hoisted_7$2={key:0,class:"mt-4 rounded-md bg-background-900 p-3"},_hoisted_8$2={class:"flex items-center justify-between"},_hoisted_9$2={class:"text-sm text-content"},_hoisted_10$2={class:"font-medium text-content"},_hoisted_11$2={key:0,class:"mt-2 flex items-center justify-between"},_hoisted_12$2={class:"text-sm text-content"},_hoisted_13$2={class:"text-sm text-content"},_hoisted_14$2={key:1,class:"mt-2 flex items-center justify-between"},_hoisted_15$1={class:"text-sm text-content"},_hoisted_16$1={class:"text-sm text-content"},_hoisted_17$1={class:"mt-3 border-t border-default pt-2 text-xs text-content-muted"},_hoisted_18$1={class:"flex justify-end gap-2 p-4"},_sfc_main$2=defineComponent({__name:"TagFormModal",props:{visible:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},editingTag:{type:Object,default:null},isSubmitting:{type:Boolean,default:!1}},emits:["close","submit"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,dialogVisible=computed({get:()=>props.visible,set:value=>{value||emit("close")}}),formData=ref({name:""}),nameError=ref(""),R=getValidationRules($t),isFormValid=computed(()=>formData.value.name.trim().length>0&&!nameError.value);watch(()=>props.editingTag,newTag=>{newTag&&(formData.value.name=newTag.name)},{immediate:!0});const resetForm=()=>{formData.value.name=props.editingTag?props.editingTag.name:"",nameError.value=""},onClose=()=>{resetForm(),emit("close")},submitForm=()=>{const check=Validator.validate(formData.value.name.trim(),[R.required,R.maxLength(50)],$t);if(!check.valid){nameError.value=check.message||$t("admin.tags.form.nameEmpty");return}emit("submit",{...props.editingTag,name:formData.value.name.trim()})},formatDate$1=dateStr=>formatDate(dateStr,"YYYY-MM-DD HH:mm");return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:dialogVisible.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>dialogVisible.value=$event),title:__props.isEditing?unref($t)("admin.tags.form.editTitle"):unref($t)("admin.tags.form.createTitle"),width:"450",onClose},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_18$1,[createVNode(_component_CyberButton,{type:"secondary",onClick:onClose},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.tags.form.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",loading:__props.isSubmitting,disabled:!isFormValid.value||__props.isSubmitting,onClick:submitForm},{default:withCtx(()=>[createTextVNode(toDisplayString(__props.isEditing?unref($t)("admin.tags.form.update"):unref($t)("admin.tags.form.create")),1)]),_:1},8,["loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("label",_hoisted_4$2,toDisplayString(unref($t)("admin.tags.form.nameLabel")),1),createVNode(_component_CyberInput,{modelValue:formData.value.name,"onUpdate:modelValue":[_cache[0]||(_cache[0]=$event=>formData.value.name=$event),_cache[1]||(_cache[1]=$event=>nameError.value="")],placeholder:unref($t)("admin.tags.form.namePlaceholder"),maxlength:50,"show-character-count":"",class:"my-2 w-full",status:nameError.value?"error":""},null,8,["modelValue","placeholder","status"]),nameError.value?(openBlock(),createElementBlock("div",_hoisted_5$2,toDisplayString(nameError.value),1)):(openBlock(),createElementBlock("p",_hoisted_6$2,toDisplayString(unref($t)("admin.tags.form.nameDesc")),1))])]),__props.isEditing&&__props.editingTag?(openBlock(),createElementBlock("div",_hoisted_7$2,[createBaseVNode("div",_hoisted_8$2,[createBaseVNode("span",_hoisted_9$2,toDisplayString(unref($t)("admin.tags.form.usageCount")),1),createBaseVNode("span",_hoisted_10$2,toDisplayString(__props.editingTag.count),1)]),__props.editingTag.created_at?(openBlock(),createElementBlock("div",_hoisted_11$2,[createBaseVNode("span",_hoisted_12$2,toDisplayString(unref($t)("admin.tags.form.createdAt")),1),createBaseVNode("span",_hoisted_13$2,toDisplayString(formatDate$1(__props.editingTag.created_at)),1)])):createCommentVNode("",!0),__props.editingTag.updated_at?(openBlock(),createElementBlock("div",_hoisted_14$2,[createBaseVNode("span",_hoisted_15$1,toDisplayString(unref($t)("admin.tags.form.updatedAt")),1),createBaseVNode("span",_hoisted_16$1,toDisplayString(formatDate$1(__props.editingTag.updated_at)),1)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_17$1,[createBaseVNode("p",null,toDisplayString(unref($t)("admin.tags.form.editWarning")),1)])])):createCommentVNode("",!0)])]),_:1},8,["modelValue","title"])}}});const TagFormModal=_export_sfc(_sfc_main$2,[["__scopeId","data-v-b847b55d"]]),_hoisted_1$1={class:"batch-operation-form"},_hoisted_2$1={class:"selected-tags-info mb-3 rounded-md p-3"},_hoisted_3$1={class:"flex items-center justify-between"},_hoisted_4$1={class:"text-content-heading"},_hoisted_5$1={class:"text-accent font-medium"},_hoisted_6$1={key:0,class:"selected-tags-list mt-2"},_hoisted_7$1={class:"flex flex-wrap gap-1"},_hoisted_8$1={class:"ml-1 text-xs text-content"},_hoisted_9$1={key:0,class:"tag-chip more-tag"},_hoisted_10$1={class:"form-section"},_hoisted_11$1={class:"cyber-form-item"},_hoisted_12$1={class:"mb-2 block text-sm text-content-heading"},_hoisted_13$1={class:"operation-type-selector mb-1"},_hoisted_14$1={key:0,class:"cyber-form-item mt-4"},_hoisted_15={class:"mb-2 block text-sm text-content-heading"},_hoisted_16={key:0,class:"text-accent mt-1 text-xs"},_hoisted_17={key:1,class:"text-content-content-muted mt-1 text-xs"},_hoisted_18={class:"flex items-start"},_hoisted_19={class:"warning-title text-sm font-medium"},_hoisted_20={class:"warning-desc mt-1 text-xs"},_hoisted_21={class:"flex justify-end gap-2 p-4"},maxDisplayTags=6,_sfc_main$1=defineComponent({__name:"BatchOperationModal",props:{visible:{type:Boolean,default:!1},selectedTags:{type:Array,default:()=>[]},availableTags:{type:Array,default:()=>[]},isSubmitting:{type:Boolean,default:!1}},emits:["close","submit"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,dialogVisible=computed({get:()=>props.visible,set:value=>{value||emit("close")}}),operationOptions=computed(()=>[{label:$t("admin.tags.batchOperation.deleteOption"),value:"delete"},{label:$t("admin.tags.batchOperation.mergeOption"),value:"merge"}]),formData=ref({action:"delete",targetId:null}),targetError=ref(""),R=getValidationRules($t),isFormValid=computed(()=>formData.value.action==="merge"?formData.value.targetId!==null&&!targetError.value:!0),submitButtonText=computed(()=>props.isSubmitting?$t("status.processing"):formData.value.action==="delete"?$t("admin.tags.batchOperation.deleteButton").replace("{count}",String(props.selectedTags.length)):$t("admin.tags.batchOperation.mergeButton")),targetOptions=computed(()=>{const selectedIds=props.selectedTags.map(tag=>tag.id);return props.availableTags.filter(tag=>!selectedIds.includes(tag.id)).map(tag=>({label:`${tag.name} (${$t("admin.tags.batchOperation.usageTimesSuffix").replace("{count}",String(tag.count))})`,value:tag.id}))}),displayedTags=computed(()=>props.selectedTags.slice(0,maxDisplayTags)),warningText=computed(()=>formData.value.action==="delete"?$t("admin.tags.batchOperation.deleteWarning").replace("{count}",String(getTotalImagesCount())):$t("admin.tags.batchOperation.mergeWarning").replace("{count}",String(getTotalImagesCount()))),warningClass=computed(()=>formData.value.action==="delete"?"warning-delete":"warning-merge"),getTotalImagesCount=()=>props.selectedTags.reduce((sum,tag)=>sum+tag.count,0),resetForm=()=>{formData.value={action:"delete",targetId:null},targetError.value=""},onClose=()=>{resetForm(),emit("close")},submitForm=()=>{if(formData.value.action==="merge"){const check=Validator.validate(formData.value.targetId,[R.required],$t);if(!check.valid){targetError.value=check.message||$t("admin.tags.batchOperation.targetError");return}}const operation={action:formData.value.action,tag_ids:props.selectedTags.map(tag=>tag.id)};formData.value.action==="merge"&&(operation.target=formData.value.targetId),emit("submit",operation)};return watch(()=>props.selectedTags,newTags=>{const selectedIds=newTags.map(tag=>tag.id);formData.value.targetId&&selectedIds.includes(formData.value.targetId)&&(formData.value.targetId=null)},{deep:!0}),(_ctx,_cache)=>{const _component_CyberRadioGroup=resolveComponent("CyberRadioGroup"),_component_CyberDropdown=resolveComponent("CyberDropdown"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:dialogVisible.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>dialogVisible.value=$event),title:unref($t)("admin.tags.batchOperation.title"),width:"480",onClose},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_21,[createVNode(_component_CyberButton,{type:"secondary",onClick:onClose},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.tags.batchOperation.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:formData.value.action==="delete"?"danger":"primary",loading:__props.isSubmitting,disabled:!isFormValid.value||__props.isSubmitting,onClick:submitForm},{default:withCtx(()=>[createTextVNode(toDisplayString(submitButtonText.value),1)]),_:1},8,["type","loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("span",_hoisted_4$1,toDisplayString(unref($t)("admin.tags.batchOperation.selectedLabel")),1),createBaseVNode("span",_hoisted_5$1,toDisplayString(__props.selectedTags.length)+" "+toDisplayString(unref($t)("admin.tags.batchOperation.selectedCount")),1)]),__props.selectedTags.length>0?(openBlock(),createElementBlock("div",_hoisted_6$1,[createBaseVNode("div",_hoisted_7$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(displayedTags.value,tag=>(openBlock(),createElementBlock("div",{key:tag.id,class:"tag-chip"},[createTextVNode(toDisplayString(tag.name)+" ",1),createBaseVNode("span",_hoisted_8$1,"("+toDisplayString(tag.count)+")",1)]))),128)),__props.selectedTags.length>maxDisplayTags?(openBlock(),createElementBlock("div",_hoisted_9$1," +"+toDisplayString(__props.selectedTags.length-maxDisplayTags)+" "+toDisplayString(unref($t)("admin.tags.batchOperation.moreCount")),1)):createCommentVNode("",!0)])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_10$1,[createBaseVNode("div",_hoisted_11$1,[createBaseVNode("label",_hoisted_12$1,toDisplayString(unref($t)("admin.tags.batchOperation.operationType")),1),createBaseVNode("div",_hoisted_13$1,[createVNode(_component_CyberRadioGroup,{modelValue:formData.value.action,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>formData.value.action=$event),options:operationOptions.value,layout:"horizontal"},null,8,["modelValue","options"])])]),formData.value.action==="merge"?(openBlock(),createElementBlock("div",_hoisted_14$1,[createBaseVNode("label",_hoisted_15,toDisplayString(unref($t)("admin.tags.batchOperation.targetLabel")),1),createVNode(_component_CyberDropdown,{modelValue:formData.value.targetId,"onUpdate:modelValue":[_cache[1]||(_cache[1]=$event=>formData.value.targetId=$event),_cache[2]||(_cache[2]=$event=>targetError.value="")],options:targetOptions.value,placeholder:unref($t)("admin.tags.batchOperation.targetPlaceholder"),class:"w-full",status:targetError.value?"error":""},null,8,["modelValue","options","placeholder","status"]),targetError.value?(openBlock(),createElementBlock("div",_hoisted_16,toDisplayString(targetError.value),1)):(openBlock(),createElementBlock("p",_hoisted_17,toDisplayString(unref($t)("admin.tags.batchOperation.mergeDesc")),1))])):createCommentVNode("",!0)]),createBaseVNode("div",{class:normalizeClass(["warning-section mt-4 rounded-md p-3",warningClass.value])},[createBaseVNode("div",_hoisted_18,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-2 mt-0.5 text-sm"},null,-1)),createBaseVNode("div",null,[createBaseVNode("p",_hoisted_19,toDisplayString(unref($t)("admin.tags.batchOperation.warningTitle")),1),createBaseVNode("p",_hoisted_20,toDisplayString(warningText.value),1)])])],2)])]),_:1},8,["modelValue","title"])}}});const BatchOperationModal=_export_sfc(_sfc_main$1,[["__scopeId","data-v-6979a832"]]),_hoisted_1={class:"admin-tags-page admin-page-container"},_hoisted_2={class:"search-input-wrapper"},_hoisted_3={class:"admin-content-wrapper"},_hoisted_4={class:"tags-content"},_hoisted_5={key:0,class:"batch-mode-notice"},_hoisted_6={class:"font-medium text-brand-400"},_hoisted_7={class:"mb-4"},_hoisted_8={class:"text-content"},_hoisted_9={class:"font-medium text-brand-400"},_hoisted_10={class:"mt-3 rounded-lg bg-background-700 p-3 text-xs"},_hoisted_11={class:"text-content-muted"},_hoisted_12={class:"font-medium text-content"},_hoisted_13={class:"mt-2 font-medium text-error-400"},_hoisted_14={class:"flex justify-end gap-2 p-4"},_sfc_main=defineComponent({__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),router=useRouter(),isLoading=ref(!1),isSubmitting=ref(!1),isDeleting=ref(!1),isBatchProcessing=ref(!1),isBatchMode=ref(!1),totalTags=ref(0),allTags=ref([]),searchKeyword=ref(""),selectedTagIds=ref([]),showCreateModal=ref(!1),showEditModal=ref(!1),showDeleteConfirm=ref(!1),showBatchOperationModal=ref(!1),editingTag=ref(null),deletingTag=ref(null),filteredTags=computed(()=>{if(!searchKeyword.value.trim())return allTags.value;const keyword=searchKeyword.value.toLowerCase().trim();return allTags.value.filter(tag=>tag.name.toLowerCase().includes(keyword))}),showModalVisible=computed({get:()=>showCreateModal.value||showEditModal.value,set:value=>{value||closeFormModal()}}),loadTags=async()=>{try{isLoading.value=!0;const response=await getTagList({keyword:"",page:1,size:1e4});allTags.value=response.data.items||[],totalTags.value=response.data.total;const newIds=allTags.value.map(tag=>tag.id);selectedTagIds.value=selectedTagIds.value.filter(id=>newIds.includes(id))}catch{}finally{isLoading.value=!1}},toggleTagSelection=tag=>{const index2=selectedTagIds.value.indexOf(tag.id);index2===-1?selectedTagIds.value.push(tag.id):selectedTagIds.value.splice(index2,1)},clearSelection=()=>{selectedTagIds.value=[]},openEditModal=tag=>{editingTag.value=tag,showEditModal.value=!0},closeFormModal=()=>{showCreateModal.value=!1,showEditModal.value=!1,editingTag.value=null},submitTagForm=async formData=>{try{isSubmitting.value=!0,showEditModal.value&&editingTag.value?(await updateTag({id:editingTag.value.id,name:formData.name}),toast.success($t("admin.tags.messages.tagUpdated"))):(await createTag({name:formData.name}),toast.success($t("admin.tags.messages.tagCreated"))),closeFormModal(),loadTags()}catch{}finally{isSubmitting.value=!1}},confirmDeleteTag=tag=>{deletingTag.value=tag,showDeleteConfirm.value=!0},deleteTag$1=async()=>{if(deletingTag.value)try{isDeleting.value=!0,await deleteTag(deletingTag.value.id),toast.success($t("admin.tags.messages.tagDeleted")),showDeleteConfirm.value=!1;const index2=selectedTagIds.value.indexOf(deletingTag.value.id);index2!==-1&&selectedTagIds.value.splice(index2,1),loadTags()}catch{}finally{isDeleting.value=!1}},getSelectedTags=()=>(allTags.value||[]).filter(tag=>selectedTagIds.value.includes(tag.id)),doBatchOperation=async operation=>{try{isBatchProcessing.value=!0,await batchOperateTags(operation),operation.action==="delete"?toast.success($t("admin.tags.messages.batchDeleted")):toast.success($t("admin.tags.messages.batchMerged")),showBatchOperationModal.value=!1,selectedTagIds.value=[],loadTags()}catch{}finally{isBatchProcessing.value=!1}},toggleBatchMode=()=>{isBatchMode.value=!isBatchMode.value,isBatchMode.value||(selectedTagIds.value=[])},viewSelectedTagsImages=()=>{if(selectedTagIds.value.length===0)return;const tagIds=selectedTagIds.value.join(",");router.push({name:"adminFiles",query:{tag_id:tagIds}})};return onMounted(()=>{loadTags()}),(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberAdminWrapper=resolveComponent("CyberAdminWrapper"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberAdminWrapper,{title:unref($t)("admin.tags.title"),subtitle:unref($t)("admin.tags.subtitle"),icon:"fas fa-tags"},{actions:withCtx(()=>[createBaseVNode("div",_hoisted_2,[createVNode(_component_CyberInput,{modelValue:searchKeyword.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>searchKeyword.value=$event),placeholder:unref($t)("admin.tags.searchPlaceholder"),size:"small",clearable:""},{prefix:withCtx(()=>[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-search text-content-muted"},null,-1)])]),_:1},8,["modelValue","placeholder"])]),createVNode(_component_CyberButton,{type:"primary",class:"text-xs",onClick:_cache[1]||(_cache[1]=$event=>showCreateModal.value=!0)},{default:withCtx(()=>[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-plus mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.tags.createTag")),1)]),_:1}),createVNode(_component_CyberButton,{type:isBatchMode.value?"success":"outlined",class:"text-xs",onClick:toggleBatchMode},{default:withCtx(()=>[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-tasks mr-1.5"},null,-1)),createTextVNode(toDisplayString(isBatchMode.value?unref($t)("admin.tags.exitBatchMode"):unref($t)("admin.tags.batchMode")),1)]),_:1},8,["type"]),isBatchMode.value?(openBlock(),createBlock(_component_CyberButton,{key:0,type:"primary",class:"text-xs",disabled:selectedTagIds.value.length===0,onClick:viewSelectedTagsImages},{default:withCtx(()=>[_cache[12]||(_cache[12]=createBaseVNode("i",{class:"fas fa-images mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.tags.viewSelectedFiles")),1)]),_:1},8,["disabled"])):createCommentVNode("",!0),isBatchMode.value?(openBlock(),createBlock(_component_CyberButton,{key:1,type:"warning",class:"text-xs",disabled:selectedTagIds.value.length===0,onClick:_cache[2]||(_cache[2]=$event=>showBatchOperationModal.value=!0)},{default:withCtx(()=>[_cache[13]||(_cache[13]=createBaseVNode("i",{class:"fas fa-cogs mr-1.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.tags.executeBatchOperation")),1)]),_:1},8,["disabled"])):createCommentVNode("",!0),selectedTagIds.value.length>0?(openBlock(),createBlock(_component_CyberButton,{key:2,type:"text",onClick:clearSelection},{default:withCtx(()=>[_cache[14]||(_cache[14]=createBaseVNode("i",{class:"fas fa-times mr-1"},null,-1)),createTextVNode(toDisplayString(unref($t)("admin.tags.cancelSelection")),1)]),_:1})):createCommentVNode("",!0)]),content:withCtx(()=>[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[isBatchMode.value?(openBlock(),createElementBlock("div",_hoisted_5,[createBaseVNode("span",_hoisted_6,toDisplayString(unref($t)("admin.tags.batchModeNotice")),1),createTextVNode(" - "+toDisplayString(unref($t)("admin.tags.batchModeHint")),1)])):createCommentVNode("",!0),createVNode(TagCloud,{tags:filteredTags.value,"selected-tag-ids":selectedTagIds.value,"is-loading":isLoading.value,"total-tags":totalTags.value,"is-batch-mode":isBatchMode.value,onSelect:toggleTagSelection,onEdit:openEditModal,onDelete:confirmDeleteTag},null,8,["tags","selected-tag-ids","is-loading","total-tags","is-batch-mode"])])])]),_:1},8,["title","subtitle"]),createVNode(TagFormModal,{modelValue:showModalVisible.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>showModalVisible.value=$event),"is-editing":showEditModal.value,"editing-tag":editingTag.value,"is-submitting":isSubmitting.value,onClose:closeFormModal,onSubmit:submitTagForm},null,8,["modelValue","is-editing","editing-tag","is-submitting"]),createVNode(_component_CyberDialog,{modelValue:showDeleteConfirm.value,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>showDeleteConfirm.value=$event),title:unref($t)("admin.tags.deleteDialog.title"),onClose:_cache[6]||(_cache[6]=$event=>showDeleteConfirm.value=!1)},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_14,[createVNode(_component_CyberButton,{type:"secondary",onClick:_cache[4]||(_cache[4]=$event=>showDeleteConfirm.value=!1)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.tags.deleteDialog.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"danger",loading:isDeleting.value,disabled:isDeleting.value,onClick:deleteTag$1},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("admin.tags.deleteDialog.delete")),1)]),_:1},8,["loading","disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_7,[createBaseVNode("p",_hoisted_8,[createTextVNode(toDisplayString(unref($t)("admin.tags.deleteDialog.confirmText"))+" ",1),createBaseVNode("span",_hoisted_9,toDisplayString(deletingTag.value?.name),1),createTextVNode(toDisplayString(unref($t)("common.questionMark")),1)]),createBaseVNode("div",_hoisted_10,[createBaseVNode("p",_hoisted_11,[createTextVNode(toDisplayString(unref($t)("admin.tags.deleteDialog.usageInfo"))+" ",1),createBaseVNode("span",_hoisted_12,toDisplayString(deletingTag.value?.count||0),1),createTextVNode(" "+toDisplayString(unref($t)("admin.tags.deleteDialog.usageTimes")),1)]),createBaseVNode("p",_hoisted_13,toDisplayString(unref($t)("admin.tags.deleteDialog.warning")),1)])])]),_:1},8,["modelValue","title"]),createVNode(BatchOperationModal,{modelValue:showBatchOperationModal.value,"onUpdate:modelValue":_cache[7]||(_cache[7]=$event=>showBatchOperationModal.value=$event),"selected-tags":getSelectedTags(),"available-tags":allTags.value,"is-submitting":isBatchProcessing.value,onClose:_cache[8]||(_cache[8]=$event=>showBatchOperationModal.value=!1),onSubmit:doBatchOperation},null,8,["modelValue","selected-tags","available-tags","is-submitting"])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-749305f2"]]);export{index as default};
