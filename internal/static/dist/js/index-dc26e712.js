import{d as defineComponent,r as ref,w as watch,b as onMounted,I as createElementBlock,A as createBlock,L as withCtx,u as unref,z as openBlock,a0 as createBaseVNode,K as createCommentVNode,R as normalizeClass,a1 as toDisplayString,Q as normalizeStyle,F as Fragment,n as nextTick,c as computed,f as createVNode,ab as createTextVNode,E as resolveComponent,af as storeToRefs,o as onUnmounted,a5 as withModifiers,ac as createStaticVNode,T as Teleport,a4 as useRoute}from"./vue-vendor-31320f47.js";import{j as useTexts,s as createFileDataURL,S as SIZE_LIMITS,T as TIMING,C as CyberTooltip,q as useToast,_ as _export_sfc,m as useSettingsStore,e as getGlobalSettings,n as useAuthStore,D as DEFAULT_WATERMARK_CONFIG,t as useUploadStore,v as useUploadConfig,i as useLayoutStore,w as logger,x as useFolderPath}from"./index-ae9c3219.js";import{s as script$2}from"./virtual-scroller-ec106627.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const _hoisted_1$3={class:"upload-progress-container"},_hoisted_2$3=["id","data-status"],_hoisted_3$3={class:"upload-card"},_hoisted_4$3={class:"upload-preview"},_hoisted_5$3={key:0,class:"skeleton absolute inset-0"},_hoisted_6$3=["src","onLoad"],_hoisted_7$3={key:2,class:"fas fa-file-image text-muted z-10 text-lg"},_hoisted_8$3={class:"upload-body"},_hoisted_9$3={class:"flex items-center justify-between"},_hoisted_10$3={class:"relative w-2/3"},_hoisted_11$3={key:0,class:"skeleton h-4 w-full rounded"},_hoisted_12$3={key:1,class:"truncate text-sm font-medium text-content"},_hoisted_13$3={class:"relative"},_hoisted_14$3={key:0,class:"skeleton h-3 w-10 rounded"},_hoisted_15$3={key:1,class:"text-muted text-xs"},_hoisted_16$3={key:0,class:"relative mt-1"},_hoisted_17$3={key:1,class:"status-badge status-badge--error"},_hoisted_18$3={class:"font-medium"},_hoisted_19$3={class:"font-medium"},_hoisted_20$2={key:3,class:"mt-0.5"},_hoisted_21$2={class:"mb-0.5 flex items-center"},_hoisted_22$2={class:"relative h-1.5 w-full overflow-hidden rounded-full bg-background-800 shadow-inner"},_hoisted_23$2={class:"ml-2 min-w-10 text-right text-xs font-medium text-content"},_hoisted_24$2={key:0,class:"text-muted flex items-center justify-between text-xs"},_hoisted_25$2={key:0,class:"truncate"},_hoisted_26$2={key:1,class:"text-2xs text-muted ml-2 flex-shrink-0"},_hoisted_27$2={key:4,class:"status-badge status-badge--analyzing"},_hoisted_28$1={class:"font-medium"},_hoisted_29$1={key:5,class:"status-badge status-badge--paused"},_hoisted_30$1={class:"font-medium"},_hoisted_31$1={key:6,class:"status-badge status-badge--retry"},_hoisted_32$1={class:"font-medium"},_hoisted_33$1={key:7,class:"status-badge status-badge--pending"},_hoisted_34$1={class:"font-medium"},_hoisted_35$1={class:"upload-actions"},_hoisted_36$1={key:0,class:"flex space-x-1"},_hoisted_37$1=["title","onClick"],_hoisted_38$1=["onClick"],_hoisted_39$1=["onClick"],_hoisted_40$1=["onClick"],_hoisted_41$1=["onClick"],_hoisted_42$1=["title","onClick"],_hoisted_43$1=["title","onClick"],_hoisted_44$1=["disabled","title","onClick"],_sfc_main$3=defineComponent({__name:"UploadProgress",props:{files:{}},emits:["remove","upload","cancel","retry","resume","update:files"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,toast=useToast(),{$t}=useTexts(),listKey=ref(0),recycleScroller=ref(null),itemRefs=ref(new Map);ref(0);const scrollQueue=ref([]),processingScroll=ref(!1),previewQueue=ref([]),isPreloading=ref(!1),preloadBatchSize=SIZE_LIMITS.COMPONENT.PRELOAD_BATCH_SIZE,preloadDelay=TIMING.ANIMATION.PRELOAD_DELAY,loadingDelay=TIMING.ANIMATION.LOADING_DELAY,setItemRef=(el,uniqueId)=>{el&&uniqueId&&itemRefs.value.set(uniqueId,el)},isItemLoaded=file=>file.itemLoaded!==void 0?file.itemLoaded:file.status!=="pending"||file.progress>0,onImageLoaded=file=>{file.previewLoaded=!0,setTimeout(()=>{file.itemLoaded=!0},loadingDelay)},processScrollQueue=async()=>{if(processingScroll.value||scrollQueue.value.length===0)return;processingScroll.value=!0;const uniqueId=scrollQueue.value.shift();if(!uniqueId){processingScroll.value=!1;return}const fileIndex=props.files.findIndex(f=>f.uniqueId===uniqueId);if(fileIndex===-1||!props.files[fileIndex]){processingScroll.value=!1;return}recycleScroller.value&&typeof recycleScroller.value.scrollToItem=="function"&&(await nextTick(),recycleScroller.value.scrollToItem(fileIndex)),processingScroll.value=!1,setTimeout(()=>{scrollQueue.value.length>0&&processScrollQueue()},200)};watch(()=>[...props.files],(newFiles,oldFiles)=>{newFiles.forEach(file=>{if(!file.uniqueId)return;const oldFile=oldFiles.find(f=>f.uniqueId===file.uniqueId);oldFile&&oldFile.status==="uploading"&&(file.status==="success"||file.status==="error")&&(file.lastStatusChange=Date.now(),scrollQueue.value.push(file.uniqueId),processingScroll.value||processScrollQueue()),!file.previewLoaded&&!previewQueue.value.includes(file)&&(previewQueue.value.push(file),isPreloading.value||preloadPreviews())})},{deep:!0});const preloadPreviews=async()=>{if(isPreloading.value||previewQueue.value.length===0)return;isPreloading.value=!0;const batch=previewQueue.value.splice(0,preloadBatchSize);await Promise.all(batch.map(async file=>{if(!(!file||file.preview||file.previewLoaded)&&file.file instanceof File)try{const preview=await createFilePreview(file.file),fileIndex=props.files.findIndex(f=>f.uniqueId===file.uniqueId);if(fileIndex!==-1&&props.files[fileIndex]){const updatedFiles=[...props.files];updatedFiles[fileIndex]={...updatedFiles[fileIndex],preview},emit("update:files",updatedFiles)}}catch(error){if(console.error(`预览图加载失败: ${file.name}`,error),file.uniqueId){const fileIndex=props.files.findIndex(f=>f.uniqueId===file.uniqueId);fileIndex!==-1&&props.files[fileIndex]&&setTimeout(()=>{if(props.files[fileIndex]){const updatedFiles=[...props.files];updatedFiles[fileIndex]={...updatedFiles[fileIndex],itemLoaded:!0},emit("update:files",updatedFiles)}},loadingDelay)}}})),await new Promise(resolve=>setTimeout(resolve,preloadDelay)),isPreloading.value=!1,previewQueue.value.length>0&&preloadPreviews()},createFilePreview=async file=>{try{return await createFileDataURL(file)}catch(error){return console.error("预览图生成失败:",file.name,error),"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjZmZmIiBmb250LXNpemU9IjE2Ij7mianlh4Y8L3RleHQ+PC9zdmc+"}};watch(()=>props.files.length,()=>{listKey.value++});const ensureUniqueIds=()=>{props.files.forEach((file,_index)=>{if(!file.uniqueId){const timestamp=new Date().getTime();file.uniqueId=`file-${index}-${timestamp}-${file.size}`,file.itemLoaded=!1,file.previewLoaded=!1}})};onMounted(()=>{ensureUniqueIds();const filesToPreload=props.files.filter(file=>!file.preview&&!file.previewLoaded);filesToPreload.length>0&&(previewQueue.value.push(...filesToPreload),preloadPreviews()),setTimeout(()=>{props.files.forEach((file,_index)=>{file.itemLoaded||setTimeout(()=>{file.itemLoaded=!0},300+Math.random()*200)})},100)}),watch(()=>props.files,()=>{ensureUniqueIds()},{deep:!0});const formatFileSize=bytes=>bytes==null||isNaN(bytes)?"0 B":bytes<1024?`${bytes} B`:bytes<1024*1024?`${(bytes/1024).toFixed(1)} KB`:`${(bytes/(1024*1024)).toFixed(1)} MB`,removeFile=index2=>{emit("remove",index2),listKey.value++},retryUpload=index2=>{emit("retry",index2)},resumeUpload=index2=>{emit("resume",index2)},openInNewTab=url=>{url&&window.open(url,"_blank","noopener,noreferrer")},copyImageUrl=async url=>{try{await navigator.clipboard.writeText(url),toast.success($t("upload.uploadProgress.toast.linkCopied"))}catch{toast.error($t("upload.uploadProgress.toast.copyFailed"))}},copyMarkdownUrl=async(url,name)=>{try{const markdownText=`![${name}](${url})`;await navigator.clipboard.writeText(markdownText),toast.success($t("upload.uploadProgress.toast.markdownLinkCopied"))}catch{toast.error($t("upload.uploadProgress.toast.copyFailed"))}},copyHtmlUrl=async(url,name)=>{try{const htmlTag=`<img src="${url}" alt="${name}" />`;await navigator.clipboard.writeText(htmlTag),toast.success($t("upload.uploadProgress.toast.htmlLinkCopied"))}catch{toast.error($t("upload.uploadProgress.toast.copyFailed"))}},copyThumbnailUrl=async url=>{try{await navigator.clipboard.writeText(url),toast.success($t("upload.uploadProgress.toast.thumbnailLinkCopied"))}catch{toast.error($t("upload.uploadProgress.toast.copyFailed"))}},formatRemainingTime=seconds=>{if(seconds<60)return $t("upload.uploadProgress.time.seconds",{count:Math.ceil(seconds)});if(seconds<3600){const minutes2=Math.ceil(seconds/60);return $t("upload.uploadProgress.time.minutes",{count:minutes2})}const hours=Math.floor(seconds/3600),minutes=Math.ceil(seconds%3600/60);return hours>0?$t("upload.uploadProgress.time.hoursMinutes",{hours,minutes}):$t("upload.uploadProgress.time.minutes",{count:minutes})},isInstantUpload=file=>{if(file.is_duplicate)return!0;if(file.statusMessage){const instantCompleted=$t("upload.smartUpload.status.instantCompleted"),instantSuccess=$t("upload.uploadProgress.status.instantSuccess"),checkingInstant=$t("upload.smartUpload.status.checkingInstant");if(file.statusMessage.includes(instantCompleted)||file.statusMessage.includes(instantSuccess)||file.statusMessage.includes(checkingInstant)||file.statusMessage.includes("instant"))return!0}return!1},getSuccessText=file=>isInstantUpload(file)?$t("upload.uploadProgress.status.instantSuccess"):$t("upload.uploadProgress.status.uploadSuccess"),getSuccessIconClass=file=>isInstantUpload(file)?"fas fa-bolt text-cyan-400":"fas fa-check-circle text-green-400";return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$3,[(openBlock(),createBlock(unref(script$2),{ref_key:"recycleScroller",ref:recycleScroller,key:listKey.value,class:"scroller",items:__props.files,"item-size":82,buffer:500,prerender:10,"key-field":"uniqueId"},{default:withCtx(({item:file,index:index2})=>[createBaseVNode("div",{id:`upload-item-${file.uniqueId}`,ref:el=>setItemRef(el,file.uniqueId),class:"upload-item","data-status":file.status},[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$3,[!file.preview||!file.previewLoaded?(openBlock(),createElementBlock("div",_hoisted_5$3)):createCommentVNode("",!0),file.preview?(openBlock(),createElementBlock("img",{key:1,src:file.preview,class:normalizeClass(["h-full w-full object-contain",{"opacity-0":!file.previewLoaded,"opacity-100 transition-opacity duration-300":file.previewLoaded}]),loading:"lazy",onLoad:$event=>onImageLoaded(file)},null,42,_hoisted_6$3)):(openBlock(),createElementBlock("i",_hoisted_7$3))]),createBaseVNode("div",_hoisted_8$3,[createBaseVNode("div",_hoisted_9$3,[createBaseVNode("div",_hoisted_10$3,[isItemLoaded(file)?(openBlock(),createElementBlock("p",_hoisted_12$3,toDisplayString(file.name),1)):(openBlock(),createElementBlock("div",_hoisted_11$3))]),createBaseVNode("div",_hoisted_13$3,[isItemLoaded(file)?(openBlock(),createElementBlock("span",_hoisted_15$3,toDisplayString(formatFileSize(file.size)),1)):(openBlock(),createElementBlock("div",_hoisted_14$3))])]),isItemLoaded(file)?file.status==="error"?(openBlock(),createElementBlock("div",_hoisted_17$3,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-exclamation-circle mr-1.5 text-error-400"},null,-1)),createBaseVNode("span",_hoisted_18$3,toDisplayString(file.error||unref($t)("upload.uploadProgress.status.uploadFailed")),1)])):file.status==="success"||file.status==="completed"?(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(["status-badge",isInstantUpload(file)?"status-badge--instant":"status-badge--success"])},[createBaseVNode("i",{class:normalizeClass([getSuccessIconClass(file),"mr-1.5"])},null,2),createBaseVNode("span",_hoisted_19$3,toDisplayString(getSuccessText(file)),1)],2)):file.status==="uploading"?(openBlock(),createElementBlock("div",_hoisted_20$2,[createBaseVNode("div",_hoisted_21$2,[createBaseVNode("div",_hoisted_22$2,[createBaseVNode("div",{class:"relative h-full rounded-full bg-gradient-to-r from-brand-500 via-info-400 to-error-500 transition-all duration-300 ease-out",style:normalizeStyle({width:`${file.progress}%`})},[..._cache[2]||(_cache[2]=[createBaseVNode("div",{class:"absolute inset-0 animate-pulse bg-gradient-to-r from-transparent via-white to-transparent opacity-20"},null,-1)])],4)]),createBaseVNode("span",_hoisted_23$2,toDisplayString(file.progress)+"%",1)]),file.statusMessage||file.remainingTime?(openBlock(),createElementBlock("div",_hoisted_24$2,[file.statusMessage?(openBlock(),createElementBlock("span",_hoisted_25$2,toDisplayString(file.statusMessage),1)):createCommentVNode("",!0),file.remainingTime&&file.remainingTime>0?(openBlock(),createElementBlock("span",_hoisted_26$2,toDisplayString(unref($t)("upload.uploadProgress.remaining"))+" "+toDisplayString(formatRemainingTime(file.remainingTime)),1)):createCommentVNode("",!0)])):createCommentVNode("",!0)])):file.status==="analyzing"?(openBlock(),createElementBlock("div",_hoisted_27$2,[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-spinner fa-spin mr-1.5 text-content"},null,-1)),createBaseVNode("span",_hoisted_28$1,toDisplayString(unref($t)("upload.uploadProgress.status.analyzing")),1)])):file.status==="paused"?(openBlock(),createElementBlock("div",_hoisted_29$1,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-pause-circle mr-1.5 text-warning-400"},null,-1)),createBaseVNode("span",_hoisted_30$1,toDisplayString(file.statusMessage||unref($t)("upload.uploadProgress.status.paused")),1)])):file.status==="retrying"?(openBlock(),createElementBlock("div",_hoisted_31$1,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-redo-alt fa-spin mr-1.5 text-warning-400"},null,-1)),createBaseVNode("span",_hoisted_32$1,toDisplayString(unref($t)("upload.uploadProgress.status.retrying")),1)])):(openBlock(),createElementBlock("div",_hoisted_33$1,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-clock text-muted mr-1.5"},null,-1)),createBaseVNode("span",_hoisted_34$1,toDisplayString(file.statusMessage||unref($t)("upload.uploadProgress.status.pending")),1)])):(openBlock(),createElementBlock("div",_hoisted_16$3,[..._cache[0]||(_cache[0]=[createBaseVNode("div",{class:"skeleton h-3 w-2/3 rounded"},null,-1)])]))]),createBaseVNode("div",_hoisted_35$1,[isItemLoaded(file)?(openBlock(),createElementBlock(Fragment,{key:1},[(file.status==="success"||file.status==="completed")&&file.full_url?(openBlock(),createElementBlock("button",{key:0,class:"upload-action upload-action--success",title:unref($t)("upload.uploadProgress.actions.openInNewTab"),onClick:$event=>openInNewTab(file.full_url)},[..._cache[8]||(_cache[8]=[createBaseVNode("i",{class:"fas fa-external-link-alt"},null,-1)])],8,_hoisted_37$1)):createCommentVNode("",!0),(file.status==="success"||file.status==="completed")&&file.full_url?(openBlock(),createBlock(CyberTooltip,{key:1,content:unref($t)("upload.uploadProgress.actions.copyLinkTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{class:"upload-action upload-action--brand",onClick:$event=>copyImageUrl(file.full_url)},[..._cache[9]||(_cache[9]=[createBaseVNode("i",{class:"fas fa-link"},null,-1)])],8,_hoisted_38$1)]),_:2},1032,["content"])):createCommentVNode("",!0),(file.status==="success"||file.status==="completed")&&file.full_url?(openBlock(),createBlock(CyberTooltip,{key:2,content:unref($t)("upload.uploadProgress.actions.copyMarkdownTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{class:"upload-action upload-action--brand",onClick:$event=>copyMarkdownUrl(file.full_url,file.name)},[..._cache[10]||(_cache[10]=[createBaseVNode("i",{class:"fab fa-markdown"},null,-1)])],8,_hoisted_39$1)]),_:2},1032,["content"])):createCommentVNode("",!0),(file.status==="success"||file.status==="completed")&&file.full_url?(openBlock(),createBlock(CyberTooltip,{key:3,content:unref($t)("upload.uploadProgress.actions.copyHtmlTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{class:"upload-action upload-action--warning",onClick:$event=>copyHtmlUrl(file.full_url,file.name)},[..._cache[11]||(_cache[11]=[createBaseVNode("i",{class:"fab fa-html5"},null,-1)])],8,_hoisted_40$1)]),_:2},1032,["content"])):createCommentVNode("",!0),(file.status==="success"||file.status==="completed")&&file.full_thumb_url?(openBlock(),createBlock(CyberTooltip,{key:4,content:unref($t)("upload.uploadProgress.actions.copyThumbnailTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{class:"upload-action upload-action--info",onClick:$event=>copyThumbnailUrl(file.full_thumb_url)},[..._cache[12]||(_cache[12]=[createBaseVNode("i",{class:"fas fa-image"},null,-1)])],8,_hoisted_41$1)]),_:2},1032,["content"])):createCommentVNode("",!0),file.status==="paused"?(openBlock(),createElementBlock("button",{key:5,class:"upload-action upload-action--success",title:unref($t)("upload.uploadProgress.actions.resume"),onClick:$event=>resumeUpload(index2)},[..._cache[13]||(_cache[13]=[createBaseVNode("i",{class:"fas fa-play"},null,-1)])],8,_hoisted_42$1)):createCommentVNode("",!0),file.status==="error"?(openBlock(),createElementBlock("button",{key:6,class:"upload-action upload-action--warning",title:unref($t)("upload.uploadProgress.actions.retry"),onClick:$event=>retryUpload(index2)},[..._cache[14]||(_cache[14]=[createBaseVNode("i",{class:"fas fa-redo-alt"},null,-1)])],8,_hoisted_43$1)):createCommentVNode("",!0),createBaseVNode("button",{class:normalizeClass(["upload-action upload-action--danger",{"cursor-not-allowed opacity-50 hover:scale-100 hover:bg-transparent hover:text-error-500":file.status==="uploading"}]),disabled:file.status==="uploading",title:unref($t)("upload.uploadProgress.actions.remove"),onClick:$event=>removeFile(index2)},[..._cache[15]||(_cache[15]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])],10,_hoisted_44$1)],64)):(openBlock(),createElementBlock("div",_hoisted_36$1,[..._cache[7]||(_cache[7]=[createBaseVNode("div",{class:"skeleton h-6 w-6 rounded"},null,-1),createBaseVNode("div",{class:"skeleton h-6 w-6 rounded"},null,-1),createBaseVNode("div",{class:"skeleton h-6 w-6 rounded"},null,-1)])]))])])],8,_hoisted_2$3)]),_:1},8,["items"]))]))}});const UploadProgress=_export_sfc(_sfc_main$3,[["__scopeId","data-v-d08466c3"]]);function useGlobalSettings(){const settingsStore=useSettingsStore(),isLoading=ref(!1),settings=ref(null),fetchSettings=async()=>{if(settingsStore.isLoaded&&settingsStore.rawSettings){settings.value=settingsStore.rawSettings;return}if(settingsStore.loading){let waited=0;const maxWait=5e3,checkInterval=setInterval(()=>{waited+=100,!settingsStore.loading&&settingsStore.isLoaded&&settingsStore.rawSettings?(clearInterval(checkInterval),settings.value=settingsStore.rawSettings):waited>=maxWait&&(clearInterval(checkInterval),doFetch())},100);return}await doFetch()},doFetch=async()=>{try{isLoading.value=!0;const response=await getGlobalSettings();response.code===200&&response.data&&(settings.value=response.data)}catch(error){console.error("获取全局设置失败:",error)}finally{isLoading.value=!1}};onMounted(()=>{fetchSettings()});const settingsRef=computed(()=>settingsStore.isLoaded&&settingsStore.rawSettings?settingsStore.rawSettings:settings.value);return{isLoading,settings:settingsRef,fetchSettings}}const _hoisted_1$2={class:"upload-settings"},_hoisted_2$2={class:"space-y-4"},_hoisted_3$2={key:0},_hoisted_4$2={class:"text-heading mb-1.5 block text-sm font-medium"},_hoisted_5$2={class:"text-muted mt-1 text-xs"},_hoisted_6$2={key:1,class:"rounded bg-background-700 p-4"},_hoisted_7$2={class:"space-y-2"},_hoisted_8$2={class:"flex items-center"},_hoisted_9$2={class:"text-sm text-content"},_hoisted_10$2={class:"flex items-center"},_hoisted_11$2={class:"text-muted text-sm"},_hoisted_12$2={key:0,class:"flex items-center"},_hoisted_13$2={class:"text-sm text-error-400"},_hoisted_14$2={key:2},_hoisted_15$2={class:"text-heading mb-1.5 block text-sm font-medium"},_hoisted_16$2={class:"text-muted mt-1 rounded bg-background-600 p-2 text-xs"},_hoisted_17$2={key:0,class:"flex items-start"},_hoisted_18$2={key:1,class:"flex items-start"},_hoisted_19$2={key:2,class:"flex items-start"},_hoisted_20$1={key:3},_hoisted_21$1={class:"text-heading mb-1.5 block text-sm font-medium"},_hoisted_22$1={class:"text-error-400"},_hoisted_23$1={class:"text-muted mt-1 text-xs"},_hoisted_24$1={class:"pt-2"},_hoisted_25$1={class:"text-muted ml-6 mt-1 text-xs"},_hoisted_26$1={class:"pt-2"},_hoisted_27$1={class:"text-muted ml-6 mt-1 text-xs"},_sfc_main$2=defineComponent({__name:"UploadSettings",props:{folderId:{},folderPath:{},accessLevel:{},optimize:{type:Boolean},autoRemove:{type:Boolean},storageDuration:{},watermarkEnabled:{type:Boolean},watermarkConfig:{}},emits:["update:folderId","update:accessLevel","update:optimize","update:autoRemove","update:storageDuration","update:watermarkEnabled","update:watermarkConfig","change"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,authStore=useAuthStore(),{settings:globalSettings}=useGlobalSettings(),localFolder=ref(props.folderId||""),localAccessLevel=ref(props.accessLevel||"private"),localOptimize=ref(props.optimize!==void 0?props.optimize:!0),localAutoRemove=ref(props.autoRemove!==void 0?props.autoRemove:!1),localStorageDuration=ref(props.storageDuration||""),localWatermarkEnabled=ref(props.watermarkEnabled||!1),watermarkConfig=ref(props.watermarkConfig||{...DEFAULT_WATERMARK_CONFIG}),selectedFolderPath=ref(""),showWatermarkConfig=ref(!1);watch([globalSettings,()=>authStore.isLoggedIn],([newSettings,isLoggedIn])=>{if(newSettings&&!props.storageDuration){let defaultDuration="";isLoggedIn?defaultDuration=newSettings.upload?.user_default_storage_duration||"permanent":defaultDuration=newSettings.guest?.guest_default_storage_duration||"",(!localStorageDuration.value||localStorageDuration.value!==defaultDuration)&&(localStorageDuration.value=defaultDuration,emitChangeEvent())}},{immediate:!0});const accessLevelOptions=computed(()=>[{label:$t("upload.settings.accessLevel.public"),value:"public",description:$t("upload.settings.accessLevel.publicDesc")},{label:$t("upload.settings.accessLevel.private"),value:"private",description:$t("upload.settings.accessLevel.privateDesc")},{label:$t("upload.settings.accessLevel.protected"),value:"protected",description:$t("upload.settings.accessLevel.protectedDesc")}]),storageDurationOptions=computed(()=>{if(authStore.isLoggedIn){const allowedDurations2=globalSettings.value?.upload?.user_allowed_storage_durations,options=[];return Array.isArray(allowedDurations2)&&allowedDurations2.length>0?allowedDurations2.forEach(duration=>{duration==="permanent"?options.push({label:$t("upload.settings.duration.permanent"),value:duration}):options.push({label:duration,value:duration})}):options.push({label:$t("upload.settings.duration.permanent"),value:"permanent"}),options}const allowedDurations=globalSettings.value?.guest?.guest_allowed_storage_durations;return Array.isArray(allowedDurations)&&allowedDurations.length>0?allowedDurations.map(duration=>({label:duration,value:duration})):[{label:"3d",value:"3d"},{label:"7d",value:"7d"},{label:"30d",value:"30d"}]});watch(storageDurationOptions,newOptions=>{if(newOptions&&newOptions.length>0&&globalSettings.value){const{isLoggedIn}=authStore,defaultDuration=isLoggedIn?globalSettings.value.upload?.user_default_storage_duration||"permanent":globalSettings.value.guest?.guest_default_storage_duration||"",shouldSetDefault=!(localStorageDuration.value&&newOptions.some(opt=>opt.value===localStorageDuration.value))||!localStorageDuration.value;shouldSetDefault&&defaultDuration&&newOptions.some(opt=>opt.value===defaultDuration)?(localStorageDuration.value=defaultDuration,emitChangeEvent()):shouldSetDefault&&newOptions.length>0&&(localStorageDuration.value=newOptions[0].value,emitChangeEvent())}},{immediate:!0});const guestAccessLevelText=computed(()=>$t("constants.accessLevels.public")),guestIsEnabled=computed(()=>globalSettings.value?.guest?.enable_guest_upload!==!1);watch(localFolder,newValue=>{emit("update:folderId",newValue),emitChangeEvent()}),watch(localAccessLevel,newValue=>{emit("update:accessLevel",newValue),emitChangeEvent()}),watch(localOptimize,newValue=>{emit("update:optimize",newValue),emitChangeEvent()}),watch(localAutoRemove,newValue=>{emit("update:autoRemove",newValue),emitChangeEvent()}),watch(localStorageDuration,newValue=>{emit("update:storageDuration",newValue),emitChangeEvent()}),watch(localWatermarkEnabled,newValue=>{emit("update:watermarkEnabled",newValue),emitChangeEvent()}),watch(watermarkConfig,newValue=>{emit("update:watermarkConfig",newValue),emitChangeEvent()},{deep:!0}),watch(()=>props.folderId,newValue=>{newValue!==localFolder.value&&(localFolder.value=newValue||"")}),watch(()=>props.accessLevel,newValue=>{newValue!==localAccessLevel.value&&(localAccessLevel.value=newValue||"private")}),watch(()=>props.optimize,newValue=>{newValue!==localOptimize.value&&(localOptimize.value=newValue!==void 0?newValue:!0)}),watch(()=>props.autoRemove,newValue=>{newValue!==localAutoRemove.value&&(localAutoRemove.value=newValue!==void 0?newValue:!1)}),watch(()=>props.storageDuration,newValue=>{newValue!==localStorageDuration.value&&(localStorageDuration.value=newValue||"permanent")}),watch(()=>props.watermarkEnabled,newValue=>{newValue!==localWatermarkEnabled.value&&(localWatermarkEnabled.value=newValue||!1)}),watch(()=>props.watermarkConfig,newValue=>{newValue&&JSON.stringify(newValue)!==JSON.stringify(watermarkConfig.value)&&(watermarkConfig.value={...newValue})},{deep:!0});const handleFolderSelected=folder=>{selectedFolderPath.value=folder.path,emitChangeEvent()},emitChangeEvent=()=>{emit("change",{folderId:localFolder.value||void 0,accessLevel:localAccessLevel.value,optimize:localOptimize.value,autoRemove:localAutoRemove.value,storageDuration:localStorageDuration.value,watermarkEnabled:localWatermarkEnabled.value,watermarkConfig:watermarkConfig.value})},handleWatermarkConfigConfirm=newConfig=>{watermarkConfig.value={...newConfig},showWatermarkConfig.value=!1};return(_ctx,_cache)=>{const _component_cyberFolderTree=resolveComponent("cyberFolderTree"),_component_cyberDropdown=resolveComponent("cyberDropdown"),_component_cyberCheckbox=resolveComponent("cyberCheckbox"),_component_cyberWatermarkConfig=resolveComponent("cyberWatermarkConfig");return openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[unref(authStore).isLoggedIn?(openBlock(),createElementBlock("div",_hoisted_3$2,[createBaseVNode("label",_hoisted_4$2,toDisplayString(unref($t)("upload.settings.folder")),1),createVNode(_component_cyberFolderTree,{modelValue:localFolder.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>localFolder.value=$event),"preset-path":props.folderPath,class:"compact-dropdown text-sm",onFolderSelected:handleFolderSelected},null,8,["modelValue","preset-path"]),createBaseVNode("p",_hoisted_5$2,toDisplayString(unref($t)("upload.settings.folderHint")),1)])):(openBlock(),createElementBlock("div",_hoisted_6$2,[createBaseVNode("div",_hoisted_7$2,[createBaseVNode("div",_hoisted_8$2,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-info-circle mr-2 text-sm text-brand-500"},null,-1)),createBaseVNode("p",_hoisted_9$2,toDisplayString(unref($t)("upload.settings.guestFolderInfo",{level:guestAccessLevelText.value})),1)]),createBaseVNode("div",_hoisted_10$2,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-upload mr-2 text-sm text-brand-500"},null,-1)),createBaseVNode("p",_hoisted_11$2,toDisplayString(unref($t)("upload.settings.guestLimitInfo")),1)]),guestIsEnabled.value===!1?(openBlock(),createElementBlock("div",_hoisted_12$2,[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-exclamation-triangle mr-2 text-sm text-error-400"},null,-1)),createBaseVNode("p",_hoisted_13$2,toDisplayString(unref($t)("upload.settings.guestDisabled")),1)])):createCommentVNode("",!0)])])),unref(authStore).isLoggedIn?(openBlock(),createElementBlock("div",_hoisted_14$2,[createBaseVNode("label",_hoisted_15$2,toDisplayString(unref($t)("upload.settings.accessLevelLabel")),1),createVNode(_component_cyberDropdown,{modelValue:localAccessLevel.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>localAccessLevel.value=$event),options:accessLevelOptions.value,placeholder:unref($t)("upload.settings.accessLevelPlaceholder"),class:"compact-dropdown text-sm"},null,8,["modelValue","options","placeholder"]),createBaseVNode("div",_hoisted_16$2,[localAccessLevel.value==="public"?(openBlock(),createElementBlock("div",_hoisted_17$2,[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-info-circle mr-1.5 mt-0.5 text-xs text-brand-500"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.settings.accessLevel.publicDesc")),1)])):localAccessLevel.value==="private"?(openBlock(),createElementBlock("div",_hoisted_18$2,[_cache[10]||(_cache[10]=createBaseVNode("i",{class:"fas fa-info-circle mr-1.5 mt-0.5 text-xs text-warning-400"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.settings.accessLevel.privateDesc")),1)])):localAccessLevel.value==="protected"?(openBlock(),createElementBlock("div",_hoisted_19$2,[_cache[11]||(_cache[11]=createBaseVNode("i",{class:"fas fa-shield-alt mr-1.5 mt-0.5 text-xs text-error-400"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.settings.accessLevel.protectedDesc")),1)])):createCommentVNode("",!0)])])):createCommentVNode("",!0),unref(authStore).isLoggedIn?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_20$1,[createBaseVNode("label",_hoisted_21$1,[createTextVNode(toDisplayString(unref($t)("upload.settings.storageDurationLabel"))+" ",1),createBaseVNode("span",_hoisted_22$1,toDisplayString(unref($t)("upload.settings.required")),1)]),createVNode(_component_cyberDropdown,{modelValue:localStorageDuration.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>localStorageDuration.value=$event),options:storageDurationOptions.value,placeholder:unref($t)("upload.settings.storageDurationPlaceholder"),class:"compact-dropdown text-sm"},{"option-icon":withCtx(()=>[..._cache[12]||(_cache[12]=[createBaseVNode("i",{class:"fas fa-calendar-alt text-sm text-brand-500"},null,-1)])]),"selected-icon":withCtx(()=>[..._cache[13]||(_cache[13]=[createBaseVNode("i",{class:"fas fa-calendar-alt text-sm text-brand-500"},null,-1)])]),_:1},8,["modelValue","options","placeholder"]),createBaseVNode("p",_hoisted_23$1,toDisplayString(unref($t)("upload.settings.storageDurationHint")),1)])),createBaseVNode("div",_hoisted_24$1,[createVNode(_component_cyberCheckbox,{modelValue:localOptimize.value,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>localOptimize.value=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("upload.settings.autoOptimize")),1)]),_:1},8,["modelValue"]),createBaseVNode("p",_hoisted_25$1,toDisplayString(unref($t)("upload.settings.autoOptimizeHint")),1)]),createBaseVNode("div",_hoisted_26$1,[createVNode(_component_cyberCheckbox,{modelValue:localAutoRemove.value,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>localAutoRemove.value=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("upload.settings.autoRemove")),1)]),_:1},8,["modelValue"]),createBaseVNode("p",_hoisted_27$1,toDisplayString(unref($t)("upload.settings.autoRemoveHint")),1)])]),createVNode(_component_cyberWatermarkConfig,{visible:showWatermarkConfig.value,"onUpdate:visible":_cache[5]||(_cache[5]=$event=>showWatermarkConfig.value=$event),config:watermarkConfig.value,onConfirm:handleWatermarkConfigConfirm},null,8,["visible","config"])])}}});const UploadSettings=_export_sfc(_sfc_main$2,[["__scopeId","data-v-ce2d99b2"]]),_hoisted_1$1={class:"folder-confirm-content"},_hoisted_2$1={class:"folder-stats"},_hoisted_3$1={class:"stat-item"},_hoisted_4$1={class:"stat-text"},_hoisted_5$1={class:"stat-label"},_hoisted_6$1={class:"stat-value"},_hoisted_7$1={class:"stat-item success-item"},_hoisted_8$1={class:"stat-text"},_hoisted_9$1={class:"stat-label"},_hoisted_10$1={class:"stat-value success-value"},_hoisted_11$1={key:0,class:"stat-item error-item"},_hoisted_12$1={class:"stat-text"},_hoisted_13$1={class:"stat-label"},_hoisted_14$1={class:"stat-value error-value"},_hoisted_15$1={class:"folder-message"},_hoisted_16$1=["innerHTML"],_hoisted_17$1={key:0,class:"folder-warning"},_hoisted_18$1={class:"warning-text"},_hoisted_19$1={class:"dialog-footer"},_sfc_main$1=defineComponent({__name:"FolderConfirmDialog",props:{visible:{type:Boolean},stats:{}},emits:["update:visible","confirm","cancel"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,dialogVisible=computed({get:()=>props.visible,set:value=>emit("update:visible",value)}),handleConfirm=()=>{emit("confirm"),dialogVisible.value=!1},handleCancel=()=>{emit("cancel"),dialogVisible.value=!1};return(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{modelValue:dialogVisible.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>dialogVisible.value=$event),title:unref($t)("upload.folder.dialog.title"),width:"480",onClose:handleCancel},{footer:withCtx(()=>[createBaseVNode("div",_hoisted_19$1,[createVNode(_component_CyberButton,{type:"secondary",onClick:handleCancel},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("upload.folder.dialog.cancel")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",disabled:__props.stats.validFiles===0,onClick:handleConfirm},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("upload.folder.dialog.confirm")),1)]),_:1},8,["disabled"])])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[_cache[1]||(_cache[1]=createBaseVNode("div",{class:"stat-icon folder-icon"},[createBaseVNode("i",{class:"fas fa-folder"})],-1)),createBaseVNode("div",_hoisted_4$1,[createBaseVNode("span",_hoisted_5$1,toDisplayString(unref($t)("upload.folder.dialog.totalFiles")),1),createBaseVNode("strong",_hoisted_6$1,toDisplayString(__props.stats.totalFiles),1)])]),createBaseVNode("div",_hoisted_7$1,[_cache[2]||(_cache[2]=createBaseVNode("div",{class:"stat-icon success-icon"},[createBaseVNode("i",{class:"fas fa-check-circle"})],-1)),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("span",_hoisted_9$1,toDisplayString(unref($t)("upload.folder.dialog.validFiles")),1),createBaseVNode("strong",_hoisted_10$1,toDisplayString(__props.stats.validFiles),1)])]),__props.stats.invalidFiles>0?(openBlock(),createElementBlock("div",_hoisted_11$1,[_cache[3]||(_cache[3]=createBaseVNode("div",{class:"stat-icon error-icon"},[createBaseVNode("i",{class:"fas fa-times-circle"})],-1)),createBaseVNode("div",_hoisted_12$1,[createBaseVNode("span",_hoisted_13$1,toDisplayString(unref($t)("upload.folder.dialog.invalidFiles")),1),createBaseVNode("strong",_hoisted_14$1,toDisplayString(__props.stats.invalidFiles),1)])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_15$1,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-info-circle message-icon"},null,-1)),createBaseVNode("p",{class:"message-text",innerHTML:unref($t)("upload.folder.dialog.confirmMessage",{count:__props.stats.validFiles})},null,8,_hoisted_16$1)]),__props.stats.invalidFiles>0?(openBlock(),createElementBlock("div",_hoisted_17$1,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-exclamation-triangle warning-icon"},null,-1)),createBaseVNode("span",_hoisted_18$1,toDisplayString(unref($t)("upload.folder.dialog.warningMessage",{count:__props.stats.invalidFiles})),1)])):createCommentVNode("",!0)])]),_:1},8,["modelValue","title"])}}});const FolderConfirmDialog=_export_sfc(_sfc_main$1,[["__scopeId","data-v-8e235d00"]]);function useGlobalUpload(options){const uploadStore=useUploadStore(),{$t}=useTexts(),{allUploads,globalProgress,globalSpeed,isUploading,statistics,maxConcurrentUploads}=storeToRefs(uploadStore);if(options){const globalOptions={};options.folderId&&(globalOptions.folderId=typeof options.folderId=="object"&&"value"in options.folderId?options.folderId.value:options.folderId),options.accessLevel&&(globalOptions.accessLevel=typeof options.accessLevel=="object"&&"value"in options.accessLevel?options.accessLevel.value:options.accessLevel),options.optimize!==void 0&&(globalOptions.optimize=typeof options.optimize=="object"&&"value"in options.optimize?options.optimize.value:options.optimize),uploadStore.setGlobalOptions(globalOptions)}const uploadQueue=computed(()=>allUploads.value.map(item=>{let status="pending";item.status==="completed"?status="success":item.status==="failed"?status="error":item.status==="uploading"||item.status==="preparing"?status="uploading":item.status==="analyzing"?status="analyzing":item.status==="instant"?status="instant":item.status==="retrying"?status="retrying":item.status==="paused"?status="paused":item.status==="pending"&&(status="pending");let resultUrls={};if(item.status==="completed"&&item.result){const resultData=item.result.data||item.result;resultUrls={full_url:resultData?.full_url,full_thumb_url:resultData?.full_thumb_url,url:resultData?.url,id:resultData?.id}}const isInstantUpload=item.statusMessage===$t("composables.useGlobalUpload.statusMessages.instantComplete")||item.statusMessage===$t("composables.useGlobalUpload.statusMessages.instantSuccess")||item.statusMessage?.includes($t("composables.useGlobalUpload.statusMessages.instantKeyword"))||status==="instant";return{file:item.file,name:item.file.name,size:item.file.size,progress:item.progress,status,...resultUrls,preview:item.preview||"",error:item.error,id:item.id||"",uniqueId:item.id,previewLoaded:!0,itemLoaded:!0,statusMessage:item.statusMessage,speed:item.speed,remainingTime:item.remainingTime,is_duplicate:isInstantUpload,type:item.type}})),addFiles=files=>uploadStore.addFiles(files),startUpload=()=>uploadStore.startUpload(),pauseUpload=itemId=>{uploadStore.pauseUpload(itemId)},resumeUpload=itemId=>{const item=allUploads.value[parseInt(itemId)];if(item)return uploadStore.resumeUpload(item.id)},cancelUpload=itemId=>{uploadStore.cancelUpload(itemId)},retryUpload=index2=>{const item=allUploads.value[index2];if(item)return uploadStore.retryUpload(item.id)},removeUploadItem=itemId=>{uploadStore.removeUploadItem(itemId)},removeFile=index2=>{const item=allUploads.value[index2];item&&uploadStore.removeUploadItem(item.id)},clearQueue=()=>{uploadStore.clearQueue()},clearAllSessions=()=>{uploadStore.clearAllSessions()},pendingCount=computed(()=>statistics.value.pending),uploadingCount=computed(()=>statistics.value.uploading),successCount=computed(()=>statistics.value.completed),errorCount=computed(()=>statistics.value.failed),hasPendingFiles=computed(()=>pendingCount.value>0),hasUploadingFiles=computed(()=>uploadingCount.value>0),hasSuccessFiles=computed(()=>successCount.value>0),totalFileSize=computed(()=>allUploads.value.reduce((total,file)=>total+file.file.size,0)),copyAllUrls=async()=>{const urls=allUploads.value.filter(file=>file.status==="completed"&&file.result?.full_url).map(file=>file.result?.full_url).filter(url=>!!url).join(`
`);if(urls)try{return await navigator.clipboard.writeText(urls),!0}catch{return!1}return!1},copyAllMarkdownUrls=async()=>{const markdownLinks=allUploads.value.filter(file=>file.status==="completed"&&file.result?.full_url).map(file=>`![${file.file.name}](${file.result?.full_url})`).join(`
`);if(markdownLinks)try{return await navigator.clipboard.writeText(markdownLinks),!0}catch{return!1}return!1},copyAllHtmlUrls=async()=>{const htmlTags=allUploads.value.filter(file=>file.status==="completed"&&file.result?.full_url).map(file=>`<img src="${file.result?.full_url}" alt="${file.file.name}" />`).join(`
`);if(htmlTags)try{return await navigator.clipboard.writeText(htmlTags),!0}catch{return!1}return!1},copyAllThumbnailUrls=async()=>{const thumbnailUrls=allUploads.value.filter(file=>file.status==="completed"&&file.result?.full_thumb_url).map(file=>file.result?.full_thumb_url).filter(url=>!!url).join(`
`);if(thumbnailUrls)try{return await navigator.clipboard.writeText(thumbnailUrls),!0}catch{return!1}return!1};return{allUploads,uploadQueue,globalProgress,globalSpeed,isUploading,runningUploads:computed(()=>uploadStore.runningUploads),maxConcurrentUploads,pendingCount,uploadingCount,successCount,errorCount,hasPendingFiles,hasUploadingFiles,hasSuccessFiles,totalFileSize,addFiles,startUpload,pauseUpload,resumeUpload,cancelUpload,retryUpload,removeUploadItem,removeFile,clearQueue,clearAllSessions,copyAllUrls,copyAllMarkdownUrls,copyAllHtmlUrls,copyAllThumbnailUrls,formatFileSize:uploadStore.formatFileSize,isValidImageFile:uploadStore.isValidImageFile,uploadStore}}async function readFolderRecursively(entry){const files=[];if(entry.isFile){const fileEntry=entry;try{const file=await new Promise((resolve,reject)=>{fileEntry.file(resolve,reject)});files.push(file)}catch(error){console.warn("[FolderReader] Failed to read file:",entry.name,error)}}else if(entry.isDirectory){const reader=entry.createReader();try{const entries=await readAllEntries(reader);for(const subEntry of entries){const subFiles=await readFolderRecursively(subEntry);files.push(...subFiles)}}catch(error){console.warn("[FolderReader] Failed to read directory:",entry.name,error)}}return files}function readAllEntries(reader){return new Promise((resolve,reject)=>{const allEntries=[];function readBatch(){reader.readEntries(entries=>{entries.length===0?resolve(allEntries):(allEntries.push(...entries),readBatch())},error=>reject(error))}readBatch()})}async function extractFilesFromItems(items){const allFiles=[];for(let i=0;i<items.length;i++){const entry=items[i].webkitGetAsEntry();if(entry){const files=await readFolderRecursively(entry);allFiles.push(...files)}}return allFiles}function extractFilesFromFileList(fileList){return Array.from(fileList)}function filterValidFiles(files,isAllowedType,isAllowedSize){return files.filter(file=>isAllowedType(file.type)&&isAllowedSize(file.size))}function getFolderStats(allFiles,validFiles){return{totalFiles:allFiles.length,validFiles:validFiles.length,invalidFiles:allFiles.length-validFiles.length}}function hasFolder(items){for(let i=0;i<items.length;i++)if(items[i].webkitGetAsEntry()?.isDirectory)return!0;return!1}function supportsFolderUpload(){return"webkitdirectory"in document.createElement("input")}const _hoisted_1={class:"upload-page min-h-screen"},_hoisted_2={class:"upload-top-panel mb-4 rounded-lg"},_hoisted_3={class:"grid grid-cols-1 gap-4 p-4 md:grid-cols-2"},_hoisted_4={class:"flex flex-col"},_hoisted_5={class:"mb-3"},_hoisted_6={class:"mb-0.5 text-xl font-bold text-content-heading"},_hoisted_7={class:"mt-1 text-sm leading-relaxed text-content-muted"},_hoisted_8=["accept"],_hoisted_9={class:"absolute inset-0 flex flex-col items-center justify-center p-4"},_hoisted_10={class:"mb-3 text-center"},_hoisted_11={class:"mb-1 text-lg font-semibold text-content"},_hoisted_12={class:"text-content-secondary text-base"},_hoisted_13={class:"font-medium text-brand-500 transition-colors hover:text-content-heading"},_hoisted_14={key:0,class:"text-content-secondary mt-1 text-sm"},_hoisted_15={class:"text-content-secondary mb-3 flex items-center gap-4 text-xs"},_hoisted_16={class:"flex items-center gap-1"},_hoisted_17={class:"flex items-center gap-1"},_hoisted_18={class:"flex items-center gap-1"},_hoisted_19={class:"text-content-secondary flex items-center justify-center gap-2 text-xs"},_hoisted_20={class:"flex items-center gap-1"},_hoisted_21={class:"rounded border border-brand-500 bg-background-600 px-1.5 py-0.5 font-medium text-content"},_hoisted_22={key:0,class:"mt-3"},_hoisted_23={class:"flex items-center justify-center rounded border border-default px-3 py-2"},_hoisted_24={class:"text-content-secondary text-xs"},_hoisted_25={class:"flex flex-col"},_hoisted_26={class:"settings-panel settings-no-scrollbar h-full rounded-md"},_hoisted_27={class:"border-b border-default p-3"},_hoisted_28={class:"flex items-center text-base font-semibold text-content"},_hoisted_29={class:"p-3"},_hoisted_30={class:"mt-4 border-t border-default pt-3"},_hoisted_31={class:"quick-actions mt-4 rounded-b-lg border-t border-default bg-gradient-to-r from-background-700 to-background-700 backdrop-blur-sm"},_hoisted_32={class:"flex flex-wrap items-center justify-center gap-3 px-4 py-4"},_hoisted_33={class:"flex flex-wrap items-center gap-2"},_hoisted_34={class:"flex items-center gap-2"},_hoisted_35=["title"],_hoisted_36={class:"upload-queue-panel mb-4 flex-1"},_hoisted_37={class:"relative flex h-full flex-col"},_hoisted_38={class:"bg-background-800/95 relative z-10 flex h-full flex-col rounded-xl border border-default shadow-lg backdrop-blur-sm"},_hoisted_39={class:"upload-header bg-background-800/95 sticky top-0 z-10 flex items-center justify-between gap-4 rounded-t-xl border-b border-default px-5 py-3.5 backdrop-blur"},_hoisted_40={class:"flex flex-wrap items-center gap-3"},_hoisted_41={class:"flex items-center gap-2.5 text-base font-semibold text-content-heading"},_hoisted_42={class:"flex items-center gap-2.5 text-xs"},_hoisted_43={key:0,class:"queue-pill bg-brand-500/15 text-brand-400"},_hoisted_44={key:1,class:"queue-pill bg-error-500/15 text-error-400"},_hoisted_45={class:"flex items-center gap-2"},_hoisted_46={key:0,class:"custom-scrollbar flex-1 overflow-y-auto px-4 py-3"},_hoisted_47={class:"upload-stats bg-background-700/90 mb-3 rounded-lg border border-default p-3 shadow-sm"},_hoisted_48={class:"grid gap-3 md:grid-cols-5"},_hoisted_49={class:"queue-stat"},_hoisted_50={class:"queue-stat__label"},_hoisted_51={class:"queue-stat__value"},_hoisted_52={class:"queue-stat"},_hoisted_53={class:"queue-stat__label"},_hoisted_54={class:"queue-stat__value"},_hoisted_55={class:"queue-stat"},_hoisted_56={class:"queue-stat__label"},_hoisted_57={class:"queue-stat__value"},_hoisted_58={class:"queue-stat"},_hoisted_59={class:"queue-stat__label"},_hoisted_60={class:"queue-stat__value"},_hoisted_61={class:"queue-stat"},_hoisted_62={class:"queue-stat__label"},_hoisted_63={class:"queue-stat__value"},_hoisted_64={class:"queue-meta"},_hoisted_65={class:"queue-meta__label"},_hoisted_66={class:"queue-meta__value"},_hoisted_67={key:0},_hoisted_68={key:1,class:"flex flex-1 flex-col items-center justify-center p-8"},_hoisted_69={class:"max-w-md p-8 text-center"},_hoisted_70={class:"mb-3 text-xl font-semibold text-content-heading"},_hoisted_71={class:"mb-6 text-sm leading-relaxed text-content-muted"},_hoisted_72={class:"flex justify-center"},_hoisted_73={class:"upload-tips bg-background-800/90 rounded-b-2xl border-t border-subtle backdrop-blur"},_hoisted_74={class:"p-4"},_hoisted_75={class:"mb-4 flex items-center"},_hoisted_76={class:"text-base font-semibold text-content"},_hoisted_77={class:"grid grid-cols-1 gap-3 lg:grid-cols-2 xl:grid-cols-3"},_hoisted_78={class:"rounded-lg border border-default p-3 transition-all duration-200 hover:border-strong hover:bg-background-700"},_hoisted_79={class:"mb-2 flex items-center"},_hoisted_80={class:"text-sm font-medium text-content"},_hoisted_81={class:"text-content-secondary text-xs leading-relaxed"},_hoisted_82={class:"rounded-lg border border-default p-3 transition-all duration-200 hover:border-strong hover:bg-background-700"},_hoisted_83={class:"mb-2 flex items-center"},_hoisted_84={class:"text-sm font-medium text-content"},_hoisted_85={class:"text-content-secondary text-xs leading-relaxed"},_hoisted_86={class:"rounded-lg border border-default p-3 transition-all duration-200 hover:border-strong hover:bg-background-700"},_hoisted_87={class:"mb-2 flex items-center"},_hoisted_88={class:"text-sm font-medium text-content"},_hoisted_89={class:"text-content-secondary text-xs leading-relaxed"},_hoisted_90={class:"mb-4 flex items-center justify-between"},_hoisted_91={class:"flex items-center text-sm font-semibold text-content"},_hoisted_92={key:0,class:"space-y-3"},_hoisted_93={class:"mb-1.5 block text-sm font-medium text-content"},_hoisted_94={class:"text-content-secondary mt-1 text-xs"},_hoisted_95={class:"flex items-center justify-between"},_hoisted_96=["title"],_hoisted_97={class:"text-content-secondary ml-6 mt-1 text-xs"},_hoisted_98={key:0,class:"ml-6 mt-2"},_hoisted_99={class:"text-content-secondary space-y-1 text-xs"},_hoisted_100={class:"flex items-center"},_hoisted_101={key:0,class:"flex items-center"},_hoisted_102={class:"flex items-center"},_hoisted_103={key:1,class:"py-6 text-center"},_hoisted_104={class:"mb-2 text-sm text-content"},_hoisted_105={class:"text-content-secondary mb-4 text-xs"},_sfc_main=defineComponent({__name:"index",setup(__props){const toast=useToast(),settingsStore=useSettingsStore(),authStore=useAuthStore(),route=useRoute(),{$t}=useTexts(),{settings:globalSettings}=useGlobalSettings(),{getFolderPathString}=useFolderPath(),uploadConfig=useUploadConfig(),isDismissed=ref(!1),fileInput=ref(null),folderInput=ref(null),isDragging=ref(!1),showFolderDialog=ref(!1),folderStats=ref({totalFiles:0,validFiles:0,invalidFiles:0}),pendingFolderFiles=ref([]),isFolderUploadSupported=supportsFolderUpload();let isSelectingFolder=!1;const folderId=ref(null),presetFolderPath=ref(""),accessLevel=ref("public"),optimize=ref(!0),autoRemove=ref(!1),storageDuration=ref(authStore.isLoggedIn?"permanent":"7d"),showAdvancedSettings=ref(!1),advancedSettingsTrigger=ref(null),panelPosition=ref({}),watermarkEnabled=ref(!1),watermarkConfig=ref({...DEFAULT_WATERMARK_CONFIG}),showWatermarkConfig=ref(!1),uploadStore=useUploadStore(),layoutStore=useLayoutStore(),globalUpload=useGlobalUpload({folderId:computed(()=>folderId.value),accessLevel:computed(()=>accessLevel.value),optimize:computed(()=>optimize.value)}),{uploadQueue,globalProgress,addFiles,startUpload,resumeUpload,cancelUpload,retryUpload,removeFile,clearQueue,clearAllSessions,formatFileSize,pendingCount,uploadingCount,successCount,errorCount,hasPendingFiles,hasUploadingFiles,hasSuccessFiles,totalFileSize,maxConcurrentUploads,copyAllUrls:copyAllUrlsFromStore,copyAllMarkdownUrls:copyAllMarkdownUrlsFromStore,copyAllHtmlUrls:copyAllHtmlUrlsFromStore,copyAllThumbnailUrls:copyAllThumbnailUrlsFromStore}=globalUpload,setupPreselectedFolder=async folderIdParam=>{try{const pathString=await getFolderPathString(folderIdParam);presetFolderPath.value=pathString,uploadStore.setGlobalOptions({folderId:folderIdParam}),pathString?toast.success($t("upload.toast.folderSelected",{path:pathString})):toast.info($t("upload.toast.folderPreselected"))}catch(error){logger.error("[Upload Page] Error setting up preselected folder:",error),toast.info($t("upload.toast.folderPreselected"))}},shouldShowContentDetectionWarning=computed(()=>{if(isDismissed.value||!globalSettings.value?.upload)return!1;const{upload}=globalSettings.value,contentDetectionEnabled=upload.content_detection_enabled,sensitiveHandling=upload.sensitive_content_handling;return contentDetectionEnabled&&sensitiveHandling&&sensitiveHandling!=="mark_only"}),simpleWarningIcon=computed(()=>{const sensitiveHandling=globalSettings.value?.upload?.sensitive_content_handling;return sensitiveHandling==="auto_delete"?"fas fa-exclamation-triangle text-red-400":sensitiveHandling==="pending_review"?"fas fa-clock text-amber-400":"fas fa-info-circle text-brand-500"}),simpleWarningMessage=computed(()=>{const sensitiveHandling=globalSettings.value?.upload?.sensitive_content_handling;return $t(sensitiveHandling==="auto_delete"?"upload.toast.sensitiveAutoDelete":sensitiveHandling==="pending_review"?"upload.toast.sensitivePendingReview":"upload.toast.defaultHint")}),acceptFormats=computed(()=>{const formats=settingsStore.allowedImageFormats;return formats.length===0?"image/*":formats.map(format=>`image/${format.toLowerCase()}`).join(",")});computed(()=>uploadQueue.value.filter(file=>file.status==="pending").reduce((total,file)=>total+file.size,0));const storageDurationOptionsForLoggedUser=computed(()=>{if(!authStore.isLoggedIn)return[];const allowedDurations=globalSettings.value?.upload?.user_allowed_storage_durations,options=[];return Array.isArray(allowedDurations)&&allowedDurations.length>0?allowedDurations.forEach(duration=>{duration==="permanent"?options.push({label:$t("upload.duration.permanent"),value:duration}):options.push({label:duration,value:duration})}):options.push({label:$t("upload.duration.permanent"),value:"permanent"}),options}),pasteShortcut=computed(()=>{const isMac=/Mac|iPod|iPhone|iPad/.test(navigator.userAgent);return{key:isMac?"Cmd":"Ctrl",isMac}}),triggerFileInput=()=>{isSelectingFolder||fileInput.value?.click()},triggerFolderInput=()=>{if(isSelectingFolder)return;if(!isFolderUploadSupported){toast.warning($t("upload.folder.browserNotSupported"));return}if(!folderInput.value){toast.error($t("upload.folder.initFailed"));return}isSelectingFolder=!0;const input=folderInput.value;input.hasAttribute("webkitdirectory")||(input.setAttribute("webkitdirectory",""),input.setAttribute("mozdirectory",""),input.setAttribute("directory","")),input.click(),setTimeout(()=>{isSelectingFolder=!1},3e3)},handleFolderChange=async event=>{const target=event.target;isSelectingFolder=!1,target.files&&target.files.length>0&&(await processFolderFiles(target.files),target.value="")},processFolderFiles=async fileList=>{try{uploadConfig.isConfigLoaded.value||await uploadConfig.loadConfig();const allFiles=extractFilesFromFileList(fileList);if(allFiles.length===0){toast.warning($t("upload.folder.noFiles"));return}const validFiles=filterValidFiles(allFiles,uploadConfig.isAllowedFileType,uploadConfig.isAllowedFileSize);if(validFiles.length===0){toast.error($t("upload.folder.noValidFiles"));return}const stats=getFolderStats(allFiles,validFiles);folderStats.value=stats,pendingFolderFiles.value=validFiles,showFolderDialog.value=!0}catch(error){logger.error("[Upload] processFolderFiles error:",error),toast.error($t("upload.folder.processingError"))}},handleConfirmFolderUpload=async()=>{pendingFolderFiles.value.length>0&&(await addFilesWithWatermark(pendingFolderFiles.value),toast.success($t("upload.folder.addSuccess",{count:pendingFolderFiles.value.length})),pendingFolderFiles.value=[])},handleCancelFolderUpload=()=>{pendingFolderFiles.value=[]},onDragOver=()=>{isDragging.value=!0},onDragLeave=()=>{isDragging.value=!1},onDrop=async event=>{isDragging.value=!1;const items=event.dataTransfer?.items;if(!items){const files=event.dataTransfer?.files;files&&await addFilesWithWatermark(files);return}if(hasFolder(items))await handleFolderDrop(items);else{const files=event.dataTransfer?.files;files&&await addFilesWithWatermark(files)}},handleFolderDrop=async items=>{try{toast.info($t("upload.folder.parsing")),uploadConfig.isConfigLoaded.value||await uploadConfig.loadConfig();const allFiles=await extractFilesFromItems(items);if(allFiles.length===0){toast.warning($t("upload.folder.noFiles"));return}const validFiles=filterValidFiles(allFiles,uploadConfig.isAllowedFileType,uploadConfig.isAllowedFileSize);if(validFiles.length===0){toast.error($t("upload.folder.noValidFiles"));return}const stats=getFolderStats(allFiles,validFiles);folderStats.value=stats,pendingFolderFiles.value=validFiles,showFolderDialog.value=!0}catch(error){logger.error("[Upload] handleFolderDrop error:",error),toast.error($t("upload.folder.processingError"))}},handleFileChange=async event=>{const target=event.target;target.files&&(await addFilesWithWatermark(target.files),target.value="")},handlePaste=async e=>{const items=e.clipboardData?.items;if(!items)return;const files=[];for(let i=0;i<items.length;i++){const item=items[i];if(item.type.indexOf("image")!==-1){const file=item.getAsFile();file&&files.push(file)}}if(files.length>0){const dt=new DataTransfer;files.forEach(file=>dt.items.add(file)),await addFilesWithWatermark(dt.files)}},addFilesWithWatermark=async files=>{const syncedWatermarkConfig={...watermarkConfig.value,enabled:watermarkEnabled.value};watermarkConfig.value=syncedWatermarkConfig,await addFiles(files)},startUploadWrapper=async()=>{const syncedWatermarkConfig={...watermarkConfig.value,enabled:watermarkEnabled.value};if(!authStore.isLoggedIn&&(!storageDuration.value||storageDuration.value==="permanent")){logger.warn("[Upload] Guest mode storage duration validation failed"),toast.error($t("upload.toast.guestDurationRequired"));return}if(!hasPendingFiles.value){showNoFilesMessage();return}watermarkConfig.value=syncedWatermarkConfig;const uploadWatermarkConfig={...syncedWatermarkConfig,type:"image"};uploadStore.setGlobalOptions({watermarkEnabled:watermarkEnabled.value,watermarkConfig:uploadWatermarkConfig}),await startUpload()},handleCancelUpload=()=>{cancelUpload(),toast.info($t("upload.toast.uploadCancelled"))},retryUploadWrapper=index2=>{retryUpload(index2)},resumeUploadWrapper=index2=>{resumeUpload(index2.toString())},removeFileWrapper=index2=>{removeFile(index2)},showNoFilesMessage=()=>{toast.warning($t("upload.toast.noFilesInQueue"))},copyAllUrls=async()=>{await copyAllUrlsFromStore()?toast.success($t("upload.toast.allLinksCopied")):toast.warning($t("upload.toast.noLinksToCopy"))},copyAllMarkdownUrls=async()=>{await copyAllMarkdownUrlsFromStore()?toast.success($t("upload.toast.markdownLinksCopied")):toast.warning($t("upload.toast.noLinksToCopy"))},copyAllHtmlUrls=async()=>{await copyAllHtmlUrlsFromStore()?toast.success($t("upload.toast.htmlLinksCopied")):toast.warning($t("upload.toast.noLinksToCopy"))},copyAllThumbnailUrls=async()=>{await copyAllThumbnailUrlsFromStore()?toast.success($t("upload.toast.thumbnailLinksCopied")):toast.warning($t("upload.toast.noLinksToCopy"))},calculatePanelPosition=()=>{if(!advancedSettingsTrigger.value)return{};const triggerRect=advancedSettingsTrigger.value.getBoundingClientRect(),panelWidth=320,panelHeight=authStore.isLoggedIn?200:280,viewportWidth=window.innerWidth,viewportHeight=window.innerHeight;let left=triggerRect.right-panelWidth,top=triggerRect.bottom+8;return left<20&&(left=20),left+panelWidth>viewportWidth-20&&(left=viewportWidth-panelWidth-20),top+panelHeight>viewportHeight-20&&(top=triggerRect.top-panelHeight-8),top<20&&(top=20),{left:`${left}px`,top:`${top}px`}},toggleAdvancedSettings=()=>{showAdvancedSettings.value||(panelPosition.value=calculatePanelPosition()),showAdvancedSettings.value=!showAdvancedSettings.value},onSettingsChange=settings=>{const uploadWatermarkConfig=settings.watermarkConfig?{...settings.watermarkConfig,type:"image"}:settings.watermarkConfig;uploadStore.setGlobalOptions({folderId:settings.folderId,accessLevel:settings.accessLevel,optimize:settings.optimize,autoRemove:settings.autoRemove,storageDuration:settings.storageDuration,watermarkEnabled:settings.watermarkEnabled,watermarkConfig:uploadWatermarkConfig}),settings.storageDuration&&(storageDuration.value=settings.storageDuration),settings.watermarkEnabled!==void 0&&(watermarkEnabled.value=settings.watermarkEnabled),settings.watermarkConfig&&(watermarkConfig.value=settings.watermarkConfig)},getPositionText=position=>({"top-left":$t("upload.watermark.position.top-left"),"top-center":$t("upload.watermark.position.top-center"),"top-right":$t("upload.watermark.position.top-right"),"middle-left":$t("upload.watermark.position.middle-left"),"middle-center":$t("upload.watermark.position.middle-center"),"middle-right":$t("upload.watermark.position.middle-right"),"bottom-left":$t("upload.watermark.position.bottom-left"),"bottom-center":$t("upload.watermark.position.bottom-center"),"bottom-right":$t("upload.watermark.position.bottom-right"),custom:$t("upload.watermark.position.custom")})[position]||position,handleWatermarkConfigConfirm=newConfig=>{watermarkConfig.value={...newConfig},showWatermarkConfig.value=!1};return watch(storageDuration,newValue=>{uploadStore.setGlobalOptions({storageDuration:newValue})}),watch(showWatermarkConfig,newValue=>{newValue&&showAdvancedSettings.value&&(showAdvancedSettings.value=!1)}),watch(storageDurationOptionsForLoggedUser,newOptions=>{if(newOptions&&newOptions.length>0&&globalSettings.value&&authStore.isLoggedIn){const defaultDuration=globalSettings.value.upload?.user_default_storage_duration||"permanent",shouldSetDefault=!(storageDuration.value&&newOptions.some(opt=>opt.value===storageDuration.value))||!storageDuration.value;shouldSetDefault&&defaultDuration&&newOptions.some(opt=>opt.value===defaultDuration)?storageDuration.value=defaultDuration:shouldSetDefault&&newOptions.length>0&&(storageDuration.value=newOptions[0].value)}},{immediate:!0}),onMounted(async()=>{if(await nextTick(),folderInput.value&&isFolderUploadSupported){const input=folderInput.value;input.setAttribute("webkitdirectory",""),input.setAttribute("mozdirectory",""),input.setAttribute("directory","");try{Object.defineProperty(input,"webkitdirectory",{value:!0,writable:!0,configurable:!0})}catch{}}if(authStore.isLoggedIn)globalSettings.value?.upload?.user_default_storage_duration&&(storageDuration.value=globalSettings.value.upload.user_default_storage_duration);else if(globalSettings.value?.guest?.guest_default_access_level&&(accessLevel.value=globalSettings.value.guest.guest_default_access_level),globalSettings.value?.guest?.guest_default_storage_duration)storageDuration.value=globalSettings.value.guest.guest_default_storage_duration;else{const allowedDurations=globalSettings.value?.guest?.guest_allowed_storage_durations;Array.isArray(allowedDurations)&&allowedDurations.length>0&&(storageDuration.value=allowedDurations[0])}document.addEventListener("paste",handlePaste);const queryFolderId=route.query.folderId;queryFolderId&&(folderId.value=queryFolderId,setupPreselectedFolder(queryFolderId))}),onUnmounted(()=>{document.removeEventListener("paste",handlePaste)}),(_ctx,_cache)=>{const _component_CyberIconButton=resolveComponent("CyberIconButton"),_component_cyberDropdown=resolveComponent("cyberDropdown"),_component_cyberCheckbox=resolveComponent("cyberCheckbox"),_component_cyberWatermarkConfig=resolveComponent("cyberWatermarkConfig");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",{class:normalizeClass(["upload-container relative z-10 flex w-full flex-col pt-4",{"mx-auto":unref(layoutStore).isTopLayout}])},[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("h1",_hoisted_6,toDisplayString(unref($t)("upload.title")),1),createBaseVNode("p",_hoisted_7,toDisplayString(unref(settingsStore).uploadLimitText),1)]),createBaseVNode("div",{class:normalizeClass(["upload-drop-zone group relative min-h-48 flex-grow cursor-pointer rounded-lg border-2 border-dashed border-default transition-all duration-300 hover:border-brand-500 hover:bg-background-700 hover:shadow-lg",{"border-brand-500 bg-background-700 shadow-lg":isDragging.value}]),onClick:triggerFileInput,onDragover:withModifiers(onDragOver,["prevent"]),onDragleave:withModifiers(onDragLeave,["prevent"]),onDrop:withModifiers(onDrop,["prevent"])},[createBaseVNode("input",{ref_key:"fileInput",ref:fileInput,type:"file",class:"hidden",accept:acceptFormats.value,multiple:"",onChange:handleFileChange},null,40,_hoisted_8),createBaseVNode("input",{ref_key:"folderInput",ref:folderInput,type:"file",class:"hidden",multiple:"",onChange:handleFolderChange},null,544),createBaseVNode("div",_hoisted_9,[_cache[26]||(_cache[26]=createBaseVNode("div",{class:"upload-icon-container relative mb-5"},[createBaseVNode("div",{class:"upload-icon relative p-6"},[createBaseVNode("i",{class:"fas fa-cloud-upload-alt to-accent-500 bg-gradient-to-r from-brand-500 bg-clip-text text-5xl text-transparent"})])],-1)),createBaseVNode("div",_hoisted_10,[createBaseVNode("p",_hoisted_11,toDisplayString(unref($t)("upload.dropZone.title")),1),createBaseVNode("p",_hoisted_12,[createTextVNode(toDisplayString(unref($t)("upload.dropZone.orText")),1),createBaseVNode("span",_hoisted_13,toDisplayString(unref($t)("upload.dropZone.clickToSelect")),1)]),unref(isFolderUploadSupported)?(openBlock(),createElementBlock("p",_hoisted_14,[_cache[19]||(_cache[19]=createBaseVNode("i",{class:"fas fa-folder-open text-brand-500"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.dropZone.supportFolder")),1)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[_cache[20]||(_cache[20]=createBaseVNode("i",{class:"fas fa-images text-brand-500"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.dropZone.features.batch")),1)]),createBaseVNode("div",_hoisted_17,[_cache[21]||(_cache[21]=createBaseVNode("i",{class:"fas fa-compress text-success-500"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.dropZone.features.autoOptimize")),1)]),createBaseVNode("div",_hoisted_18,[_cache[22]||(_cache[22]=createBaseVNode("i",{class:"fas fa-shield-alt text-content-heading"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.dropZone.features.secureStorage")),1)])]),createBaseVNode("div",_hoisted_19,[_cache[25]||(_cache[25]=createBaseVNode("i",{class:"fas fa-keyboard text-brand-500"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.dropZone.shortcut.label")),1),createBaseVNode("div",_hoisted_20,[createBaseVNode("kbd",_hoisted_21,toDisplayString(pasteShortcut.value.key),1),_cache[23]||(_cache[23]=createBaseVNode("span",null,"+",-1)),_cache[24]||(_cache[24]=createBaseVNode("kbd",{class:"rounded border border-brand-500 bg-background-600 px-1.5 py-0.5 font-medium text-content"}," V ",-1))]),createBaseVNode("span",null,toDisplayString(unref($t)("upload.dropZone.shortcut.paste")),1)])])],34),shouldShowContentDetectionWarning.value?(openBlock(),createElementBlock("div",_hoisted_22,[createBaseVNode("div",_hoisted_23,[createBaseVNode("i",{class:normalizeClass([simpleWarningIcon.value,"mr-2 text-xs opacity-70"])},null,2),createBaseVNode("span",_hoisted_24,toDisplayString(simpleWarningMessage.value),1)])])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_25,[createBaseVNode("div",_hoisted_26,[createBaseVNode("div",_hoisted_27,[createBaseVNode("h2",_hoisted_28,[_cache[27]||(_cache[27]=createBaseVNode("i",{class:"fas fa-cogs mr-1.5 text-sm text-brand-500"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.settings.title")),1)])]),createBaseVNode("div",_hoisted_29,[createVNode(UploadSettings,{"folder-id":folderId.value,"onUpdate:folderId":_cache[0]||(_cache[0]=$event=>folderId.value=$event),"access-level":accessLevel.value,"onUpdate:accessLevel":_cache[1]||(_cache[1]=$event=>accessLevel.value=$event),optimize:optimize.value,"onUpdate:optimize":_cache[2]||(_cache[2]=$event=>optimize.value=$event),"auto-remove":autoRemove.value,"onUpdate:autoRemove":_cache[3]||(_cache[3]=$event=>autoRemove.value=$event),"storage-duration":storageDuration.value,"onUpdate:storageDuration":_cache[4]||(_cache[4]=$event=>storageDuration.value=$event),"watermark-enabled":watermarkEnabled.value,"onUpdate:watermarkEnabled":_cache[5]||(_cache[5]=$event=>watermarkEnabled.value=$event),"watermark-config":watermarkConfig.value,"onUpdate:watermarkConfig":_cache[6]||(_cache[6]=$event=>watermarkConfig.value=$event),"folder-path":presetFolderPath.value,onChange:onSettingsChange},null,8,["folder-id","access-level","optimize","auto-remove","storage-duration","watermark-enabled","watermark-config","folder-path"]),createBaseVNode("div",_hoisted_30,[createBaseVNode("button",{ref_key:"advancedSettingsTrigger",ref:advancedSettingsTrigger,class:"flex w-full items-center text-base font-semibold text-content transition-colors hover:text-content-heading",onClick:toggleAdvancedSettings},[_cache[28]||(_cache[28]=createBaseVNode("i",{class:"fas fa-sliders-h mr-1.5 text-sm text-brand-500"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.settings.advanced")),1),_cache[29]||(_cache[29]=createBaseVNode("i",{class:"fas fa-external-link-alt ml-auto text-xs"},null,-1))],512)])])])])]),createBaseVNode("div",_hoisted_31,[createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createBaseVNode("button",{class:"cyber-button cyber-button-gradient flex items-center gap-2 rounded-lg px-4 py-2 font-medium transition-all hover:scale-105 hover:shadow-lg hover:shadow-error-200",onClick:_cache[7]||(_cache[7]=withModifiers($event=>unref(hasPendingFiles)?startUploadWrapper():showNoFilesMessage(),["stop"]))},[_cache[30]||(_cache[30]=createBaseVNode("i",{class:"fas fa-rocket text-sm"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.actions.startUpload")),1)]),createBaseVNode("button",{class:"cyber-button cyber-button-outline flex items-center gap-2 rounded-lg px-4 py-2 font-medium transition-all hover:scale-105",onClick:withModifiers(triggerFileInput,["stop"])},[_cache[31]||(_cache[31]=createBaseVNode("i",{class:"fas fa-plus text-sm"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.actions.selectFiles")),1)]),unref(isFolderUploadSupported)?(openBlock(),createElementBlock("button",{key:0,class:"cyber-button cyber-button-outline flex items-center gap-2 rounded-lg px-4 py-2 font-medium transition-all hover:scale-105",onClick:withModifiers(triggerFolderInput,["stop"])},[_cache[32]||(_cache[32]=createBaseVNode("i",{class:"fas fa-folder-open text-sm"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.actions.selectFolder")),1)])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_34,[createBaseVNode("button",{class:"cyber-button cyber-button-outline flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all hover:scale-105",onClick:_cache[8]||(_cache[8]=(...args)=>unref(clearQueue)&&unref(clearQueue)(...args))},[_cache[33]||(_cache[33]=createBaseVNode("i",{class:"fas fa-trash"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.actions.clearQueue")),1)]),createBaseVNode("button",{class:"cyber-button cyber-button-outline flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium transition-all hover:scale-105",title:unref($t)("upload.actions.clearCache"),onClick:_cache[9]||(_cache[9]=(...args)=>unref(clearAllSessions)&&unref(clearAllSessions)(...args))},[_cache[34]||(_cache[34]=createBaseVNode("i",{class:"fas fa-broom"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.actions.clearCache")),1)],8,_hoisted_35)])])])]),createBaseVNode("div",_hoisted_36,[createBaseVNode("div",_hoisted_37,[createBaseVNode("div",_hoisted_38,[createBaseVNode("div",_hoisted_39,[createBaseVNode("div",_hoisted_40,[createBaseVNode("div",_hoisted_41,[_cache[35]||(_cache[35]=createBaseVNode("i",{class:"fas fa-list text-brand-400"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.queue.title")),1)]),createBaseVNode("div",_hoisted_42,[unref(uploadQueue).length>0?(openBlock(),createElementBlock("span",_hoisted_43,toDisplayString(unref($t)("upload.queue.filesCount",{count:unref(uploadQueue).length})),1)):createCommentVNode("",!0),unref(uploadingCount)>0?(openBlock(),createElementBlock("span",_hoisted_44,[_cache[36]||(_cache[36]=createBaseVNode("i",{class:"fas fa-rocket mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.queue.concurrent",{current:unref(uploadingCount),max:unref(maxConcurrentUploads)})),1)])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_45,[unref(hasSuccessFiles)?(openBlock(),createBlock(_component_CyberIconButton,{key:0,type:"cyber",size:"small",tooltip:unref($t)("upload.actions.copyLinks"),"tooltip-placement":"top",onClick:copyAllUrls},{default:withCtx(()=>[..._cache[37]||(_cache[37]=[createBaseVNode("i",{class:"fas fa-copy"},null,-1)])]),_:1},8,["tooltip"])):createCommentVNode("",!0),unref(hasSuccessFiles)?(openBlock(),createBlock(_component_CyberIconButton,{key:1,type:"cyber",size:"small",tooltip:unref($t)("upload.actions.copyMarkdownLinks"),"tooltip-placement":"top",onClick:copyAllMarkdownUrls},{default:withCtx(()=>[..._cache[38]||(_cache[38]=[createBaseVNode("i",{class:"fab fa-markdown"},null,-1)])]),_:1},8,["tooltip"])):createCommentVNode("",!0),unref(hasSuccessFiles)?(openBlock(),createBlock(_component_CyberIconButton,{key:2,type:"cyber",size:"small",tooltip:unref($t)("upload.actions.copyHtmlLinks"),"tooltip-placement":"top",onClick:copyAllHtmlUrls},{default:withCtx(()=>[..._cache[39]||(_cache[39]=[createBaseVNode("i",{class:"fab fa-html5"},null,-1)])]),_:1},8,["tooltip"])):createCommentVNode("",!0),unref(hasSuccessFiles)?(openBlock(),createBlock(_component_CyberIconButton,{key:3,type:"cyber",size:"small",tooltip:unref($t)("upload.actions.copyThumbnailLinks"),"tooltip-placement":"top",onClick:copyAllThumbnailUrls},{default:withCtx(()=>[..._cache[40]||(_cache[40]=[createBaseVNode("i",{class:"fas fa-image"},null,-1)])]),_:1},8,["tooltip"])):createCommentVNode("",!0),unref(hasUploadingFiles)?(openBlock(),createBlock(_component_CyberIconButton,{key:4,type:"danger",size:"small",tooltip:unref($t)("upload.actions.cancelUpload"),"tooltip-placement":"top",onClick:handleCancelUpload},{default:withCtx(()=>[..._cache[41]||(_cache[41]=[createBaseVNode("i",{class:"fas fa-ban"},null,-1)])]),_:1},8,["tooltip"])):createCommentVNode("",!0)])]),unref(uploadQueue).length>0?(openBlock(),createElementBlock("div",_hoisted_46,[createBaseVNode("div",_hoisted_47,[createBaseVNode("div",_hoisted_48,[createBaseVNode("div",_hoisted_49,[createBaseVNode("span",_hoisted_50,toDisplayString(unref($t)("upload.queue.stats.pending")),1),createBaseVNode("span",_hoisted_51,[_cache[42]||(_cache[42]=createBaseVNode("i",{class:"fas fa-clock text-warning-400"},null,-1)),createTextVNode(" "+toDisplayString(unref(pendingCount)),1)])]),createBaseVNode("div",_hoisted_52,[createBaseVNode("span",_hoisted_53,toDisplayString(unref($t)("upload.queue.stats.uploading")),1),createBaseVNode("span",_hoisted_54,[_cache[43]||(_cache[43]=createBaseVNode("i",{class:"fas fa-arrow-circle-up text-brand-400"},null,-1)),createTextVNode(" "+toDisplayString(unref(uploadingCount)),1)])]),createBaseVNode("div",_hoisted_55,[createBaseVNode("span",_hoisted_56,toDisplayString(unref($t)("upload.queue.stats.success")),1),createBaseVNode("span",_hoisted_57,[_cache[44]||(_cache[44]=createBaseVNode("i",{class:"fas fa-check-circle text-success-400"},null,-1)),createTextVNode(" "+toDisplayString(unref(successCount)),1)])]),createBaseVNode("div",_hoisted_58,[createBaseVNode("span",_hoisted_59,toDisplayString(unref($t)("upload.queue.stats.failed")),1),createBaseVNode("span",_hoisted_60,[_cache[45]||(_cache[45]=createBaseVNode("i",{class:"fas fa-times-circle text-error-400"},null,-1)),createTextVNode(" "+toDisplayString(unref(errorCount)),1)])]),createBaseVNode("div",_hoisted_61,[createBaseVNode("span",_hoisted_62,toDisplayString(unref($t)("upload.queue.stats.total")),1),createBaseVNode("span",_hoisted_63,[_cache[46]||(_cache[46]=createBaseVNode("i",{class:"fas fa-layer-group text-info-400"},null,-1)),createTextVNode(" "+toDisplayString(unref(uploadQueue).length),1)])])]),createBaseVNode("div",_hoisted_64,[createBaseVNode("span",_hoisted_65,toDisplayString(unref($t)("upload.queue.stats.totalSize")),1),createBaseVNode("span",_hoisted_66,[createTextVNode(toDisplayString(unref(formatFileSize)(unref(totalFileSize)))+" ",1),unref(globalProgress)>0?(openBlock(),createElementBlock("span",_hoisted_67," · "+toDisplayString(unref(globalProgress))+"%",1)):createCommentVNode("",!0)])])]),createVNode(UploadProgress,{files:unref(uploadQueue),onRemove:removeFileWrapper,onUpload:startUploadWrapper,onCancel:handleCancelUpload,onRetry:retryUploadWrapper,onResume:resumeUploadWrapper},null,8,["files"])])):(openBlock(),createElementBlock("div",_hoisted_68,[createBaseVNode("div",_hoisted_69,[_cache[48]||(_cache[48]=createStaticVNode('<div class="mb-6 flex items-center justify-center" data-v-66ed426c><div class="relative" data-v-66ed426c><div class="bg-brand-500/20 absolute inset-0 animate-pulse rounded-full blur-xl" data-v-66ed426c></div><div class="from-brand-500/20 to-brand-600/20 relative flex h-20 w-20 items-center justify-center rounded-full bg-gradient-to-br shadow-inner" data-v-66ed426c><i class="fas fa-cloud-upload-alt text-4xl text-brand-400" data-v-66ed426c></i></div></div></div>',1)),createBaseVNode("h3",_hoisted_70,toDisplayString(unref($t)("upload.queue.empty.title")),1),createBaseVNode("p",_hoisted_71,toDisplayString(unref($t)("upload.queue.empty.desc")),1),createBaseVNode("div",_hoisted_72,[createBaseVNode("button",{class:"queue-empty-primary",onClick:triggerFileInput},[_cache[47]||(_cache[47]=createBaseVNode("i",{class:"fas fa-images mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.queue.empty.action")),1)])])])])),createBaseVNode("div",_hoisted_73,[createBaseVNode("div",_hoisted_74,[createBaseVNode("div",_hoisted_75,[_cache[49]||(_cache[49]=createBaseVNode("div",{class:"to-accent-500 mr-3 h-6 w-2 rounded-full bg-gradient-to-b from-brand-500"},null,-1)),createBaseVNode("h4",_hoisted_76,toDisplayString(unref($t)("upload.guide.title")),1)]),createBaseVNode("div",_hoisted_77,[createBaseVNode("div",_hoisted_78,[createBaseVNode("div",_hoisted_79,[_cache[50]||(_cache[50]=createBaseVNode("div",{class:"mr-2 flex h-6 w-6 items-center justify-center rounded-md bg-brand-500"},[createBaseVNode("i",{class:"fas fa-upload text-xs text-content-heading"})],-1)),createBaseVNode("span",_hoisted_80,toDisplayString(unref($t)("upload.guide.multipleWays.title")),1)]),createBaseVNode("p",_hoisted_81,toDisplayString(unref($t)("upload.guide.multipleWays.desc",{key:pasteShortcut.value.key})),1)]),createBaseVNode("div",_hoisted_82,[createBaseVNode("div",_hoisted_83,[_cache[51]||(_cache[51]=createBaseVNode("div",{class:"mr-2 flex h-6 w-6 items-center justify-center rounded-md bg-error-500"},[createBaseVNode("i",{class:"fas fa-puzzle-piece text-xs text-content-heading"})],-1)),createBaseVNode("span",_hoisted_84,toDisplayString(unref($t)("upload.guide.smartChunking.title")),1)]),createBaseVNode("p",_hoisted_85,toDisplayString(unref($t)("upload.guide.smartChunking.desc")),1)]),createBaseVNode("div",_hoisted_86,[createBaseVNode("div",_hoisted_87,[_cache[52]||(_cache[52]=createBaseVNode("div",{class:"mr-2 flex h-6 w-6 items-center justify-center rounded-md bg-brand-500"},[createBaseVNode("i",{class:"fas fa-magic text-xs text-content-heading"})],-1)),createBaseVNode("span",_hoisted_88,toDisplayString(unref($t)("upload.guide.oneCopy.title")),1)]),createBaseVNode("p",_hoisted_89,toDisplayString(unref($t)("upload.guide.oneCopy.desc")),1)])])])])])])])],2),(openBlock(),createBlock(Teleport,{to:"body"},[showAdvancedSettings.value?(openBlock(),createElementBlock("div",{key:0,class:"advanced-settings-panel fixed z-[9999] w-80 rounded-lg border border-default bg-background-900 p-4 shadow-2xl backdrop-blur-md",style:normalizeStyle(panelPosition.value),onClick:_cache[15]||(_cache[15]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",_hoisted_90,[createBaseVNode("h3",_hoisted_91,[_cache[53]||(_cache[53]=createBaseVNode("i",{class:"fas fa-sliders-h mr-2 text-brand-500"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("upload.advanced.title")),1)]),createBaseVNode("button",{class:"text-content-secondary transition-colors hover:text-content-heading",onClick:_cache[10]||(_cache[10]=$event=>showAdvancedSettings.value=!1)},[..._cache[54]||(_cache[54]=[createBaseVNode("i",{class:"fas fa-times text-sm"},null,-1)])])]),unref(authStore).isLoggedIn?(openBlock(),createElementBlock("div",_hoisted_92,[createBaseVNode("div",null,[createBaseVNode("label",_hoisted_93,toDisplayString(unref($t)("upload.advanced.storageDuration")),1),createVNode(_component_cyberDropdown,{modelValue:storageDuration.value,"onUpdate:modelValue":_cache[11]||(_cache[11]=$event=>storageDuration.value=$event),options:storageDurationOptionsForLoggedUser.value,placeholder:unref($t)("upload.form.storageDuration.placeholder"),class:"compact-dropdown text-sm"},{"option-icon":withCtx(()=>[..._cache[55]||(_cache[55]=[createBaseVNode("i",{class:"fas fa-calendar-alt text-sm text-content"},null,-1)])]),"selected-icon":withCtx(()=>[..._cache[56]||(_cache[56]=[createBaseVNode("i",{class:"fas fa-calendar-alt text-sm text-content"},null,-1)])]),_:1},8,["modelValue","options","placeholder"]),createBaseVNode("p",_hoisted_94,toDisplayString(unref($t)("upload.advanced.storageDurationDesc")),1)]),createBaseVNode("div",null,[createBaseVNode("div",_hoisted_95,[createVNode(_component_cyberCheckbox,{modelValue:watermarkEnabled.value,"onUpdate:modelValue":_cache[12]||(_cache[12]=$event=>watermarkEnabled.value=$event)},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("upload.advanced.watermark")),1)]),_:1},8,["modelValue"]),watermarkEnabled.value?(openBlock(),createElementBlock("button",{key:0,class:"config-btn",title:unref($t)("upload.watermark.configure"),onClick:_cache[13]||(_cache[13]=$event=>showWatermarkConfig.value=!0)},[..._cache[57]||(_cache[57]=[createBaseVNode("i",{class:"fas fa-cog"},null,-1)])],8,_hoisted_96)):createCommentVNode("",!0)]),createBaseVNode("p",_hoisted_97,toDisplayString(unref($t)("upload.advanced.watermarkDesc")),1),watermarkEnabled.value&&watermarkConfig.value.type?(openBlock(),createElementBlock("div",_hoisted_98,[createBaseVNode("div",_hoisted_99,[createBaseVNode("div",_hoisted_100,[_cache[58]||(_cache[58]=createBaseVNode("i",{class:"fas fa-tag mr-1"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.advanced.watermarkInfo.type"))+" "+toDisplayString(watermarkConfig.value.type==="text"?unref($t)("upload.advanced.watermarkType.text"):unref($t)("upload.advanced.watermarkType.image")),1)]),watermarkConfig.value.text?(openBlock(),createElementBlock("div",_hoisted_101,[_cache[59]||(_cache[59]=createBaseVNode("i",{class:"fas fa-font mr-1"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.advanced.watermarkInfo.content"))+" "+toDisplayString(watermarkConfig.value.text),1)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_102,[_cache[60]||(_cache[60]=createBaseVNode("i",{class:"fas fa-map-marker-alt mr-1"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("upload.advanced.watermarkInfo.position"))+" "+toDisplayString(getPositionText(watermarkConfig.value.position)),1)])])])):createCommentVNode("",!0)])])):(openBlock(),createElementBlock("div",_hoisted_103,[_cache[61]||(_cache[61]=createBaseVNode("i",{class:"fas fa-star mb-3 text-2xl text-brand-500"},null,-1)),createBaseVNode("p",_hoisted_104,toDisplayString(unref($t)("upload.advanced.loginPrompt.title")),1),createBaseVNode("p",_hoisted_105,toDisplayString(unref($t)("upload.advanced.loginPrompt.desc")),1),createBaseVNode("button",{class:"rounded bg-brand-500 px-4 py-2 text-sm text-content-heading transition-colors hover:bg-brand-600",onClick:_cache[14]||(_cache[14]=$event=>_ctx.$router.push("/auth"))},toDisplayString(unref($t)("upload.advanced.loginPrompt.action")),1)]))],4)):createCommentVNode("",!0),showAdvancedSettings.value?(openBlock(),createElementBlock("div",{key:1,class:"fixed inset-0 z-[9998]",onClick:_cache[16]||(_cache[16]=$event=>showAdvancedSettings.value=!1)})):createCommentVNode("",!0)])),createVNode(_component_cyberWatermarkConfig,{visible:showWatermarkConfig.value,"onUpdate:visible":_cache[17]||(_cache[17]=$event=>showWatermarkConfig.value=$event),config:watermarkConfig.value,onConfirm:handleWatermarkConfigConfirm},null,8,["visible","config"]),createVNode(FolderConfirmDialog,{visible:showFolderDialog.value,"onUpdate:visible":_cache[18]||(_cache[18]=$event=>showFolderDialog.value=$event),stats:folderStats.value,onConfirm:handleConfirmFolderUpload,onCancel:handleCancelFolderUpload},null,8,["visible","stats"])])}}});const index$1=_export_sfc(_sfc_main,[["__scopeId","data-v-66ed426c"]]);export{index$1 as default};
