import{j as useTexts,a3 as getValidationRules,a6 as Validator,l as __unplugin_components_0,q as useToast,_ as _export_sfc}from"./index-38202212.js";import{d as defineComponent,r as ref,b as onMounted,I as createElementBlock,f as createVNode,a0 as createBaseVNode,F as Fragment,M as renderList,ac as createStaticVNode,a1 as toDisplayString,u as unref,ab as createTextVNode,a5 as withModifiers,H as withDirectives,a9 as vModelText,aa as withKeys,a4 as useRoute,a3 as useRouter,z as openBlock,Q as normalizeStyle}from"./vue-vendor-31320f47.js";import{u as useAuthApi}from"./auth-5bfb5b0c.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";const _hoisted_1={class:"reset-password-page"},_hoisted_2={class:"floating-particles"},_hoisted_3={class:"page-content"},_hoisted_4={class:"main-content"},_hoisted_5={class:"reset-panel-container"},_hoisted_6={key:0,class:"reset-panel"},_hoisted_7={class:"panel-header"},_hoisted_8={class:"panel-title"},_hoisted_9={class:"panel-body"},_hoisted_10={class:"loading-container"},_hoisted_11={class:"loading-text"},_hoisted_12={key:1,class:"reset-panel"},_hoisted_13={class:"panel-header"},_hoisted_14={class:"panel-title"},_hoisted_15={class:"panel-body"},_hoisted_16={class:"error-container"},_hoisted_17={class:"error-title"},_hoisted_18={class:"error-message"},_hoisted_19={class:"error-hint"},_hoisted_20={key:2,class:"reset-panel"},_hoisted_21={class:"panel-header"},_hoisted_22={class:"panel-title"},_hoisted_23={class:"panel-subtitle"},_hoisted_24={class:"panel-body"},_hoisted_25={class:"form-group"},_hoisted_26={class:"form-label"},_hoisted_27=["placeholder","disabled"],_hoisted_28={class:"form-group"},_hoisted_29={class:"form-label"},_hoisted_30=["placeholder","disabled"],_hoisted_31=["disabled"],_hoisted_32={key:0,class:"fas fa-spinner fa-spin mr-2"},_hoisted_33={key:1,class:"fas fa-check mr-2"},_hoisted_34={class:"back-to-login"},_sfc_main=defineComponent({name:"ResetPassword",__name:"index",setup(__props){const route=useRoute(),router=useRouter(),toast=useToast(),authApi=useAuthApi(),{$t}=useTexts(),R=getValidationRules($t),token=ref(""),newPassword=ref(""),confirmPassword=ref(""),loading=ref(!1),verifying=ref(!0),tokenValid=ref(!1),email=ref(""),errorMessage=ref(""),verifyToken=async()=>{const tokenParam=route.query.token;if(!tokenParam){errorMessage.value=$t("resetPassword.error.missingToken"),verifying.value=!1;return}token.value=tokenParam;try{const response=await authApi.verifyResetToken(tokenParam);tokenValid.value=!0,email.value=response.email||""}catch(error){const message=error?.message||$t("resetPassword.error.invalidToken");errorMessage.value=message}finally{verifying.value=!1}},handleSubmit=async()=>{const pwdCheck=Validator.validate(newPassword.value||"",[R.required,R.minLength(6),R.maxLength(50)],$t);if(!pwdCheck.valid){toast.error(pwdCheck.message||$t("utils.validation.errors.password"));return}const confirmCheck=Validator.validate(confirmPassword.value||"",[R.required],$t);if(!confirmCheck.valid){toast.error(confirmCheck.message||$t("utils.validation.errors.required"));return}if((confirmPassword.value||"")!==(newPassword.value||"")){toast.error($t("resetPassword.validation.passwordMismatch"));return}loading.value=!0;try{await authApi.resetPassword(token.value,newPassword.value),setTimeout(()=>{router.push("/auth")},2e3)}catch{}finally{loading.value=!1}};return onMounted(()=>{verifyToken()}),(_ctx,_cache)=>{const _component_CyberHomeBackground=__unplugin_components_0;return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberHomeBackground,{"show-enhanced-effects":!0,"show-digital-rain":!1,"show-red-orb":!0,"show-aurora":!0}),createBaseVNode("div",_hoisted_2,[(openBlock(),createElementBlock(Fragment,null,renderList(8,i=>createBaseVNode("div",{key:i,class:"particle",style:normalizeStyle({"--delay":i*.5+"s","--duration":8+i*2+"s"})},null,4)),64))]),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[_cache[10]||(_cache[10]=createStaticVNode('<div class="panel-glow-effect" data-v-3a185dc2></div><div class="corner-lines" data-v-3a185dc2><div class="corner-line top-left" data-v-3a185dc2></div><div class="corner-line top-right" data-v-3a185dc2></div><div class="corner-line bottom-left" data-v-3a185dc2></div><div class="corner-line bottom-right" data-v-3a185dc2></div></div><div class="scan-line-container" data-v-3a185dc2><div class="scan-line" data-v-3a185dc2></div></div>',3)),verifying.value?(openBlock(),createElementBlock("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[createBaseVNode("h1",_hoisted_8,toDisplayString(unref($t)("resetPassword.verifying.title")),1)]),createBaseVNode("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-spinner fa-spin loading-icon"},null,-1)),createBaseVNode("p",_hoisted_11,toDisplayString(unref($t)("resetPassword.verifying.loading")),1)])])])):tokenValid.value?(openBlock(),createElementBlock("div",_hoisted_20,[createBaseVNode("div",_hoisted_21,[createBaseVNode("h1",_hoisted_22,toDisplayString(unref($t)("resetPassword.title")),1),createBaseVNode("p",_hoisted_23,toDisplayString(unref($t)("resetPassword.form.subtitle",{email:email.value})),1)]),createBaseVNode("div",_hoisted_24,[createBaseVNode("form",{onSubmit:withModifiers(handleSubmit,["prevent"])},[createBaseVNode("div",_hoisted_25,[createBaseVNode("label",_hoisted_26,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-lock mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("resetPassword.form.newPassword.label")),1)]),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>newPassword.value=$event),type:"password",class:"form-input",placeholder:unref($t)("resetPassword.form.newPassword.placeholder"),disabled:loading.value,autocomplete:"new-password"},null,8,_hoisted_27),[[vModelText,newPassword.value]])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("label",_hoisted_29,[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-lock mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("resetPassword.form.confirmPassword.label")),1)]),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>confirmPassword.value=$event),type:"password",class:"form-input",placeholder:unref($t)("resetPassword.form.confirmPassword.placeholder"),disabled:loading.value,autocomplete:"new-password",onKeyup:withKeys(handleSubmit,["enter"])},null,40,_hoisted_30),[[vModelText,confirmPassword.value]])]),createBaseVNode("button",{type:"submit",class:"submit-button",disabled:loading.value},[loading.value?(openBlock(),createElementBlock("i",_hoisted_32)):(openBlock(),createElementBlock("i",_hoisted_33)),createTextVNode(" "+toDisplayString(loading.value?unref($t)("resetPassword.form.submitting"):unref($t)("resetPassword.form.submit")),1)],8,_hoisted_31),createBaseVNode("div",_hoisted_34,[createBaseVNode("button",{type:"button",class:"link-button",onClick:_cache[3]||(_cache[3]=$event=>unref(router).push("/auth"))},[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-arrow-left mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("resetPassword.actions.backToLogin")),1)])])],32)])])):(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createBaseVNode("h1",_hoisted_14,toDisplayString(unref($t)("resetPassword.title")),1)]),createBaseVNode("div",_hoisted_15,[createBaseVNode("div",_hoisted_16,[_cache[6]||(_cache[6]=createBaseVNode("div",{class:"error-icon"},[createBaseVNode("i",{class:"fas fa-exclamation-triangle"})],-1)),createBaseVNode("h3",_hoisted_17,toDisplayString(unref($t)("resetPassword.error.invalidOrExpired")),1),createBaseVNode("p",_hoisted_18,toDisplayString(errorMessage.value),1),createBaseVNode("p",_hoisted_19,toDisplayString(unref($t)("resetPassword.error.hint")),1),createBaseVNode("button",{class:"action-button",onClick:_cache[0]||(_cache[0]=$event=>unref(router).push("/auth"))},[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-arrow-left mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("resetPassword.actions.backToLogin")),1)])])])]))])])])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-3a185dc2"]]);export{index as default};
