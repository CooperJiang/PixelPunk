import{j as useTexts,L as LAYOUT,_ as _export_sfc,F as FileViewer,o as galleryVectorSearch,p as processParams,q as useToast,i as useLayoutStore,r as downloadFileQuick}from"./index-ae9c3219.js";import{r as ref,c as computed,d as defineComponent,a as reactive,w as watch,b as onMounted,E as resolveComponent,z as openBlock,I as createElementBlock,a0 as createBaseVNode,ab as createTextVNode,a1 as toDisplayString,u as unref,f as createVNode,L as withCtx,R as normalizeClass,K as createCommentVNode,Q as normalizeStyle,a6 as Transition,H as withDirectives,$ as vShow,o as onUnmounted,F as Fragment,M as renderList,a3 as useRouter,a5 as withModifiers,A as createBlock,n as nextTick,i as isRef,a4 as useRoute}from"./vue-vendor-31320f47.js";import{g as getFilterSortOptions,a as getResolutionOptions}from"./filterOptions-1ed3ac9a.js";import{a as getGuestTagList,b as getGuestColorList,c as getGuestFileList}from"./index-121a3036.js";import{C as CompactSearchBar,E as EmptyState}from"./EmptyState-d1c9e231.js";import{S as ShareButton,C as CreateShareDialog}from"./CreateShareDialog-15304665.js";import{u as useMultipleLoading}from"./useLoading-8da70177.js";/* empty css                                                           */import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./marked-e9418aa8.js";import"./dompurify-76a35038.js";import"./vue-table-79795ca5.js";import"./index-cecfa401.js";import"./clipboard-b54d9428.js";const DEFAULT_PAGE_SIZE=24,MAX_GALLERY_ITEMS=5e3;function usePaginatedTags(initialPageSize=20){const state=ref({tags:[],loading:!1,loadingMore:!1,hasMore:!0,currentPage:1,pageSize:initialPageSize,searchQuery:""}),tagOptions=computed(()=>state.value.tags.map(tag=>({label:`${tag.name} (${tag.count})`,value:tag.name}))),loadTags=async(page=1,append=!1)=>{page===1?state.value.loading=!0:state.value.loadingMore=!0;try{const result=await getGuestTagList(page,state.value.pageSize);if(result.success&&result.data){const newTags=result.data.items||[];append?state.value.tags=[...state.value.tags,...newTags]:(state.value.tags=newTags,state.value.currentPage=1);const pagination=result.data.pagination;pagination?(state.value.hasMore=pagination.current_page<pagination.last_page,state.value.currentPage=pagination.current_page):state.value.hasMore=newTags.length>=state.value.pageSize}}catch(error){console.error("Load tags failed:",error),state.value.hasMore=!1}finally{state.value.loading=!1,state.value.loadingMore=!1}},loadMore=async()=>{state.value.loadingMore||!state.value.hasMore||await loadTags(state.value.currentPage+1,!0)},searchTags=async query=>{state.value.searchQuery=query,state.value.currentPage=1,state.value.hasMore=!0,await loadTags(1,!1)},initialize=async()=>{await loadTags(1,!1)};return{tags:computed(()=>state.value.tags),tagOptions,loading:computed(()=>state.value.loading),loadingMore:computed(()=>state.value.loadingMore),hasMore:computed(()=>state.value.hasMore),loadMore,searchTags,initialize}}function usePaginatedColors(initialPageSize=20){const state=ref({colors:[],loading:!1,loadingMore:!1,hasMore:!0,currentPage:1,pageSize:initialPageSize,searchQuery:""}),colorOptions=computed(()=>state.value.colors.map(color=>({label:color,value:color,color}))),loadColors=async(page=1,append=!1)=>{page===1?state.value.loading=!0:state.value.loadingMore=!0;try{const result=await getGuestColorList(page,state.value.pageSize);if(result.success&&result.data){const newColors=result.data.items||[];append?state.value.colors=[...state.value.colors,...newColors]:(state.value.colors=newColors,state.value.currentPage=1);const pagination=result.data.pagination;pagination?(state.value.hasMore=pagination.current_page<pagination.last_page,state.value.currentPage=pagination.current_page):state.value.hasMore=newColors.length>=state.value.pageSize}}catch(error){console.error("Load colors failed:",error),state.value.hasMore=!1}finally{state.value.loading=!1,state.value.loadingMore=!1}},loadMore=async()=>{state.value.loadingMore||!state.value.hasMore||await loadColors(state.value.currentPage+1,!0)},searchColors=async query=>{state.value.searchQuery=query,state.value.currentPage=1,state.value.hasMore=!0,await loadColors(1,!1)},initialize=async()=>{await loadColors(1,!1)};return{colors:computed(()=>state.value.colors),colorOptions,loading:computed(()=>state.value.loading),loadingMore:computed(()=>state.value.loadingMore),hasMore:computed(()=>state.value.hasMore),loadMore,searchColors,initialize}}const _hoisted_1$7={class:"gallery-filter-panel-container"},_hoisted_2$6={class:"gallery-filter-panel mb-3 rounded-lg border border-subtle bg-background-600 p-2.5"},_hoisted_3$6={class:"mb-2 flex items-center justify-between"},_hoisted_4$6={class:"text-sm font-bold text-content-heading"},_hoisted_5$5={class:"flex space-x-1"},_hoisted_6$2={class:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"},_hoisted_7$2={class:"filter-item"},_hoisted_8$1={class:"mb-0.5 block text-xs text-content-muted"},_hoisted_9$1={class:"filter-item"},_hoisted_10$1={class:"mb-0.5 block text-xs text-content-muted"},_hoisted_11$1={class:"filter-item"},_hoisted_12$1={class:"mb-0.5 block text-xs text-content-muted"},_hoisted_13$1=["onClick"],_hoisted_14$1={class:"checkbox-wrapper"},_hoisted_15={class:"checkbox"},_hoisted_16={key:0,class:"fas fa-check"},_hoisted_17={class:"ml-2 text-sm"},_hoisted_18={class:"filter-item"},_hoisted_19={class:"mb-0.5 block text-xs text-content-muted"},_hoisted_20={class:"filter-item"},_hoisted_21={class:"mb-0.5 block text-xs text-content-muted"},_hoisted_22={class:"flex items-center gap-1"},_hoisted_23={class:"filter-item"},_hoisted_24={class:"mb-0.5 block text-xs text-content-muted"},_sfc_main$8=defineComponent({__name:"GalleryFilterPanel",props:{initialFilters:{},show:{type:Boolean}},emits:["filter"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,filters=reactive({page:1,size:LAYOUT.DEFAULT_PAGE_SIZE,sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0}),selectedColors=ref([]),selectedTags=ref([]);computed(()=>selectedColors.value?.length?selectedColors.value.map(color=>{const colorOption=colorOptions.value?.find(opt=>opt.value===color);return colorOption||{value:color,label:color,color}}):"");const{tagOptions,loading:tagsLoading,loadingMore:tagsLoadingMore,hasMore:tagsHasMore,loadMore:loadMoreTags,searchTags,initialize:initializeTags}=usePaginatedTags(20),{colorOptions,loading:colorsLoading,loadingMore:colorsLoadingMore,hasMore:colorsHasMore,loadMore:loadMoreColors,searchColors,initialize:initializeColors}=usePaginatedColors(20),sortOptions=computed(()=>getFilterSortOptions($t)),resolutionOptions=computed(()=>getResolutionOptions($t)),handleTagLoadMore=()=>{loadMoreTags()},handleTagSearch=query=>{searchTags(query)},handleColorLoadMore=()=>{loadMoreColors()},handleColorSearch=query=>{searchColors(query)};watch(()=>props.initialFilters,newFilters=>{newFilters&&(Object.assign(filters,newFilters),newFilters.tags&&(selectedTags.value=newFilters.tags.split(",")),newFilters.dominant_color&&(selectedColors.value=newFilters.dominant_color.split(",")))},{immediate:!0,deep:!0});const applyFilters=()=>{filters.dominant_color=selectedColors.value.join(","),filters.tags=selectedTags.value.join(","),emit("filter",{...filters})},resetFilters=()=>{selectedColors.value=[],selectedTags.value=[],Object.assign(filters,{page:1,size:LAYOUT.DEFAULT_PAGE_SIZE,sort:"newest",keyword:"",tags:"",dominant_color:"",resolution:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0}),emit("filter",{...filters})},isFilterDataLoaded=ref(!1),loadFilterData=async()=>{isFilterDataLoaded.value||(isFilterDataLoaded.value=!0,await Promise.all([initializeTags(),initializeColors()]))};return watch(()=>props.show,show=>{show&&loadFilterData()},{immediate:!0}),onMounted(()=>{props.show&&loadFilterData()}),(_ctx,_cache)=>{const _component_CyberButton=resolveComponent("CyberButton"),_component_CyberInput=resolveComponent("CyberInput"),_component_CyberDropdown=resolveComponent("CyberDropdown");return openBlock(),createElementBlock("div",_hoisted_1$7,[createBaseVNode("div",_hoisted_2$6,[createBaseVNode("div",_hoisted_3$6,[createBaseVNode("h3",_hoisted_4$6,[_cache[7]||(_cache[7]=createBaseVNode("i",{class:"fas fa-filter mr-1 text-content"},null,-1)),createTextVNode(toDisplayString(unref($t)("explore.filter.conditions")),1)]),createBaseVNode("div",_hoisted_5$5,[createVNode(_component_CyberButton,{type:"secondary",class:"px-1.5 py-0.5 text-xs",onClick:resetFilters},{default:withCtx(()=>[_cache[8]||(_cache[8]=createBaseVNode("i",{class:"fas fa-undo-alt mr-0.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("explore.search.reset")),1)]),_:1}),createVNode(_component_CyberButton,{type:"primary",class:"px-1.5 py-0.5 text-xs",onClick:applyFilters},{default:withCtx(()=>[_cache[9]||(_cache[9]=createBaseVNode("i",{class:"fas fa-search mr-0.5"},null,-1)),createTextVNode(toDisplayString(unref($t)("explore.actions.filter")),1)]),_:1})])]),createBaseVNode("div",_hoisted_6$2,[createBaseVNode("div",_hoisted_7$2,[createBaseVNode("label",_hoisted_8$1,toDisplayString(unref($t)("explore.filter.keyword")),1),createVNode(_component_CyberInput,{modelValue:filters.keyword,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>filters.keyword=$event),placeholder:unref($t)("explore.filter.keywordPlaceholder")},null,8,["modelValue","placeholder"])]),createBaseVNode("div",_hoisted_9$1,[createBaseVNode("label",_hoisted_10$1,toDisplayString(unref($t)("explore.filter.tag")),1),createVNode(_component_CyberDropdown,{modelValue:selectedTags.value,"onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>selectedTags.value=$event),options:unref(tagOptions),placeholder:unref($t)("explore.filter.tagPlaceholder"),multiple:"",searchable:"",pagination:"",loading:unref(tagsLoading),"loading-more":unref(tagsLoadingMore),"has-more":unref(tagsHasMore),class:"compact",onLoadMore:handleTagLoadMore,onSearch:handleTagSearch},null,8,["modelValue","options","placeholder","loading","loading-more","has-more"])]),createBaseVNode("div",_hoisted_11$1,[createBaseVNode("label",_hoisted_12$1,toDisplayString(unref($t)("explore.filter.color")),1),createVNode(_component_CyberDropdown,{modelValue:selectedColors.value,"onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>selectedColors.value=$event),options:unref(colorOptions),placeholder:unref($t)("explore.filter.colorPlaceholder"),"is-color-mode":"",multiple:"",searchable:"",pagination:"",loading:unref(colorsLoading),"loading-more":unref(colorsLoadingMore),"has-more":unref(colorsHasMore),class:"compact",onLoadMore:handleColorLoadMore,onSearch:handleColorSearch},{option:withCtx(({option,isSelected,onSelect})=>[createBaseVNode("div",{class:normalizeClass(["cyber-dropdown-option color-option-row",{"is-selected":isSelected}]),onClick:onSelect},[createBaseVNode("div",_hoisted_14$1,[createBaseVNode("span",_hoisted_15,[isSelected?(openBlock(),createElementBlock("i",_hoisted_16)):createCommentVNode("",!0)])]),createBaseVNode("div",{class:"color-item h-6 w-6 rounded",style:normalizeStyle({backgroundColor:option.color})},null,4),createBaseVNode("span",_hoisted_17,toDisplayString(option.label),1)],10,_hoisted_13$1)]),_:1},8,["modelValue","options","placeholder","loading","loading-more","has-more"])]),createBaseVNode("div",_hoisted_18,[createBaseVNode("label",_hoisted_19,toDisplayString(unref($t)("explore.filter.sort")),1),createVNode(_component_CyberDropdown,{modelValue:filters.sort,"onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>filters.sort=$event),options:sortOptions.value,placeholder:unref($t)("explore.filter.sortPlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])]),createBaseVNode("div",_hoisted_20,[createBaseVNode("label",_hoisted_21,toDisplayString(unref($t)("explore.filter.size")),1),createBaseVNode("div",_hoisted_22,[createVNode(_component_CyberInput,{modelValue:filters.min_width,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>filters.min_width=$event),modelModifiers:{number:!0},placeholder:unref($t)("explore.filter.minWidth"),type:"number",class:"w-full"},null,8,["modelValue","placeholder"]),_cache[10]||(_cache[10]=createBaseVNode("span",{class:"text-content-content-disabled mx-0.5"},"×",-1)),createVNode(_component_CyberInput,{modelValue:filters.min_height,"onUpdate:modelValue":_cache[5]||(_cache[5]=$event=>filters.min_height=$event),modelModifiers:{number:!0},placeholder:unref($t)("explore.filter.minHeight"),type:"number",class:"w-full"},null,8,["modelValue","placeholder"])])]),createBaseVNode("div",_hoisted_23,[createBaseVNode("label",_hoisted_24,toDisplayString(unref($t)("explore.filter.resolution")),1),createVNode(_component_CyberDropdown,{modelValue:filters.resolution,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>filters.resolution=$event),options:resolutionOptions.value,placeholder:unref($t)("explore.filter.resolutionPlaceholder"),class:"compact"},null,8,["modelValue","options","placeholder"])])])])])}}});const GalleryFilterPanel=_export_sfc(_sfc_main$8,[["__scopeId","data-v-8d21bd95"]]),_hoisted_1$6={class:"gallery-header-aligned px-8 lg:px-[max(2rem,calc((100vw-1600px)/2))]"},_sfc_main$7=defineComponent({__name:"GalleryFilterSection",props:{show:{type:Boolean},initialFilters:{}},emits:["filter"],setup(__props,{emit:__emit}){const emit=__emit;return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$6,[createVNode(Transition,{name:"filter-panel","enter-active-class":"transition duration-300 ease-out","leave-active-class":"transition duration-200 ease-in","enter-from-class":"opacity-0 transform -translate-y-6","enter-to-class":"opacity-100 transform translate-y-0","leave-from-class":"opacity-100 transform translate-y-0","leave-to-class":"opacity-0 transform -translate-y-6"},{default:withCtx(()=>[withDirectives(createVNode(GalleryFilterPanel,{show:__props.show,"initial-filters":__props.initialFilters,class:"mb-3",onFilter:_cache[0]||(_cache[0]=p=>emit("filter",p))},null,8,["show","initial-filters"]),[[vShow,__props.show]])]),_:1})]))}}),_hoisted_1$5={class:"gallery-masonry-container"},_hoisted_2$5=["onClick"],_hoisted_3$5={key:0,class:"selection-indicator file-selected-indicator"},_hoisted_4$5={class:"file-container"},_hoisted_5$4=["src","alt"],_hoisted_6$1={key:0,class:"image-actions"},_hoisted_7$1=["title","onClick"],_hoisted_8=["title","onClick"],_hoisted_9=["title","onClick"],_hoisted_10={class:"hover-overlay"},_hoisted_11={class:"file-info"},_hoisted_12={class:"file-title"},_hoisted_13={class:"file-meta"},_hoisted_14={key:1,class:"file-tags"},_sfc_main$6=defineComponent({__name:"GalleryMasonry",props:{files:{},selectMode:{type:Boolean},isFileSelected:{type:Function},isVectorSearch:{type:Boolean},columnCount:{},showTags:{type:Boolean}},emits:["view","download","details","select"],setup(__props,{emit:__emit}){const{$t}=useTexts(),props=__props,emit=__emit,router=useRouter(),masonryGrid=ref(),dynamicColumnCount=ref(4),calculateColumns=()=>{if(!masonryGrid.value)return;const width=masonryGrid.value.offsetWidth,density=getCurrentDensity(),baseColumns=getBaseColumns(width);density==="compact"?dynamicColumnCount.value=Math.min(baseColumns+2,12):density==="comfortable"?dynamicColumnCount.value=Math.max(baseColumns-2,2):dynamicColumnCount.value=baseColumns},getCurrentDensity=()=>{const galleryElement=document.querySelector(".gallery-files-fullscreen");return galleryElement?galleryElement.classList.contains("density-compact")?"compact":galleryElement.classList.contains("density-comfortable")?"comfortable":"normal":"normal"},getBaseColumns=width=>width<640?2:width<768?3:width<1024?4:width<1280?5:width<1536?6:width<1920?7:width<2560?8:10,columns=computed(()=>{const cols=props.columnCount||dynamicColumnCount.value,result=Array.from({length:cols},()=>[]);if(!props.files||!Array.isArray(props.files))return result;const columnHeights=new Array(cols).fill(0);return props.files.forEach(file=>{const minHeightIndex=columnHeights.indexOf(Math.min(...columnHeights));result[minHeightIndex].push(file);const ratio=(file.height||100)/(file.width||100);columnHeights[minHeightIndex]+=ratio}),result}),handleFileClick=file=>{props.selectMode?emit("select",file):emit("view",file.id)},handleTagClick=tag=>{router.push({path:"/gallery",query:{tags:tag,from:"gallery"}})},openInNewWindow=file=>{const url=file.full_url||file.url;url&&window.open(url,"_blank","noopener,noreferrer")},getMaxVisibleTags=tags=>{if(!tags||tags.length===0)return 0;const currentDensity=getCurrentDensity();let maxTags=2;return currentDensity==="compact"?maxTags=1:currentDensity==="comfortable"&&(maxTags=2),Math.min(maxTags,tags.length)},formatFileSize=bytes=>bytes<1024?`${bytes} B`:bytes<1024*1024?`${(bytes/1024).toFixed(1)} KB`:`${(bytes/(1024*1024)).toFixed(1)} MB`,handleImageLoad=event=>{event.target.classList.add("loaded")},handleImageError=event=>{const img=event.target;img.src="/placeholder-file.png"};let resizeObserver;return onMounted(()=>{calculateColumns(),masonryGrid.value&&(resizeObserver=new ResizeObserver(()=>{calculateColumns()}),resizeObserver.observe(masonryGrid.value)),window.addEventListener("resize",calculateColumns)}),onUnmounted(()=>{resizeObserver&&masonryGrid.value&&resizeObserver.unobserve(masonryGrid.value),window.removeEventListener("resize",calculateColumns)}),(_ctx,_cache)=>{const _component_CyberTag=resolveComponent("CyberTag");return openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("div",{ref_key:"masonryGrid",ref:masonryGrid,class:"masonry-grid"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(columns.value,(column,colIndex)=>(openBlock(),createElementBlock("div",{key:`col-${colIndex}`,class:"masonry-column"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(column,file=>(openBlock(),createElementBlock("div",{key:file.id,class:normalizeClass(["masonry-item selectable-item",{selected:__props.selectMode&&__props.isFileSelected(file),"is-selected":__props.selectMode&&__props.isFileSelected(file),selectable:__props.selectMode,"has-tags":__props.showTags&&file.ai_info?.tags?.length}]),onClick:$event=>handleFileClick(file)},[__props.selectMode&&__props.isFileSelected(file)?(openBlock(),createElementBlock("div",_hoisted_3$5,[..._cache[0]||(_cache[0]=[createBaseVNode("i",{class:"fas fa-check"},null,-1)])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$5,[createBaseVNode("img",{src:file.full_thumb_url||file.thumb_url,alt:file.display_name||file.original_name,class:"masonry-file",style:normalizeStyle({aspectRatio:`${file.width}/${file.height}`}),loading:"lazy",onLoad:handleImageLoad,onError:handleImageError},null,44,_hoisted_5$4),__props.selectMode?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_6$1,[file.ai_info?(openBlock(),createElementBlock("button",{key:0,class:"image-action-icon",title:unref($t)("explore.actions.details"),onClick:withModifiers($event=>_ctx.$emit("details",file.id),["stop"])},[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-info-circle"},null,-1)])],8,_hoisted_7$1)):createCommentVNode("",!0),createBaseVNode("button",{class:"image-action-icon",title:unref($t)("explore.actions.preview"),onClick:withModifiers($event=>openInNewWindow(file),["stop"])},[..._cache[2]||(_cache[2]=[createBaseVNode("i",{class:"fas fa-external-link-alt"},null,-1)])],8,_hoisted_8),createBaseVNode("button",{class:"image-action-icon",title:unref($t)("explore.actions.download"),onClick:withModifiers($event=>_ctx.$emit("download",file),["stop"])},[..._cache[3]||(_cache[3]=[createBaseVNode("i",{class:"fas fa-download"},null,-1)])],8,_hoisted_9)])),__props.isVectorSearch&&file.similarity!==void 0?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["similarity-badge",{"with-actions":!__props.selectMode}])},[_cache[4]||(_cache[4]=createBaseVNode("i",{class:"fas fa-percentage"},null,-1)),createTextVNode(" "+toDisplayString(Math.round(file.similarity*100)),1)],2)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[createBaseVNode("h3",_hoisted_12,toDisplayString(file.display_name||file.original_name),1),createBaseVNode("div",_hoisted_13,[createBaseVNode("span",null,toDisplayString(file.width)+" × "+toDisplayString(file.height),1),createBaseVNode("span",null,toDisplayString(formatFileSize(file.size)),1)])])])]),__props.showTags&&file.ai_info?.tags?.length?(openBlock(),createElementBlock("div",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment,null,renderList(file.ai_info.tags.slice(0,getMaxVisibleTags(file.ai_info.tags)),(tag,idx)=>(openBlock(),createBlock(_component_CyberTag,{key:idx,variant:"primary",size:"small",onClick:withModifiers($event=>handleTagClick(tag),["stop"])},{default:withCtx(()=>[createTextVNode(toDisplayString(tag),1)]),_:2},1032,["onClick"]))),128)),file.ai_info.tags.length>getMaxVisibleTags(file.ai_info.tags)?(openBlock(),createBlock(_component_CyberTag,{key:0,variant:"secondary",size:"small"},{default:withCtx(()=>[createTextVNode(" +"+toDisplayString(file.ai_info.tags.length-getMaxVisibleTags(file.ai_info.tags)),1)]),_:2},1024)):createCommentVNode("",!0)])):createCommentVNode("",!0)],10,_hoisted_2$5))),128))]))),128))],512)])}}});const GalleryMasonry=_export_sfc(_sfc_main$6,[["__scopeId","data-v-b6645169"]]),_sfc_main$5=defineComponent({__name:"GalleryModals",props:{showDetailModal:{type:Boolean},showFilePreview:{type:Boolean},selectedFile:{},previewFileUrl:{},previewFileName:{},files:{},currentPreviewIndex:{}},emits:["update:showDetailModal","update:showFilePreview","download","prev","next"],setup(__props){const props=__props,mapToViewerFile=file=>({id:String(file.id),url:file.full_url||file.url||file.full_thumb_url||file.thumb_url||"",full_url:file.full_url||file.url||file.full_thumb_url||file.thumb_url||"",display_name:file.display_name||file.original_name||"file",description:file.description||file.ai_info?.description||"",width:file.width,height:file.height,format:file.format,size_formatted:file.size_formatted,resolution:file.ai_info?.resolution,file_type:file.file_type,tags:file.ai_info?.tags?.map(tag=>({id:tag,name:tag}))||[],ai_info:file.ai_info?{description:file.ai_info.description}:void 0}),viewerFiles=computed(()=>(props.files||[]).map(mapToViewerFile)),viewerSelectedFile=computed(()=>{try{return props.selectedFile?mapToViewerFile(props.selectedFile):null}catch{return null}});return(_ctx,_cache)=>{const _component_CyberFileDetailModal=resolveComponent("CyberFileDetailModal");return openBlock(),createElementBlock("div",null,[createVNode(_component_CyberFileDetailModal,{"model-value":__props.showDetailModal,fileInfo:__props.selectedFile,"is-admin":!1,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>_ctx.$emit("update:showDetailModal",$event)),onDownload:_cache[1]||(_cache[1]=$event=>_ctx.$emit("download",__props.selectedFile?.id))},null,8,["model-value","fileInfo"]),__props.showFilePreview&&viewerSelectedFile.value?(openBlock(),createBlock(FileViewer,{key:0,"model-value":__props.showFilePreview,file:viewerSelectedFile.value,files:viewerFiles.value,"initial-index":__props.currentPreviewIndex,"show-side-nav":!0,"show-keyboard-tips":!0,"controls-hide-timeout":8e3,"search-scope":"gallery","onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>_ctx.$emit("update:showFilePreview",$event)),onClose:_cache[3]||(_cache[3]=$event=>_ctx.$emit("update:showFilePreview",!1)),onPrev:_cache[4]||(_cache[4]=$event=>_ctx.$emit("prev")),onNext:_cache[5]||(_cache[5]=$event=>_ctx.$emit("next"))},null,8,["model-value","file","files","initial-index"])):createCommentVNode("",!0)])}}}),_hoisted_1$4={class:"selection-toolbar-compact"},_hoisted_2$4={class:"flex items-center gap-2"},_hoisted_3$4=["title"],_hoisted_4$4=["title"],_hoisted_5$3={class:"text-xs text-content-muted"},_sfc_main$4=defineComponent({__name:"SelectionToolbar",props:{isAllSelected:{type:Boolean},selectedCount:{}},emits:["toggle-all","invert"],setup(__props,{emit:__emit}){const{$t}=useTexts(),emit=__emit;function onToggleAll(){emit("toggle-all")}function onInvert(){emit("invert")}return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$4,[createBaseVNode("div",_hoisted_2$4,[createBaseVNode("button",{class:normalizeClass(["select-btn select-all-btn",{active:__props.isAllSelected}]),title:__props.isAllSelected?unref($t)("explore.selection.deselectAll"):unref($t)("explore.selection.selectAllPage"),onClick:onToggleAll},[createBaseVNode("i",{class:normalizeClass(["fas",__props.isAllSelected?"fa-check-double":"fa-check"])},null,2),createTextVNode(" "+toDisplayString(__props.isAllSelected?unref($t)("explore.selection.deselectAll"):unref($t)("explore.selection.selectAllPage")),1)],10,_hoisted_3$4),createBaseVNode("button",{class:"select-btn invert-btn",title:unref($t)("explore.selection.invertPage"),onClick:onInvert},[_cache[0]||(_cache[0]=createBaseVNode("i",{class:"fas fa-exchange-alt"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("explore.selection.invertPage")),1)],8,_hoisted_4$4)]),createBaseVNode("div",_hoisted_5$3,toDisplayString(unref($t)("explore.selection.selected",{count:__props.selectedCount})),1)]))}});const SelectionToolbar=_export_sfc(_sfc_main$4,[["__scopeId","data-v-2dbfa3ca"]]),_hoisted_1$3={class:"toolbar-group"},_hoisted_2$3={class:"sort-switcher"},_hoisted_3$3=["title","onClick"],_hoisted_4$3={class:"density-switcher"},_hoisted_5$2=["title","onClick"],_sfc_main$3=defineComponent({__name:"GalleryToolbarControls",props:{filtersSort:{},sortOptions:{},currentDensity:{},densityOptions:{}},emits:["sort","change-density"],setup(__props,{emit:__emit}){const emit=__emit;function onSort(value){emit("sort",value)}function setDensity(density){emit("change-density",density)}return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.sortOptions,sort=>(openBlock(),createElementBlock("button",{key:sort.value,class:normalizeClass(["sort-btn",{active:__props.filtersSort===sort.value}]),title:sort.label,onClick:$event=>onSort(sort.value)},[createBaseVNode("i",{class:normalizeClass(sort.icon)},null,2)],10,_hoisted_3$3))),128))]),createBaseVNode("div",_hoisted_4$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(__props.densityOptions,density=>(openBlock(),createElementBlock("button",{key:density.value,class:normalizeClass(["density-btn",{active:__props.currentDensity===density.value}]),title:density.label,onClick:$event=>setDensity(density.value)},[createBaseVNode("i",{class:normalizeClass(density.icon)},null,2)],10,_hoisted_5$2))),128))])]))}}),_hoisted_1$2={key:0},_hoisted_2$2={class:"text-lg font-bold text-content md:text-xl"},_hoisted_3$2={class:"whitespace-nowrap text-xs text-content-muted"},_hoisted_4$2={key:1},_hoisted_5$1={class:"mt-3 flex items-center gap-3 md:mt-0"},_hoisted_6={class:"toolbar-section flex items-center gap-3"},_hoisted_7={class:"search-section flex-shrink-0"},_sfc_main$2=defineComponent({__name:"GalleryHeaderBar",props:{images:{},hasContent:{type:Boolean},setShareButtonRef:{type:Function},filtersSort:{},sortOptions:{},currentDensity:{},densityOptions:{},searchKeyword:{},searchMode:{},showFilter:{type:Boolean},filterCount:{},isSearching:{type:Boolean},isLeftLayout:{type:Boolean}},emits:["update:select-mode","update:share-dialog-visible","sort","change-density","update:search-keyword","update:search-mode","update:show-filter","search"],setup(__props,{emit:__emit}){const emit=__emit;return(_ctx,_cache)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["gallery-header-aligned",{"px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16":!__props.isLeftLayout,"px-0":__props.isLeftLayout}])},[createBaseVNode("div",{class:normalizeClass(["gallery-header-inner flex flex-col md:flex-row md:items-center",{"md:justify-between":!__props.isLeftLayout,"md:justify-end":__props.isLeftLayout,"gallery-header-transparent":!__props.hasContent}])},[!__props.isLeftLayout&&__props.hasContent?(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("h1",_hoisted_2$2,toDisplayString(_ctx.$t("explore.header.title")),1),createBaseVNode("p",_hoisted_3$2,toDisplayString(_ctx.$t("explore.header.subtitle")),1)])):!__props.isLeftLayout&&!__props.hasContent?(openBlock(),createElementBlock("div",_hoisted_4$2)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_5$1,[createBaseVNode("div",_hoisted_6,[createVNode(ShareButton,{ref:__props.setShareButtonRef,images:__props.images,"require-login":!0,"onUpdate:selectMode":_cache[0]||(_cache[0]=v=>emit("update:select-mode",v)),"onUpdate:shareDialogVisible":_cache[1]||(_cache[1]=v=>emit("update:share-dialog-visible",v))},null,8,["images"]),createVNode(_sfc_main$3,{class:"toolbar-group","filters-sort":__props.filtersSort,"sort-options":__props.sortOptions,"current-density":__props.currentDensity,"density-options":__props.densityOptions,onSort:_cache[2]||(_cache[2]=v=>emit("sort",v)),onChangeDensity:_cache[3]||(_cache[3]=v=>emit("change-density",v))},null,8,["filters-sort","sort-options","current-density","density-options"])]),createBaseVNode("div",_hoisted_7,[createVNode(CompactSearchBar,{"model-value":__props.searchKeyword,"search-mode":__props.searchMode,"show-filter":__props.showFilter,"filter-count":__props.filterCount,"is-searching":__props.isSearching,"onUpdate:modelValue":_cache[4]||(_cache[4]=v=>emit("update:search-keyword",v)),"onUpdate:searchMode":_cache[5]||(_cache[5]=v=>emit("update:search-mode",v)),"onUpdate:showFilter":_cache[6]||(_cache[6]=v=>emit("update:show-filter",v)),onSearch:_cache[7]||(_cache[7]=p=>emit("search",p))},null,8,["model-value","search-mode","show-filter","filter-count","is-searching"])])])],2)],2))}}),_hoisted_1$1={key:0,class:"mb-4 mt-6 flex justify-center"},_hoisted_2$1={key:0,class:"loading-indicator"},_hoisted_3$1={key:1,class:"end-message"},_hoisted_4$1={key:2,class:"end-message"},_sfc_main$1=defineComponent({__name:"GalleryFooterStatus",props:{filesLength:{},isLoadingMore:{type:Boolean},hasReachedLimit:{type:Boolean},hasMore:{type:Boolean}},setup(__props){return(_ctx,_cache)=>__props.filesLength>0?(openBlock(),createElementBlock("div",_hoisted_1$1,[__props.isLoadingMore?(openBlock(),createElementBlock("div",_hoisted_2$1,[_cache[0]||(_cache[0]=createBaseVNode("div",{class:"loading-spinner"},[createBaseVNode("i",{class:"fas fa-circle-notch fa-spin"})],-1)),createBaseVNode("span",null,toDisplayString(_ctx.$t("explore.footer.loadingMore")),1)])):__props.hasReachedLimit?(openBlock(),createElementBlock("div",_hoisted_3$1,[_cache[1]||(_cache[1]=createBaseVNode("i",{class:"fas fa-info-circle mr-2"},null,-1)),createTextVNode(" "+toDisplayString(_ctx.$t("explore.footer.enoughContent")),1)])):__props.hasMore?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_4$1,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-check-circle mr-2"},null,-1)),createTextVNode(" "+toDisplayString(_ctx.$t("explore.footer.loadedAll")),1)]))])):createCommentVNode("",!0)}});function useGalleryFilters(options){const{filters,loadFiles,defaultPageSize,searchKeyword}=options;return{getFilterCount:()=>{let count=0;return filters.sort&&filters.sort!=="newest"&&count++,filters.dominant_color&&count++,filters.tags&&count++,filters.is_recommended!==void 0&&count++,filters.resolution&&count++,(filters.min_width||filters.max_width||filters.min_height||filters.max_height)&&count++,count},quickSort:sortValue=>{filters.sort=sortValue,loadFiles(!1)},applyFilter:newFilters=>{Object.assign(filters,newFilters),loadFiles(!1)},resetFilter:()=>{Object.assign(filters,{page:1,size:defaultPageSize,sort:"newest",keyword:"",tags:"",dominant_color:"",is_recommended:void 0,resolution:"",min_width:void 0,max_width:void 0,min_height:void 0,max_height:void 0}),searchKeyword.value="",loadFiles(!1)}}}function useGallerySearch(opts){const{$t}=useTexts(),{images,currentPage,hasMore,hasReachedLimit,withPageLoading,loadImages,searchKeyword,searchMode,isVectorSearchMode,lastVectorSearchQuery,toast}=opts,handleNormalSearch=()=>{isVectorSearchMode.value&&(isVectorSearchMode.value=!1,lastVectorSearchQuery.value=""),loadImages(!1)},handleVectorSearch=async()=>{const query=searchKeyword.value.trim();if(!query){isVectorSearchMode.value=!1,lastVectorSearchQuery.value="",loadImages(!1);return}images.value=[],currentPage.value=1,hasMore.value=!1,hasReachedLimit.value=!1,await withPageLoading("isLoading",async()=>{const result=await galleryVectorSearch({query,page:1});if(result&&result.data&&result.data.items){const{data}=result,newImages=data.items.map(item=>(item.ai_info?.description&&(item.description=item.ai_info.description),item.similarity!==void 0&&(item.similarity=item.similarity),item));images.value=newImages,isVectorSearchMode.value=!0,lastVectorSearchQuery.value=query,toast.success($t("explore.toast.foundResults").replace("{count}",data.pagination.total.toString()))}else images.value=[],toast.info($t("explore.toast.noResultsFound"))},{onError:_error=>{toast.error($t("explore.toast.searchFailed"))}})},handleAdvancedSearch=({keyword,mode})=>{searchKeyword.value=keyword,searchMode.value=mode,mode==="vector"?handleVectorSearch():handleNormalSearch()};return watch(searchMode,newMode=>{newMode==="normal"&&isVectorSearchMode.value&&(isVectorSearchMode.value=!1,lastVectorSearchQuery.value="",searchKeyword.value?handleNormalSearch():loadImages(!1))}),{handleNormalSearch,handleVectorSearch,handleAdvancedSearch}}function useGalleryList(options){const{images,filters,searchKeyword,isVectorSearchMode,pageSize:initialPageSize=24,maxImages=5e3}=options,currentPage=ref(1),pageSize=ref(initialPageSize),hasMore=ref(!0),hasReachedLimit=ref(!1),{loading:loadingStates,withLoading}=useMultipleLoading({isLoading:!1,isLoadingMore:!1}),isLoading=computed(()=>loadingStates.value?.isLoading||!1),isLoadingMore=computed(()=>loadingStates.value?.isLoadingMore||!1),checkAndLoadMoreIfNeeded=async()=>{if(!isVectorSearchMode||!images||isVectorSearchMode&&isVectorSearchMode.value||!images.value||images.value.length===0||hasReachedLimit.value||!hasMore.value)return;await nextTick();const{height,scroll}=getScrollMetricsFrom(),contentHeight=scroll,threshold=height*1.5;contentHeight<threshold&&hasMore.value&&!isLoadingMore.value&&(currentPage.value++,await loadImages(!0),await checkAndLoadMoreIfNeeded())},loadImages=async(append=!1)=>{append||(images.value=[],currentPage.value=1,hasMore.value=!0,hasReachedLimit.value=!1),await withLoading(append?"isLoadingMore":"isLoading",async()=>{const params=processParams({...filters,page:currentPage.value,size:pageSize.value,keyword:searchKeyword&&searchKeyword.value||""},{removeUndefined:!0,removeEmpty:!0}),result=await getGuestFileList(params);if(result.success){const{data}=result,newFiles=(data.items||[]).map(file=>(file.ai_info?.description&&(file.description=file.ai_info.description),file));append?images.value=[...images.value,...newFiles]:images.value=newFiles;const currentImageCount=images.value.length,total=data.pagination?.total;typeof total=="number"&&total>=0?hasMore.value=currentImageCount<total&&newFiles.length>0:hasMore.value=newFiles.length>=pageSize.value,images.value.length>=maxImages&&(hasReachedLimit.value=!0,hasMore.value=!1,images.value=images.value.slice(0,maxImages)),!append&&newFiles.length>0&&setTimeout(()=>{checkAndLoadMoreIfNeeded()},300)}else hasMore.value=!1},{onError:error=>{console.error("Load files failed:",error),hasMore.value=!1}})},loadMore=async()=>{isLoadingMore.value||isLoading.value||!hasMore.value||hasReachedLimit.value||(currentPage.value++,await loadImages(!0))},hasUserScrolled=ref(!1),markUserScrolled=()=>{hasUserScrolled.value=!0},onKeyDown=e=>{["ArrowDown","ArrowUp","PageDown","PageUp","Space"].includes(e.code)&&(hasUserScrolled.value=!0)};onMounted(()=>{window.addEventListener("wheel",markUserScrolled,{passive:!0}),window.addEventListener("touchmove",markUserScrolled,{passive:!0}),window.addEventListener("keydown",onKeyDown)}),onUnmounted(()=>{window.removeEventListener("wheel",markUserScrolled),window.removeEventListener("touchmove",markUserScrolled),window.removeEventListener("keydown",onKeyDown)});const scrollTarget=ref(window),pickScrollTarget=()=>{const candidates=[document.querySelector(".main-content"),document.querySelector(".gallery-images-fullscreen"),document.querySelector(".gallery-container"),document.querySelector(".gallery-page")];for(const el of candidates){if(!el)continue;const overflowY=window.getComputedStyle(el).overflowY;if(overflowY==="auto"||overflowY==="scroll")return el}return window},getScrollMetricsFrom=el=>{const t=el||scrollTarget.value;if(t===window||t===document||t===document.documentElement||t===document.body){const docEl=document.documentElement,body=document.body,top=window.scrollY||docEl.scrollTop||body.scrollTop||0,height=window.innerHeight,scroll=docEl.scrollHeight;return{top,height,scroll}}const node=t;return{top:node.scrollTop,height:node.clientHeight,scroll:node.scrollHeight}},BOTTOM_THRESHOLD=40;let scrollRafPending=!1;const checkShouldLoad=source=>{if(!hasUserScrolled.value||isLoadingMore.value||isLoading.value||!hasMore.value||hasReachedLimit.value||isVectorSearchMode&&isVectorSearchMode.value)return!1;const{top,height,scroll}=getScrollMetricsFrom(source);return scroll-(top+height)<=BOTTOM_THRESHOLD},onScroll=e=>{hasUserScrolled.value=!0,!scrollRafPending&&(scrollRafPending=!0,requestAnimationFrame(async()=>{scrollRafPending=!1;const src=e&&(e.target||e.currentTarget)||void 0;checkShouldLoad(src)&&await loadMore()}))};return onMounted(()=>{scrollTarget.value=pickScrollTarget(),scrollTarget.value.addEventListener("scroll",onScroll,{passive:!0})}),onUnmounted(()=>{const tgt=scrollTarget.value;tgt&&tgt.removeEventListener("scroll",onScroll)}),{images,currentPage,pageSize,hasMore,hasReachedLimit,isLoading,isLoadingMore,loadImages,loadMore,withPageLoading:withLoading}}function useGalleryPreview(images){const showDetailModal=ref(!1),showFilePreview=ref(!1),selectedImage=ref(null),previewImageUrl=ref(""),previewImageName=ref(""),currentPreviewIndex=ref(0);function closeFilePreview(){showFilePreview.value=!1}const handlePreviewChange=index=>{index<0||index>=images.value.length||(currentPreviewIndex.value=index,selectedImage.value=images.value[index])};return{showDetailModal,showFilePreview,selectedImage,previewImageUrl,previewImageName,currentPreviewIndex,closeFilePreview,handlePreviewChange,handlePrevImage:()=>{currentPreviewIndex.value>0&&handlePreviewChange(currentPreviewIndex.value-1)},handleNextImage:()=>{currentPreviewIndex.value<images.value.length-1&&handlePreviewChange(currentPreviewIndex.value+1)},viewImageDetails:id=>{const image=images.value.find(img=>img.id===id);image&&(selectedImage.value=image,showDetailModal.value=!0)},viewImage:id=>{const imageIndex=images.value.findIndex(img=>img.id===id);imageIndex!==-1&&(currentPreviewIndex.value=imageIndex,selectedImage.value=images.value[imageIndex],showFilePreview.value=!0)}}}function useGallerySelection(images){const toast=useToast(),{$t}=useTexts(),selectMode=ref(!1),shareButton=ref(),isAllImagesSelected=ref(!1),showShareDialog=ref(!1),handleSelectModeChange=value=>{selectMode.value=value},isFileSelected=file=>shareButton.value?.isFileSelected?.(file),handleFileSelect=file=>{shareButton.value?.toggleFileSelect(file)},toggleSelectAllImages=()=>{selectMode.value&&(isAllImagesSelected.value=!isAllImagesSelected.value,images.value.forEach(image=>{const selected=isFileSelected(image);(isAllImagesSelected.value&&!selected||!isAllImagesSelected.value&&selected)&&handleFileSelect(image)}))},invertImageSelection=()=>{selectMode.value&&images.value.forEach(image=>handleFileSelect(image))},handleShareCreated=_share=>{shareButton.value?.cancelSelectMode?.(),showShareDialog.value=!1,toast.success($t("explore.explore.toast.shareCreated"))},setShareButtonRef=el=>{shareButton.value=el||void 0},handleKeydown=event=>{event.key==="Escape"&&selectMode.value&&(shareButton.value?.cancelSelectMode?.(),event.preventDefault())};return{selectMode,shareButton,isAllImagesSelected,showShareDialog,handleSelectModeChange,isFileSelected,handleFileSelect,toggleSelectAllImages,invertImageSelection,handleShareCreated,setShareButtonRef,attachEscListener:()=>{window.addEventListener("keydown",handleKeydown)},detachEscListener:()=>{window.removeEventListener("keydown",handleKeydown)}}}function useDisplayDensity(defaultDensity="normal"){const currentDensity=ref(defaultDensity);return{currentDensity,changeDensity:density=>{currentDensity.value=density;try{localStorage.setItem("gallery_density",density)}catch{}nextTick(()=>{window.dispatchEvent(new Event("resize"))})},loadSavedDensity:()=>{try{const saved=localStorage.getItem("gallery_density");saved&&["compact","normal","comfortable"].includes(saved)&&(currentDensity.value=saved)}catch{}}}}const getSortOptions=()=>{const{$t}=useTexts();return[{value:"newest",label:$t("explore.sort.newest"),icon:"fas fa-clock"},{value:"oldest",label:$t("explore.sort.oldest"),icon:"fas fa-history"},{value:"size",label:$t("explore.sort.size"),icon:"fas fa-sort-amount-down"},{value:"name",label:$t("explore.sort.name"),icon:"fas fa-sort-alpha-down"}]},SORT_OPTIONS=getSortOptions(),getDensityOptions=()=>{const{$t}=useTexts();return[{value:"compact",label:$t("explore.density.compact"),icon:"fas fa-compress"},{value:"normal",label:$t("explore.density.normal"),icon:"fas fa-arrows-alt"},{value:"comfortable",label:$t("explore.density.comfortable"),icon:"fas fa-expand"}]},DENSITY_OPTIONS=getDensityOptions(),_hoisted_1={class:"gallery-page text-sm"},_hoisted_2={class:"gallery-container w-full pb-4"},_hoisted_3={class:"mb-3 px-4 py-2 text-center text-sm",style:{background:"rgba(var(--color-background-900-rgb), 0.5)","backdrop-filter":"blur(20px)",border:"1px solid rgba(var(--color-brand-500-rgb), 0.1)","border-radius":"var(--radius-sm)",color:"var(--color-content-muted)","box-shadow":"0 2px 8px var(--color-overlay-light)"}},_hoisted_4={class:"share-select-tip-container"},_hoisted_5={class:"share-select-tip"},_sfc_main=defineComponent({name:"ExplorePage",__name:"index",setup(__props){const{$t}=useTexts(),toast=useToast(),route=useRoute(),layoutStore=useLayoutStore(),isLeftLayout=computed(()=>layoutStore.isLeftLayout),showFilter=ref(!1),images=ref([]),searchKeyword=ref(""),searchMode=ref("vector"),isVectorSearchMode=ref(!1),lastVectorSearchQuery=ref(""),{currentDensity,changeDensity,loadSavedDensity}=useDisplayDensity("compact"),filters=reactive({page:1,size:DEFAULT_PAGE_SIZE,sort:"newest",dominant_color:""}),{showDetailModal,showFilePreview,selectedImage,previewImageUrl,previewImageName,currentPreviewIndex,closeFilePreview,handlePrevImage,handleNextImage,viewImageDetails,viewImage}=useGalleryPreview(images),{selectMode,shareButton,isAllImagesSelected,showShareDialog,handleSelectModeChange,setShareButtonRef,isFileSelected,handleFileSelect,toggleSelectAllImages,invertImageSelection,handleShareCreated,attachEscListener,detachEscListener}=useGallerySelection(images),{currentPage,hasMore,hasReachedLimit,isLoading,isLoadingMore,loadImages,withPageLoading}=useGalleryList({images,filters,searchKeyword,isVectorSearchMode,pageSize:DEFAULT_PAGE_SIZE,maxImages:MAX_GALLERY_ITEMS}),{getFilterCount,quickSort,applyFilter,resetFilter}=useGalleryFilters({filters,loadFiles:loadImages,defaultPageSize:DEFAULT_PAGE_SIZE,searchKeyword}),{handleAdvancedSearch}=useGallerySearch({images,currentPage,hasMore,hasReachedLimit,withPageLoading,loadImages,searchKeyword,searchMode,isVectorSearchMode,lastVectorSearchQuery,toast}),onFilter=newFilters=>{applyFilter(newFilters),showFilter.value=!1},downloadFile=async file=>{await downloadFileQuick(file.id,file.display_name||file.original_name||"file")},handleShowDetailModalChange=value=>{showDetailModal.value=value},handleShowFilePreviewChange=value=>{showFilePreview.value=value};return onMounted(()=>{loadSavedDensity();const urlTags=route.query.tags,fromShare=route.query.from==="share";urlTags&&typeof urlTags=="string"&&(filters.tags=urlTags,searchKeyword.value="",fromShare&&toast.info($t("explore.toast.showingTagResults",{tags:urlTags}))),loadImages(!1),attachEscListener()}),onUnmounted(()=>{detachEscListener()}),(_ctx,_cache)=>{const _component_CyberLoading=resolveComponent("CyberLoading");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberLoading,{visible:unref(isLoading),"full-screen":!0,text:unref($t)("explore.loadingText")},null,8,["visible","text"]),createBaseVNode("div",_hoisted_2,[createVNode(_sfc_main$2,{images:images.value,"has-content":images.value.length>0,"set-share-button-ref":unref(setShareButtonRef),"filters-sort":filters.sort,"sort-options":unref(SORT_OPTIONS),"current-density":unref(currentDensity),"density-options":unref(DENSITY_OPTIONS),"search-keyword":searchKeyword.value,"search-mode":searchMode.value,"show-filter":showFilter.value,"filter-count":unref(getFilterCount)(),"is-searching":!1,"is-left-layout":isLeftLayout.value,"onUpdate:selectMode":unref(handleSelectModeChange),"onUpdate:shareDialogVisible":_cache[0]||(_cache[0]=$event=>showShareDialog.value=$event),onSort:unref(quickSort),onChangeDensity:unref(changeDensity),"onUpdate:searchKeyword":_cache[1]||(_cache[1]=$event=>searchKeyword.value=$event),"onUpdate:searchMode":_cache[2]||(_cache[2]=$event=>searchMode.value=$event),"onUpdate:showFilter":_cache[3]||(_cache[3]=$event=>showFilter.value=$event),onSearch:unref(handleAdvancedSearch)},null,8,["images","has-content","set-share-button-ref","filters-sort","sort-options","current-density","density-options","search-keyword","search-mode","show-filter","filter-count","is-left-layout","onUpdate:selectMode","onSort","onChangeDensity","onSearch"]),createVNode(_sfc_main$7,{show:showFilter.value,"initial-filters":filters,onFilter},null,8,["show","initial-filters"]),unref(hasReachedLimit)?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass({"px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16":!isLeftLayout.value,"px-0":isLeftLayout.value})},[createBaseVNode("div",_hoisted_3,[_cache[5]||(_cache[5]=createBaseVNode("i",{class:"fas fa-info-circle mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("explore.footer.narrowSearch")),1)])],2)):createCommentVNode("",!0),unref(selectMode)?(openBlock(),createElementBlock("div",{key:1,class:normalizeClass({"px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16":!isLeftLayout.value,"px-0":isLeftLayout.value})},[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[_cache[6]||(_cache[6]=createBaseVNode("i",{class:"fas fa-hand-pointer mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("explore.selection.shareHint")),1)]),createVNode(SelectionToolbar,{"is-all-selected":unref(isAllImagesSelected),"selected-count":unref(shareButton)?.selectedFiles?.length||0,onToggleAll:unref(toggleSelectAllImages),onInvert:unref(invertImageSelection)},null,8,["is-all-selected","selected-count","onToggleAll","onInvert"])])],2)):createCommentVNode("",!0),images.value.length>0?(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(["gallery-images-fullscreen",[`density-${unref(currentDensity)}`,{"px-4 sm:px-6 lg:px-8 xl:px-12 2xl:px-16":!isLeftLayout.value,"px-0":isLeftLayout.value}]])},[createVNode(GalleryMasonry,{files:images.value,"select-mode":unref(selectMode),"is-file-selected":unref(isFileSelected),"is-vector-search":isVectorSearchMode.value,"show-tags":!0,onView:unref(viewImage),onDownload:downloadFile,onDetails:unref(viewImageDetails),onSelect:unref(handleFileSelect)},null,8,["files","select-mode","is-file-selected","is-vector-search","onView","onDetails","onSelect"]),createVNode(_sfc_main$1,{"files-length":images.value.length,"is-loading-more":unref(isLoadingMore),"has-reached-limit":unref(hasReachedLimit),"has-more":unref(hasMore)},null,8,["files-length","is-loading-more","has-reached-limit","has-more"])],2)):createCommentVNode("",!0),!unref(isLoading)&&images.value.length===0?(openBlock(),createElementBlock("div",{key:3,class:normalizeClass(["empty-state-fullscreen",{"left-layout":isLeftLayout.value}])},[createVNode(EmptyState,{onReset:unref(resetFilter)},null,8,["onReset"])],2)):createCommentVNode("",!0),createVNode(_sfc_main$5,{"show-detail-modal":unref(showDetailModal),"show-file-preview":unref(showFilePreview),"selected-file":unref(selectedImage),"preview-file-url":unref(previewImageUrl),"preview-file-name":unref(previewImageName),files:images.value,"current-preview-index":unref(currentPreviewIndex),"onUpdate:showDetailModal":handleShowDetailModalChange,"onUpdate:showFilePreview":handleShowFilePreviewChange,onDownload:downloadFile,onPreviewClose:unref(closeFilePreview),onPrev:unref(handlePrevImage),onNext:unref(handleNextImage)},null,8,["show-detail-modal","show-file-preview","selected-file","preview-file-url","preview-file-name","files","current-preview-index","onPreviewClose","onPrev","onNext"]),createVNode(CreateShareDialog,{modelValue:unref(showShareDialog),"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>isRef(showShareDialog)?showShareDialog.value=$event:null),"selected-folders":unref(shareButton)?.selectedFolders||[],"selected-images":unref(shareButton)?.selectedFiles||[],onCreated:unref(handleShareCreated)},null,8,["modelValue","selected-folders","selected-images","onCreated"])])])}}});export{_sfc_main as default};
