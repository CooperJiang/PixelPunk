import{j as useTexts,q as useToast,_ as _export_sfc,n as useAuthStore,a0 as StorageUtil,h as getLegalDocuments,aJ as sendRegistrationCode,m as useSettingsStore,i as useLayoutStore,aK as _imports_0,aL as __unplugin_components_1,l as __unplugin_components_0}from"./index-ae9c3219.js";import{d as defineComponent,r as ref,E as resolveComponent,z as openBlock,A as createBlock,L as withCtx,I as createElementBlock,a0 as createBaseVNode,a1 as toDisplayString,u as unref,ab as createTextVNode,f as createVNode,aa as withKeys,K as createCommentVNode,c as computed,a5 as withModifiers,a6 as Transition,T as Teleport,a3 as useRouter,a4 as useRoute,a as reactive,b as onMounted,H as withDirectives,a9 as vModelText,j as onBeforeUnmount,w as watch,ac as createStaticVNode,R as normalizeClass,Q as normalizeStyle,F as Fragment,M as renderList}from"./vue-vendor-31320f47.js";import{a as useLoading,u as useMultipleLoading}from"./useLoading-8da70177.js";import{u as useAuthApi}from"./auth-eda49e32.js";import{d}from"./marked-e9418aa8.js";import{p as purify}from"./dompurify-76a35038.js";import{g as getOAuthConfig,a as githubOAuthLogin,b as googleOAuthLogin,l as linuxdoOAuthLogin}from"./oauth-e58d389a.js";import"./editor-markdown-0b2e1ce5.js";import"./axios-c2a59b9f.js";import"./spark-md5-d0a97131.js";import"./highlight-common-d6c232ae.js";import"./comlink-c7be92b7.js";/* empty css                 */import"./vueuse-2480d07f.js";import"./vue-table-79795ca5.js";const EMAIL_REGEX=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,REMEMBERED_LOGIN_KEY="rememberedLogin",VERIFY_CODE_COUNTDOWN_KEY="verifyCodeCountdown",REMEMBER_PASSWORD_HOURS=24*7,VERIFY_CODE_COUNTDOWN_SECONDS=60,_hoisted_1$5={key:0,class:"forgot-password-form"},_hoisted_2$5={class:"description"},_hoisted_3$4={class:"form-group"},_hoisted_4$4={class:"form-label"},_hoisted_5$4={key:0,class:"fas fa-paper-plane mr-2"},_hoisted_6$3={key:1,class:"success-message"},_hoisted_7$3={class:"success-title"},_hoisted_8$3={class:"success-text"},_hoisted_9$3={class:"success-hint"},_hoisted_10$3={class:"success-note"},_sfc_main$5=defineComponent({name:"ForgotPasswordModal",__name:"index",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(__props,{emit:__emit}){const{$t}=useTexts(),emit=__emit,toast=useToast(),authApi=useAuthApi(),email=ref(""),loading=ref(!1),sent=ref(!1),closeModal=()=>{emit("update:visible",!1),setTimeout(()=>{email.value="",sent.value=!1},300)},handleSubmit=async()=>{if(!email.value){toast.warning($t("auth.forgotPassword.errors.enterEmail"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)){toast.warning($t("auth.forgotPassword.errors.invalidEmail"));return}loading.value=!0;try{await authApi.forgotPassword(email.value),sent.value=!0}catch{}finally{loading.value=!1}};return(_ctx,_cache)=>{const _component_CyberInput=resolveComponent("CyberInput"),_component_CyberButton=resolveComponent("CyberButton"),_component_CyberDialog=resolveComponent("CyberDialog");return openBlock(),createBlock(_component_CyberDialog,{"model-value":__props.visible,title:unref($t)("auth.forgotPassword.title"),width:"400px","show-footer":!1,"onUpdate:modelValue":_cache[1]||(_cache[1]=val=>emit("update:visible",val)),onClose:closeModal},{default:withCtx(()=>[sent.value?(openBlock(),createElementBlock("div",_hoisted_6$3,[_cache[4]||(_cache[4]=createBaseVNode("div",{class:"success-icon"},[createBaseVNode("i",{class:"fas fa-check-circle"})],-1)),createBaseVNode("h3",_hoisted_7$3,toDisplayString(unref($t)("auth.forgotPassword.success.title")),1),createBaseVNode("p",_hoisted_8$3,toDisplayString(unref($t)("auth.forgotPassword.success.message",{email:email.value})),1),createBaseVNode("p",_hoisted_9$3,toDisplayString(unref($t)("auth.forgotPassword.success.hint")),1),createBaseVNode("p",_hoisted_10$3,toDisplayString(unref($t)("auth.forgotPassword.success.note")),1),createVNode(_component_CyberButton,{type:"primary",block:"",onClick:closeModal},{default:withCtx(()=>[_cache[3]||(_cache[3]=createBaseVNode("i",{class:"fas fa-check mr-2"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.forgotPassword.success.button")),1)]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_1$5,[createBaseVNode("p",_hoisted_2$5,toDisplayString(unref($t)("auth.forgotPassword.description")),1),createBaseVNode("div",_hoisted_3$4,[createBaseVNode("label",_hoisted_4$4,[_cache[2]||(_cache[2]=createBaseVNode("i",{class:"fas fa-envelope"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.forgotPassword.emailLabel")),1)]),createVNode(_component_CyberInput,{modelValue:email.value,"onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>email.value=$event),type:"email",placeholder:unref($t)("auth.forgotPassword.emailPlaceholder"),disabled:loading.value,onKeyup:withKeys(handleSubmit,["enter"])},null,8,["modelValue","placeholder","disabled"])]),createVNode(_component_CyberButton,{type:"primary",block:"",loading:loading.value,onClick:handleSubmit},{default:withCtx(()=>[loading.value?createCommentVNode("",!0):(openBlock(),createElementBlock("i",_hoisted_5$4)),createTextVNode(" "+toDisplayString(loading.value?unref($t)("auth.forgotPassword.sending"):unref($t)("auth.forgotPassword.sendButton")),1)]),_:1},8,["loading"])]))]),_:1},8,["model-value","title"])}}});const ForgotPasswordModal=_export_sfc(_sfc_main$5,[["__scopeId","data-v-512af1b7"]]),_hoisted_1$4={class:"modal-body"},_hoisted_2$4=["innerHTML"],_sfc_main$4=defineComponent({name:"LegalDocumentModal",__name:"index",props:{modelValue:{type:Boolean,default:!1},type:{},content:{default:""}},emits:["update:modelValue"],setup(__props,{emit:__emit}){d.setOptions({gfm:!0,breaks:!0});const{$t}=useTexts(),props=__props,emit=__emit,renderedContent=computed(()=>{if(!props.content)return`<p class="empty-notice">${$t("components.legalDocumentModal.noContent")}</p>`;try{const html=d.parse(props.content);return purify.sanitize(html,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","strong","em","u","s","a","ul","ol","li","blockquote","code","pre","img","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","src","alt","title","class"]})}catch(error){return console.error("Markdown render failed:",error),props.content}}),close=()=>{emit("update:modelValue",!1)},handleBackdropClick=event=>{event.target===event.currentTarget&&close()};return(_ctx,_cache)=>(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(Transition,{name:"modal-fade"},{default:withCtx(()=>[__props.modelValue?(openBlock(),createElementBlock("div",{key:0,class:"legal-document-modal-backdrop",onClick:handleBackdropClick},[createBaseVNode("div",{class:"legal-document-modal",onClick:_cache[0]||(_cache[0]=withModifiers(()=>{},["stop"]))},[createBaseVNode("button",{type:"button",class:"close-button",onClick:close},[..._cache[1]||(_cache[1]=[createBaseVNode("i",{class:"fas fa-times"},null,-1)])]),createBaseVNode("div",_hoisted_1$4,[createBaseVNode("div",{class:"document-content",innerHTML:renderedContent.value},null,8,_hoisted_2$4)])])])):createCommentVNode("",!0)]),_:1})]))}});const LegalDocumentModal=_export_sfc(_sfc_main$4,[["__scopeId","data-v-0bd48af8"]]),_hoisted_1$3={class:"relative"},_hoisted_2$3={key:0,class:"oauth-loading-overlay"},_hoisted_3$3={class:"loading-spinner"},_hoisted_4$3={class:"loading-text"},_hoisted_5$3={class:"input-container mb-2"},_hoisted_6$2={class:"cyber-label mb-1 block text-sm text-content",for:"login-account"},_hoisted_7$2={class:"cyber-input-wrapper"},_hoisted_8$2=["placeholder","disabled"],_hoisted_9$2={class:"input-container mb-3"},_hoisted_10$2={class:"cyber-label mb-1 block text-sm text-content",for:"login-password"},_hoisted_11$2={class:"cyber-input-wrapper"},_hoisted_12$2=["placeholder","disabled"],_hoisted_13$2={class:"mt-3 flex justify-between"},_hoisted_14$2={class:"hint-text-area mb-3 mt-5 text-center text-xs"},_hoisted_15$2={class:"mb-2"},_hoisted_16$2=["disabled"],_hoisted_17$1={key:0,class:"oauth-section"},_hoisted_18$1={class:"oauth-divider"},_hoisted_19$1={key:0,class:"oauth-compact-layout"},_hoisted_20$1=["disabled"],_hoisted_21$1=["disabled"],_hoisted_22$1=["disabled"],_hoisted_23$1={key:1},_hoisted_24$1=["disabled"],_hoisted_25$1=["disabled"],_hoisted_26$1=["disabled"],_sfc_main$3=defineComponent({name:"AuthLoginForm",__name:"index",emits:["login-success","switch-to-register","password-focus"],setup(__props,{emit:__emit}){const emit=__emit,router=useRouter(),route=useRoute(),toast=useToast(),authStore=useAuthStore(),{$t}=useTexts(),{loading:isLoading,withLoading}=useLoading(),showForgotPasswordModal=ref(!1),showLegalModal=ref(!1),legalModalType=ref("privacy"),privacyContent=ref(""),termsContent=ref(""),oauthConfig=ref(null),isOAuthLoading=ref(!1),generateOAuthState=provider=>{const random=crypto.randomUUID(),stateData={provider,random,timestamp:Date.now()};return sessionStorage.setItem("oauth_state",JSON.stringify(stateData)),btoa(JSON.stringify({provider,random}))},validateOAuthState=stateParam=>{try{const savedStateStr=sessionStorage.getItem("oauth_state");if(!savedStateStr)return{valid:!1};const savedState=JSON.parse(savedStateStr),receivedState=JSON.parse(atob(stateParam));if(savedState.provider!==receivedState.provider||savedState.random!==receivedState.random)return{valid:!1};const tenMinutes=10*60*1e3;return Date.now()-savedState.timestamp>tenMinutes?(sessionStorage.removeItem("oauth_state"),{valid:!1}):(sessionStorage.removeItem("oauth_state"),{valid:!0,provider:savedState.provider})}catch{return{valid:!1}}},form=reactive({account:"",password:"",remember:!1}),isGithubEnabled=computed(()=>oauthConfig.value?.github?.enabled??!1),isGoogleEnabled=computed(()=>oauthConfig.value?.google?.enabled??!1),isLinuxdoEnabled=computed(()=>oauthConfig.value?.linuxdo?.enabled??!1),enabledProvidersCount=computed(()=>{let count=0;return isGithubEnabled.value&&count++,isGoogleEnabled.value&&count++,isLinuxdoEnabled.value&&count++,count}),hasMultipleProviders=computed(()=>enabledProvidersCount.value>1),rememberedLogin=StorageUtil.get(REMEMBERED_LOGIN_KEY);rememberedLogin&&(form.account=rememberedLogin.account,form.password=rememberedLogin.password,form.remember=!0);const handleLogin=async()=>{isLoading.value||await withLoading(async()=>{await authStore.login({account:form.account,password:form.password}),form.remember?StorageUtil.set(REMEMBERED_LOGIN_KEY,{account:form.account,password:form.password},REMEMBER_PASSWORD_HOURS):StorageUtil.remove(REMEMBERED_LOGIN_KEY);const fallbackName=$t("auth.login.successFallbackName"),username=authStore.userInfo?.username||fallbackName;toast.success($t("auth.login.success").replace("{username}",username)),form.remember||(form.account="",form.password="",form.remember=!1),emit("login-success"),router.push("/")},{onError:caughtError=>{const message=getErrorMessage(caughtError,$t("auth.login.failure"));toast.error(message)}})},forgotPassword=()=>{showForgotPasswordModal.value=!0},switchToRegister=()=>{emit("switch-to-register")},openPrivacyPolicy=e=>{e.preventDefault(),legalModalType.value="privacy",showLegalModal.value=!0},openTermsOfService=e=>{e.preventDefault(),legalModalType.value="terms",showLegalModal.value=!0},loadLegalDocuments=async()=>{try{const result=await getLegalDocuments();result.success&&result.data&&(privacyContent.value=result.data.privacy_policy||"",termsContent.value=result.data.terms_of_service||"")}catch{}},loadOAuthConfig=async()=>{try{const result=await getOAuthConfig();result.success&&result.data&&(oauthConfig.value=result.data)}catch{}},oauthApiMap={github:githubOAuthLogin,google:googleOAuthLogin,linuxdo:linuxdoOAuthLogin},handleOAuthCallback=async(provider,code)=>{try{isOAuthLoading.value=!0;const result=await oauthApiMap[provider](code);result.success&&result.data&&(authStore.setToken(result.data.token),authStore.setUserInfo(result.data.userInfo),toast.success($t("auth.login.oauth.successWelcome").replace("{username}",result.data.userInfo.username)),emit("login-success"),router.replace("/"))}catch(error){const message=getErrorMessage(error,$t("auth.login.oauth.failure"));toast.error(message),router.replace("/auth")}finally{isOAuthLoading.value=!1}},loginWithGithub=()=>{if(!oauthConfig.value?.github)return;const{client_id,redirect_uri,scope}=oauthConfig.value.github,state=generateOAuthState("github"),githubAuthUrl=`https://github.com/login/oauth/authorize?client_id=${client_id}&redirect_uri=${encodeURIComponent(redirect_uri)}&scope=${scope}&state=${state}`;window.location.href=githubAuthUrl},loginWithGoogle=()=>{if(!oauthConfig.value?.google)return;const{client_id,redirect_uri,scope}=oauthConfig.value.google,state=generateOAuthState("google"),googleAuthUrl=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${client_id}&redirect_uri=${encodeURIComponent(redirect_uri)}&response_type=code&scope=${encodeURIComponent(scope)}&access_type=offline&prompt=consent&state=${state}`;window.location.href=googleAuthUrl},loginWithLinuxdo=()=>{if(!oauthConfig.value?.linuxdo)return;const{client_id,redirect_uri,scope}=oauthConfig.value.linuxdo,state=generateOAuthState("linuxdo"),linuxdoAuthUrl=`https://connect.linux.do/oauth2/authorize?client_id=${client_id}&redirect_uri=${encodeURIComponent(redirect_uri)}&response_type=code&scope=${scope}&state=${state}`;window.location.href=linuxdoAuthUrl};onMounted(async()=>{loadLegalDocuments(),loadOAuthConfig();const code=route.query.code,state=route.query.state;if(code&&state){const validation=validateOAuthState(state);validation.valid&&validation.provider?await handleOAuthCallback(validation.provider,code):(toast.error($t("auth.login.oauth.stateValidationFailed")),router.replace("/auth"))}});function getErrorMessage(error,fallback){if(typeof error=="string")return error;if(error instanceof Error){const axiosError=error;return axiosError.response?.data?.message||axiosError.message||fallback}if(error&&typeof error=="object"&&"message"in error){const message=error.message;if(message)return message}return fallback}return(_ctx,_cache)=>{const _component_CyberCheckbox=resolveComponent("CyberCheckbox"),_component_CyberTooltip=resolveComponent("CyberTooltip");return openBlock(),createElementBlock("div",_hoisted_1$3,[isOAuthLoading.value?(openBlock(),createElementBlock("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[_cache[7]||(_cache[7]=createBaseVNode("div",{class:"spinner-ring"},null,-1)),createBaseVNode("p",_hoisted_4$3,toDisplayString(unref($t)("auth.login.oauth.loading")),1)])])):createCommentVNode("",!0),createBaseVNode("form",{class:"flex flex-col",onSubmit:withModifiers(handleLogin,["prevent"])},[createBaseVNode("div",_hoisted_5$3,[createBaseVNode("label",_hoisted_6$2,[_cache[8]||(_cache[8]=createBaseVNode("span",{class:"cyber-icon"},"⌘",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.login.accountLabel")),1)]),createBaseVNode("div",_hoisted_7$2,[withDirectives(createBaseVNode("input",{id:"login-account","onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>form.account=$event),type:"text",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.login.accountPlaceholder"),required:"",disabled:unref(isLoading)},null,8,_hoisted_8$2),[[vModelText,form.account]]),_cache[9]||(_cache[9]=createBaseVNode("span",{class:"input-highlight"},null,-1))])]),createBaseVNode("div",_hoisted_9$2,[createBaseVNode("label",_hoisted_10$2,[_cache[10]||(_cache[10]=createBaseVNode("span",{class:"cyber-icon"},"⌥",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.login.passwordLabel")),1)]),createBaseVNode("div",_hoisted_11$2,[withDirectives(createBaseVNode("input",{id:"login-password","onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>form.password=$event),type:"password",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.login.passwordPlaceholder"),required:"",disabled:unref(isLoading),onFocus:_cache[2]||(_cache[2]=$event=>emit("password-focus",!0)),onBlur:_cache[3]||(_cache[3]=$event=>emit("password-focus",!1))},null,40,_hoisted_12$2),[[vModelText,form.password]]),_cache[11]||(_cache[11]=createBaseVNode("span",{class:"input-highlight"},null,-1))]),createBaseVNode("div",_hoisted_13$2,[createVNode(_component_CyberCheckbox,{modelValue:form.remember,"onUpdate:modelValue":_cache[4]||(_cache[4]=$event=>form.remember=$event),size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref($t)("auth.login.rememberMe")),1)]),_:1},8,["modelValue"]),createBaseVNode("button",{type:"button",class:"cyber-link text-xs text-content hover:text-brand-400",onClick:forgotPassword},toDisplayString(unref($t)("auth.login.forgotPassword")),1)])]),createBaseVNode("div",_hoisted_14$2,[createBaseVNode("p",_hoisted_15$2,[createTextVNode(toDisplayString(unref($t)("auth.login.registerHint.prefix"))+" ",1),createBaseVNode("button",{type:"button",class:"register-link text-content",onClick:switchToRegister},toDisplayString(unref($t)("auth.login.registerHint.highlight")),1),createTextVNode(" "+toDisplayString(unref($t)("auth.login.registerHint.suffix")),1)]),createBaseVNode("p",null,[createTextVNode(toDisplayString(unref($t)("auth.login.agreementPrefix"))+" ",1),createBaseVNode("a",{href:"#",onClick:openTermsOfService},toDisplayString(unref($t)("auth.login.termsOfService")),1),createTextVNode(" "+toDisplayString(unref($t)("auth.login.agreementAnd"))+" ",1),createBaseVNode("a",{href:"#",onClick:openPrivacyPolicy},toDisplayString(unref($t)("auth.login.privacyPolicy")),1)])]),createBaseVNode("button",{type:"submit",class:"cyber-btn w-full rounded bg-brand-500 py-2 text-sm font-semibold transition-colors hover:bg-brand-400",disabled:unref(isLoading)},[_cache[12]||(_cache[12]=createBaseVNode("span",{class:"btn-glitch-effect"},null,-1)),createTextVNode(" "+toDisplayString(unref(isLoading)?unref($t)("auth.login.submitting"):unref($t)("auth.login.submit")),1)],8,_hoisted_16$2),isGithubEnabled.value||isGoogleEnabled.value||isLinuxdoEnabled.value?(openBlock(),createElementBlock("div",_hoisted_17$1,[createBaseVNode("div",_hoisted_18$1,[createBaseVNode("span",null,toDisplayString(unref($t)("auth.login.oauth.divider")),1)]),hasMultipleProviders.value?(openBlock(),createElementBlock("div",_hoisted_19$1,[isGithubEnabled.value?(openBlock(),createBlock(_component_CyberTooltip,{key:0,content:unref($t)("auth.login.oauth.githubTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{type:"button",class:"oauth-icon-btn github",disabled:unref(isLoading),onClick:loginWithGithub},[..._cache[13]||(_cache[13]=[createBaseVNode("i",{class:"fab fa-github"},null,-1)])],8,_hoisted_20$1)]),_:1},8,["content"])):createCommentVNode("",!0),isGoogleEnabled.value?(openBlock(),createBlock(_component_CyberTooltip,{key:1,content:unref($t)("auth.login.oauth.googleTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{type:"button",class:"oauth-icon-btn google",disabled:unref(isLoading),onClick:loginWithGoogle},[..._cache[14]||(_cache[14]=[createBaseVNode("i",{class:"fab fa-google"},null,-1)])],8,_hoisted_21$1)]),_:1},8,["content"])):createCommentVNode("",!0),isLinuxdoEnabled.value?(openBlock(),createBlock(_component_CyberTooltip,{key:2,content:unref($t)("auth.login.oauth.linuxdoTooltip"),placement:"top"},{default:withCtx(()=>[createBaseVNode("button",{type:"button",class:"oauth-icon-btn linuxdo",disabled:unref(isLoading),onClick:loginWithLinuxdo},[..._cache[15]||(_cache[15]=[createBaseVNode("i",{class:"fab fa-linux"},null,-1)])],8,_hoisted_22$1)]),_:1},8,["content"])):createCommentVNode("",!0)])):(openBlock(),createElementBlock("div",_hoisted_23$1,[isGithubEnabled.value?(openBlock(),createElementBlock("button",{key:0,type:"button",class:"github-login-btn",disabled:unref(isLoading),onClick:loginWithGithub},[_cache[16]||(_cache[16]=createBaseVNode("i",{class:"fab fa-github"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("auth.login.oauth.githubButton")),1)],8,_hoisted_24$1)):createCommentVNode("",!0),isGoogleEnabled.value?(openBlock(),createElementBlock("button",{key:1,type:"button",class:"google-login-btn",disabled:unref(isLoading),onClick:loginWithGoogle},[_cache[17]||(_cache[17]=createBaseVNode("i",{class:"fab fa-google"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("auth.login.oauth.googleButton")),1)],8,_hoisted_25$1)):createCommentVNode("",!0),isLinuxdoEnabled.value?(openBlock(),createElementBlock("button",{key:2,type:"button",class:"linuxdo-login-btn",disabled:unref(isLoading),onClick:loginWithLinuxdo},[_cache[18]||(_cache[18]=createBaseVNode("i",{class:"fab fa-linux"},null,-1)),createBaseVNode("span",null,toDisplayString(unref($t)("auth.login.oauth.linuxdoButton")),1)],8,_hoisted_26$1)):createCommentVNode("",!0)]))])):createCommentVNode("",!0),createVNode(ForgotPasswordModal,{visible:showForgotPasswordModal.value,"onUpdate:visible":_cache[5]||(_cache[5]=$event=>showForgotPasswordModal.value=$event)},null,8,["visible"]),createVNode(LegalDocumentModal,{modelValue:showLegalModal.value,"onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>showLegalModal.value=$event),type:legalModalType.value,content:legalModalType.value==="privacy"?privacyContent.value:termsContent.value},null,8,["modelValue","type","content"])],32)])}}});const LoginForm=_export_sfc(_sfc_main$3,[["__scopeId","data-v-6da6e01e"]]),_hoisted_1$2={class:"input-container mb-2"},_hoisted_2$2={class:"cyber-label mb-1 block text-sm text-content",for:"register-username"},_hoisted_3$2={class:"cyber-input-wrapper"},_hoisted_4$2=["placeholder","disabled"],_hoisted_5$2={class:"mb-2"},_hoisted_6$1={class:"input-container mb-2"},_hoisted_7$1={class:"cyber-label mb-1 block text-sm text-content",for:"register-email"},_hoisted_8$1={class:"flex items-stretch"},_hoisted_9$1={class:"cyber-input-wrapper flex-1"},_hoisted_10$1=["placeholder","disabled"],_hoisted_11$1=["disabled"],_hoisted_12$1={key:0},_hoisted_13$1={key:1},_hoisted_14$1={key:2},_hoisted_15$1={key:1,class:"verify-code-btn disabled-verification-notice min-w-16 flex-shrink-0 whitespace-nowrap px-1 text-xs"},_hoisted_16$1={class:"input-container"},_hoisted_17={class:"cyber-label mb-1 block text-sm text-content",for:"register-code"},_hoisted_18={class:"cyber-input-wrapper"},_hoisted_19=["placeholder","disabled"],_hoisted_20={key:0,class:"verification-notice mt-1"},_hoisted_21={class:"text-accent text-xs"},_hoisted_22={class:"mb-3 grid grid-cols-2 gap-2"},_hoisted_23={class:"input-container"},_hoisted_24={class:"cyber-label mb-1 block text-sm text-content",for:"register-password"},_hoisted_25={class:"cyber-input-wrapper"},_hoisted_26=["placeholder","disabled"],_hoisted_27={class:"input-container"},_hoisted_28={class:"cyber-label mb-1 block text-sm text-content",for:"register-confirm-password"},_hoisted_29={class:"cyber-input-wrapper"},_hoisted_30=["placeholder","disabled"],_hoisted_31=["disabled"],_sfc_main$2=defineComponent({name:"AuthRegisterForm",__name:"index",props:{emailVerificationEnabled:{type:Boolean}},emits:["register-success","password-focus"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,authStore=useAuthStore(),toast=useToast(),{$t}=useTexts(),{loading:loadingStates,withLoading}=useMultipleLoading({isLoading:!1,isSendingCode:!1}),isLoading=computed(()=>loadingStates.value.isLoading),isSendingCode=computed(()=>loadingStates.value.isSendingCode),registerForm=reactive({username:"",email:"",password:"",confirmPassword:"",code:""}),verifyCodeSent=ref(!1),countdown=ref(0);let countdownTimer=null;onMounted(()=>{const storedCountdownTime=StorageUtil.get(VERIFY_CODE_COUNTDOWN_KEY);if(!storedCountdownTime)return;const now=Date.now(),remainingTime=Math.max(0,Math.floor((storedCountdownTime-now)/1e3));remainingTime>0?(countdown.value=remainingTime,startCountdown()):StorageUtil.remove(VERIFY_CODE_COUNTDOWN_KEY)}),onBeforeUnmount(()=>{countdownTimer&&clearInterval(countdownTimer)});const startCountdown=()=>{countdownTimer&&clearInterval(countdownTimer),countdownTimer=setInterval(()=>{countdown.value-=1,countdown.value<=0&&(countdownTimer&&(clearInterval(countdownTimer),countdownTimer=null),StorageUtil.remove(VERIFY_CODE_COUNTDOWN_KEY),countdown.value=0)},1e3)},sendVerifyCode=async()=>{if(!(!props.emailVerificationEnabled||countdown.value>0)){if(!EMAIL_REGEX.test(registerForm.email)){toast.error($t("auth.register.toastInvalidEmail"));return}await withLoading("isSendingCode",async()=>{const result=await sendRegistrationCode({email:registerForm.email});if(!result.success)throw new Error(result.message||$t("auth.register.toastSendCodeFailed"));toast.success($t("auth.register.toastCodeSent")),verifyCodeSent.value=!0,countdown.value=VERIFY_CODE_COUNTDOWN_SECONDS;const expiryTime=Date.now()+countdown.value*1e3;StorageUtil.set(VERIFY_CODE_COUNTDOWN_KEY,expiryTime,1),startCountdown()},{onError:error=>{const message=error.message||$t("auth.register.toastSendCodeFailed");toast.error(message,3e4)}})}},handleRegister=async()=>{if(!isLoading.value){if(registerForm.password!==registerForm.confirmPassword){toast.error($t("auth.register.toastPasswordMismatch"));return}if(!registerForm.code){toast.error(props.emailVerificationEnabled?$t("auth.register.toastCodeRequired"):$t("auth.register.toastDefaultCodeRequired"));return}if(!props.emailVerificationEnabled&&registerForm.code!=="999999"){toast.error($t("auth.register.toastDefaultCodeInvalid"));return}await withLoading("isLoading",async()=>{await authStore.register({username:registerForm.username,email:registerForm.email,password:registerForm.password,code:registerForm.code});try{await authStore.login({account:registerForm.username,password:registerForm.password}),toast.success($t("auth.register.toastSuccessAutoLogin")),window.location.href="/";return}catch{toast.success($t("auth.register.toastSuccessFallback")),emit("register-success",registerForm.username),registerForm.username="",registerForm.email="",registerForm.password="",registerForm.confirmPassword="",registerForm.code="",verifyCodeSent.value=!1,countdown.value=0,countdownTimer&&(clearInterval(countdownTimer),countdownTimer=null),StorageUtil.remove(VERIFY_CODE_COUNTDOWN_KEY)}},{onError:error=>{const message=error.message||$t("auth.register.toastFailure");toast.error(message)}})}};return(_ctx,_cache)=>(openBlock(),createElementBlock("form",{class:"form-small",onSubmit:withModifiers(handleRegister,["prevent"])},[createBaseVNode("div",_hoisted_1$2,[createBaseVNode("label",_hoisted_2$2,[_cache[9]||(_cache[9]=createBaseVNode("span",{class:"cyber-icon"},"⌦",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.usernameLabel")),1)]),createBaseVNode("div",_hoisted_3$2,[withDirectives(createBaseVNode("input",{id:"register-username","onUpdate:modelValue":_cache[0]||(_cache[0]=$event=>registerForm.username=$event),type:"text",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.register.usernamePlaceholder"),required:"",disabled:isLoading.value},null,8,_hoisted_4$2),[[vModelText,registerForm.username]]),_cache[10]||(_cache[10]=createBaseVNode("span",{class:"input-highlight"},null,-1))])]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$1,[createBaseVNode("label",_hoisted_7$1,[_cache[11]||(_cache[11]=createBaseVNode("span",{class:"cyber-icon"},"✉",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.emailLabel")),1)]),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("div",_hoisted_9$1,[withDirectives(createBaseVNode("input",{id:"register-email","onUpdate:modelValue":_cache[1]||(_cache[1]=$event=>registerForm.email=$event),type:"email",class:"cyber-input w-full rounded-l border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.register.emailPlaceholder"),required:"",disabled:isLoading.value||verifyCodeSent.value},null,8,_hoisted_10$1),[[vModelText,registerForm.email]]),_cache[12]||(_cache[12]=createBaseVNode("span",{class:"input-highlight"},null,-1))]),props.emailVerificationEnabled?(openBlock(),createElementBlock("button",{key:0,type:"button",class:"verify-code-btn min-w-16 flex-shrink-0 whitespace-nowrap rounded-r px-1 text-xs",disabled:isSendingCode.value||countdown.value>0,onClick:sendVerifyCode},[countdown.value>0?(openBlock(),createElementBlock("span",_hoisted_12$1,toDisplayString(countdown.value)+toDisplayString(unref($t)("auth.register.countdownUnit")),1)):isSendingCode.value?(openBlock(),createElementBlock("span",_hoisted_13$1,toDisplayString(unref($t)("auth.register.sendingCode")),1)):(openBlock(),createElementBlock("span",_hoisted_14$1,toDisplayString(unref($t)("auth.register.sendCode")),1))],8,_hoisted_11$1)):(openBlock(),createElementBlock("div",_hoisted_15$1,toDisplayString(unref($t)("auth.register.verificationDisabled")),1))])]),createBaseVNode("div",_hoisted_16$1,[createBaseVNode("label",_hoisted_17,[_cache[13]||(_cache[13]=createBaseVNode("span",{class:"cyber-icon"},"#",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.codeLabel")),1)]),createBaseVNode("div",_hoisted_18,[withDirectives(createBaseVNode("input",{id:"register-code","onUpdate:modelValue":_cache[2]||(_cache[2]=$event=>registerForm.code=$event),type:"text",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:props.emailVerificationEnabled?unref($t)("auth.register.codePlaceholder"):unref($t)("auth.register.codePlaceholderDisabled"),required:"",disabled:isLoading.value},null,8,_hoisted_19),[[vModelText,registerForm.code]]),_cache[14]||(_cache[14]=createBaseVNode("span",{class:"input-highlight"},null,-1))]),props.emailVerificationEnabled?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_20,[createBaseVNode("span",_hoisted_21,[_cache[15]||(_cache[15]=createBaseVNode("i",{class:"fas fa-info-circle mr-1"},null,-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.verificationNotice")),1)])]))])]),createBaseVNode("div",_hoisted_22,[createBaseVNode("div",_hoisted_23,[createBaseVNode("label",_hoisted_24,[_cache[16]||(_cache[16]=createBaseVNode("span",{class:"cyber-icon"},"⌥",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.passwordLabel")),1)]),createBaseVNode("div",_hoisted_25,[withDirectives(createBaseVNode("input",{id:"register-password","onUpdate:modelValue":_cache[3]||(_cache[3]=$event=>registerForm.password=$event),type:"password",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.register.passwordPlaceholder"),required:"",disabled:isLoading.value,onFocus:_cache[4]||(_cache[4]=$event=>emit("password-focus",!0)),onBlur:_cache[5]||(_cache[5]=$event=>emit("password-focus",!1))},null,40,_hoisted_26),[[vModelText,registerForm.password]]),_cache[17]||(_cache[17]=createBaseVNode("span",{class:"input-highlight"},null,-1))])]),createBaseVNode("div",_hoisted_27,[createBaseVNode("label",_hoisted_28,[_cache[18]||(_cache[18]=createBaseVNode("span",{class:"cyber-icon"},"⍗",-1)),createTextVNode(" "+toDisplayString(unref($t)("auth.register.confirmPasswordLabel")),1)]),createBaseVNode("div",_hoisted_29,[withDirectives(createBaseVNode("input",{id:"register-confirm-password","onUpdate:modelValue":_cache[6]||(_cache[6]=$event=>registerForm.confirmPassword=$event),type:"password",class:"cyber-input w-full rounded border border-input-border bg-input-bg px-3 py-1.5 text-sm text-content outline-none focus:border-input-border-focus",placeholder:unref($t)("auth.register.confirmPasswordPlaceholder"),required:"",disabled:isLoading.value,onFocus:_cache[7]||(_cache[7]=$event=>emit("password-focus",!0)),onBlur:_cache[8]||(_cache[8]=$event=>emit("password-focus",!1))},null,40,_hoisted_30),[[vModelText,registerForm.confirmPassword]]),_cache[19]||(_cache[19]=createBaseVNode("span",{class:"input-highlight"},null,-1))])])]),createBaseVNode("button",{type:"submit",class:"cyber-btn w-full rounded bg-brand-500 py-2 text-sm text-background-900 hover:bg-error-500",disabled:isLoading.value},[_cache[20]||(_cache[20]=createBaseVNode("span",{class:"btn-glitch-effect"},null,-1)),createTextVNode(" "+toDisplayString(isLoading.value?unref($t)("auth.register.submitting"):unref($t)("auth.register.submit")),1)],8,_hoisted_31)],32))}});const RegisterForm=_export_sfc(_sfc_main$2,[["__scopeId","data-v-48fd5a7d"]]),_hoisted_1$1={class:"auth-panel cyber-panel"},_hoisted_2$1={class:"cyber-header"},_hoisted_3$1={class:"logo-wrapper mb-3"},_hoisted_4$1=["alt"],_hoisted_5$1={class:"cyber-text ml-2 text-xl font-bold text-content"},_hoisted_6={key:0,class:"registration-disabled-notice mb-4"},_hoisted_7={class:"cyber-text-glow mb-2 text-lg font-bold text-content"},_hoisted_8={class:"text-sm text-content"},_hoisted_9={key:1},_hoisted_10={class:"tabs-wrapper mb-4"},_hoisted_11={class:"tabs-container"},_hoisted_12={class:"forms-container"},_hoisted_13={key:0},_hoisted_14={key:1},_hoisted_15={key:0,class:"back-home-wrapper"},_hoisted_16={class:"button-text"},_sfc_main$1=defineComponent({name:"AuthPanel",__name:"index",emits:["password-focus"],setup(__props,{emit:__emit}){const emit=__emit,router=useRouter(),settingsStore=useSettingsStore(),layoutStore=useLayoutStore(),{$t}=useTexts(),activeTab=ref("login"),slideDirection=ref("right"),isRegistrationEnabled=computed(()=>settingsStore.isRegistrationEnabled),isEmailVerificationEnabled=computed(()=>settingsStore.isEmailVerificationEnabled),indicatorStyle=computed(()=>({transform:activeTab.value==="login"?"translateX(0)":"translateX(100%)"}));watch(activeTab,(nextTab,previousTab)=>{nextTab==="register"&&previousTab==="login"?slideDirection.value="right":nextTab==="login"&&previousTab==="register"&&(slideDirection.value="left")});const setActiveTab=tab=>{tab!==activeTab.value&&(activeTab.value=tab)},onRegisterSuccess=()=>{activeTab.value="login"},onLoginSuccess=()=>{},goToHome=()=>{router.replace("/")},showBackHomeButton=computed(()=>layoutStore.isTopLayout);return(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[_cache[9]||(_cache[9]=createStaticVNode('<div class="corner-decoration top-left" data-v-40401005></div><div class="corner-decoration top-right" data-v-40401005></div><div class="corner-decoration bottom-left" data-v-40401005></div><div class="corner-decoration bottom-right" data-v-40401005></div><div class="scan-line" data-v-40401005></div>',5)),createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[_cache[6]||(_cache[6]=createBaseVNode("div",{class:"logo-glow"},null,-1)),createBaseVNode("img",{src:_imports_0,alt:unref($t)("auth.panel.brandName"),class:"h-10 w-10"},null,8,_hoisted_4$1),createBaseVNode("h1",_hoisted_5$1,toDisplayString(unref($t)("auth.panel.brandName")),1)]),isRegistrationEnabled.value?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[createBaseVNode("button",{class:normalizeClass(["tab-button",{active:activeTab.value==="login"}]),onClick:_cache[0]||(_cache[0]=$event=>setActiveTab("login"))},toDisplayString(unref($t)("auth.panel.loginHeading")),3),createBaseVNode("button",{class:normalizeClass(["tab-button",{active:activeTab.value==="register"}]),onClick:_cache[1]||(_cache[1]=$event=>setActiveTab("register"))},toDisplayString(unref($t)("auth.panel.registerHeading")),3),createBaseVNode("div",{class:"active-indicator",style:normalizeStyle(indicatorStyle.value)},null,4)])])])):(openBlock(),createElementBlock("div",_hoisted_6,[_cache[7]||(_cache[7]=createBaseVNode("div",{class:"notice-icon"},[createBaseVNode("i",{class:"fas fa-lock text-brand-400"})],-1)),createBaseVNode("h2",_hoisted_7,toDisplayString(unref($t)("auth.panel.registrationDisabledTitle")),1),createBaseVNode("p",_hoisted_8,toDisplayString(unref($t)("auth.panel.registrationDisabledHint")),1)]))]),createBaseVNode("div",_hoisted_12,[isRegistrationEnabled.value?(openBlock(),createElementBlock("div",_hoisted_14,[createVNode(Transition,{name:"slide-"+slideDirection.value,mode:"out-in"},{default:withCtx(()=>[activeTab.value==="login"?(openBlock(),createBlock(LoginForm,{key:"login",class:"form-transition",onLoginSuccess,onSwitchToRegister:_cache[3]||(_cache[3]=$event=>setActiveTab("register")),onPasswordFocus:_cache[4]||(_cache[4]=$event=>emit("password-focus",$event))})):(openBlock(),createBlock(RegisterForm,{key:"register","email-verification-enabled":isEmailVerificationEnabled.value,class:"form-transition",onRegisterSuccess,onPasswordFocus:_cache[5]||(_cache[5]=$event=>emit("password-focus",$event))},null,8,["email-verification-enabled"]))]),_:1},8,["name"])])):(openBlock(),createElementBlock("div",_hoisted_13,[createVNode(LoginForm,{class:"form-transition",onLoginSuccess,onPasswordFocus:_cache[2]||(_cache[2]=$event=>emit("password-focus",$event))})]))]),showBackHomeButton.value?(openBlock(),createElementBlock("div",_hoisted_15,[createBaseVNode("button",{type:"button",class:"back-home-button",onClick:goToHome},[_cache[8]||(_cache[8]=createBaseVNode("span",{class:"button-icon"},[createBaseVNode("i",{class:"fas fa-arrow-left"})],-1)),createBaseVNode("span",_hoisted_16,toDisplayString(unref($t)("auth.page.backHome")),1)])])):createCommentVNode("",!0)]))}});const AuthPanel=_export_sfc(_sfc_main$1,[["__scopeId","data-v-40401005"]]),_hoisted_1={class:"auth-page"},_hoisted_2={class:"floating-particles"},_hoisted_3={class:"page-content"},_hoisted_4={class:"main-content"},_hoisted_5={class:"auth-panel-container"},_sfc_main=defineComponent({__name:"index",setup(__props){const isPasswordFocused=ref(!1),handlePasswordFocus=isFocused=>{isPasswordFocused.value=isFocused};return(_ctx,_cache)=>{const _component_CyberHomeBackground=__unplugin_components_0,_component_CyborgCharacter=__unplugin_components_1;return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_component_CyberHomeBackground,{"show-enhanced-effects":!0,"show-digital-rain":!1,"show-red-orb":!0,"show-aurora":!0}),createBaseVNode("div",_hoisted_2,[(openBlock(),createElementBlock(Fragment,null,renderList(8,i=>createBaseVNode("div",{key:i,class:"particle",style:normalizeStyle({"--delay":i*.5+"s","--duration":8+i*2+"s"})},null,4)),64))]),createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[_cache[0]||(_cache[0]=createStaticVNode('<div class="panel-glow-effect" data-v-202aff4b></div><div class="corner-lines" data-v-202aff4b><div class="corner-line top-left" data-v-202aff4b></div><div class="corner-line top-right" data-v-202aff4b></div><div class="corner-line bottom-left" data-v-202aff4b></div><div class="corner-line bottom-right" data-v-202aff4b></div></div>',2)),createVNode(_component_CyborgCharacter,{size:"medium",position:"top-left","cover-eyes":isPasswordFocused.value},null,8,["cover-eyes"]),_cache[1]||(_cache[1]=createStaticVNode('<div class="floating-tech-element left-top" data-v-202aff4b></div><div class="floating-tech-element right-bottom" data-v-202aff4b></div><div class="cyber-header-decoration" data-v-202aff4b><span class="cyber-line" data-v-202aff4b></span><span class="cyber-circle" data-v-202aff4b></span><span class="cyber-square" data-v-202aff4b></span></div><div class="scan-line-container" data-v-202aff4b><div class="scan-line" data-v-202aff4b></div></div>',4)),createVNode(AuthPanel,{onPasswordFocus:handlePasswordFocus})])])])])}}});const index=_export_sfc(_sfc_main,[["__scopeId","data-v-202aff4b"]]);export{index as default};
